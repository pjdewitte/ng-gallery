/*
 Copyright (c) 2013 Autodesk Inc.  Copyright (c) 2014 Autodesk Inc.  Copyright (c) 2014 Autodesk Inc.  Copyright (c) 2013 Autodesk Inc.  Copyright (c) 2013 Autodesk Inc.  Copyright (c) 2013 Autodesk Inc.  Copyright (c) 2013 Autodesk Inc.  Copyright (c) 2013 Autodesk Inc.  Copyright (c) 2014 Autodesk Inc.  Copyright (c) 2014 Autodesk Inc. */
var IS_CONCAT_BUILD=!0,BUILD_LMV_WORKER_URL="lmvworker.min.js",LMV_WORKER_URL=BUILD_LMV_WORKER_URL,ENABLE_DEBUG=!1,ENABLE_TRACE=!1,ENABLE_INLINE_WORKER=!0;AutodeskNamespace=function(a){var b=this;a=a.split(".");for(var c=0;c<a.length;++c)b[a[c]]=b[a[c]]||{},b=b[a[c]];return b};var _isIE11=!!navigator.userAgent.match(/Trident\/7\./);
"undefined"!==typeof window&&_isIE11&&function(){function a(a,c){c=c||{bubbles:!1,cancelable:!1,detail:void 0};var f=document.createEvent("CustomEvent");f.initCustomEvent(a,c.bubbles,c.cancelable,c.detail);return f}a.prototype=window.CustomEvent.prototype;window.CustomEvent=a}();
ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(a,b){!b||b>this.byteLength?b=this.byteLength:0>b&&(b=this.byteLength+b,0>b&&(b=0));0>a&&(a=this.byteLength+a,0>a&&(a=0));if(b<=a)return new ArrayBuffer;for(var c=b-a,f=new Uint8Array(this,a,c),d=new Uint8Array(c),g=0;g<c;g++)d[g]=f[g];return d.buffer});"undefined"!==typeof window&&(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);
function launchFullscreen(a,b){a.requestFullscreen?a.requestFullscreen(b):a.mozRequestFullScreen?a.mozRequestFullScreen(b):a.webkitRequestFullscreen?a.webkitRequestFullscreen(b):a.msRequestFullscreen&&a.msRequestFullscreen(b)}function exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}
function inFullscreen(){return document.fullscreenEnabled||document.mozFullScreenElement||document.webkitIsFullScreen||document.msFullscreenElement?!0:!1}function fullscreenElement(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function isFullscreenAvailable(a){return a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullscreen||a.msRequestFullscreen}
function getAndroidVersion(a){a=a||navigator.userAgent;return(a=a.match(/Android\s([0-9\.]*)/))?a[1]:!1}function isTouchDevice(){return"ontouchstart"in window}function isIOSDevice(){return/ip(ad|hone|od)/.test(navigator.userAgent.toLowerCase())}function isAndroidDevice(){return-1!==navigator.userAgent.toLowerCase().indexOf("android")}function isMobileDevice(){return isIOSDevice()||isAndroidDevice()}
function detectWebGL(){if(window.WebGLRenderingContext){for(var a=document.createElement("canvas"),b=["webgl","experimental-webgl","moz-webgl","webkit-3d"],c=!1,f=0;4>f;f++)try{if((c=a.getContext(b[f]))&&"function"===typeof c.getParameter)return 1}catch(d){}return 0}return-1}function touchStartToClick(a){a.preventDefault();a.stopPropagation();a.target.click()}(function(){var a="undefined"!==typeof window&&null!==window?window:self;a.performance||(a.performance=Date)})();
"undefined"!==typeof window&&!function(a,b,c,f){function d(a,b,c){return setTimeout(q(a,c),b)}function g(a,b,c){return Array.isArray(a)?(h(a,c[b],c),!0):!1}function h(a,b,c){var g;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==f)for(g=0;g<a.length;)b.call(c,a[g],g,a),g++;else for(g in a)a.hasOwnProperty(g)&&b.call(c,a[g],g,a)}function k(a,b,c){for(var g=Object.keys(b),d=0;d<g.length;)(!c||c&&a[g[d]]===f)&&(a[g[d]]=b[g[d]]),d++;return a}function l(a,b){return k(a,b,!0)}function n(a,b,c){var g=
b.prototype;b=a.prototype=Object.create(g);b.constructor=a;b._super=g;c&&k(b,c)}function q(a,b){return function(){return a.apply(b,arguments)}}function m(a,b){return typeof a==sa?a.apply(b?b[0]||f:f,b):a}function p(a,b,c){h(B(b),function(b){a.addEventListener(b,c,!1)})}function t(a,b,c){h(B(b),function(b){a.removeEventListener(b,c,!1)})}function r(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function B(a){return a.trim().split(/\s+/g)}function z(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);
for(var g=0;g<a.length;){if(c&&a[g][c]==b||!c&&a[g]===b)return g;g++}return-1}function F(a){return Array.prototype.slice.call(a,0)}function C(a,b,c){for(var g=[],d=[],h=0;h<a.length;){var f=b?a[h][b]:a[h];0>z(d,f)&&g.push(a[h]);d[h]=f;h++}return c&&(g=b?g.sort(function(a,c){return a[b]>c[b]}):g.sort()),g}function w(a,b){for(var c,g,d=b[0].toUpperCase()+b.slice(1),h=0;h<za.length;){if(c=za[h],g=c?c+d:b,g in a)return g;h++}return f}function E(a){a=a.ownerDocument;return a.defaultView||a.parentWindow}
function A(a,b){var c=this;this.manager=a;this.callback=b;this.element=a.element;this.target=a.options.inputTarget;this.domHandler=function(b){m(a.options.enable,[a])&&c.handler(b)};this.init()}function D(a){var b=a.options.inputClass;return new (b?b:Ca?P:Ea?Y:Ga?Z:L)(a,I)}function I(a,b,c){var g=c.pointers.length,d=c.changedPointers.length,h=b&oa&&0===g-d,g=b&(na|ga)&&0===g-d;c.isFirst=!!h;c.isFinal=!!g;h&&(a.session={});c.eventType=b;b=a.session;h=c.pointers;g=h.length;b.firstInput||(b.firstInput=
G(c));1<g&&!b.firstMultiple?b.firstMultiple=G(c):1===g&&(b.firstMultiple=!1);var d=b.firstInput,k=(g=b.firstMultiple)?g.center:d.center,l=c.center=H(h);c.timeStamp=xa();c.deltaTime=c.timeStamp-d.timeStamp;c.angle=M(k,l);c.distance=J(k,l);var d=c.center,k=b.offsetDelta||{},l=b.prevDelta||{},n=b.prevInput||{};(c.eventType===oa||n.eventType===na)&&(l=b.prevDelta={x:n.deltaX||0,y:n.deltaY||0},k=b.offsetDelta={x:d.x,y:d.y});c.deltaX=l.x+(d.x-k.x);c.deltaY=l.y+(d.y-k.y);c.offsetDirection=K(c.deltaX,c.deltaY);
g?(d=g.pointers,d=J(h[0],h[1],Ya)/J(d[0],d[1],Ya)):d=1;c.scale=d;g?(g=g.pointers,h=M(h[1],h[0],Ya)-M(g[1],g[0],Ya)):h=0;c.rotation=h;l=b.lastInterval||c;h=c.timeStamp-l.timeStamp;c.eventType!=ga&&(h>Ma||l.velocity===f)?(d=l.deltaX-c.deltaX,l=l.deltaY-c.deltaY,k={x:d/h||0,y:l/h||0},h=k.x,g=k.y,k=Ba(k.x)>Ba(k.y)?k.x:k.y,d=K(d,l),b.lastInterval=c):(k=l.velocity,h=l.velocityX,g=l.velocityY,d=l.direction);c.velocity=k;c.velocityX=h;c.velocityY=g;c.direction=d;b=a.element;r(c.srcEvent.target,b)&&(b=c.srcEvent.target);
c.target=b;a.emit("hammer.input",c);a.recognize(c);a.session.prevInput=c}function G(a){for(var b=[],c=0;c<a.pointers.length;)b[c]={clientX:va(a.pointers[c].clientX),clientY:va(a.pointers[c].clientY)},c++;return{timeStamp:xa(),pointers:b,center:H(b),deltaX:a.deltaX,deltaY:a.deltaY}}function H(a){var b=a.length;if(1===b)return{x:va(a[0].clientX),y:va(a[0].clientY)};for(var c=0,g=0,d=0;b>d;)c+=a[d].clientX,g+=a[d].clientY,d++;return{x:va(c/b),y:va(g/b)}}function K(a,b){return a===b?ma:Ba(a)>=Ba(b)?0<
a?ya:Oa:0<b?v:Ia}function J(a,b,c){c||(c=bb);var g=b[c[0]]-a[c[0]];a=b[c[1]]-a[c[1]];return Math.sqrt(g*g+a*a)}function M(a,b,c){c||(c=bb);return 180*Math.atan2(b[c[1]]-a[c[1]],b[c[0]]-a[c[0]])/Math.PI}function L(){this.evEl=ja;this.evWin=Wa;this.allow=!0;this.pressed=!1;A.apply(this,arguments)}function P(){this.evEl=Za;this.evWin=Xa;A.apply(this,arguments);this.store=this.manager.session.pointerEvents=[]}function S(){this.evTarget=hb;this.evWin=$a;this.started=!1;A.apply(this,arguments)}function Y(){this.evTarget=
nb;this.targetIds={};A.apply(this,arguments)}function U(a,b){var c=F(a.touches),g=this.targetIds;if(b&(oa|qa)&&1===c.length)return g[c[0].identifier]=!0,[c,c];var d,h=F(a.changedTouches),f=[],k=this.target;if(d=c.filter(function(a){return r(a.target,k)}),b===oa)for(c=0;c<d.length;)g[d[c].identifier]=!0,c++;for(c=0;c<h.length;)g[h[c].identifier]&&f.push(h[c]),b&(na|ga)&&delete g[h[c].identifier],c++;return f.length?[C(d.concat(f),"identifier",!0),f]:void 0}function Z(){A.apply(this,arguments);var a=
q(this.handler,this);this.touch=new Y(this.manager,a);this.mouse=new L(this.manager,a)}function da(a,b){this.manager=a;this.set(b)}function V(a){if(-1<a.indexOf(Ka))return Ka;var b=-1<a.indexOf(Sa),c=-1<a.indexOf(Pa);return b&&c?Sa+" "+Pa:b||c?b?Sa:Pa:-1<a.indexOf(Ta)?Ta:Qa}function O(a){this.id=Ja++;this.manager=null;this.options=l(a||{},this.defaults);a=this.options.enable;this.options.enable=a===f?!0:a;this.state=Ua;this.simultaneous={};this.requireFail=[]}function ca(a){return a==Ia?"down":a==
v?"up":a==ya?"left":a==Oa?"right":""}function W(a,b){var c=b.manager;return c?c.get(a):a}function N(){O.apply(this,arguments)}function ea(){N.apply(this,arguments);this.pY=this.pX=null}function ba(){N.apply(this,arguments)}function fa(){O.apply(this,arguments);this._input=this._timer=null}function X(){N.apply(this,arguments)}function ia(){N.apply(this,arguments)}function aa(){O.apply(this,arguments);this.pCenter=this.pTime=!1;this._input=this._timer=null;this.count=0}function R(a,b){b=b||{};var c=
b.recognizers;return b.recognizers=c===f?R.defaults.preset:c,new pa(a,b)}function pa(a,b){b=b||{};this.options=l(b,R.defaults);this.options.inputTarget=this.options.inputTarget||a;this.handlers={};this.session={};this.recognizers=[];this.element=a;this.input=D(this);this.touchAction=new da(this,this.options.touchAction);ha(this,!0);h(b.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]);a[3]&&b.requireFailure(a[3])},this)}function ha(a,b){var c=a.element;h(a.options.cssProps,
function(a,g){c.style[w(c.style,g)]=b?a:""})}function la(a,c){var g=b.createEvent("Event");g.initEvent(a,!0,!0);g.gesture=c;c.target.dispatchEvent(g)}var za=" webkit moz MS ms o".split(" "),Na=b.createElement("div"),sa="function",va=Math.round,Ba=Math.abs,xa=Date.now,Ja=1,Ha=/mobile|tablet|ip(ad|hone|od)|android/i,Ga="ontouchstart"in a,Ca=w(a,"PointerEvent")!==f,Ea=Ga&&Ha.test(navigator.userAgent),Ma=25,oa=1,qa=2,na=4,ga=8,ma=1,ya=2,Oa=4,v=8,Ia=16,Da=ya|Oa,Aa=v|Ia,Ha=Da|Aa,bb=["x","y"],Ya=["clientX",
"clientY"];A.prototype={handler:function(){},init:function(){this.evEl&&p(this.element,this.evEl,this.domHandler);this.evTarget&&p(this.target,this.evTarget,this.domHandler);this.evWin&&p(E(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&t(this.element,this.evEl,this.domHandler);this.evTarget&&t(this.target,this.evTarget,this.domHandler);this.evWin&&t(E(this.element),this.evWin,this.domHandler)}};var ka={mousedown:oa,mousemove:qa,mouseup:na},ja="mousedown",Wa="mousemove mouseup";
n(L,A,{handler:function(a){var b=ka[a.type];b&oa&&0===a.button&&(this.pressed=!0);b&qa&&1!==a.which&&(b=na);this.pressed&&this.allow&&(b&na&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:"mouse",srcEvent:a}))}});var cb={pointerdown:oa,pointermove:qa,pointerup:na,pointercancel:ga,pointerout:ga},db={2:"touch",3:"pen",4:"mouse",5:"kinect"},Za="pointerdown",Xa="pointermove pointerup pointercancel";a.MSPointerEvent&&(Za="MSPointerDown",Xa="MSPointerMove MSPointerUp MSPointerCancel");
n(P,A,{handler:function(a){var b=this.store,c=!1,g=a.type.toLowerCase().replace("ms",""),g=cb[g],d=db[a.pointerType]||a.pointerType,h="touch"==d,f=z(b,a.pointerId,"pointerId");g&oa&&(0===a.button||h)?0>f&&(b.push(a),f=b.length-1):g&(na|ga)&&(c=!0);0>f||(b[f]=a,this.callback(this.manager,g,{pointers:b,changedPointers:[a],pointerType:d,srcEvent:a}),c&&b.splice(f,1))}});var ob={touchstart:oa,touchmove:qa,touchend:na,touchcancel:ga},hb="touchstart",$a="touchstart touchmove touchend touchcancel";n(S,A,
{handler:function(a){var b=ob[a.type];if(b===oa&&(this.started=!0),this.started){var c,g=F(a.touches);c=F(a.changedTouches);c=(b&(na|ga)&&(g=C(g.concat(c),"identifier",!0)),[g,c]);b&(na|ga)&&0===c[0].length-c[1].length&&(this.started=!1);this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:"touch",srcEvent:a})}}});var eb={touchstart:oa,touchmove:qa,touchend:na,touchcancel:ga},nb="touchstart touchmove touchend touchcancel";n(Y,A,{handler:function(a){var b=eb[a.type],c=U.call(this,
a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:"touch",srcEvent:a})}});n(Z,A,{handler:function(a,b,c){var g="mouse"==c.pointerType;if("touch"==c.pointerType)this.mouse.allow=!1;else if(g&&!this.mouse.allow)return;b&(na|ga)&&(this.mouse.allow=!0);this.callback(a,b,c)},destroy:function(){this.touch.destroy();this.mouse.destroy()}});var fb=w(Na.style,"touchAction"),ib=fb!==f,Qa="auto",Ta="manipulation",Ka="none",Sa="pan-x",Pa="pan-y";da.prototype={set:function(a){"compute"==
a&&(a=this.compute());ib&&(this.manager.element.style[fb]=a);this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return h(this.manager.recognizers,function(b){m(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),V(a.join(" "))},preventDefaults:function(a){if(!ib){var b=a.srcEvent;a=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var c=this.actions,g=-1<c.indexOf(Ka),d=-1<c.indexOf(Pa),
c=-1<c.indexOf(Sa);return g||d&&a&Da||c&&a&Aa?this.preventSrc(b):void 0}},preventSrc:function(a){this.manager.session.prevented=!0;a.preventDefault()}};var Ua=1;O.prototype={defaults:{},set:function(a){return k(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(g(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=W(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return g(a,"dropRecognizeWith",
this)?this:(a=W(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(g(a,"requireFailure",this))return this;var b=this.requireFail;return a=W(a,this),-1===z(b,a)&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(g(a,"dropRequireFailure",this))return this;a=W(a,this);a=z(this.requireFail,a);return-1<a&&this.requireFail.splice(a,1),this},hasRequireFailures:function(){return 0<this.requireFail.length},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},
emit:function(a){function b(d){c.manager.emit(c.options.event+(d?g&16?"cancel":g&8?"end":g&4?"move":g&2?"start":"":""),a)}var c=this,g=this.state;8>g&&b(!0);b();8<=g&&b(!0)},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=32)},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(32|Ua)))return!1;a++}return!0},recognize:function(a){a=k({},a);return m(this.options.enable,[this,a])?(this.state&56&&(this.state=Ua),this.state=this.process(a),
void(this.state&30&&this.tryEmit(a))):(this.reset(),void(this.state=32))},process:function(){},getTouchAction:function(){},reset:function(){}};n(N,O,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,g=b&6;a=this.attrTest(a);return g&&(c&ga||!a)?b|16:g||a?c&na?b|8:b&2?b|4:2:32}});n(ea,N,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ha},getTouchAction:function(){var a=this.options.direction,
b=[];return a&Da&&b.push(Pa),a&Aa&&b.push(Sa),b},directionTest:function(a){var b=this.options,c=!0,g=a.distance,d=a.direction,h=a.deltaX,f=a.deltaY;return d&b.direction||(b.direction&Da?(d=0===h?ma:0>h?ya:Oa,c=h!=this.pX,g=Math.abs(a.deltaX)):(d=0===f?ma:0>f?v:Ia,c=f!=this.pY,g=Math.abs(a.deltaY))),a.direction=d,c&&g>b.threshold&&d&b.direction},attrTest:function(a){return N.prototype.attrTest.call(this,a)&&(this.state&2||!(this.state&2)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX;this.pY=
a.deltaY;var b=ca(a.direction);b&&this.manager.emit(this.options.event+b,a);this._super.emit.call(this,a)}});n(ba,N,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ka]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&2)},emit:function(a){(this._super.emit.call(this,a),1!==a.scale)&&this.manager.emit(this.options.event+(1>a.scale?"in":"out"),a)}});n(fa,O,{defaults:{event:"press",pointers:1,time:500,
threshold:5},getTouchAction:function(){return[Qa]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,g=a.distance<b.threshold,h=a.deltaTime>b.time;if(this._input=a,!g||!c||a.eventType&(na|ga)&&!h)this.reset();else if(a.eventType&oa)this.reset(),this._timer=d(function(){this.state=8;this.tryEmit()},b.time,this);else if(a.eventType&na)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(a){8===this.state&&(a&&a.eventType&na?this.manager.emit(this.options.event+
"up",a):(this._input.timeStamp=xa(),this.manager.emit(this.options.event,this._input)))}});n(X,N,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ka]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&2)}});n(ia,N,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:Da|Aa,pointers:1},getTouchAction:function(){return ea.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;
return c&(Da|Aa)?b=a.velocity:c&Da?b=a.velocityX:c&Aa&&(b=a.velocityY),this._super.attrTest.call(this,a)&&c&a.direction&&a.distance>this.options.threshold&&Ba(b)>this.options.velocity&&a.eventType&na},emit:function(a){var b=ca(a.direction);b&&this.manager.emit(this.options.event+b,a);this.manager.emit(this.options.event,a)}});n(aa,O,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[Ta]},process:function(a){var b=this.options,
c=a.pointers.length===b.pointers,g=a.distance<b.threshold,h=a.deltaTime<b.time;if(this.reset(),a.eventType&oa&&0===this.count)return this.failTimeout();if(g&&h&&c){if(a.eventType!=na)return this.failTimeout();c=this.pTime?a.timeStamp-this.pTime<b.interval:!0;g=!this.pCenter||J(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp;this.pCenter=a.center;g&&c?this.count+=1:this.count=1;this._input=a;if(0===this.count%b.taps)return this.hasRequireFailures()?(this._timer=d(function(){this.state=
8;this.tryEmit()},b.interval,this),2):8}return 32},failTimeout:function(){return this._timer=d(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});R.VERSION="2.0.4";R.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[X,{enable:!1}],[ba,{enable:!1},["rotate"]],[ia,{direction:Da}],[ea,{direction:Da},
["swipe"]],[aa],[aa,{event:"doubletap",taps:2},["tap"]],[fa]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};pa.prototype={set:function(a){return k(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this},stop:function(a){this.session.stopped=a?2:1},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);
var c,g=this.recognizers,d=b.curRecognizer;(!d||d&&d.state&8)&&(d=b.curRecognizer=null);for(var h=0;h<g.length;)c=g[h],2===b.stopped||d&&c!=d&&!c.canRecognizeWith(d)?c.reset():c.recognize(a),!d&&c.state&14&&(d=b.curRecognizer=c),h++}},get:function(a){if(a instanceof O)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(g(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),
a.manager=this,this.touchAction.update(),a},remove:function(a){if(g(a,"remove",this))return this;var b=this.recognizers;return a=this.get(a),b.splice(z(b,a),1),this.touchAction.update(),this},on:function(a,b){var c=this.handlers;return h(B(a),function(a){c[a]=c[a]||[];c[a].push(b)}),this},off:function(a,b){var c=this.handlers;return h(B(a),function(a){b?c[a].splice(z(c[a],b),1):delete c[a]}),this},emit:function(a,b){this.options.domEvents&&la(a,b);var c=this.handlers[a]&&this.handlers[a].slice();
if(c&&c.length){b.type=a;b.preventDefault=function(){b.srcEvent.preventDefault()};for(var g=0;g<c.length;)c[g](b),g++}},destroy:function(){this.element&&ha(this,!1);this.handlers={};this.session={};this.input.destroy();this.element=null}};k(R,{INPUT_START:oa,INPUT_MOVE:qa,INPUT_END:na,INPUT_CANCEL:ga,STATE_POSSIBLE:Ua,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:ma,DIRECTION_LEFT:ya,DIRECTION_RIGHT:Oa,DIRECTION_UP:v,DIRECTION_DOWN:Ia,
DIRECTION_HORIZONTAL:Da,DIRECTION_VERTICAL:Aa,DIRECTION_ALL:Ha,Manager:pa,Input:A,TouchAction:da,TouchInput:Y,MouseInput:L,PointerEventInput:P,TouchMouseInput:Z,SingleTouchInput:S,Recognizer:O,AttrRecognizer:N,Tap:aa,Pan:ea,Swipe:ia,Pinch:ba,Rotate:X,Press:fa,on:p,off:t,each:h,merge:l,extend:k,inherit:n,bindFn:q,prefixed:w});a[c]=R}(window,document,"Hammer");
function init_three_dds_loader(){THREE.DDSLoader=function(){this._parser=THREE.DDSLoader.parse};THREE.DDSLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype);THREE.DDSLoader.prototype.constructor=THREE.DDSLoader;THREE.DDSLoader.parse=function(a,b){function c(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function f(a,b,c,g){var d=c*g*4;a=new Uint8Array(a,b,d);for(var d=new Uint8Array(d),h=b=0,f=0;f<g;f++)for(var k=0;k<c;k++){var l=a[h];
h++;var n=a[h];h++;var m=a[h];h++;var t=a[h];h++;d[b]=m;b++;d[b]=n;b++;d[b]=l;b++;d[b]=t;b++}return d}var d={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},g=c("DXT1"),h=c("DXT3"),k=c("DXT5"),l=new Int32Array(a,0,31);if(542327876!==l[0])return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),d;if(!l[20]&4)return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),d;var n=l[21],q=!1;switch(n){case g:g=8;d.format=THREE.RGB_S3TC_DXT1_Format;
break;case h:g=16;d.format=THREE.RGBA_S3TC_DXT3_Format;break;case k:g=16;d.format=THREE.RGBA_S3TC_DXT5_Format;break;default:if(32==l[22]&&l[23]&16711680&&l[24]&65280&&l[25]&255&&l[26]&4278190080)q=!0,g=64,d.format=THREE.RGBAFormat;else return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",String.fromCharCode(n&255,n>>8&255,n>>16&255,n>>24&255)),d}d.mipmapCount=1;l[2]&131072&&!1!==b&&(d.mipmapCount=Math.max(1,l[7]));d.isCubemap=l[28]&512?!0:!1;d.width=l[4];d.height=l[3];for(var l=
l[1]+4,h=d.width,k=d.height,n=d.isCubemap?6:1,m=0;m<n;m++){for(var p=0;p<d.mipmapCount;p++){if(q)var t=f(a,l,h,k),r=t.length;else r=Math.max(4,h)/4*Math.max(4,k)/4*g,t=new Uint8Array(a,l,r);d.mipmaps.push({data:t,width:h,height:k});l+=r;h=Math.max(.5*h,1);k=Math.max(.5*k,1)}h=d.width;k=d.height}return d}}
!function(a){var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self);b.lmv_poly2tri=a()}(function(){return function b(c,f,d){function g(k,n){if(!f[k]){if(!c[k]){var q="function"==typeof require&&require;if(!n&&q)return q(k,!0);if(h)return h(k,!0);throw Error("Cannot find module '"+k+"'");}q=f[k]={exports:{}};c[k][0].call(q.exports,function(b){var d=c[k][1][b];return g(d?d:b)},q,q.exports,b,c,f,d)}return f[k].exports}for(var h="function"==typeof require&&
require,k=0;k<d.length;k++)g(d[k]);return g}({1:[function(b,c,f){c.exports={version:"1.3.5"}},{}],2:[function(b,c,f){b=function(b,c){this.head_=b;this.tail_=c;this.search_node_=b};b.prototype.head=function(){return this.head_};b.prototype.setHead=function(b){this.head_=b};b.prototype.tail=function(){return this.tail_};b.prototype.setTail=function(b){this.tail_=b};b.prototype.search=function(){return this.search_node_};b.prototype.setSearch=function(b){this.search_node_=b};b.prototype.findSearchNode=
function(){return this.search_node_};b.prototype.locateNode=function(b){var c=this.search_node_;if(b<c.value)for(;c=c.prev;){if(b>=c.value)return this.search_node_=c}else for(;c=c.next;)if(b<c.value)return this.search_node_=c.prev;return null};b.prototype.locatePoint=function(b){var c=b.x,h=this.findSearchNode(c),f=h.point.x;if(c===f){if(b!==h.point)if(b===h.prev.point)h=h.prev;else if(b===h.next.point)h=h.next;else throw Error("poly2tri Invalid AdvancingFront.locatePoint() call");}else if(c<f)for(;(h=
h.prev)&&b!==h.point;);else for(;(h=h.next)&&b!==h.point;);h&&(this.search_node_=h);return h};c.exports=b;c.exports.Node=function(b,c){this.point=b;this.triangle=c||null;this.prev=this.next=null;this.value=b.x}},{}],3:[function(b,c,f){c.exports=function(b,c){if(!b)throw Error(c||"Assert Failed");}},{}],4:[function(b,c,f){var d=b("./xy"),g=function(b,c){this.x=+b||0;this.y=+c||0;this._p2t_edge_list=null};g.prototype.toString=function(){return d.toStringBase(this)};g.prototype.toJSON=function(){return{x:this.x,
y:this.y}};g.prototype.clone=function(){return new g(this.x,this.y)};g.prototype.set_zero=function(){this.y=this.x=0;return this};g.prototype.set=function(b,c){this.x=+b||0;this.y=+c||0;return this};g.prototype.negate=function(){this.x=-this.x;this.y=-this.y;return this};g.prototype.add=function(b){this.x+=b.x;this.y+=b.y;return this};g.prototype.sub=function(b){this.x-=b.x;this.y-=b.y;return this};g.prototype.mul=function(b){this.x*=b;this.y*=b;return this};g.prototype.length=function(){return Math.sqrt(this.x*
this.x+this.y*this.y)};g.prototype.normalize=function(){var b=this.length();this.x/=b;this.y/=b;return b};g.prototype.equals=function(b){return this.x===b.x&&this.y===b.y};g.negate=function(b){return new g(-b.x,-b.y)};g.add=function(b,c){return new g(b.x+c.x,b.y+c.y)};g.sub=function(b,c){return new g(b.x-c.x,b.y-c.y)};g.mul=function(b,c){return new g(b*c.x,b*c.y)};g.cross=function(b,c){return"number"===typeof b?"number"===typeof c?b*c:new g(-b*c.y,b*c.x):"number"===typeof c?new g(c*b.y,-c*b.x):b.x*
c.y-b.y*c.x};g.toString=d.toString;g.compare=d.compare;g.cmp=d.compare;g.equals=d.equals;g.dot=function(b,c){return b.x*c.x+b.y*c.y};c.exports=g},{"./xy":11}],5:[function(b,c,f){var d=b("./xy");b=function(b,c){this.name="PointError";this.points=c=c||[];this.message=b||"Invalid Points!";for(var f=0;f<c.length;f++)this.message+=" "+d.toString(c[f])};b.prototype=Error();b.prototype.constructor=b;c.exports=b},{"./xy":11}],6:[function(b,c,f){(function(c){var g=c.poly2tri;f.noConflict=function(){c.poly2tri=
g;return f};f.VERSION=b("../dist/version.json").version;f.PointError=b("./pointerror");f.Point=b("./point");f.Triangle=b("./triangle");f.SweepContext=b("./sweepcontext");var h=b("./sweep");f.triangulate=h.triangulate;f.sweep={Triangulate:h.triangulate}}).call(this,"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(b,c,f){function d(b,c,h,f,k){if(!g(f,c,h)){var l=f.pointCCW(k),
n=H(h,l,c);if(n===G.COLLINEAR)throw new E("poly2tri EdgeEvent: Collinear not supported!",[h,l,c]);var l=f.pointCW(k),m=H(h,l,c);if(m===G.COLLINEAR)throw new E("poly2tri EdgeEvent: Collinear not supported!",[h,l,c]);n===m?(f=n===G.CW?f.neighborCCW(k):f.neighborCW(k),d(b,c,h,f,k)):z(b,c,h,f,k)}}function g(b,c,g){var d=b.edgeIndex(c,g);return-1!==d?(b.markConstrainedEdgeByIndex(d),(b=b.getNeighbor(d))&&b.markConstrainedEdgeByPoints(c,g),!0):!1}function h(b,c){var g=new A(c.prev.point,c.point,c.next.point);
g.markNeighbor(c.prev.triangle);g.markNeighbor(c.triangle);b.addToMap(g);c.prev.next=c.next;c.next.prev=c.prev;k(b,g)||b.mapTriangleToNodes(g)}function k(b,c){for(var g=0;3>g;++g)if(!c.delaunay_edge[g]){var d=c.getNeighbor(g);if(d){var h=c.getPoint(g),f=d.oppositePoint(c,h),n=d.index(f);if(d.constrained_edge[n]||d.delaunay_edge[n])c.constrained_edge[g]=d.constrained_edge[n];else{var m;var t=c.pointCCW(h),q=c.pointCW(h);m=h.x-f.x;var p=h.y-f.y,r=t.x-f.x,t=t.y-f.y,z=m*t-r*p;if(0>=z)m=!1;else{var w=
q.x-f.x,q=q.y-f.y,C=w*p-m*q;m=0>=C?!1:0<(m*m+p*p)*(r*q-w*t)+(r*r+t*t)*C+(w*w+q*q)*z}if(m)return c.delaunay_edge[g]=!0,d.delaunay_edge[n]=!0,l(c,h,d,f),(h=!k(b,c))&&b.mapTriangleToNodes(c),(h=!k(b,d))&&b.mapTriangleToNodes(d),c.delaunay_edge[g]=!1,d.delaunay_edge[n]=!1,!0}}}return!1}function l(b,c,g,d){var h,f,k,l;h=b.neighborCCW(c);f=b.neighborCW(c);k=g.neighborCCW(d);l=g.neighborCW(d);var n,m,t,q;n=b.getConstrainedEdgeCCW(c);m=b.getConstrainedEdgeCW(c);t=g.getConstrainedEdgeCCW(d);q=g.getConstrainedEdgeCW(d);
var p,r,z,w;p=b.getDelaunayEdgeCCW(c);r=b.getDelaunayEdgeCW(c);z=g.getDelaunayEdgeCCW(d);w=g.getDelaunayEdgeCW(d);b.legalize(c,d);g.legalize(d,c);g.setDelaunayEdgeCCW(c,p);b.setDelaunayEdgeCW(c,r);b.setDelaunayEdgeCCW(d,z);g.setDelaunayEdgeCW(d,w);g.setConstrainedEdgeCCW(c,n);b.setConstrainedEdgeCW(c,m);b.setConstrainedEdgeCCW(d,t);g.setConstrainedEdgeCW(d,q);b.clearNeighbors();g.clearNeighbors();h&&g.markNeighbor(h);f&&b.markNeighbor(f);k&&b.markNeighbor(k);l&&g.markNeighbor(l);b.markNeighbor(g)}
function n(b,c){var g;g=b.basin.width>(b.basin.left_highest?b.basin.left_node.point.y-c.point.y:b.basin.right_node.point.y-c.point.y)?!0:!1;if(!g&&(h(b,c),c.prev!==b.basin.left_node||c.next!==b.basin.right_node)){if(c.prev===b.basin.left_node){g=H(c.point,c.next.point,c.next.next.point);if(g===G.CW)return;c=c.next}else if(c.next===b.basin.right_node){g=H(c.point,c.prev.point,c.prev.prev.point);if(g===G.CCW)return;c=c.prev}else c=c.prev.point.y<c.next.point.y?c.prev:c.next;n(b,c)}}function q(b,c,g){g.point.x<
c.p.x&&(H(g.point,g.next.point,g.next.next.point)===G.CCW?m(b,c,g):(p(b,c,g),q(b,c,g)))}function m(b,c,g){h(b,g.next);g.next.point!==c.p&&H(c.q,g.next.point,c.p)===G.CCW&&H(g.point,g.next.point,g.next.next.point)===G.CCW&&m(b,c,g)}function p(b,c,g){H(g.next.point,g.next.next.point,g.next.next.next.point)===G.CCW?m(b,c,g.next):H(c.q,g.next.next.point,c.p)===G.CCW&&p(b,c,g.next)}function t(b,c,g){g.point.x>c.p.x&&(H(g.point,g.prev.point,g.prev.prev.point)===G.CW?B(b,c,g):(r(b,c,g),t(b,c,g)))}function r(b,
c,g){H(g.prev.point,g.prev.prev.point,g.prev.prev.prev.point)===G.CW?B(b,c,g.prev):H(c.q,g.prev.prev.point,c.p)===G.CW&&r(b,c,g.prev)}function B(b,c,g){h(b,g.prev);g.prev.point!==c.p&&H(c.q,g.prev.point,c.p)===G.CW&&H(g.point,g.prev.point,g.prev.prev.point)===G.CW&&B(b,c,g)}function z(b,c,g,h,f){var n=h.neighborAcross(f);w(n,"FLIP failed due to missing triangle!");var m=n.oppositePoint(h,f);if(h.getConstrainedEdgeAcross(f))throw b=h.index(f),new E("poly2tri Intersecting Constraints",[f,m,h.getPoint((b+
1)%3),h.getPoint((b+2)%3)]);if(K(f,h.pointCCW(f),h.pointCW(f),m))if(l(h,f,n,m),b.mapTriangleToNodes(h),b.mapTriangleToNodes(n),f===g&&m===c)g===b.edge_event.constrained_edge.q&&c===b.edge_event.constrained_edge.p&&(h.markConstrainedEdgeByPoints(c,g),n.markConstrainedEdgeByPoints(c,g),k(b,h),k(b,n));else{var t=H(g,m,c);t===G.CCW?(m=n.edgeIndex(f,m),n.delaunay_edge[m]=!0,k(b,n),n.clearDelaunayEdges()):(m=h.edgeIndex(f,m),h.delaunay_edge[m]=!0,k(b,h),h.clearDelaunayEdges(),h=n);z(b,c,g,h,f)}else m=F(c,
g,n,m),C(b,c,g,h,n,m),d(b,c,g,h,f)}function F(b,c,g,d){var h=H(c,d,b);if(h===G.CW)return g.pointCCW(d);if(h===G.CCW)return g.pointCW(d);throw new E("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[c,d,b]);}function C(b,c,g,d,h,f){var k=h.neighborAcross(f);w(k,"FLIP failed due to missing triangle");h=k.oppositePoint(h,f);K(g,d.pointCCW(g),d.pointCW(g),h)?z(b,g,h,k,h):(h=F(c,g,k,h),C(b,c,g,d,k,h))}var w=b("./assert"),E=b("./pointerror"),A=b("./triangle"),D=b("./advancingfront").Node;
b=b("./utils");var I=b.EPSILON,G=b.Orientation,H=b.orient2d,K=b.inScanArea,J=b.isAngleObtuse;f.triangulate=function(b){b.initTriangulation();b.createAdvancingFront();var c,f=b.pointCount();for(c=1;c<f;++c){var l=b.getPoint(c),m;m=b;var p=l,r=m.locateNode(p),z=void 0,z=new A(p,r.point,r.next.point);z.markNeighbor(r.triangle);m.addToMap(z);var C=new D(p);C.next=r.next;C.prev=r;r.next.prev=C;r.next=C;k(m,z)||m.mapTriangleToNodes(z);z=C;p.x<=r.point.x+I&&h(m,r);for(p=z.next;p.next&&!J(p.point,p.next.point,
p.prev.point);)h(m,p),p=p.next;for(p=z.prev;p.prev&&!J(p.point,p.next.point,p.prev.point);)h(m,p),p=p.prev;if(z.next&&z.next.next&&(p=z.point.x-z.next.next.point.x,r=z.point.y-z.next.next.point.y,w(0<=r,"unordered y"),0<=p||Math.abs(p)<r)){p=z;H(p.point,p.next.point,p.next.next.point)===G.CCW?m.basin.left_node=p.next.next:m.basin.left_node=p.next;for(m.basin.bottom_node=m.basin.left_node;m.basin.bottom_node.next&&m.basin.bottom_node.point.y>=m.basin.bottom_node.next.point.y;)m.basin.bottom_node=m.basin.bottom_node.next;
if(m.basin.bottom_node!==m.basin.left_node){for(m.basin.right_node=m.basin.bottom_node;m.basin.right_node.next&&m.basin.right_node.point.y<m.basin.right_node.next.point.y;)m.basin.right_node=m.basin.right_node.next;m.basin.right_node!==m.basin.bottom_node&&(m.basin.width=m.basin.right_node.point.x-m.basin.left_node.point.x,m.basin.left_highest=m.basin.left_node.point.y>m.basin.right_node.point.y,n(m,m.basin.bottom_node))}}m=z;l=l._p2t_edge_list;for(z=0;l&&z<l.length;++z)if(p=b,r=l[z],C=m,p.edge_event.constrained_edge=
r,p.edge_event.right=r.p.x>r.q.x,!g(C.triangle,r.p,r.q)){if(p.edge_event.right)for(var F=p,E=r,B=C;B.next.point.x<E.p.x;)H(E.q,B.next.point,E.p)===G.CCW?q(F,E,B):B=B.next;else for(F=p,E=r,B=C;B.prev.point.x>E.p.x;)H(E.q,B.prev.point,E.p)===G.CW?t(F,E,B):B=B.prev;d(p,r.p,r.q,C.triangle,r.q)}}c=b.front().head().next.triangle;for(f=b.front().head().next.point;!c.getConstrainedEdgeCW(f);)c=c.neighborCCW(f);b.meshClean(c)}},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],
8:[function(b,c,f){var d=b("./pointerror"),g=b("./point"),h=b("./triangle"),k=b("./sweep"),l=b("./advancingfront"),n=l.Node,q=function(b,c){this.p=b;this.q=c;if(b.y>c.y)this.q=b,this.p=c;else if(b.y===c.y)if(b.x>c.x)this.q=b,this.p=c;else if(b.x===c.x)throw new d("poly2tri Invalid Edge constructor: repeated points!",[b]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]);this.q._p2t_edge_list.push(this)},m=function(){this.right_node=this.bottom_node=this.left_node=null;this.width=0;this.left_highest=
!1};m.prototype.clear=function(){this.right_node=this.bottom_node=this.left_node=null;this.width=0;this.left_highest=!1};var p=function(){this.constrained_edge=null;this.right=!1};b=function(b,c){c=c||{};this.triangles_=[];this.map_=[];this.points_=c.cloneArrays?b.slice(0):b;this.edge_list=[];this.af_tail_=this.af_middle_=this.af_head_=this.tail_=this.head_=this.front_=this.pmin_=this.pmax_=null;this.basin=new m;this.edge_event=new p;this.initEdges(this.points_)};b.prototype.addHole=function(b){this.initEdges(b);
var c,g=b.length;for(c=0;c<g;c++)this.points_.push(b[c]);return this};b.prototype.AddHole=b.prototype.addHole;b.prototype.addHoles=function(b){var c,g=b.length;for(c=0;c<g;c++)this.initEdges(b[c]);this.points_=this.points_.concat.apply(this.points_,b);return this};b.prototype.addPoint=function(b){this.points_.push(b);return this};b.prototype.AddPoint=b.prototype.addPoint;b.prototype.addPoints=function(b){this.points_=this.points_.concat(b);return this};b.prototype.triangulate=function(){k.triangulate(this);
return this};b.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}};b.prototype.getTriangles=function(){return this.triangles_};b.prototype.GetTriangles=b.prototype.getTriangles;b.prototype.front=function(){return this.front_};b.prototype.pointCount=function(){return this.points_.length};b.prototype.head=function(){return this.head_};b.prototype.setHead=function(b){this.head_=b};b.prototype.tail=function(){return this.tail_};b.prototype.setTail=function(b){this.tail_=b};b.prototype.getMap=
function(){return this.map_};b.prototype.initTriangulation=function(){var b=this.points_[0].x,c=this.points_[0].x,d=this.points_[0].y,h=this.points_[0].y,f,k=this.points_.length;for(f=1;f<k;f++){var l=this.points_[f];l.x>b&&(b=l.x);l.x<c&&(c=l.x);l.y>d&&(d=l.y);l.y<h&&(h=l.y)}this.pmin_=new g(c,h);this.pmax_=new g(b,d);f=.3*(b-c);d=.3*(d-h);this.head_=new g(b+f,h-d);this.tail_=new g(c-f,h-d);this.points_.sort(g.compare)};b.prototype.initEdges=function(b,c){var g,d=b.length,h=c?b.length-1:b.length;
for(g=0;g<h;++g)this.edge_list.push(new q(b[g],b[(g+1)%d]))};b.prototype.getPoint=function(b){return this.points_[b]};b.prototype.addToMap=function(b){this.map_.push(b)};b.prototype.locateNode=function(b){return this.front_.locateNode(b.x)};b.prototype.createAdvancingFront=function(){var b,c,g;g=new h(this.points_[0],this.tail_,this.head_);this.map_.push(g);b=new n(g.getPoint(1),g);c=new n(g.getPoint(0),g);g=new n(g.getPoint(2));this.front_=new l(b,g);b.next=c;c.next=g;c.prev=b;g.prev=c};b.prototype.removeNode=
function(b){};b.prototype.mapTriangleToNodes=function(b){for(var c=0;3>c;++c)if(!b.getNeighbor(c)){var g=this.front_.locatePoint(b.pointCW(b.getPoint(c)));g&&(g.triangle=b)}};b.prototype.removeFromMap=function(b){var c,g=this.map_,d=g.length;for(c=0;c<d;c++)if(g[c]===b){g.splice(c,1);break}};b.prototype.meshClean=function(b){b=[b];for(var c,g;c=b.pop();)if(!c.isInterior())for(c.setInterior(!0),this.triangles_.push(c),g=0;3>g;g++)c.constrained_edge[g]||b.push(c.getNeighbor(g))};c.exports=b},{"./advancingfront":2,
"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(b,c,f){f=function(b,c,d){this.points_=[b,c,d];this.neighbors_=[null,null,null];this.interior_=!1;this.constrained_edge=[!1,!1,!1];this.delaunay_edge=[!1,!1,!1]};var d=b("./xy").toString;f.prototype.toString=function(){return"["+d(this.points_[0])+d(this.points_[1])+d(this.points_[2])+"]"};f.prototype.getPoint=function(b){return this.points_[b]};f.prototype.GetPoint=f.prototype.getPoint;f.prototype.getPoints=function(){return this.points_};
f.prototype.getNeighbor=function(b){return this.neighbors_[b]};f.prototype.containsPoint=function(b){var c=this.points_;return b===c[0]||b===c[1]||b===c[2]};f.prototype.containsEdge=function(b){return this.containsPoint(b.p)&&this.containsPoint(b.q)};f.prototype.containsPoints=function(b,c){return this.containsPoint(b)&&this.containsPoint(c)};f.prototype.isInterior=function(){return this.interior_};f.prototype.setInterior=function(b){this.interior_=b;return this};f.prototype.markNeighborPointers=
function(b,c,d){var f=this.points_;if(b===f[2]&&c===f[1]||b===f[1]&&c===f[2])this.neighbors_[0]=d;else if(b===f[0]&&c===f[2]||b===f[2]&&c===f[0])this.neighbors_[1]=d;else if(b===f[0]&&c===f[1]||b===f[1]&&c===f[0])this.neighbors_[2]=d;else throw Error("poly2tri Invalid Triangle.markNeighborPointers() call");};f.prototype.markNeighbor=function(b){var c=this.points_;b.containsPoints(c[1],c[2])?(this.neighbors_[0]=b,b.markNeighborPointers(c[1],c[2],this)):b.containsPoints(c[0],c[2])?(this.neighbors_[1]=
b,b.markNeighborPointers(c[0],c[2],this)):b.containsPoints(c[0],c[1])&&(this.neighbors_[2]=b,b.markNeighborPointers(c[0],c[1],this))};f.prototype.clearNeighbors=function(){this.neighbors_[0]=null;this.neighbors_[1]=null;this.neighbors_[2]=null};f.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1;this.delaunay_edge[1]=!1;this.delaunay_edge[2]=!1};f.prototype.pointCW=function(b){var c=this.points_;return b===c[0]?c[2]:b===c[1]?c[0]:b===c[2]?c[1]:null};f.prototype.pointCCW=function(b){var c=
this.points_;return b===c[0]?c[1]:b===c[1]?c[2]:b===c[2]?c[0]:null};f.prototype.neighborCW=function(b){return b===this.points_[0]?this.neighbors_[1]:b===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]};f.prototype.neighborCCW=function(b){return b===this.points_[0]?this.neighbors_[2]:b===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]};f.prototype.getConstrainedEdgeCW=function(b){return b===this.points_[0]?this.constrained_edge[1]:b===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]};
f.prototype.getConstrainedEdgeCCW=function(b){return b===this.points_[0]?this.constrained_edge[2]:b===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]};f.prototype.getConstrainedEdgeAcross=function(b){return b===this.points_[0]?this.constrained_edge[0]:b===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]};f.prototype.setConstrainedEdgeCW=function(b,c){b===this.points_[0]?this.constrained_edge[1]=c:b===this.points_[1]?this.constrained_edge[2]=c:this.constrained_edge[0]=
c};f.prototype.setConstrainedEdgeCCW=function(b,c){b===this.points_[0]?this.constrained_edge[2]=c:b===this.points_[1]?this.constrained_edge[0]=c:this.constrained_edge[1]=c};f.prototype.getDelaunayEdgeCW=function(b){return b===this.points_[0]?this.delaunay_edge[1]:b===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]};f.prototype.getDelaunayEdgeCCW=function(b){return b===this.points_[0]?this.delaunay_edge[2]:b===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]};f.prototype.setDelaunayEdgeCW=
function(b,c){b===this.points_[0]?this.delaunay_edge[1]=c:b===this.points_[1]?this.delaunay_edge[2]=c:this.delaunay_edge[0]=c};f.prototype.setDelaunayEdgeCCW=function(b,c){b===this.points_[0]?this.delaunay_edge[2]=c:b===this.points_[1]?this.delaunay_edge[0]=c:this.delaunay_edge[1]=c};f.prototype.neighborAcross=function(b){return b===this.points_[0]?this.neighbors_[0]:b===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]};f.prototype.oppositePoint=function(b,c){var d=b.pointCW(c);return this.pointCW(d)};
f.prototype.legalize=function(b,c){var d=this.points_;if(b===d[0])d[1]=d[0],d[0]=d[2],d[2]=c;else if(b===d[1])d[2]=d[1],d[1]=d[0],d[0]=c;else if(b===d[2])d[0]=d[2],d[2]=d[1],d[1]=c;else throw Error("poly2tri Invalid Triangle.legalize() call");};f.prototype.index=function(b){var c=this.points_;if(b===c[0])return 0;if(b===c[1])return 1;if(b===c[2])return 2;throw Error("poly2tri Invalid Triangle.index() call");};f.prototype.edgeIndex=function(b,c){var d=this.points_;if(b===d[0]){if(c===d[1])return 2;
if(c===d[2])return 1}else if(b===d[1]){if(c===d[2])return 0;if(c===d[0])return 2}else if(b===d[2]){if(c===d[0])return 1;if(c===d[1])return 0}return-1};f.prototype.markConstrainedEdgeByIndex=function(b){this.constrained_edge[b]=!0};f.prototype.markConstrainedEdgeByEdge=function(b){this.markConstrainedEdgeByPoints(b.p,b.q)};f.prototype.markConstrainedEdgeByPoints=function(b,c){var d=this.points_;if(c===d[0]&&b===d[1]||c===d[1]&&b===d[0])this.constrained_edge[2]=!0;else if(c===d[0]&&b===d[2]||c===d[2]&&
b===d[0])this.constrained_edge[1]=!0;else if(c===d[1]&&b===d[2]||c===d[2]&&b===d[1])this.constrained_edge[0]=!0};c.exports=f},{"./xy":11}],10:[function(b,c,f){f.EPSILON=1E-12;var d={CW:1,CCW:-1,COLLINEAR:0};f.Orientation=d;f.orient2d=function(b,c,f){b=(b.x-f.x)*(c.y-f.y)-(b.y-f.y)*(c.x-f.x);return-1E-12<b&&1E-12>b?d.COLLINEAR:0<b?d.CCW:d.CW};f.inScanArea=function(b,c,d,f){return-1E-12<=(b.x-c.x)*(f.y-c.y)-(f.x-c.x)*(b.y-c.y)||1E-12>=(b.x-d.x)*(f.y-d.y)-(f.x-d.x)*(b.y-d.y)?!1:!0};f.isAngleObtuse=function(b,
c,d){return 0>(c.x-b.x)*(d.x-b.x)+(c.y-b.y)*(d.y-b.y)}},{}],11:[function(b,c,f){function d(b){return"("+b.x+";"+b.y+")"}c.exports={toString:function(b){var c=b.toString();return"[object Object]"===c?d(b):c},toStringBase:d,compare:function(b,c){return b.y===c.y?b.x-c.x:b.y-c.y},equals:function(b,c){return b.x===c.x&&b.y===c.y}}},{}]},{},[6])(6)});AutodeskNamespace("Autodesk.Viewing");
(function(){var a=Autodesk.Viewing;a.EventDispatcher=function(){};a.EventDispatcher.prototype={constructor:a.EventDispatcher,apply:function(b){b.addEventListener=a.EventDispatcher.prototype.addEventListener;b.hasEventListener=a.EventDispatcher.prototype.hasEventListener;b.removeEventListener=a.EventDispatcher.prototype.removeEventListener;b.fireEvent=a.EventDispatcher.prototype.fireEvent;b.dispatchEvent=a.EventDispatcher.prototype.fireEvent},addEventListener:function(a,c){void 0===this.listeners&&
(this.listeners={});"undefined"==typeof this.listeners[a]&&(this.listeners[a]=[]);this.listeners[a].push(c)},hasEventListener:function(a,c){if(void 0===this.listeners)return!1;var f=this.listeners;return void 0!==f[a]&&-1!==f[a].indexOf(c)?!0:!1},removeEventListener:function(a,c){void 0===this.listeners&&(this.listeners={});if(this.listeners[a]instanceof Array)for(var f=this.listeners[a],d=0,g=f.length;d<g;d++)if(f[d]===c){f.splice(d,1);break}},fireEvent:function(a){void 0===this.listeners&&(this.listeners=
{});"string"==typeof a&&(a={type:a});a.target||(a.target=this);if(!a.type)throw Error("event type unknown.");if(this.listeners[a.type]instanceof Array)for(var c=this.listeners[a.type].slice(),f=0;f<c.length;f++)c[f].call(this,a)}}})();AutodeskNamespace("Autodesk.Viewing.Private");
(function(){function a(a){for(var b=0;b<d.length;++b)document.addEventListener(d[b],a,!1)}function b(a){for(var b=0;b<d.length;++b)document.removeEventListener(d[b],a,!1)}var c=Autodesk.Viewing,f=Autodesk.Viewing.Private,d=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"];c.ScreenMode={kNormal:0,kFullBrowser:1,kFullScreen:2};c.ScreenModeDelegate=function(b){this.viewer=b;this.bindFullscreenEventListener=this.fullscreenEventListener.bind(this);this.getMode()===
c.ScreenMode.kFullScreen&&a(this.bindFullscreenEventListener)};c.ScreenModeDelegate.prototype.uninitialize=function(){b(this.bindFullscreenEventListener);this.viewer=null};c.ScreenModeDelegate.prototype.isModeSupported=function(a){return!0};c.ScreenModeDelegate.prototype.setMode=function(a){var b=this.getMode();return a!==b&&this.isModeSupported(a)?(this.doScreenModeChange(b,a),this.onScreenModeChanged(b,a),!0):!1};c.ScreenModeDelegate.prototype.getMode=function(){throw"Implement getMode() in derived class";
};c.ScreenModeDelegate.prototype.getNextMode=function(){var a=this.getMode(),b,d=c.ScreenMode;a===d.kNormal&&this.isModeSupported(d.kFullBrowser)?b=d.kFullBrowser:a===d.kNormal&&this.isModeSupported(d.kFullScreen)?b=d.kFullScreen:a===d.kFullBrowser&&this.isModeSupported(d.kFullScreen)?b=d.kFullScreen:a===d.kFullBrowser&&this.isModeSupported(d.kNormal)?b=d.kNormal:a===d.kFullScreen&&this.isModeSupported(d.kNormal)?b=d.kNormal:a===d.kFullScreen&&this.isModeSupported(d.kFullBrowser)&&(b=d.kFullBrowser);
return b};c.ScreenModeDelegate.prototype.getEscapeMode=function(){return this.getMode()!==c.ScreenMode.kNormal?c.ScreenMode.kNormal:void 0};c.ScreenModeDelegate.prototype.fullscreenEventListener=function(){if(inFullscreen())this.viewer.resize();else{var a=c.ScreenMode;this.doScreenModeChange(a.kFullScreen,a.kNormal);this.onScreenModeChanged(a.kFullScreen,a.kNormal)}};c.ScreenModeDelegate.prototype.doScreenModeChange=function(a,b){throw"Implement doScreenModeChange() in derived class";};c.ScreenModeDelegate.prototype.onScreenModeChanged=
function(d,f){d===c.ScreenMode.kFullScreen?b(this.bindFullscreenEventListener):f===c.ScreenMode.kFullScreen&&a(this.bindFullscreenEventListener);this.viewer.resize();this.viewer.fireEvent({type:c.FULLSCREEN_MODE_EVENT,mode:f})};c.ApplicationScreenModeDelegate=function(a){c.ScreenModeDelegate.call(this,a)};c.ApplicationScreenModeDelegate.prototype=Object.create(c.ScreenModeDelegate.prototype);c.ApplicationScreenModeDelegate.prototype.constructor=c.ApplicationScreenModeDelegate;c.ApplicationScreenModeDelegate.prototype.isModeSupported=
function(a){return a!==c.ScreenMode.kFullBrowser};c.ApplicationScreenModeDelegate.prototype.getMode=function(){return inFullscreen()?c.ScreenMode.kFullScreen:c.ScreenMode.kNormal};c.ApplicationScreenModeDelegate.prototype.doScreenModeChange=function(a,b){var d=this.viewer.container;b===c.ScreenMode.kNormal?(d.classList.remove("viewer-fill-browser"),exitFullscreen()):b===c.ScreenMode.kFullScreen&&(d.classList.add("viewer-fill-browser"),launchFullscreen(d))};c.NullScreenModeDelegate=function(a){c.ScreenModeDelegate.call(this,
a)};c.NullScreenModeDelegate.prototype=Object.create(c.ScreenModeDelegate.prototype);c.NullScreenModeDelegate.prototype.constructor=c.ScreenModeDelegate;c.NullScreenModeDelegate.prototype.isModeSupported=function(a){return!1};c.NullScreenModeDelegate.prototype.getMode=function(){return c.ScreenMode.kNormal};c.ScreenModeMixin=function(){};c.ScreenModeMixin.prototype={setScreenModeDelegate:function(a){this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null);this.screenModeDelegateClass=
a?a:null===a?c.NullScreenModeDelegate:c.ApplicationScreenModeDelegate},getScreenModeDelegate:function(){this.screenModeDelegate||(this.screenModeDelegate=new this.screenModeDelegateClass(this));return this.screenModeDelegate},isScreenModeSupported:function(a){return this.getScreenModeDelegate().isModeSupported(a)},canChangeScreenMode:function(){return this.isScreenModeSupported(Autodesk.Viewing.ScreenMode.kNormal)},setScreenMode:function(a){var b=f.logger;b&&b.log({category:"screen_mode",value:a});
return this.getScreenModeDelegate().setMode(a)},getScreenMode:function(){return this.getScreenModeDelegate().getMode()},nextScreenMode:function(){var a=this.getScreenModeDelegate().getNextMode();return void 0!==a?this.setScreenMode(a):!1},escapeScreenMode:function(){var a=this.getScreenModeDelegate().getEscapeMode();return void 0!==a?this.setScreenMode(a):!1},apply:function(a){var b=c.ScreenModeMixin.prototype;a.setScreenModeDelegate=b.setScreenModeDelegate;a.getScreenModeDelegate=b.getScreenModeDelegate;
a.isScreenModeSupported=b.isScreenModeSupported;a.canChangeScreenMode=b.canChangeScreenMode;a.setScreenMode=b.setScreenMode;a.getScreenMode=b.getScreenMode;a.nextScreenMode=b.nextScreenMode;a.escapeScreenMode=b.escapeScreenMode}}})();AutodeskNamespace("Autodesk.Viewing.Private");
(function(){var a=Autodesk.Viewing.Private;a.inWorkerThread="undefined"!==typeof self&&"undefined"===typeof window;a.ViewingService={};a.ViewingService.shouldRefreshToken=function(a){var c=!1;if(401===a.statusCode){a=a.responseText;try{var f=a?JSON.parse(a):{}}catch(d){}c=!a||f.errorCode&&"AUTH-006"===f.errorCode}else c=403===a.statusCode;return c};a.ViewingService.refreshToken=function(b,c){a.inWorkerThread?(self.addEventListener("message",function(a){a.data&&a.data.tokenRefreshed?b(a):c(a)}),self.postMessage({refreshToken:!0})):
a.refreshTokenAndCookie(b,c)};a.ViewingService.generateUrl=function(b,c,f){if(0!==f.indexOf("urn:"))return f;b+="/";"items"!==c&&(f=f.substr(4));return b="bubbles"===c?0==a.env.indexOf("Autodesk")?b+f:b+(c+"/"+f):b+(c+"/"+encodeURIComponent(f))};a.ViewingService.get=function(b,c,f,d,g,h){h=h?h:{};f=a.ViewingService.generateUrl(b,c,f);h.queryParams&&(f=f+"?"+h.queryParams);var k=new XMLHttpRequest;try{var l=function(a){200===k.status?d(k.response?k.response:k.responseText):n(a)},n=function(l){!h.retriedOnce&&
a.ViewingService.shouldRefreshToken(k)?a.ViewingService.refreshToken(function(k){h.retriedOnce=!0;a.ViewingService.get(b,c,f,d,g,h)},function(a){g(k.status,k.statusText,{url:f})}):g(k.status,k.statusText,{url:f})},q=h.hasOwnProperty("asynchronous")?h.asynchronous:!0;k.open("GET",f,q);h.hasOwnProperty("responseType")&&(k.responseType=h.responseType);k.withCredentials=!0;h.hasOwnProperty("withCredentials")&&(k.withCredentials=h.withCredentials);if(h.headers)for(var m in h.headers)k.setRequestHeader(m,
h.headers[m]);q&&(k.onload=l,k.onerror=n,k.ontimeout=n);k.send();a.inWorkerThread?self.postMessage({assetRequest:[f,h.headers,null]}):a.assets.push([f,h.headers,null]);q||l(null)}catch(p){g(k.status,k.statusText,{url:f,exception:p})}}})();
var Xhr=function(){var a=function(a,c,f){this.xhr=new XMLHttpRequest;this.errorHandler=a;this.success=!1;this.viewing_url=f;this.auth=c};a.prototype.generateUrl=function(a,c,f){var d=a.indexOf("urn:");0===d&&this.viewing_url&&((f=f&&f.feature?f.feature:null)?"render"==f?(a=a.substr(4),a=this.viewing_url+"/"+f+"/"+encodeURIComponent(a)):"bubbles"==f?(a=a.substr(4),a=this.viewing_url+"/"+f+"/"+encodeURIComponent(a)):"comments"==f?(a=a.substr(4),a=this.viewing_url+"/"+f+"/file/"+encodeURIComponent(a)):
a=this.viewing_url+"/"+f+"/"+encodeURIComponent(a.substr(d)):a=this.viewing_url+"/items/"+encodeURIComponent(a.substr(d)));c&&(a=a+"?"+c);return a};a.prototype.addHeaders=function(a){for(var c in a)this.xhr.setRequestHeader(c,a[c])};a.prototype.get=function(a,c,f,d,g,h){a=this.generateUrl(a,h,{feature:g});try{this.xhr.open("GET",a,!!d),this.xhr.responseType=f,this.success=!1,this.auth&&(this.xhr.withCredentials=!0),d&&(this.xhr.onload=d),this.addHeaders(c),this.xhr.send()}catch(k){return this.errorHandler&&
this.errorHandler.networkFailure(a,k),null}this.errorCheck(a,200);return this.xhr.response};a.prototype.post=function(a,c,f,d,g,h){a=this.generateUrl(a,null,{feature:h});c["Content-Type"]||(c["Content-Type"]="application/json");try{this.xhr.open("POST",a,!!g),this.xhr.responseType=d,this.success=!1,this.auth&&(this.xhr.withCredentials=!0),g&&(this.xhr.onload=g),this.addHeaders(c),this.xhr.send(f)}catch(k){return this.errorHandler&&this.errorHandler.networkFailure(a,k),null}this.errorCheck(a,200,201);
return this.xhr.response};a.prototype.getRange=function(a,c,f,d,g,h){a=this.generateUrl(path);c.Range="bytes="+d+"-"+g;try{this.xhr.open("GET",a,!!h),this.xhr.responseType=f,this.success=!1,this.auth&&(this.xhr.withCredentials=!0),h&&(this.xhr.onload=h),this.addHeaders(c),this.xhr.send()}catch(k){return this.errorHandler&&this.errorHandler.networkFailure(a,k),null}this.errorCheck(a,206);return this.xhr.response};a.prototype.head=function(a){a=this.generateUrl(path);try{this.xhr.open("GET",a,!1),this.success=
!1,this.auth&&(this.xhr.withCredentials=!0),this.addHeaders([]),this.xhr.send()}catch(c){return this.errorHandler&&this.errorHandler.networkFailure(a,c),null}this.errorCheck(a,200);a=[];a["Accept-Ranges"]=this.xhr.getResponseHeader("Accept-Ranges");a["Content-Length"]=this.xhr.getResponseHeader("Content-Length");return a};a.prototype.errorCheck=function(a,c){if(4===this.xhr.readyState&&this.xhr.status){var f;for(f=1;f<arguments.length&&this.xhr.status!==arguments[f];f++);f===arguments.length&&this.errorHandler?
this.errorHandler.unsuccessfulResponse(a,this.xhr.status,this.xhr.statusText):this.success=!0}else this.success=!0};return a}(),XhrErrorHandler=function(){var a=function(a){this.host=a;this.ignoreFileNotFound=!1};a.prototype.networkFailure=function(a,c){this.host.raiseError(Autodesk.Viewing.ErrorCodes.NETWORK_FAILURE,"Network failure",{url:a,exception:c.toString(),stack:c.stack})};a.prototype.unsuccessfulResponse=function(a,c,f){403==c?this.host.raiseError(Autodesk.Viewing.ErrorCodes.NETWORK_ACCESS_DENIED,
"Access denied to remote resource",{url:a,httpStatus:c,httpStatusText:f}):404==c?this.ignoreFileNotFound||this.host.raiseError(Autodesk.Viewing.ErrorCodes.NETWORK_FILE_NOT_FOUND,"Remote resource not found",{url:a,httpStatus:c,httpStatusText:f}):500<=c&&600>c?this.host.raiseError(Autodesk.Viewing.ErrorCodes.NETWORK_SERVER_ERROR,"Server error when accessing resource",{url:a,httpStatus:c,httpStatusText:f}):this.host.raiseError(Autodesk.Viewing.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE,"Unhandled response code from server",
{url:a,httpStatus:c,httpStatusText:f})};return a}();
if("undefined"!==typeof window){var trace=function(a){"\n"==a[a.length-1]&&(a=a.substring(0,a.length-1));console.log((performance.now()/1E3).toFixed(3)+": "+a)},RTCPeerConnection=null,getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null;if(navigator.mozGetUserMedia)webrtcDetectedBrowser="firefox",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]),RTCPeerConnection=mozRTCPeerConnection,RTCSessionDescription=
mozRTCSessionDescription,RTCIceCandidate=mozRTCIceCandidate,getUserMedia=navigator.mozGetUserMedia.bind(navigator),createIceServer=function(a,b,c){var f=null,d=a.split(":");0===d[0].indexOf("stun")?f={url:a}:0!==d[0].indexOf("turn")||-1===a.indexOf("transport=udp")&&-1!==a.indexOf("?transport")||(f={url:a.split("?")[0],credential:c,username:b});return f},attachMediaStream=function(a,b){console.log("Attaching media stream");a.mozSrcObject=b;a.play()},reattachMediaStream=function(a,b){console.log("Reattaching media stream");
a.mozSrcObject=b.mozSrcObject;a.play()},MediaStream.prototype.getVideoTracks=function(){return[]},MediaStream.prototype.getAudioTracks=function(){return[]};else if(navigator.webkitGetUserMedia){var match=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./),webrtcDetectedBrowser="chrome",webrtcDetectedVersion=match?parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2]):40;createIceServer=function(a,b,c){var f=null,d=a.split(":");0===d[0].indexOf("stun")?f={url:a}:0===d[0].indexOf("turn")&&
(28>webrtcDetectedVersion?(a=a.split("turn:"),f={url:"turn:"+b+"@"+a[1],credential:c}):f={url:a,credential:c,username:b});return f};RTCPeerConnection=webkitRTCPeerConnection;getUserMedia=navigator.webkitGetUserMedia.bind(navigator);attachMediaStream=function(a,b){"undefined"!==typeof a.srcObject?a.srcObject=b:"undefined"!==typeof a.mozSrcObject?a.mozSrcObject=b:"undefined"!==typeof a.src?a.src=URL.createObjectURL(b):console.log("Error attaching stream to element.")};reattachMediaStream=function(a,
b){a.src=b.src};webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks});webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})}else console.log("Browser does not appear to be WebRTC-capable")}AutodeskNamespace("Autodesk.Viewing.Private");
(function(){var a=Autodesk.Viewing.Private;a.config={userName:""};a.setUserName=function(b){a.config.userName=b};a.MessageClient=function(b,f){function d(){return a.config.userName&&a.config.userName.length?a.config.userName:n?n.slice(0,5):"Unknown"}function g(a){switch(a.type){case "txt":if(0==a.msg.indexOf("/nick ")){var b=m.getUserById(a.from,a.roomId),c=a.msg.slice(6);c.length&&(b.name=c,b.id==n&&(b.name+=" (you)"));m.dispatchEvent({type:"userListChange",data:a,channelId:a.roomId})}break;case "joinok":b=
q[a.roomId];stderr("joined channel "+a.roomId);b.users=a.users&&a.users.length?a.users:[];for(c=0;c<b.users.length;c++)b.users[c].name&&b.users[c].name.length||(b.users[c].name=b.users[c].id.slice(0,5));var c=d(),g={id:n,name:c+" (you)",isSelf:!0,status:0};b.userSet[n]||(b.users.push(g),b.userSet[n]=g);0!=g.id.indexOf(c)&&m.sendChatMessage("/nick "+c,a.roomId);break;case "join_error":break;case "sessionId":stderr("Connect successful, your id is: "+a.id);n=a.id;break;case "joined":a.userStatus="joined";
a.user.name&&a.user.name.length||(a.user.name=a.user.id.slice(0,5));a.roomId&&((b=q[a.roomId])?(b.users.push(a.user),stderr(a.user+" joined room "+a.roomId)):stderr("Channel "+a.roomId+" does not exist for socket "+n));break;case "left":a.userStatus="left";stderr(a.user+" left room "+a.room);for(b in q){for(var c=q[b].users,g=-1,f=0;f<c.length;f++)if(c[f].id==a.user){g=f;break}-1!=g&&c.splice(g,1);delete q[b].userSet[a.user]}break;case "camera":case "pointer":break;default:stderr(a)}m.dispatchEvent({type:k[a.type],
data:a,channelId:a.roomId})}function h(a){m.dispatchEvent({type:"socketError",data:a})}var k={camera:"cameraChange",pointer:"pointerMove",joystick:"joystick",state:"viewerState",txt:"chatReceived",joinok:"userListChange",sessionId:"connectSucceeded",joined:"userListChange",left:"userListChange","private":"privateMessage",join_error:"socketError"},l,n=null,q={},m=this;this.connect=function(a){if(!l)return"undefined"!==typeof window.WebSocket?(this.sessionID=a,l=io.connect(b+"?sessionID="+a,{path:f,
forceNew:!0}),l.on("message",g),l.on("connect_error",h),l.on("error",h),!0):!1};this.join=function(a){q[a]={id:a,users:[],userSet:{}};l||this.connect();l.emit("join",{roomId:a,name:d()})};this.disconnect=function(){l&&(l.disconnect(),l=null,q={},n=null)};this.sendMessage=function(a,b,c){l.emit("message",{type:a,from:n,msg:b,roomId:c})};this.sendPrivateMessage=function(a,b){l.emit("message",{type:"private",target:a,from:n,msg:b})};this.sendChatMessage=function(a,b){var c={type:"txt",from:n,msg:a,roomId:b};
l.emit("message",c);g(c)};this.getUserById=function(a,b){for(var c=q[b].users,d=0;d<c.length;d++)if(c[d].id==a)return c[d];return null};this.getLocalId=function(){return n};this.getChannelInfo=function(a){return q[a]};this.isConnected=function(){return l}};a.MessageClient.prototype.constructor=a.MessageClient;Autodesk.Viewing.EventDispatcher.prototype.apply(a.MessageClient.prototype);var b={};a.MessageClient.GetInstance=function(c,f){c||(c=a.EnvironmentConfigurations[a.env].RTC);var d=b[c];if(d)return d;
d=new a.MessageClient(c,f);return b[c]=d}})();AutodeskNamespace("Autodesk.Viewing.Private");
(function(){var a=Autodesk.Viewing.Private;a.P2PClient=function(a){function c(a){try{q=new RTCPeerConnection(z),q.onicecandidate=function(a){a.candidate?n.sendPrivateMessage(p,{type:"candidate",label:a.candidate.sdpMLineIndex,id:a.candidate.sdpMid,candidate:a.candidate.candidate}):stderr("End of candidates.")},q.ondatachannel=function(a){stderr("Data channel added.");r=a.channel;r.onmessage=h;l.dispatchEvent({type:"dataChannelAdded",data:a.channel})},q.onaddstream=function(a){stderr("Remote stream added.");
l.dispatchEvent({type:"remoteStreamAdded",data:a.stream})},q.onremovestream=function(a){stderr("Remote stream removed. Event: ",a);l.dispatchEvent({type:"remoteStreamRemoved",data:a.stream})},a&&(r=q.createDataChannel("sendDataChannel",{reliable:!1,ordered:!1}),r.onmessage=h)}catch(b){stderr("Failed to create PeerConnection, exception: "+b.message),alert("Cannot create RTCPeerConnection object.")}}function f(a){stderr("createOffer() error: ",e)}function d(a){q.setLocalDescription(a);n.sendPrivateMessage(p,
a);if(B.length){for(a=0;a<B.length;a++)q.addIceCandidate(B[a]);B=[]}}function g(a){a=a.split("\n");for(var b=!1,c=!1,d=!1,g=0;g<a.length;g++)0==a[g].indexOf("a=mid:data")&&(b=!0),0==a[g].indexOf("a=mid:video")&&(d=!0),0==a[g].indexOf("a=mid:audio")&&(c=!0);return b&&!d&&!c}function h(a){a=JSON.parse(a.data);switch(a.type){case "camera":l.dispatchEvent({type:"cameraChange",data:a});break;case "joystick":l.dispatchEvent({type:"joystick",data:a});break;case "state":l.dispatchEvent({type:"viewerState",
data:a})}}function k(){m=!1;q.close();p=t=q=null}var l=this,n=a,q,m=!1,p,t,r,B=[],z={iceServers:[{url:"stun:stun.l.google.com:19302"}]},F={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},C={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}};n.addEventListener("privateMessage",function(a){var b=a.data.msg;stderr("Client received message:"+JSON.stringify(b));"offer"!=b.type||m?"answer"===b.type&&m?q.setRemoteDescription(new RTCSessionDescription(b)):"candidate"===b.type?(a=new RTCIceCandidate({sdpMLineIndex:b.label,
candidate:b.candidate}),m?q.addIceCandidate(a):B.push(a)):"bye"===b&&m&&(l.dispatchEvent({type:"remoteHangup",data:null}),stderr("Session terminated."),k()):(stderr("Received offer. Accepting."),l.receiveCall(a.data))});this.hangup=function(){stderr("Hanging up.");m&&(n.sendPrivateMessage(p,"bye"),k())};this.initUserMedia=function(a){var b={video:!0,audio:!0};window.getUserMedia(b,function(b){stderr("Adding local stream.");a&&a(b);l.dispatchEvent({type:"localStreamAdded",data:b})},function(a){stderr("getUserMedia error: ",
a)});stderr("Getting user media with constraints",b)};this.callUser=function(a,b){p?stderr("Already in a call. Ignoring call request."):(p=a,stderr("Calling user "+p),b?(c(!0),m=!0,stderr("Sending data channel offer to peer"),q.createOffer(d,f)):this.initUserMedia(function(a){t=a;m||"undefined"==typeof t||(c(!1),q.addStream(t),m=!0,stderr("Sending audio/video offer to peer"),q.createOffer(d,f))}))};this.receiveCall=function(a){p=a.from;p||(p=a.senderId);g(a.msg.sdp)?(c(!0),m=!0,q.setRemoteDescription(new RTCSessionDescription(a.msg)),
stderr("Sending data-only answer to peer."),q.createAnswer(d,null,C)):this.initUserMedia(function(b){t=b;m||"undefined"==typeof t||(c(!1),q.addStream(t),m=!0);q.setRemoteDescription(new RTCSessionDescription(a.msg));stderr("Sending audio+video answer to peer.");q.createAnswer(d,null,F)})};this.getCurrentCallTarget=function(){return p};this.dataChannel=function(){return r}};a.P2PClient.prototype.constructor=a.P2PClient;Autodesk.Viewing.EventDispatcher.prototype.apply(a.P2PClient.prototype)})();AutodeskNamespace("Autodesk.Viewing.Private");
(function(){var a=Autodesk.Viewing.Private;a.Logger=function(b){this.queue=[];b.eventCallback&&(this.callback=b.eventCallback);this.sessionId=b.sessionId;if(!this.sessionId){var c=Date.now()+"";this.sessionId=parseFloat((1E4*Math.random()|0)+""+c.substring(4))}this.endpoint=b.endpoint?b.endpoint+"/logs":null;this.flushThreshold=b.flushThreshold||10;this.ready=!1;this.retries=0;this.lastFlushTime=Date.now();this.heartbeat=null;b={category:"viewer_start",touch:isTouchDevice(),env:a.env,referer:window.location.href,
version:LMV_VIEWER_VERSION};this.log(b)};a.Logger.prototype.setupWS=function(){var a=this;a.reconnectPending=!1;if(this.endpoint){stderr("Opening web socket.");var c=function(){a.ready=!0;a.lastConnectTime=Date.now();stderr("Web socket opened successfully.");0<a.retries&&a.socket.send({category:"reconnect",sessionId:this.sessionId});a.flush()},f=function(){a.reconnectPending||a.xhr||(a.ready=!1,3>a.retries?(stderr("Attempting web socket reconnect."),a.retries++,a.reconnectPending=!0,setTimeout(function(){a.setupWS()},
5E3)):(stderr("Giving up on web sockets. Trying POST."),a.setupXHR()))},d=function(a){console.log(a.message);f()},g=function(c){6E4<Date.now()-a.lastConnectTime?(stderr("Web socket closed due to inactivity."),a.socket=null,a.ready=!1,a.retries=0):f()};try{this.socket=new WebSocket("wss://"+this.endpoint,"lmv-log-v1"),this.socket.onopen=c,this.socket.onerror=d,this.socket.onclose=g,this.socket.onmessage=function(a){console.log(a.data)}}catch(h){a.setupXHR()}}};a.Logger.prototype.setupXHR=function(){this.socket=
null;this.xhr=new XMLHttpRequest;this.ready=!0;this.retries=0;this.flush();var a=this;this.heartbeat&&clearInterval(this.heartbeat);this.heartbeat=setInterval(function(){a.flush()},6E4);"undefined"!==typeof window&&window.addEventListener("beforeunload",function(){a.log({category:"viewer_stop"},!0)})};a.Logger.prototype.flush=function(){if(!(2<this.retries)&&this.queue.length&&this.ready){var a=this,c=this.queue;this.queue=[];var f=JSON.stringify(c);if(this.socket)try{this.socket.send(f)}catch(d){}else if(this.endpoint)try{var g=
this.xhr;g.open("POST","https://"+this.endpoint,!0);g.send(f);g.onreadystatechange=function(){4==g.readyState&&200!==g.status&&(a.retries++,a.queue.unshift(c))}}catch(h){}else stderr(this.queue);this.lastFlushTime=Date.now()}};a.Logger.prototype.log=function(a,c){Autodesk.Viewing.Private.offline||(this.callback&&this.callback(a),2<this.retries||(a.timestamp=Date.now(),a.sessionId=this.sessionId,this.queue.push(a),this.socket||this.ready?(this.socket||this.queue.length>this.flushThreshold||6E4<a.timestamp-
this.lastFlushTime||c)&&this.flush():this.setupWS()))}})();
var Autocam=Autocam||function(a,b,c,f,d){function g(b){B=!0;a.target.copy(m.center);a.pivot.copy(m.pivot);a.worldup?a.worldup.copy(m.sceneUpDirection):a.up.copy(m.sceneUpDirection);f&&f(b);B=!1}function h(a,b){var c=new THREE.Vector2(0,0);c.x=a/window.innerWidth;c.y=b/window.innerHeight;return c}function k(a,b,c){var d,g,f,h=0,k=null,l=null,n=m.snapOrbitDeadZone,q=m.orbitMultiplier;"h"==a?(a=m.snapOrbitThresholdH,d=m.snapOrbitAccelerationAX,g=m.snapOrbitAccelerationBX,f=1-m.snapOrbitAccelerationPointX,
l=m.lockDeltaX,k=m.lockedX):(a=m.snapOrbitThresholdV,d=m.snapOrbitAccelerationAY,g=m.snapOrbitAccelerationBY,f=1-m.snapOrbitAccelerationPointY,l=m.lockDeltaY,k=m.lockedY);k?(l+=c,l<-n?h=(l+n)*q*1/g:l>n&&(h=(l-n)*q*1/g)):(h=Math.abs(b)>a?c*q:Math.abs(b)>f*a?0<c*b?c*q*d:c*q*1/d:0<c*b?c*q*g:c*q*1/g,0<h*b&&Math.abs(h)>Math.abs(b)&&(this.lockDeltaX=this.lockDeltaY=0,h=b));return h}function l(a,b){var c=!1,d=window.innerWidth,g=a.x%d,f=window.innerHeight,h=a.y%f,f=0<h?h-b.y:f+h-b.y;30>Math.abs(0<g?g-b.x:
d+g-b.x)&&30>Math.abs(f)&&(c=!0);return c}function n(a,b,c){if(!Y||!a){if(a){var d=new THREE.Vector2;d.x=(b.x-c.x)/window.innerWidth;b.x=c.x+(b.x-c.x)%window.innerWidth;d.y=(b.y-c.y)/window.innerHeight;b.y=c.y+(b.y-c.y)%window.innerHeight}Y=a}}function q(a){var b=m.sceneFrontDirection.clone().cross(m.sceneUpDirection),c=Math.abs(Math.abs(a.dot(m.sceneUpDirection))-1),d=Math.abs(Math.abs(a.dot(m.sceneFrontDirection))-1);a=Math.abs(Math.abs(a.dot(b))-1);return 1E-5>c||1E-5>d||1E-5>a}var m=this,p=null,
t=null,r=null,B=!1;this.camera=a;this.renderer="WEBGL";this.startState={};this.navApi=b;this.orthographicFaces=!1;var z=Date.now(),F,C=!1;this.showPivot=function(a){d&&d(a)};this.setViewCubeContainer=function(a){r=a};this.setWorldUpVector=function(a){!B&&a&&0<a.lengthSq()&&!a.normalize().equals(this.sceneUpDirection)&&(this.sceneUpDirection.copy(a),this.sceneFrontDirection.copy(this.getWorldFrontVector()),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),p&&requestAnimationFrame(p.render))};
this.getWorldUpVector=function(){return this.sceneUpDirection.clone()};this.getWorldRightVector=function(){var a=this.sceneUpDirection.clone();Math.abs(a.z)<=Math.abs(a.y)?a.set(a.y,-a.x,0):0<=a.z?a.set(a.z,0,-a.x):a.set(-a.z,0,a.x);return a.normalize()};this.getWorldFrontVector=function(){return this.getWorldUpVector().cross(this.getWorldRightVector()).normalize()};this.goToView=function(a){this.navApi.getIsLocked()||(a={position:a.position.clone(),up:a.up.clone(),center:a.center.clone(),pivot:a.pivot.clone(),
fov:a.fov,worldUp:a.worldUp.clone(),isOrtho:a.isOrtho},m.elapsedTime=0,this.animateTransition(a))};this.getCurrentView=function(){return{position:a.position.clone(),up:a.up.clone(),center:this.center.clone(),pivot:this.pivot.clone(),fov:a.fov,worldUp:this.sceneUpDirection.clone(),isOrtho:!1===a.isPerspective}};this.setCurrentViewAsHome=function(a){a?(this.navApi.setRequestFitToView(!0),C=!0):this.homeVector=this.getCurrentView()};this.setHomeViewFrom=function(a){var b=a.pivot?a.pivot:this.center,
c=a.target?a.target:this.pivot,d=a.worldup?a.worldup:this.sceneUpDirection;this.homeVector={position:a.position.clone(),up:a.up.clone(),center:c.clone(),pivot:b.clone(),fov:a.fov,worldUp:d.clone(),isOrtho:!1===a.isPerspective};this.originalHomeVector={position:a.position.clone(),up:a.up.clone(),center:c.clone(),pivot:b.clone(),fov:a.fov,worldUp:d.clone(),worldFront:this.sceneFrontDirection.clone(),isOrtho:!1===a.isPerspective}};this.toPerspective=function(){a.isPerspective||(a.toPerspective(),g(!1))};
this.toOrthographic=function(){a.isPerspective&&(a.toOrthographic(),g(!1))};this.setOrthographicFaces=function(a){this.orthographicFaces=a};this.goHome=function(){this.navApi.getIsLocked()||(this.navApi.setPivotSetFlag(!1),this.goToView(this.homeVector))};this.resetHome=function(){this.homeVector.position.copy(this.originalHomeVector.position);this.homeVector.up.copy(this.originalHomeVector.up);this.homeVector.center.copy(this.originalHomeVector.center);this.homeVector.pivot.copy(this.originalHomeVector.pivot);
this.homeVector.fov=this.originalHomeVector.fov;this.homeVector.worldUp.copy(this.originalHomeVector.worldUp);this.homeVector.isOrtho=this.originalHomeVector.isOrtho;this.goHome()};this.getView=function(){return this.center.clone().sub(a.position)};this.setCameraUp=function(b){var c=this.dir.clone(),d=c.cross(b).normalize();0===d.lengthSq()&&(c.copy(this.dir),b.z>b.y?c.y+=1E-4:c.z+=1E-4,d=c.cross(b).normalize());a.up.copy(d).cross(this.dir).normalize()};(function V(){requestAnimationFrame(V);var a=
Date.now();F=a-z;z=a})();this.ortho=!1;this.center=a.target?a.target.clone():new THREE.Vector3(0,0,0);this.pivot=a.pivot?a.pivot.clone():this.center.clone();this.sceneUpDirection=a.worldup?a.worldup.clone():a.up.clone();this.sceneFrontDirection=this.getWorldFrontVector();this.dir=this.getView();this.setCameraUp(a.up);this.saveCenter=this.center.clone();this.savePivot=this.pivot.clone();this.saveEye=a.position.clone();this.saveUp=a.up.clone();var w,E,A,D;this.cubeFront=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();
this.setHomeViewFrom(a);var I=new THREE.Quaternion,G=new THREE.Quaternion,H=new THREE.Quaternion,K=new THREE.Quaternion,J,M;this.userPanSpeed=.5;this.userLookSpeed=2;this.userHeightSpeed=5;this.walkMultiplier=1;this.userZoomSpeed=1.015;this.orbitMultiplier=5;this.currentlyAnimating=!1;this.alignOrbitUpDirection=this.preserveOrbitUpDirection=a.keepSceneUpright=!0;this.doCustomOrbit=this.constrainOrbitVertical=this.constrainOrbitHorizontal=!1;this.snapOrbitDeadZone=.045;this.snapOrbitThresholdH=this.snapOrbitThresholdV=
THREE.Math.degToRad(15);this.snapOrbitAccelerationAX=this.snapOrbitAccelerationAY=1.5;this.snapOrbitAccelerationBX=this.snapOrbitAccelerationBY=2;this.snapOrbitAccelerationPointX=this.snapOrbitAccelerationPointY=.5;this.alignDirTable=Array(26);this.alignDirTable[0]=new THREE.Vector3(-1,0,0);this.alignDirTable[1]=new THREE.Vector3(1,0,0);this.alignDirTable[2]=new THREE.Vector3(0,-1,0);this.alignDirTable[3]=new THREE.Vector3(0,1,0);this.alignDirTable[4]=new THREE.Vector3(0,0,-1);this.alignDirTable[5]=
new THREE.Vector3(0,0,1);this.alignDirTable[6]=new THREE.Vector3(-1,-1,0);this.alignDirTable[7]=new THREE.Vector3(-1,1,0);this.alignDirTable[8]=new THREE.Vector3(1,-1,0);this.alignDirTable[9]=new THREE.Vector3(1,1,0);this.alignDirTable[10]=new THREE.Vector3(0,-1,-1);this.alignDirTable[11]=new THREE.Vector3(0,-1,1);this.alignDirTable[12]=new THREE.Vector3(0,1,-1);this.alignDirTable[13]=new THREE.Vector3(0,1,1);this.alignDirTable[14]=new THREE.Vector3(-1,0,-1);this.alignDirTable[15]=new THREE.Vector3(1,
0,-1);this.alignDirTable[16]=new THREE.Vector3(-1,0,1);this.alignDirTable[17]=new THREE.Vector3(1,0,1);this.alignDirTable[18]=new THREE.Vector3(-1,-1,-1);this.alignDirTable[19]=new THREE.Vector3(-1,-1,1);this.alignDirTable[20]=new THREE.Vector3(-1,1,-1);this.alignDirTable[21]=new THREE.Vector3(-1,1,1);this.alignDirTable[22]=new THREE.Vector3(1,-1,-1);this.alignDirTable[23]=new THREE.Vector3(1,-1,1);this.alignDirTable[24]=new THREE.Vector3(1,1,-1);this.alignDirTable[25]=new THREE.Vector3(1,1,1);this.useSnap=
this.combined=!1;this.lockDeltaX=0;this.lockedX=!1;this.lockDeltaY=this.lastSnapRotateX=0;this.lockedY=!1;this.lastSnapRotateY=0;this.lastSnapDir=new THREE.Vector3(0,0,0);this.bottomLimit=this.topLimit=!1;this.maxSceneBound=this.minSceneBound=0;var L={destinationPercent:1,duration:1,zoomToFitScene:!0,useOffAxis:!1};this.shotParams=L;var P,S;this.zoomDelta=new THREE.Vector2;var Y,U=new THREE.Vector3,Z=new THREE.Vector3;this.rewindParams={history:[],startTime:void 0,thumbnailSize:56,thumbnailGapSize:12,
maxHistorySize:25,snappingEnabled:!0,timelineIndex:0,timelineIndexSlide:0,open:!1,openLocation:new THREE.Vector2(0,0),openBracket:new THREE.Vector2(0,0),openBracketA:new THREE.Vector2(0,0),openBracketB:new THREE.Vector2(0,0),openLocationOrigin:new THREE.Vector2(0,0),locationOffset:new THREE.Vector2(0,0),snapOffset:new THREE.Vector2(0,0),slideOffset:new THREE.Vector2(0,0),snapped:!0,resetWeights:!1,recordEnabled:!1,elementIsRecording:!1};this.viewCubeMenuOpen=!1;this.menuSize=new THREE.Vector2(0,0);
this.menuOrigin=new THREE.Vector2(0,0);a.lookAt(this.center);this.setCube=function(a){p=a};this.loadObject=function(a,b,c){loader=new THREE.JSONLoader;loader.load(a,function(a,d){var g=new THREE.MeshPhongMaterial(d);mesh=new THREE.Mesh(a,g);mesh.scale=b;mesh.position.copy(c);mesh.geometry.computeBoundingBox();g=mesh.geometry.boundingBox.clone();Z.set(g.max.x,g.max.y,g.max.z);U.set(g.min.x,g.min.y,g.min.z);Z.multiply(b);U.multiply(b);scene.add(mesh);objects.push(mesh)})};this.sync=function(b){b.isPerspective!==
a.isPerspective&&(b.isPerspective?a.toPerspective():(a.toOrthographic(),b.saveFov&&(a.saveFov=b.saveFov)));a.fov=b.fov;a.position.copy(b.position);b.target&&(this.center.copy(b.target),a.target.copy(b.target));b.pivot&&(this.pivot.copy(b.pivot),a.pivot.copy(b.pivot));this.dir.copy(this.center).sub(a.position);this.setCameraUp(b.up);b=b.worldup?b.worldup:b.up;1E-4<b.distanceToSquared(this.sceneUpDirection)&&this.setWorldUpVector(b);C&&!this.navApi.getTransitionActive()&&(C=!1,this.setCurrentViewAsHome(!1));
p&&requestAnimationFrame(p.render)};this.refresh=function(){p&&p.refreshCube()};THREE.Box2.prototype.setCenter=function(a){var b=new THREE.Vector2(Math.abs(this.max.x-this.min.x)/2,Math.abs(this.max.y-this.min.y)/2);this.min.copy(a).sub(b);this.max.copy(a).add(b);return this};THREE.Box2.prototype.getIcon2DCoords=function(a,b){var c=this.center;b.set((a.x-c.x)/(this.size().x/2),(a.y-c.y)/(this.size().y/2))};THREE.Matrix3.prototype.makeRotationFromQuaternion=function(a){var b=this.elements,c=a.x,d=
a.y,g=a.z,f=a.w,h=c+c,k=d+d,l=g+g;a=c*h;var n=c*k,c=c*l,m=d*k,d=d*l,g=g*l,h=f*h,k=f*k,f=f*l;b[0]=1-(m+g);b[3]=n-f;b[6]=c+k;b[1]=n+f;b[4]=1-(a+g);b[7]=d-h;b[2]=c-k;b[5]=d+h;b[8]=1-(a+m);return this};THREE.Quaternion.prototype.setFromRotationMatrix3=function(a){var b=a.elements,c=b[0];a=b[3];var d=b[6],g=b[1],f=b[4],h=b[7],k=b[2],l=b[5],b=b[8],n=c+f+b;0<n?(c=.5/Math.sqrt(n+1),this.w=.25/c,this.x=(l-h)*c,this.y=(d-k)*c,this.z=(g-a)*c):c>f&&c>b?(c=2*Math.sqrt(1+c-f-b),this.w=(l-h)/c,this.x=.25*c,this.y=
(a+g)/c,this.z=(d+k)/c):f>b?(c=2*Math.sqrt(1+f-c-b),this.w=(d-k)/c,this.x=(a+g)/c,this.y=.25*c,this.z=(h+l)/c):(c=2*Math.sqrt(1+b-c-f),this.w=(g-a)/c,this.x=(d+k)/c,this.y=(h+l)/c,this.z=.25*c);return this};THREE.Quaternion.prototype.rotate=function(a){var b=(new THREE.Matrix4).makeRotationFromQuaternion(this).elements,b=(new THREE.Matrix3).set(b[0],b[1],b[2],b[4],b[5],b[6],b[8],b[9],b[10]);return a.applyMatrix3(b)};THREE.Vector3.prototype.findAngleWith=function(a,b){var c=0,d=this.clone().normalize().clone().dot(a.clone().normalize()),
c=this.clone().cross(a).clone().normalize();if(c.clone().length()<Number.MIN_VALUE)c=0<d?0:180;else{b=0<c.clone().dot(b.clone().normalize())?c:-c;var g=(new THREE.Quaternion).setFromAxisAngle(b,90*THREE.Math.degToRad),g=g.clone().rotate(a).clone().normalize().clone().dot(this),c=Math.acos(d)*THREE.Math.radToDeg;Math.abs(c-90)<Number.MIN_VALUE&&(c=90);if(90>c&&0<d*g||90<c&&0>d*g||90==c&&0<g)c*=-1}return c=THREE.Math.degToRad(c)};"contains"in String.prototype||(String.prototype.contains=function(a,
b){return-1!==String.prototype.indexOf.call(this,a,b)});Math.linearClamp=function(a,b,c){return a<=b?0:a>=c?1:(a-b)/(c-b)};Math.easeClamp=function(a,b,c){return a<=b?0:a>=c?1:.5*(Math.sin(((a-b)/(c-b)-.5)*Math.PI)+1)};Math.linearInterp=function(a,b,c){return b*(1-a)+c*a};Math.equalityClamp=function(a,b,c){return a<=b?b:a>=c?c:a};Math.round2=function(a){return Math.round(100*a)/100};Math.round1=function(a){return Math.round(10*a)/10};this.animateTransition=function(b){if(b){var c=!1,d=0;this.setCameraOrtho(b.isOrtho);
if(m.elapsedTime>=L.duration)d=1,m.center.copy(b.center),m.pivot.copy(b.pivot),a.position.copy(b.position),a.up.copy(b.up),b.isOrtho||(a.fov=b.fov),(c=!b.worldUp.equals(this.sceneUpDirection))&&this.setWorldUpVector(b.worldUp),this.currentlyAnimating=!1,g(c),this.showPivot(!1),p&&requestAnimationFrame(p.render),this.addHistoryElement(),this.navApi.setTransitionActive(!1);else{this.currentlyAnimating=!0;this.showPivot(!0);this.navApi.setTransitionActive(!0);d=Math.easeClamp(m.elapsedTime/L.duration,
0,L.destinationPercent);oneMinusTime=1-d;m.elapsedTime+=F/500;var c=m.center.clone().multiplyScalar(oneMinusTime).add(b.center.clone().multiplyScalar(d)),f=a.position.clone().multiplyScalar(oneMinusTime).add(b.position.clone().multiplyScalar(d)),h=a.up.clone().multiplyScalar(oneMinusTime).add(b.up.clone().multiplyScalar(d)),k=a.pivot.clone().multiplyScalar(oneMinusTime).add(b.pivot.clone().multiplyScalar(d)),l=this.sceneUpDirection.clone().multiplyScalar(oneMinusTime).add(b.worldUp.clone().multiplyScalar(d)),
d=a.fov*oneMinusTime+b.fov*d;m.center.copy(c);m.pivot.copy(k);a.position.copy(f);a.up.copy(h);b.isOrtho||(a.fov=d);(c=1E-4<l.distanceToSquared(this.sceneUpDirection))&&this.setWorldUpVector(l);a.lookAt(m.center);g(c);p&&requestAnimationFrame(p.render);requestAnimationFrame(function(){m.animateTransition(b)})}}};this.sphericallyInterpolateTransition=function(b){var c,d,f;c=0;this.currentlyAnimating=!0;this.navApi.setTransitionActive(!0);m.elapsedTime>=L.duration?(c=1,this.currentlyAnimating=!1):(c=
Math.easeClamp(m.elapsedTime/L.duration,0,L.destinationPercent),m.elapsedTime+=F/500);1===c?(d=S.position,c=S.center,f=S.up):(f=new THREE.Matrix3,d=I.clone(),d.slerp(G,c),f.makeRotationFromQuaternion(d),d=Math.linearInterp(c,J,M),f=f.elements,c=P.center.clone().multiplyScalar(1-c).add(S.center.clone().multiplyScalar(c)),d=c.clone().sub((new THREE.Vector3(f[0],f[1],f[2])).multiplyScalar(d)),f=new THREE.Vector3(f[3],f[4],f[5]));m.center.copy(c);a.position.copy(d);a.up.copy(f);m.navApi.getUsePivotAlways()||
m.pivot.copy(c);a.lookAt(m.center);!0===this.currentlyAnimating?(this.showPivot(!0),requestAnimationFrame(function(){m.sphericallyInterpolateTransition(b)})):(this.navApi.setTransitionActive(!1),this.showPivot(!1),this.addHistoryElement(),this.orthographicFaces&&this.isFaceView()&&this.setCameraOrtho(!0),b&&b());g(!1);p&&requestAnimationFrame(p.render)};this.getOrientation=function(){if(p){var b=Math.round1(a.up.x),c=Math.round1(a.up.y),d=Math.round1(a.up.z),g=this.sceneFrontDirection.clone(),f=this.sceneUpDirection.clone(),
h=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();g.x=Math.round1(g.x);g.y=Math.round1(g.y);g.z=Math.round1(g.z);f.x=Math.round1(f.x);f.y=Math.round1(f.y);f.z=Math.round1(f.z);h.x=Math.round1(h.x);h.y=Math.round1(h.y);h.z=Math.round1(h.z);var k=h.clone().multiplyScalar(-1),l=f.clone().multiplyScalar(-1),n=g.clone().multiplyScalar(-1);switch(p.currentFace){case "front":if(f.x==b&&f.y==c&&f.z==d)return"up";if(l.x==b&&l.y==c&&l.z==d)return"down";if(h.x==b&&h.y==c&&h.z==d)return"right";
if(k.x==b&&k.y==c&&k.z==d)return"left";break;case "right":if(f.x==b&&f.y==c&&f.z==d)return"up";if(l.x==b&&l.y==c&&l.z==d)return"down";if(n.x==b&&n.y==c&&n.z==d)return"left";if(g.x==b&&g.y==c&&g.z==d)return"right";break;case "left":if(f.x==b&&f.y==c&&f.z==d)return"up";if(l.x==b&&l.y==c&&l.z==d)return"down";if(g.x==b&&g.y==c&&g.z==d)return"left";if(n.x==b&&n.y==c&&n.z==d)return"right";break;case "back":if(f.x==b&&f.y==c&&f.z==d)return"up";if(l.x==b&&l.y==c&&l.z==d)return"down";if(k.x==b&&k.y==c&&k.z==
d)return"right";if(h.x==b&&h.y==c&&h.z==d)return"left";break;case "top":if(n.x==b&&n.y==c&&n.z==d)return"down";if(g.x==b&&g.y==c&&g.z==d)return"up";if(h.x==b&&h.y==c&&h.z==d)return"right";if(k.x==b&&k.y==c&&k.z==d)return"left";break;case "bottom":if(g.x==b&&g.y==c&&g.z==d)return"down";if(n.x==b&&n.y==c&&n.z==d)return"up";if(h.x==b&&h.y==c&&h.z==d)return"right";if(k.x==b&&k.y==c&&k.z==d)return"left"}}};this.setCameraOrtho=function(b){b&&a.isPerspective&&a.toOrthographic();b||a.isPerspective||a.toPerspective()};
this.resetOrientation=function(){this.setCameraOrtho(this.originalHomeVector.isOrtho);this.sceneUpDirection.copy(this.originalHomeVector.worldUp);this.sceneFrontDirection.copy(this.originalHomeVector.worldFront);this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize();this.setCameraUp(this.sceneUpDirection);g(!0)};this.setCurrentViewAsFront=function(){p&&(p.currentFace="front");this.sceneUpDirection.copy(a.up.clone());this.sceneFrontDirection.copy(this.getView()).normalize();
this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize();this.orthographicFaces&&this.setCameraOrtho(!0);g(!0)};this.setCurrentViewAsTop=function(){p&&(p.currentFace="top");this.sceneUpDirection.copy(this.getView()).multiplyScalar(-1).normalize();this.sceneFrontDirection.copy(a.up);this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize();g(!0)};this.calculateCubeTransform=function(b){var c=this.sceneUpDirection.clone(),d=this.sceneFrontDirection.clone(),
g=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();P=a.clone();P.center=m.center.clone();P.pivot=m.pivot.clone();S=a.clone();S.center=m.center.clone();S.pivot=m.pivot.clone();var f=new THREE.Vector3(0,0,0);b.contains("back")&&(f=f.add(d));b.contains("front")&&(f=f.sub(d));b.contains("top")&&(f=f.add(c));b.contains("bottom")&&(f=f.sub(c));b.contains("right")&&(f=f.add(g));b.contains("left")&&(f=f.sub(g));b=c;var h=f.clone().normalize();if(1-Math.abs(h.dot(c))<Number.MIN_VALUE)for(var k=
this.getView().normalize(),d=[d.clone(),d.clone().negate(),g.clone(),g.clone().negate()],c=0<h.dot(c)?1:-1,k=k.clone().add(a.up.clone().multiplyScalar(c)).normalize(),g=-2,h=0;4>h;h++){var l=k.dot(d[h]);l>g&&(g=l,b=d[h].multiplyScalar(c))}M=J=this.getView().length();S.position.copy(S.center.clone().add(f.multiplyScalar(M/f.length())));S.up.copy(b);f=P.center.clone().sub(P.position).normalize();b=f.clone().cross(P.up).normalize();d=b.clone().cross(f).normalize();c=new THREE.Matrix3;c.set(f.x,d.x,b.x,
f.y,d.y,b.y,f.z,d.z,b.z);I.setFromRotationMatrix3(c);f=S.center.clone().sub(S.position).normalize();b=f.clone().cross(S.up).normalize();d=b.clone().cross(f).normalize();c.set(f.x,d.x,b.x,f.y,d.y,b.y,f.z,d.z,b.z);H.setFromAxisAngle(f,0);K.setFromAxisAngle(d,0);G.setFromRotationMatrix3(c);G.multiply(H).multiply(K).normalize()};this.centerShot=function(b){if(!P||b)m.elapsedTime=0,P=S=a.clone(),P.center=m.center;b=m.pivot.clone();var c=b.clone().sub(P.position),d=P.center.clone().sub(P.position).normalize(),
f=P.up.clone(),h=d.clone().cross(f).normalize(),f=h.clone().cross(d).normalize(),d=h.clone().multiplyScalar(h.dot(c)),c=f.clone().multiplyScalar(f.dot(c)),c=d.clone().add(c);S.position.copy(P.position.clone().add(c));S.center=b;S.pivot=b;b=0;m.elapsedTime>=L.duration?b=1:(b=Math.easeClamp(m.elapsedTime/L.duration,0,L.destinationPercent),m.elapsedTime+=F/2E3);c=a.position.clone().multiplyScalar(1-b).add(S.position.clone().multiplyScalar(b));f=m.center.clone().multiplyScalar(1-b).add(S.center.clone().multiplyScalar(b));
d=m.pivot.clone().multiplyScalar(1-b).add(S.pivot.clone().multiplyScalar(b));a.position.copy(c);m.center.copy(f);m.pivot.copy(d);a.lookAt(m.center);g(!1);1===b?this.addHistoryElement():requestAnimationFrame(function(){m.centerShot(!1)})};this.levelShot=function(){var b=this.getView(),c=b.length(),d=this.sceneUpDirection.clone(),g=a.up.clone().normalize(),b=b.normalize(),f=b.dot(d);1-Math.abs(f)>Number.MIN_VALUE?(g=b.clone().cross(d),b=d.clone().cross(g),b.normalize()):b=g.clone();b.multiplyScalar(c);
c={center:b.add(a.position),up:d,position:a.position,pivot:m.center.clone().add(b),fov:a.fov,worldUp:d};m.elapsedTime=0;m.animateTransition(c)};this.fitToWindow=function(){var b=this.getView(),c=a.up.clone();b.normalize();c.normalize();S=a.clone();S.center=m.center;var d=c,c=d.clone();if(!(Math.abs(c.clone().dot(b))<Number.MIN_VALUE)&&(b.normalize(),c=d.clone().dot(b),c=b.clone().multiplyScalar(c),c=d.clone().sub(c),c.length()<Number.MIN_VALUE)){for(var d=new THREE.Vector3(0,0,0),c=[new THREE.Vector3(0,
1,0),new THREE.Vector3(1,0,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,1,1),new THREE.Vector3(1,0,1),new THREE.Vector3(1,1,0),new THREE.Vector3(1,1,1)],g=0;7>g;g++)if(Math.abs(c[g].dot(b))<Number.MIN_VALUE){d=c[g];break}c=d}c.normalize();c.normalize();S.up.copy(c);g=b.clone().cross(c);g.normalize();var f=U.clone(),h=Z.clone(),k=[f,h],d=new THREE.Vector3(h.x-f.x,h.y-f.y,h.z-f.z);k[2]=new THREE.Vector3(h.x,f.y,h.z);k[3]=new THREE.Vector3(h.x,f.y,f.z);k[4]=new THREE.Vector3(h.x,h.y,f.z);k[5]=new THREE.Vector3(f.x,
h.y,h.z);k[6]=new THREE.Vector3(f.x,h.y,f.z);k[7]=new THREE.Vector3(f.x,f.y,h.z);for(f=0;8>f;f++)h=k[f].clone().sub(a.position),k[f].setX(h.clone().dot(g)),k[f].setY(h.clone().dot(c)),k[f].setZ(h.clone().dot(b));var f=THREE.Math.degToRad(a.topFov),h=THREE.Math.degToRad(a.bottomFov),l=THREE.Math.degToRad(a.leftFov),n=THREE.Math.degToRad(a.rightFov),q,z,t,p;q=0<=l?Number.MAX_VALUE:Number.MIN_VALUE;z=0<=n?Number.MAX_VALUE:Number.MIN_VALUE;t=0<=f?Number.MAX_VALUE:Number.MIN_VALUE;p=0<=h?Number.MAX_VALUE:
Number.MIN_VALUE;for(var r=1/Math.tan(n),C=-1/Math.tan(l),M=1/Math.tan(f),F=-1/Math.tan(h),w=0;8>w;w++){var E=k[w].clone(),A=E.z-C*E.x;q=0<=l?Math.min(q,A):Math.max(q,A);A=E.z-r*E.x;z=0<=n?Math.min(z,A):Math.max(z,A);A=E.z-M*E.y;t=0<=f?Math.min(t,A):Math.max(t,A);A=E.z-F*E.y;p=0<=h?Math.min(p,A):Math.max(p,A)}k=(z-q)/(C-r);q=C*k+q;p=(p-t)/(M-F);t=M*p+t;M=0;q<=t?(f=(f-h)/2,Math.abs(f)>Number.MIN_VALUE&&(f=1/Math.tan(f),p=p-t/f+q/f),M=q):(f=(n-l)/2,Math.abs(f)>Number.MIN_VALUE&&(f=1/Math.tan(f),k=k-
q/f+t/f),M=t);f=new THREE.Vector3(k,p,M);g=g.clone().multiplyScalar(f.x);c=c.clone().multiplyScalar(f.y);f=b.clone().multiplyScalar(f.z);f=g.clone().add(c.clone().add(f));S.position.add(f);c=d.clone().sub(S.position).dot(b);S.center=S.position.clone().add(b.multiplyScalar(c));S.pivot=d.clone();b={center:S.center,up:S.up,position:S.position,pivot:S.pivot,fov:a.fov,worldUp:m.sceneUpDirection.clone()};m.elapsedTime=0;m.animateTransition(b)};this.updatePivotPosition=function(b){var c;c=new THREE.Vector3(b.x/
window.innerWidth*2-1,2*-(b.y/window.innerHeight)+1,.5);c=c.unproject(a);c=(new THREE.Raycaster(a.position,c.sub(a.position).normalize())).intersectObjects(objects);if("zoom"==m.mode)if(void 0!==c[0])b=c[0].point,m.pivot.copy(b);else{b.y=Math.abs(b.y-window.innerHeight);var d=a.position;c=m.center.clone().sub(d);var g=a.up,f=c.clone().cross(g),h=c.clone().length(),k=h*Math.tan(THREE.Math.degToRad(a.leftFov)),l=h*Math.tan(THREE.Math.degToRad(a.rightFov)),n=h*Math.tan(THREE.Math.degToRad(a.topFov)),
h=h*Math.tan(THREE.Math.degToRad(a.bottomFov)),k=b.x*(k+l)/window.innerWidth-k;b=b.y*(n+h)/window.innerHeight-h;g=g.clone().normalize().clone().multiplyScalar(b);f=f.clone().normalize().clone().multiplyScalar(k);m.ortho?b=d.clone().add(f).clone().add(g):(b=d,c=c.clone().add(g).clone().add(f));m.pivot.copy(b.clone().add(c))}else void 0!==c[0]?(wheel.cursorImage("pivot"),b=c[0].point,m.isMouseDown||m.pivot.copy(b)):wheel.cursorImage("SWInvalidArea")};this.onDrawHeight=function(b,c,d,g,f){b=new THREE.Vector3(0,
1,0);b=a.position.clone().dot(b);b=Math.linearClamp(b,m.minSceneBound,m.maxSceneBound)-.5;r&&(r.find("img#updownImageA").remove(),r.prepend('<img src="'+f+'SWheighthandleA.png" id="updownImageA" style="position:fixed; z-index:9999; top:'+(d-86*b)+"px; left:"+c+'px;"/>'),g||r.prepend('<img src="'+f+'SWheighthandleI.png" id="updownImageI" style="position:fixed; z-index:9998; top:'+(d-86*b)+"px; left:"+c+'px;"/>'))};this.drawDropdownMenu=function(a,b,d,g,f,h,k){var l=0;if(t)h.appendChild(t);else{t=document.createElement("div");
t.className="dropDownMenu";t.style.top="100px";t.style.left="-400px";for(var n=0,m=0;m<a.length;m++){var q;if(null===a[m])q=document.createElement("li"),q.style.height="1px",n+=1,q.style.backgroundColor="#E0E0E0";else{var p=Autodesk.Viewing.i18n.translate(a[m]);if(d[m]){q=document.createElement("div");var z=document.createElement("input"),r=document.createElement("label");z.type="checkbox";z.className="dropDownMenuCheck";r.innerHTML=p;r.className="dropDownMenuCheckText";q.appendChild(z);q.appendChild(r);
q.className="dropDownMenuCheckbox"}else q=document.createElement("li"),q.textContent=p,q.className=b[m]?"dropDownMenuItem":"dropDownMenuItemDisabled";q.id="menuItem"+l;l++;n+=25;q.setAttribute("data-i18n",a[m])}t.appendChild(q)}h.appendChild(t);l=t.getBoundingClientRect().width;this.menuSize.x=l;this.menuSize.y=n}for(m=l=0;m<a.length;m++)null!==a[m]&&(d[m]&&(n=document.getElementById("menuItem"+l))&&(n.children[0].checked=d[m]()),l++);a=f-15;d=g+1;f=c.getBoundingClientRect();d+this.menuSize.x>f.right&&
(d=g-this.menuSize.x-1);a+this.menuSize.y>f.bottom&&(a=f.bottom-this.menuSize.y);a-=k.y;d-=k.x;t.style.top=a+"px";t.style.left=d+"px";this.menuOrigin.x=d;this.menuOrigin.y=a};this.removeDropdownMenu=function(a){a.removeChild(t)};this.isFaceView=function(){var b=this.center.clone().sub(a.position).normalize();return q(b)&&q(a.up)};this.startInteraction=function(a,b){this.startCursor=new THREE.Vector2(a,b);this.startState={saveCenter:this.center.clone(),saveEye:this.camera.position.clone(),savePivot:this.pivot.clone(),
saveUp:this.camera.up.clone()};this.lockDeltaX=0;this.lockedX=!1;this.lockDeltaY=this.lastSnapRotateX=0;this.lockedY=!1;this.lastSnapRotateY=0;this.lastSnapDir=new THREE.Vector3(0,0,0)};this.orbit=function(b,c,d,f){if(!this.navApi.getIsLocked()&&!0!==this.currentlyAnimating){var l="wheel";m.orthographicFaces&&!a.isPerspective&&(a.toPerspective(),f&&f.saveEye.copy(this.camera.position));f&&(l="cube");"cube"==l?(this.saveCenter.copy(f.saveCenter),this.saveEye.copy(f.saveEye),this.savePivot.copy(f.savePivot),
this.saveUp.copy(f.saveUp),this.doCustomOrbit=this.useSnap=!0):(this.saveCenter.copy(this.center),this.savePivot.copy(this.pivot),this.saveEye.copy(a.position),this.saveUp.copy(a.up),this.doCustomOrbit=this.useSnap=!1);m.combined&&void 0==E&&(E=this.saveCenter.clone(),w=this.saveEye.clone(),D=this.savePivot.clone(),A=this.saveUp.clone());if(this.preserveOrbitUpDirection){var l=h(b.x-c.x,b.y-c.y),n=h(d.x,d.y);c=this.sceneUpDirection.clone();var q=this.sceneFrontDirection.clone(),p=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();
d=m.combined?D:this.savePivot;f=m.combined?w:this.saveEye;var t=m.combined?E:this.saveCenter,z=m.combined?A:this.saveUp,r=d.clone().sub(f).normalize(),C=t.clone().sub(f).normalize(),M=C.clone().cross(z);b=f.clone().sub(d).length();f=f.clone().sub(t).length();r=r.clone().multiplyScalar(-1);C=C.clone().multiplyScalar(-1);z=z.clone();this.constrainOrbitHorizontal||(-.009>c.dot(this.saveUp)&&(l.x=-l.x,n.x=-n.x),t=0,this.lastSnapRotateX=t=m.combined?n.x*this.orbitMultiplier:this.useSnap?this.lastSnapRotateX+
k("h",0,-n.x):l.x*this.orbitMultiplier,t=(new THREE.Quaternion).setFromAxisAngle(c,-t),r.applyQuaternion(t),C.applyQuaternion(t),M.applyQuaternion(t),z.applyQuaternion(t));this.constrainOrbitVertical||(q=q.clone().multiplyScalar(q.dot(M)),p=p.clone().multiplyScalar(p.dot(M)),p=q.clone().add(p),p.clone().normalize(),M=0,m.combined?M=n.y*this.orbitMultiplier:(n=k("v",0,n.y),M=this.useSnap?this.lastSnapRotateY+n:l.y*this.orbitMultiplier),l=(new THREE.Quaternion).setFromAxisAngle(p,-M),this.navApi.getOrbitPastWorldPoles()||
(n=z.clone(),n.applyQuaternion(l).normalize(),0>c.dot(n)&&(n=C.clone(),n.applyQuaternion(l).normalize(),c=n.angleTo(c),Math.abs(c)>.5*Math.PI&&(c-=0<c?Math.PI:-Math.PI),M-=c,l.setFromAxisAngle(p,-M))),r.applyQuaternion(l).normalize(),C.applyQuaternion(l).normalize(),z.applyQuaternion(l).normalize(),this.lastSnapRotateY=M);d=r.multiplyScalar(b).add(d);a.position.copy(d);a.up.copy(z);this.center.copy(d);this.center.sub(C.multiplyScalar(f));m.combined&&(E.copy(this.center),w.copy(a.position),D.copy(this.pivot),
A.copy(a.up))}a.lookAt(this.center);g(!1)}};this.endInteraction=function(){};this.look=function(b){if(!this.navApi.getIsLocked()){var c=h(b.x,b.y),d=this.userLookSpeed;b=this.getView();var f=a.up,k=b.clone().cross(f).normalize(),l=this.sceneUpDirection.clone(),c=c.clone();c.x*=Math.PI;c.y*=Math.PI/a.aspect;c.multiplyScalar(d);d=(new THREE.Quaternion).setFromAxisAngle(k,-c.y);if(a.keepSceneUpright&&!this.navApi.getOrbitPastWorldPoles()){var n=f.clone();n.applyQuaternion(d).normalize();0>n.dot(l)&&
(n=b.clone(),n.applyQuaternion(d),n=n.angleTo(l),Math.abs(n)>.5*Math.PI&&(n-=0<n?Math.PI:-Math.PI),c.y-=n,d.setFromAxisAngle(k,-c.y))}b=d.clone().rotate(b);f=d.clone().rotate(f);f.normalize();k=a.keepSceneUpright?l:f;k=(new THREE.Quaternion).setFromAxisAngle(k,-c.x);b=k.clone().rotate(b);f=k.clone().rotate(f);this.center.copy(b.add(a.position));a.up.copy(f);a.lookAt(this.center);g(!1)}};this.pan=function(b){if(!this.navApi.getIsLocked()){b=h(b.x,b.y);var c=this.getView(),d=a.up.clone().cross(c),f=
c.clone().cross(d);d.normalize();f.normalize();c.normalize();var k=this.pivot.clone().sub(a.position),k=c.clone().dot(k),c=k*(Math.tan(THREE.Math.degToRad(a.leftFov))+Math.tan(THREE.Math.degToRad(a.rightFov))),k=k*(Math.tan(THREE.Math.degToRad(a.topFov))+Math.tan(THREE.Math.degToRad(a.bottomFov))),c=b.x*Math.abs(c);b=b.y*Math.abs(k);k=new THREE.Vector3;d=d.clone().multiplyScalar(c);f=f.clone().multiplyScalar(b);k=d.clone().add(f).clone().multiplyScalar(this.userPanSpeed);a.position.add(k);this.center.add(k);
a.lookAt(this.center);g(!1)}};this.zoom=function(b){if(!this.navApi.getIsLocked()){var c=this.userZoomSpeed,d=Number.MAX_VALUE;b=b.x+b.y;var f=Math.pow(c,b),h=this.pivot.clone().sub(this.pivot.clone().sub(this.saveEye).clone().multiplyScalar(f)),k=h.clone().add(m.D.clone().multiplyScalar(m.D.clone().dot(this.pivot.clone().sub(h).clone())));if(!(f>=d)){if(0<b){Math.pow(c,b-0);if(0>b)return;a.position.copy(h);this.center.copy(k);h.clone().sub(this.saveEye).dot(m.D)>d&&a.position.copy(this.saveEye.sub(m.D).clone().multiplyScalar(d))}else a.position.copy(h),
this.center.copy(k);a.lookAt(this.center);g(!1)}}};this.walk=function(b,c,d,f,k){if(!this.navApi.getIsLocked()){d=this.sceneUpDirection.clone();f=this.sceneFrontDirection.clone();k=this.sceneFrontDirection.clone().cross(this.sceneUpDirection);l(b,c)?(wheel.cursorImage("SWWalk"),n(!0,b,c),x=c.x,y=c.y):n(!1,b,c);x=b.x;y=b.y;var m=h(x-c.x,y-c.y),q=-m.x,t=-m.y,p=0>q?-1:1,m=0>t?-1:1,z=Math.abs(q),r=Math.abs(t),r=new THREE.Vector2(30,30),r=h(r.x,r.y),z=l(b,c)?0:Math.abs(q)-r.x,r=l(b,c)?0:Math.abs(t)-r.y,
z=z/.25,r=r/.25,z=1>z?Math.easeClamp(z,0,1):Math.pow(z,1),r=1>r?Math.easeClamp(r,0,1):Math.pow(r,1),q=0<z?z*p:0,m=0<r?r*m:0;b=this.getView();c=b.length();b.normalize();b.clone().cross(a.up).normalize();k=k.clone().multiplyScalar(k.clone().dot(b));k=f.clone().multiplyScalar(f.clone().dot(b)).clone().add(k);k=k.clone().length()>Number.MIN_VALUE?k.normalize():a.up;f=1*m*this.walkMultiplier;m=Math.cos(.65);1!=m&&(d.clone().dot(a.up)<-Number.MIN_VALUE&&d.clone().dot(b)<-m||d.clone().dot(a.up)>Number.MIN_VALUE&&
d.clone().dot(b)>m)&&(k=-k);q=-q*this.walkMultiplier*.05;m=a.up;if(d.clone().dot(a.up)<-Number.MIN_VALUE||Math.abs(d.clone().dot(a.up))<Number.MIN_VALUE&&d.clone().dot(b)>Number.MIN_VALUE)q=-q;m=d;q=(new THREE.Quaternion).setFromAxisAngle(m,q);q.normalize();b=q.clone().rotate(b);b.normalize();a.up.copy(q.clone().rotate(a.up));a.up.normalize();a.position.add(k.clone().multiplyScalar(f));this.center.copy(a.position.clone().add(b.clone().multiplyScalar(c)));d.normalize();a.lookAt(this.center);g(!1)}};
this.updown=function(b){if(!this.navApi.getIsLocked()){var c=Math.pow(b,2);0>b&&(c=-c);c=h(0,c);c.y=.01*c.y*(m.maxSceneBound-m.minSceneBound);c=m.userHeightSpeed*c.y;var d=m.m_amount;if(0===b)c=0;else{var f=m.saveEye.clone().sub(worldUp.clone().multiplyScalar(d+c)),d=m.saveEye.clone().sub(worldUp.clone().multiplyScalar(d)),k=0,k=(m.maxSceneBound-m.minSceneBound)/1E3;m.topLimit&&0<b?(k=m.maxSceneBound-k,m.topLimit=!1):m.bottomLimit&&0>b?(k=m.minSceneBound+k,m.bottomLimit=!1):k=f.dot(worldUp);b=d.dot(worldUp);
k<m.minSceneBound?b<m.minSceneBound&&(m.bottomLimit=!0,c=0):k>m.maxSceneBound&&b>m.maxSceneBound&&(m.topLimit=!0,c=0)}m.m_amount+=c;b=new THREE.Vector3(0,1,0);c=m.saveEye.clone().sub(b.clone().multiplyScalar(m.m_amount));f=c.clone().dot(b);a.position.copy(c);f<m.minSceneBound&&a.position.add(b.clone().multiplyScalar(m.minSceneBound-f));f>m.maxSceneBound&&a.position.add(b.clone().multiplyScalar(m.maxSceneBound-f));this.center.copy(a.position.clone().add(m.saveCenter.clone().sub(m.saveEye)));a.lookAt(this.center);
g(!1)}};this.addHistoryElement=function(){};this.addIntermediateHistoryElement=function(){this.rewindParams.history=this.rewindParams.snapped?this.rewindParams.history.slice(0,this.rewindParams.timelineIndex):0<this.rewindParams.slideOffset.x?this.rewindParams.history.slice(0,this.rewindParams.timelineIndex):this.rewindParams.history.slice(0,this.rewindParams.timelineIndex+1);this.addHistoryElement()};this.clearHistory=function(){this.rewindParams.history.length=0;this.rewindParams.timelineIndex=
0;this.rewindParams.timelineIndexSlide=0;this.rewindParams.resetWeights=!0};this.openTimeline=function(a){this.rewindParams.timelineIndexSlide=this.rewindParams.timelineIndex;this.rewindParams.resetWeights&&(this.rewindParams.slideOffset.x=0,this.rewindParams.snapped=this.rewindParams.snappingEnabled);0===this.rewindParams.history.length&&this.addHistoryElement();for(var b=0;b<this.rewindParams.history.length;b++){var c=this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize;this.rewindParams.history[b].thumbnailBounds.setCenter((new THREE.Vector2(a.x+
(b-this.rewindParams.timelineIndex)*c,a.y)).add(this.rewindParams.slideOffset));this.rewindParams.resetWeights&&(this.rewindParams.history[b].weight=b==this.rewindParams.timelineIndex?1:0)}this.rewindParams.resetWeights&&(this.rewindParams.resetWeights=!1);c=2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize);this.rewindParams.open=!0;this.rewindParams.openLocation=a.clone();this.rewindParams.openLocationOrigin=a.clone();this.rewindParams.openBracket=a.clone();this.rewindParams.openBracketA=
new THREE.Vector2(c,a.y);this.rewindParams.openBracketB=new THREE.Vector2(window.innerWidth-c,a.y);this.rewindParams.openBracketA.x>this.rewindParams.openBracketB.x&&(a=this.rewindParams.openBracketA.x,this.rewindParams.openBracketA.x=this.rewindParams.openBracketB.x,this.rewindParams.openBracketB.x=a);this.rewindParams.locationOffset=new THREE.Vector2(0,0);this.rewindParams.snapOffset=new THREE.Vector2(0,0)};this.slideTimeline=function(a){if(this.rewindParams.open&&0!==this.rewindParams.history.length){var b=
a.clone().add(this.rewindParams.locationOffset),c=2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize);a=window.innerWidth-c;var d=this.rewindParams.history[0].thumbnailBounds.center().x,g=this.rewindParams.history[this.rewindParams.history.length-1].thumbnailBounds.center().x,f=0;b.x<this.rewindParams.openBracketA.x&&(f=b.x-this.rewindParams.openBracketA.x,d-=f,c<d&&(f=Math.min(f+(d-c),0)));b.x>this.rewindParams.openBracketB.x&&(f=b.x-this.rewindParams.openBracketB.x,c=g-f,a>c&&
(f=Math.max(f+(c-a),0)));this.rewindParams.openLocation.x+=f;this.rewindParams.openBracketA.x+=f;this.rewindParams.openBracketB.x+=f;this.rewindParams.openBracket.x=b.x-(this.rewindParams.openLocation.x-this.rewindParams.openLocationOrigin.x);a=new THREE.Vector2(-f,0);b=b.clone().sub(this.rewindParams.openLocation.clone().sub(this.rewindParams.openLocationOrigin));a.x+=this.rewindParams.snapOffset.x;this.rewindParams.snapOffset.x=0;c=!1;if(this.rewindParams.snappingEnabled)for(g=0;g<this.rewindParams.history.length;g++)if(d=
this.rewindParams.history[g].thumbnailBounds.center().add(a),4>Math.abs(d.x-b.x)||this.rewindParams.snapped&&16>Math.abs(d.x-b.x)){c=!0;0!==f?(this.rewindParams.snapOffset.x=d.x-b.x,a.x-=this.rewindParams.snapOffset.x):this.rewindParams.openBracket.x+=d.x-b.x;b.x=d.x;break}this.rewindParams.snapped=c;c=-1;for(g=f=0;g<this.rewindParams.history.length;g++){d=this.rewindParams.history[g].thumbnailBounds.clone();this.rewindParams.history[g].thumbnailBounds.setCenter(this.rewindParams.history[g].thumbnailBounds.center().add(a));
if(this.rewindParams.history[g].thumbnail){var h=this.rewindParams.history[g].thumbnailBounds.center().x-this.rewindParams.thumbnailSize/2;$("#rewindFrame"+g).css("left",h);$("#rewindBorder"+g).css("left",h-4)}h=new THREE.Vector2(2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize),2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize));d.setFromCenterAndSize(d.center(),h);h=new THREE.Vector2(0,0);d.getIcon2DCoords(b,h);h=1-Math.abs(Math.equalityClamp(h.x,-1,1));
this.rewindParams.history[g].weight=h;0===g&&b.x<d.center().x&&(this.rewindParams.history[g].weight=1);g===this.rewindParams.history.length-1&&b.x>d.center().x&&(this.rewindParams.history[g].weight=1);f+=this.rewindParams.history[g].weight;this.rewindParams.history[g].weight>c&&(c=this.rewindParams.history[g].weight,this.rewindParams.snappingEnabled&&1==this.rewindParams.history[g].weight?(this.rewindParams.slideOffset.x=0,this.rewindParams.snapped=!0):this.rewindParams.slideOffset.x=this.rewindParams.history[g].thumbnailBounds.center().x-
b.x,this.rewindParams.timelineIndexSlide=g)}for(a=0;a<this.rewindParams.history.length;a++)this.rewindParams.history[a].weight/=f;a=this.rewindParams.history[0].thumbnailBounds.center().x;b=this.rewindParams.history[this.rewindParams.history.length-1].thumbnailBounds.center().x;this.rewindParams.openBracket.x<a?(this.rewindParams.locationOffset.x+=a-this.rewindParams.openBracket.x,this.rewindParams.openBracket.x=a):this.rewindParams.openBracket.x>b&&(this.rewindParams.locationOffset.x+=b-this.rewindParams.openBracket.x,
this.rewindParams.openBracket.x=b)}};this.shiftBackOneElement=function(){0!==this.rewindParams.history.length&&(0<this.rewindParams.timelineIndex||0!==this.rewindParams.slideOffset.x)&&((this.rewindParams.snapped||0<this.rewindParams.slideOffset.x)&&this.rewindParams.timelineIndex--,this.rewindParams.timelineIndexSlide=this.rewindParams.timelineIndex,this.rewindParams.resetWeights=!0,m.elapsedTime=0,this.animateToRewindIndex())};this.animateToRewindIndex=function(){var b=this.rewindParams.timelineIndex,
c=0;m.elapsedTime>=L.duration?c=1:(c=Math.easeClamp(m.elapsedTime/L.duration,0,L.destinationPercent),m.elapsedTime+=F/500);m.center.copy(m.center.clone().multiplyScalar(1-c).clone().add(this.rewindParams.history[b].camera.center.clone().multiplyScalar(c)));a.position.copy(a.position.clone().multiplyScalar(1-c).clone().add(this.rewindParams.history[b].camera.position.clone().multiplyScalar(c)));a.up.copy(this.rewindParams.history[b].camera.up);m.pivot.copy(m.center);a.lookAt(m.center);g(!1);p&&requestAnimationFrame(p.render);
1!==c&&requestAnimationFrame(function(){m.animateToRewindIndex()})};this.closeTimeline=function(){this.rewindParams.timelineIndex!=this.rewindParams.timelineIndexSlide&&(this.rewindParams.timelineIndex=this.rewindParams.timelineIndexSlide);this.rewindParams.open=!1};this.getInterpolatedCamera=function(){var b=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,1E4);b.center=new THREE.Vector3(0,0,0);b.pivot=new THREE.Vector3(0,0,0);b.leftFov=0;b.rightFov=0;b.topFov=0;b.bottomFov=
0;b.up.set(0,0,0);for(var c=0;c<this.rewindParams.history.length;c++){var d=this.rewindParams.history[c].camera,f=this.rewindParams.history[c].weight;b.center.add(d.center.clone().multiplyScalar(f));b.position.add(d.position.clone().multiplyScalar(f));b.up.add(d.up.clone().multiplyScalar(f));b.rotation.add(d.rotation.clone().multiplyScalar(f));b.pivot.add(d.pivot.clone().multiplyScalar(f));b.leftFov+=d.leftFov*f;b.rightFov+=d.rightFov*f;b.topFov+=d.topFov*f;b.bottomFov+=d.bottomFov*f}a.position.copy(b.position);
a.up.copy(b.up);a.rotation=b.rotation;a.leftFov=b.leftFov;a.rightFov=b.rightFov;a.topFov=b.topFov;a.bottomFov=b.bottomFov;m.center.copy(b.center);m.pivot.copy(b.pivot);a.lookAt(m.center);a.up.normalize();g(!1)}};
Autocam.ViewCube=function(a,b,c,f){function d(a,b){var c={};0===a.type.indexOf("touch")?0<a.touches.length?(c.clientX=a.touches[0].clientX,c.clientY=a.touches[0].clientY,c.pageX=a.touches[0].pageX,c.pageY=a.touches[0].pageY,c.screenX=a.touches[0].screenX,c.screenY=a.touches[0].screenY,c.movementX=c.screenX-b.prevX,c.movementY=c.screenY-b.prevY,c.which=h.navApi.getUseLeftHandedInput()?3:1):c=b.prevCoords:(c.clientX=a.clientX,c.clientY=a.clientY,c.pageX=a.pageX,c.pageY=a.pageY,c.screenX=a.screenX,c.screenY=
a.screenY,c.which=a.which,fa?(c.movementX=a.movementX||a.mozMovementX||a.webkitMovementX||0,c.movementY=a.movementY||a.mozMovementY||a.webkitMovementY||0):(c.movementX=c.screenX-b.prevX,c.movementY=c.screenY-b.prevY));b.prevX=c.screenX;b.prevY=c.screenY;return b.prevCoords=c}var g=this,h=b,k=b.camera;b.setCube(this);g.currentFace="front";var l="top,front;top right;top,left;top,back;bottom,front;bottom,right;bottom,left;bottom,back;left,front;front,right;right,back;back,left".split(";"),n="front,top,right back,top,right front,top,left back,top,left front,bottom,right back,bottom,right front,bottom,left back,bottom,left".split(" "),
q=["Go Home",null,"Orthographic","Perspective","Perspective with Ortho Faces",null,"Set current view as Home","Focus and set as Home","Reset Home",null,"Set current view as Front","Set current view as Top","Reset orientation"],m=[!0,null,!0,!0,!0,null,!0,!0,!0,null,!0,!0,!0],p=[null,null,function(){return!h.orthographicFaces&&!k.isPerspective},function(){return!h.orthographicFaces&&k.isPerspective},function(){return h.orthographicFaces},null,null,null,null,null,null,null,null],t,r,B,z,F,C,w;g.camera=
new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,2E3);g.camera.position.copy(k.position);g.center=new THREE.Vector3(0,0,0);g.camera.lookAt(g.center);var E,A,D,I,G,H=[],K,J=[],M=[],L=[],P=[],S=null,Y=null,U=null,Z,da,V,O,ca,W=0,N,ea=0,ba=!0,fa=!1,X=!1,ia=-1!=navigator.userAgent.search("Chrome"),aa=-1!=navigator.platform.search("Win32"),R=!1,pa=!1,ha=[];this.height=this.width=0;this.animSpeed=500;this.animate=!0;this.compass=!1;this.viewScaleFactorCompass=1.5;this.viewScale=1;this.draggable=
!0;this.wantHomeButton=!1;this.wantContextMenu=this.wantRollArrows=!0;this.inactiveOpacity=.5;var la=function(a){a=a.getBoundingClientRect();return{x:a.left,y:a.top,w:a.width,h:a.height}},za=function(){h.navApi.getIsLocked()||(c.style.opacity="1.0",pa=!1);requestAnimationFrame(g.render)},Na=function(a){if(pa||h.viewCubeMenuOpen||h.navApi.getIsLocked())h.navApi.getIsLocked()||(c.style.opacity=1);else{var b=Math.max(4*Math.abs((a.clientX-N.x)/N.w-.5)-1,0);a=Math.max(4*Math.abs((a.clientY-N.y)/N.h-.5)-
1,0);b=Math.max(0,Math.min(Math.sqrt(b*b+a*a),1));c.style.opacity=1-b*(1-g.inactiveOpacity)}},sa=function(){h.viewCubeMenuOpen||(c.style.opacity=g.inactiveOpacity,pa=!0,requestAnimationFrame(g.render))},va=function(a){var b=new Image;b.crossOrigin="anonymous";var c=new THREE.Texture(b);b.onload=function(){c.needsUpdate=!0;ea++;11<=ea&&requestAnimationFrame(g.render)};b.src=a;return c},Ba=function(a,b,c){var d=new THREE.Vector3;d.copy(a);d=d.unproject(b);return(new THREE.Raycaster(b.position,d.sub(b.position).normalize())).intersectObjects(c)},
xa=function(a,b){var c=a.clientX-b.x,d=a.clientY-b.y,c=c/b.w*2-1,d=(b.h-d)/b.h*2-1;return new THREE.Vector3(c,d,.5)},Ja=function(a){a.preventDefault();a.stopPropagation();if(!h.navApi.getIsLocked()&&!h.currentlyAnimating){a=d(a,g);N=la(c);c.removeEventListener("mousemove",Ea,!1);document.addEventListener("mouseup",Ca,!1);document.addEventListener("touchend",Ca,!1);h.navApi.getUsePivotAlways()||(h.pivot.copy(h.center),h.navApi.setPivotPoint(h.center),h.navApi.setPivotSetFlag(!1));h.startInteraction(a.pageX,
a.pageY);0==h.rewindParams.history.length&&h.addHistoryElement();h.rewindParams.snapped&&h.rewindParams.timelineIndex+1==h.rewindParams.history.length||h.addIntermediateHistoryElement();var b=h.navApi.getUseLeftHandedInput()?1:3;a.which!==b&&(0>=g.animSpeed?console.error("animSpeed cannot be 0 or less, use ViewCube.animate flag to turn on and off animation"):(a=xa(a,N),a=Ba(a,g.camera,P),0<a.length&&(ma(),g.draggable&&(document.addEventListener("mousemove",Ha,!1),document.addEventListener("touchmove",
Ha,!1),fa&&(c.requestPointerLock(),X=ia&&aa)))))}},Ha=function(a){a.preventDefault();a.stopPropagation();0>=g.animSpeed?(document.removeEventListener("mousemove",Ha,!1),document.removeEventListener("touchmove",Ha,!1),console.error("animSpeed cannot be 0 or less")):h.currentlyAnimating||(a=d(a,g),fa&&X&&(X=!1,a.movementX=a.movementY=0),a.movementX===a.movementY&&0===a.movementX?h.currentlyAnimating=!1:(ba=!1,R=!0,h.showPivot(!0),h.currentCursor=new THREE.Vector2(a.pageX,a.pageY),h.orbit(h.currentCursor,
h.startCursor,new THREE.Vector3(-a.movementX,a.movementY,0),h.startState),g.camera.lookAt(g.center),requestAnimationFrame(g.render)))},Ga=function(a){a||(document.removeEventListener("mouseup",Ca,!1),document.removeEventListener("touchend",Ca,!1));document.removeEventListener("mousemove",Ha,!1);document.removeEventListener("touchmove",Ha,!1);c.addEventListener("mousemove",Ea,!1)},Ca=function(a){a.preventDefault();a.stopPropagation();var b,f,l;if(h.currentlyAnimating||R)h.endInteraction(),h.showPivot(!1),
R=!1,Ga(!1);else{var n=d(a,g);if(h.viewCubeMenuOpen){a=n.clientX-N.x;b=n.clientY-N.y;if(h.menuOrigin.x<=a&&a<=h.menuOrigin.x+h.menuSize.x&&h.menuOrigin.y<=b&&b<=h.menuOrigin.y+h.menuSize.y)switch(Math.floor((b-5-h.menuOrigin.y)/25)){case 0:h.goHome();break;case 1:h.setOrthographicFaces(!1);h.toOrthographic();break;case 2:h.setOrthographicFaces(!1);h.toPerspective();break;case 3:h.setOrthographicFaces(!0);ba?h.toOrthographic():h.toPerspective();break;case 4:h.setCurrentViewAsHome(!1);break;case 5:h.setCurrentViewAsHome(!0);
break;case 6:h.resetHome();break;case 7:h.setCurrentViewAsFront();break;case 8:h.setCurrentViewAsTop();break;case 9:h.resetOrientation()}h.viewCubeMenuOpen=!1;h.removeDropdownMenu(c);(n.clientX<N.x||n.clientX>N.w+N.x||n.clientY<N.y||n.clientY>N.h+N.y)&&sa();g.mouseMoveSave&&g.processMouseMove(g.mouseMoveSave);Ga(!1)}else if(b=h.navApi.getUseLeftHandedInput()?1:3,n.which===b)h.viewCubeMenuOpen=!0,h.drawDropdownMenu(q,m,p,n.clientX,n.clientY,c,N),Ga(!0);else{l=xa(n,N);b=Ba(l,g.camera,P);f=Ba(l,w,J);
l=Ba(l,w,L);if(0<f.length&&ba){var z=h.getOrientation();switch(g.currentFace){case "front":switch(z){case "up":f[0].object===J[0]?(h.calculateCubeTransform("top"),g.currentFace="top"):f[0].object===J[1]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):f[0].object===J[2]?(h.calculateCubeTransform("right"),g.currentFace="right"):f[0].object===J[3]&&(h.calculateCubeTransform("left"),g.currentFace="left");break;case "right":f[0].object===J[0]?(h.calculateCubeTransform("right"),g.currentFace=
"right"):f[0].object===J[1]?(h.calculateCubeTransform("left"),g.currentFace="left"):f[0].object===J[2]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):f[0].object===J[3]&&(h.calculateCubeTransform("top"),g.currentFace="top");break;case "down":f[0].object===J[0]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):f[0].object===J[1]?(h.calculateCubeTransform("top"),g.currentFace="top"):f[0].object===J[2]?(h.calculateCubeTransform("left"),g.currentFace="left"):f[0].object===J[3]&&
(h.calculateCubeTransform("right"),g.currentFace="right");break;case "left":f[0].object===J[0]?(h.calculateCubeTransform("left"),g.currentFace="left"):f[0].object===J[1]?(h.calculateCubeTransform("right"),g.currentFace="right"):f[0].object===J[2]?(h.calculateCubeTransform("top"),g.currentFace="top"):f[0].object===J[3]&&(h.calculateCubeTransform("bottom"),g.currentFace="bottom")}break;case "right":switch(z){case "up":f[0].object===J[0]?(h.calculateCubeTransform("top"),g.currentFace="top"):f[0].object===
J[1]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):f[0].object===J[2]?(h.calculateCubeTransform("back"),g.currentFace="back"):f[0].object===J[3]&&(h.calculateCubeTransform("front"),g.currentFace="front");break;case "right":f[0].object===J[0]?(h.calculateCubeTransform("back"),g.currentFace="back"):f[0].object===J[1]?(h.calculateCubeTransform("front"),g.currentFace="front"):f[0].object===J[2]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):f[0].object===J[3]&&(h.calculateCubeTransform("top"),
g.currentFace="top");break;case "down":f[0].object===J[0]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):f[0].object===J[1]?(h.calculateCubeTransform("top"),g.currentFace="top"):f[0].object===J[2]?(h.calculateCubeTransform("front"),g.currentFace="front"):f[0].object===J[3]&&(h.calculateCubeTransform("back"),g.currentFace="back");break;case "left":f[0].object===J[0]?(h.calculateCubeTransform("front"),g.currentFace="front"):f[0].object===J[1]?(h.calculateCubeTransform("back"),g.currentFace=
"back"):f[0].object===J[2]?(h.calculateCubeTransform("top"),g.currentFace="top"):f[0].object===J[3]&&(h.calculateCubeTransform("bottom"),g.currentFace="bottom")}break;case "left":switch(z){case "up":f[0].object===J[0]?(h.calculateCubeTransform("top"),g.currentFace="top"):f[0].object===J[1]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):f[0].object===J[2]?(h.calculateCubeTransform("front"),g.currentFace="front"):f[0].object===J[3]&&(h.calculateCubeTransform("back"),g.currentFace="back");
break;case "right":f[0].object===J[0]?(h.calculateCubeTransform("front"),g.currentFace="front"):f[0].object===J[1]?(h.calculateCubeTransform("back"),g.currentFace="back"):f[0].object===J[2]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):f[0].object===J[3]&&(h.calculateCubeTransform("top"),g.currentFace="top");break;case "down":f[0].object===J[0]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):f[0].object===J[1]?(h.calculateCubeTransform("top"),g.currentFace="top"):f[0].object===
J[2]?(h.calculateCubeTransform("back"),g.currentFace="back"):f[0].object===J[3]&&(h.calculateCubeTransform("front"),g.currentFace="front");break;case "left":f[0].object===J[0]?(h.calculateCubeTransform("back"),g.currentFace="back"):f[0].object===J[1]?(h.calculateCubeTransform("front"),g.currentFace="front"):f[0].object===J[2]?(h.calculateCubeTransform("top"),g.currentFace="top"):f[0].object===J[3]&&(h.calculateCubeTransform("bottom"),g.currentFace="bottom")}break;case "back":switch(z){case "up":f[0].object===
J[0]?(h.calculateCubeTransform("top"),g.currentFace="top"):f[0].object===J[1]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):f[0].object===J[2]?(h.calculateCubeTransform("left"),g.currentFace="left"):f[0].object===J[3]&&(h.calculateCubeTransform("right"),g.currentFace="right");break;case "right":f[0].object===J[0]?(h.calculateCubeTransform("left"),g.currentFace="left"):f[0].object===J[1]?(h.calculateCubeTransform("right"),g.currentFace="right"):f[0].object===J[2]?(h.calculateCubeTransform("bottom"),
g.currentFace="bottom"):f[0].object===J[3]&&(h.calculateCubeTransform("top"),g.currentFace="top");break;case "down":f[0].object===J[0]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):f[0].object===J[1]?(h.calculateCubeTransform("top"),g.currentFace="top"):f[0].object===J[2]?(h.calculateCubeTransform("right"),g.currentFace="right"):f[0].object===J[3]&&(h.calculateCubeTransform("left"),g.currentFace="left");break;case "left":f[0].object===J[0]?(h.calculateCubeTransform("right"),g.currentFace=
"right"):f[0].object===J[1]?(h.calculateCubeTransform("left"),g.currentFace="left"):f[0].object===J[2]?(h.calculateCubeTransform("top"),g.currentFace="top"):f[0].object===J[3]&&(h.calculateCubeTransform("bottom"),g.currentFace="bottom")}break;case "top":switch(z){case "up":f[0].object===J[0]?(h.calculateCubeTransform("back"),g.currentFace="back"):f[0].object===J[1]?(h.calculateCubeTransform("front"),g.currentFace="front"):f[0].object===J[2]?(h.calculateCubeTransform("right"),g.currentFace="right"):
f[0].object===J[3]&&(h.calculateCubeTransform("left"),g.currentFace="left");break;case "right":f[0].object===J[0]?(h.calculateCubeTransform("right"),g.currentFace="right"):f[0].object===J[1]?(h.calculateCubeTransform("left"),g.currentFace="left"):f[0].object===J[2]?(h.calculateCubeTransform("front"),g.currentFace="front"):f[0].object===J[3]&&(h.calculateCubeTransform("back"),g.currentFace="back");break;case "down":f[0].object===J[0]?(h.calculateCubeTransform("front"),g.currentFace="front"):f[0].object===
J[1]?(h.calculateCubeTransform("back"),g.currentFace="back"):f[0].object===J[2]?(h.calculateCubeTransform("left"),g.currentFace="left"):f[0].object===J[3]&&(h.calculateCubeTransform("right"),g.currentFace="right");break;case "left":f[0].object===J[0]?(h.calculateCubeTransform("left"),g.currentFace="left"):f[0].object===J[1]?(h.calculateCubeTransform("right"),g.currentFace="right"):f[0].object===J[2]?(h.calculateCubeTransform("back"),g.currentFace="back"):f[0].object===J[3]&&(h.calculateCubeTransform("front"),
g.currentFace="front")}break;case "bottom":switch(z){case "up":f[0].object===J[0]?(h.calculateCubeTransform("front"),g.currentFace="front"):f[0].object===J[1]?(h.calculateCubeTransform("back"),g.currentFace="back"):f[0].object===J[2]?(h.calculateCubeTransform("right"),g.currentFace="right"):f[0].object===J[3]&&(h.calculateCubeTransform("left"),g.currentFace="left");break;case "right":f[0].object===J[0]?(h.calculateCubeTransform("right"),g.currentFace="right"):f[0].object===J[1]?(h.calculateCubeTransform("left"),
g.currentFace="left"):f[0].object===J[2]?(h.calculateCubeTransform("back"),g.currentFace="back"):f[0].object===J[3]&&(h.calculateCubeTransform("front"),g.currentFace="front");break;case "down":f[0].object===J[0]?(h.calculateCubeTransform("back"),g.currentFace="back"):f[0].object===J[1]?(h.calculateCubeTransform("front"),g.currentFace="front"):f[0].object===J[2]?(h.calculateCubeTransform("left"),g.currentFace="left"):f[0].object===J[3]&&(h.calculateCubeTransform("right"),g.currentFace="right");break;
case "left":f[0].object===J[0]?(h.calculateCubeTransform("left"),g.currentFace="left"):f[0].object===J[1]?(h.calculateCubeTransform("right"),g.currentFace="right"):f[0].object===J[2]?(h.calculateCubeTransform("front"),g.currentFace="front"):f[0].object===J[3]&&(h.calculateCubeTransform("back"),g.currentFace="back")}}h.elapsedTime=0;h.sphericallyInterpolateTransition()}if(0<l.length){h.elapsedTime=0;if(g.wantHomeButton&&l[0].object===L[O]){h.goHome();Ga(!1);return}if(g.wantContextMenu&&l[0].object===
L[ca]){h.viewCubeMenuOpen=!0;h.drawDropdownMenu(q,m,p,n.clientX,n.clientY,c,N);Ga(!0);return}g.wantRollArrows&&ba&&(l[0].object===L[Z]||l[0].object===L[da])&&(n=l[0].object===L[da],f={center:h.center.clone(),position:k.position.clone(),pivot:k.pivot.clone(),fov:k.fov,worldUp:h.sceneUpDirection.clone(),isOrtho:!1===k.isPerspective},l=h.center.clone().sub(k.position).normalize(),n?f.up=k.up.clone().cross(l):(f.up=k.up.clone().multiplyScalar(-1),f.up.cross(l)),f.up.normalize(),h.elapsedTime=0,h.animateTransition(f))}0<
b.length&&(g.currentFace=b[0].object.name,h.orthographicFaces&&-1!==g.currentFace.indexOf(",")&&h.setCameraOrtho(!1),h.calculateCubeTransform(g.currentFace),h.elapsedTime=0,g.mouseMoveSave=a,h.sphericallyInterpolateTransition(function(){g.mouseMoveSave&&g.processMouseMove(g.mouseMoveSave)}));Ga(!1)}}};this.processMouseMove=function(a){var b,c;if(h.viewCubeMenuOpen||h.currentlyAnimating)g.mouseMoveSave=a;else{g.mouseMoveSave=null;a=d(a,g);c=xa(a,N);a=Ba(c,g.camera,M);b=Ba(c,w,J);c=Ba(c,w,L);S&&!R&&
(S.material.color.setHex(14540253),S=null,requestAnimationFrame(g.render));if(0<b.length&&!R){S=b[0].object;for(b=K.children.length;0<=--b;)if(S===J[b]){S=K.children[b];S.material.color.setHex(45055);break}requestAnimationFrame(g.render)}Y&&!R&&(Y.material.opacity=0,Y=null,requestAnimationFrame(g.render));0<a.length&&!R&&(Y=a[0].object,Y.material.opacity=.3,requestAnimationFrame(g.render));0<c.length&&!R?U!==c[0].object&&(g.wantHomeButton&&c[0].object===L[O]?(U=c[0].object,L[O].material.map=ha[0]):
g.wantRollArrows&&c[0].object===L[Z]?(U=c[0].object,L[V].material.map=ha[1]):g.wantRollArrows&&c[0].object===L[da]?(U=c[0].object,L[V].material.map=ha[2]):g.wantContextMenu&&c[0].object===L[ca]?(U=c[0].object,L[ca].material.map=ha[6]):g.wantHomeButton&&U===L[O]?(U=null,L[O].material.map=ha[3]):!g.wantRollArrows||U!==L[Z]&&U!==L[da]&&U!==L[V]?g.wantContextMenu&&U===L[ca]&&(U=null,L[ca].material.map=ha[5]):(U=null,L[V].material.map=ha[4]),requestAnimationFrame(g.render)):null===U||R||(g.wantHomeButton&&
U===L[O]?(U=null,L[O].material.map=ha[3]):!g.wantRollArrows||U!==L[Z]&&U!==L[da]&&U!==L[V]?g.wantContextMenu&&U===L[ca]&&(U=null,L[ca].material.map=ha[5]):(U=null,L[V].material.map=ha[4]),requestAnimationFrame(g.render))}};var Ea=function(a){h.navApi.getIsLocked()||g.processMouseMove(a)},Ma=function(){N=la(c);g.width=c.offsetWidth;g.height=c.offsetHeight;g.camera.aspect=g.width/g.height;g.camera.updateProjectionMatrix();g.camera.topFov=g.camera.bottomFov=g.camera.fov/2;g.camera.leftFov=g.camera.rightFov=
g.camera.aspect*g.camera.fov/2;C.setSize(g.width,g.height);requestAnimationFrame(g.render)},oa=function(a,b){var c,d=new THREE.Geometry;c=new THREE.Vector3(0,0,0);var f=new THREE.Vector3(60,-60,105),g=new THREE.Vector3(60,60,105),h=new THREE.Vector3(-60,60,105),k=new THREE.Vector3(-60,-60,105);d.vertices.push(c);d.vertices.push(f);d.vertices.push(g);d.vertices.push(h);d.vertices.push(k);d.faces.push(new THREE.Face3(1,2,3));d.faces.push(new THREE.Face3(1,3,4));d.applyMatrix((new THREE.Matrix4).makeRotationX(a));
d.applyMatrix((new THREE.Matrix4).makeRotationY(b));d.computeFaceNormals();d.computeVertexNormals();c=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0});return new THREE.Mesh(d,c)},qa=function(a,b,c){var d=new THREE.Geometry,f=new THREE.Vector3(60,105,105),g=new THREE.Vector3(-60,105,105),h=new THREE.Vector3(-60,60,105),k=new THREE.Vector3(60,60,105),l=new THREE.Vector3(60,105,60),n=new THREE.Vector3(-60,105,60),m=new THREE.Vector3(-60,105,105),q=new THREE.Vector3(60,
105,105);d.vertices.push(f);d.vertices.push(g);d.vertices.push(h);d.vertices.push(k);d.vertices.push(l);d.vertices.push(n);d.vertices.push(m);d.vertices.push(q);d.faces.push(new THREE.Face3(0,1,2));d.faces.push(new THREE.Face3(0,2,3));d.faces.push(new THREE.Face3(4,5,6));d.faces.push(new THREE.Face3(4,6,7));d.applyMatrix((new THREE.Matrix4).makeRotationX(a));d.applyMatrix((new THREE.Matrix4).makeRotationY(b));d.applyMatrix((new THREE.Matrix4).makeRotationZ(c));d.computeFaceNormals();d.computeVertexNormals();
a=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0});return new THREE.Mesh(d,a)},na=function(a,b){var c,d=new THREE.Geometry;c=new THREE.Vector3(105,105,105);var f=new THREE.Vector3(60,105,105),g=new THREE.Vector3(60,60,105),h=new THREE.Vector3(105,60,105),k=new THREE.Vector3(105,105,60),l=new THREE.Vector3(105,105,105),n=new THREE.Vector3(105,60,105),m=new THREE.Vector3(105,60,60),q=new THREE.Vector3(105,105,105),z=new THREE.Vector3(105,105,60),t=new THREE.Vector3(60,
105,60),p=new THREE.Vector3(60,105,105);d.vertices.push(c);d.vertices.push(f);d.vertices.push(g);d.vertices.push(h);d.vertices.push(k);d.vertices.push(l);d.vertices.push(n);d.vertices.push(m);d.vertices.push(q);d.vertices.push(z);d.vertices.push(t);d.vertices.push(p);d.faces.push(new THREE.Face3(0,1,2));d.faces.push(new THREE.Face3(0,2,3));d.faces.push(new THREE.Face3(4,5,6));d.faces.push(new THREE.Face3(4,6,7));d.faces.push(new THREE.Face3(8,9,10));d.faces.push(new THREE.Face3(8,10,11));d.applyMatrix((new THREE.Matrix4).makeRotationX(a));
d.applyMatrix((new THREE.Matrix4).makeRotationY(b));d.computeFaceNormals();d.computeVertexNormals();c=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0});return new THREE.Mesh(d,c)},ga=function(a){var b=h.cubeFront.clone(),c=h.sceneUpDirection.clone(),d=b.clone().cross(c);c.copy(d).cross(b);b.normalize();c.normalize();d.normalize();var f=(new THREE.Vector3(b.x,c.x,d.x)).multiplyScalar(a.x);f.add((new THREE.Vector3(b.y,c.y,d.y)).multiplyScalar(a.y));f.add((new THREE.Vector3(b.z,
c.z,d.z)).multiplyScalar(a.z));return f};this.render=function(){var a=g.compass?g.viewScaleFactorCompass*g.viewScale:g.viewScale,b=h.center.clone().sub(k.position).normalize(),c=k.up.normalize(),b=ga(b),c=ga(c);g.camera.position.copy(b);g.camera.position.multiplyScalar(-a/g.camera.position.length());g.camera.up=c.normalize();g.camera.lookAt(g.center);ba=h.isFaceView();!ba||pa||h.currentlyAnimating?ma():(F.add(K),a=g.wantRollArrows?1:0,L[V].material.opacity=a,L[ca].material.opacity=a);G.material.opacity=
pa?0:g.wantContextMenu?1:0;D.material.opacity=pa?0:g.wantHomeButton?1:0;C.clear();C.render(t,g.camera);C.render(r,g.camera);C.render(z,g.camera);C.render(B,g.camera);C.render(F,w)};var ma=function(){F.remove(K);L[V].material.opacity=0;L[ca].material.opacity=0};this.refreshCube=function(){Ma()};this.setSize=function(a,b){g.width=a;g.height=b;if(1<c.children.length)for(var d=1;d<c.children.length;d++)c.children[d].style.bottom=(g.height/5).toString()+"px";Ma()};this.useTransparency=function(a){(pa=
a)?(c.onmouseover=za,c.onmousemove=Na,c.onmouseout=sa,sa()):(c.onmouseover=null,c.onmouseout=null,c.onmousemove=null,c.style.opacity="1.0")};(function(){var a=c.getBoundingClientRect();g.width=a.width;g.height=a.height;N=la(c);w=new THREE.PerspectiveCamera(70,g.height/g.width,1,1E4);w.position.set(0,0,500);t=new THREE.Scene;r=new THREE.Scene;B=new THREE.Scene;z=new THREE.Scene;F=new THREE.Scene;ba=!0;W=200;g.viewScale=3.5*W;var b=THREE.LinearFilter,a=Autodesk.Viewing.Private.getResourceUrl,d=f||"res/textures/",
k=(new THREE.DDSLoader).load(a(d+"VCcrossRGBA8small.dds"));k.minFilter=k.maxFilter=b;d=THREE.ShaderLib.cube;d=new THREE.ShaderMaterial({fragmentShader:d.fragmentShader,vertexShader:d.vertexShader,uniforms:THREE.UniformsUtils.clone(d.uniforms),depthWrite:!1});d.uniforms.tCube.value=k;var m=new THREE.BoxGeometry(W,W,W,4,4,4),k=new THREE.BoxGeometry(W+1,W+1,W+1,4,4,4);E=new THREE.Mesh(m,d);E.position.set(0,0,0);r.add(E);d=va(a("res/textures/VCedge1.png"));d.minFilter=d.maxFilter=b;A=new THREE.Mesh(k,
new THREE.MeshBasicMaterial({map:d,overdraw:!1,transparent:!0,shading:THREE.SmoothShading}));A.position.set(0,0,0);z.add(A);var b=W,d=new THREE.Geometry,k=new THREE.Vector3(-30,0,0),m=new THREE.Vector3(30,0,0),q=new THREE.Vector3(0,-30,0);d.vertices.push(k);d.vertices.push(m);d.vertices.push(q);d.faces.push(new THREE.Face3(1,0,2));d.computeFaceNormals();var q=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),p=new THREE.MeshBasicMaterial({overdraw:!0,
color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),ia=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),aa=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),k=new THREE.PlaneBufferGeometry(.5*W,.3*W,2,2),m=new THREE.MeshBasicMaterial({transparent:!0,opacity:0}),q=new THREE.Mesh(d,q),R=new THREE.Mesh(k,m);q.position.set(0,b,0);R.position.set(0,.9*b,.1);var p=new THREE.Mesh(d,
p),pa=new THREE.Mesh(k,m);p.position.set(0,-b,0);pa.position.set(0,.9*-b,.1);p.rotation.z+=Math.PI;pa.rotation.z+=Math.PI;var ia=new THREE.Mesh(d,ia),X=new THREE.Mesh(k,m);ia.position.set(b,0,0);X.position.set(.9*b,0,.1);ia.rotation.z-=Math.PI/2;X.rotation.z-=Math.PI/2;d=new THREE.Mesh(d,aa);k=new THREE.Mesh(k,m);d.position.set(-b,0,0);k.position.set(.9*-b,0,.1);d.rotation.z+=Math.PI/2;k.rotation.z+=Math.PI/2;K=new THREE.Object3D;K.position.set(0,0,0);K.add(q);K.add(p);K.add(ia);K.add(d);F.add(R);
F.add(pa);F.add(X);F.add(k);F.add(K);J.push(R);J.push(pa);J.push(X);J.push(k);b=new THREE.PlaneBufferGeometry(W/3,W/3,2,2);d=new THREE.MeshBasicMaterial({map:va(a("res/textures/VChome.png")),transparent:!0,shading:THREE.FlatShading});D=new THREE.Mesh(b,d);D.position.set(-W,W,0);O=L.length;F.add(D);L.push(D);b=new THREE.PlaneBufferGeometry(1.5*W,1.5*W,2,2);d=new THREE.MeshBasicMaterial({map:va(a("res/textures/VCarrows.png")),shading:THREE.FlatShading,transparent:!0});b=new THREE.Mesh(b,d);b.position.set(.5*
W+20,.5*W+20,0);d=new THREE.PlaneBufferGeometry(.6*W,.45*W,2,2);k=new THREE.MeshBasicMaterial({transparent:!0,opacity:0});d=new THREE.Mesh(d,k);d.position.set(.5*W+20,W+20,.1);k=new THREE.PlaneBufferGeometry(.45*W,.6*W,2,2);m=new THREE.MeshBasicMaterial({transparent:!0,opacity:0});k=new THREE.Mesh(k,m);k.position.set(W+20,.5*W+20,.1);F.add(b);F.add(d);F.add(k);Z=L.length;L.push(d);da=L.length;L.push(k);V=L.length;L.push(b);b=new THREE.PlaneBufferGeometry(W/2.3,W/2.3,2,2);d=new THREE.MeshBasicMaterial({map:va(a("res/textures/VCcontext.png")),
transparent:!0,shading:THREE.FlatShading});G=new THREE.Mesh(b,d);G.position.set(W,-W,0);ca=L.length;F.add(G);L.push(G);b=new THREE.Geometry;b.vertices.push(new THREE.Vector3(0,0,0));b.vertices.push(new THREE.Vector3(-W/2,-W/2-20,-W/2));b.vertices.push(new THREE.Vector3(W/2,-W/2-20,-W/2));b.vertices.push(new THREE.Vector3(W/2,-W/2-20,W/2));b.vertices.push(new THREE.Vector3(-W/2,-W/2-20,W/2));b.faces.push(new THREE.Face3(4,3,2));b.faces.push(new THREE.Face3(4,2,1));d=new THREE.MeshBasicMaterial({color:0,
transparent:!0,opacity:.5});I=new THREE.Mesh(b,d);t.add(I);d=[];k=[];d[0]=na(0,0);d[1]=na(0,Math.PI/2);d[2]=na(0,-Math.PI/2);d[3]=na(0,Math.PI);d[4]=na(Math.PI/2,0);d[5]=na(Math.PI/2,Math.PI/2);d[6]=na(Math.PI/2,-Math.PI/2);d[7]=na(Math.PI/2,Math.PI);k[0]=qa(0,0,0);k[1]=qa(0,Math.PI/2,0);k[2]=qa(0,-Math.PI/2,0);k[3]=qa(0,Math.PI,0);k[4]=qa(Math.PI/2,0,0);k[5]=qa(Math.PI/2,Math.PI/2,0);k[6]=qa(Math.PI/2,-Math.PI/2,0);k[7]=qa(Math.PI/2,Math.PI,0);k[8]=qa(0,0,Math.PI/2);k[9]=qa(0,0,-Math.PI/2);k[10]=
qa(-Math.PI/2,0,-Math.PI/2);k[11]=qa(-Math.PI,0,-Math.PI/2);H.push(oa(0,0));H[0].name="front";M.push(H[0]);P.push(H[0]);B.add(H[0]);H.push(oa(0,Math.PI/2));H[1].name="right";M.push(H[1]);P.push(H[1]);B.add(H[1]);H.push(oa(0,Math.PI));H[2].name="back";M.push(H[2]);P.push(H[2]);B.add(H[2]);H.push(oa(0,-Math.PI/2));H[3].name="left";M.push(H[3]);P.push(H[3]);B.add(H[3]);H.push(oa(Math.PI/2,0));H[4].name="bottom";M.push(H[4]);P.push(H[4]);B.add(H[4]);H.push(oa(-Math.PI/2,0));H[5].name="top";M.push(H[5]);
P.push(H[5]);B.add(H[5]);b=H.length;for(m=0;m<d.length;m++)H.push(d[m]),H[b+m].name=n[m],B.add(H[b+m]),M.push(H[b+m]),P.push(H[b+m]);b=H.length;for(m=0;m<k.length;m++)H.push(k[m]),H[b+m].name=l[m],B.add(H[b+m]),M.push(H[b+m]),P.push(H[b+m]);"CANVAS"===h.renderer.toUpperCase()?C=new THREE.CanvasRenderer:"WEBGL"===h.renderer.toUpperCase()?C=new FireflyWebGLRenderer({alpha:!0,antialias:!0}):(console.log("Incorrect use of Autocam.renderer property"),C=new THREE.CanvasRenderer);g.useTransparency(!0);g.setSize(g.width,
g.height);g.camera.topFov=g.camera.bottomFov=g.camera.fov/2;g.camera.leftFov=g.camera.rightFov=g.camera.aspect*g.camera.fov/2;C.autoClear=!1;C.setSize(g.width,g.height);C.sortObjects=!1;c.appendChild(C.domElement);c.addEventListener("touchstart",Ja,!1);c.addEventListener("mousedown",Ja,!1);c.addEventListener("mousemove",Ea,!1);window.addEventListener("resize",Ma,!1);fa=!1;ha.push(va(a("res/textures/VChomeS.png")));ha.push(va(a("res/textures/VCarrowsS0.png")));ha.push(va(a("res/textures/VCarrowsS1.png")));
ha.push(va(a("res/textures/VChome.png")));ha.push(va(a("res/textures/VCarrows.png")));ha.push(va(a("res/textures/VCcontext.png")));ha.push(va(a("res/textures/VCcontextS.png")))})()};AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.ToolController=function(a,b,c,f,d){function g(a,c){return b.navigation.getUseLeftHandedInput()&&0===a||k&&1===a||h&&!l&&0===a&&c.ctrlKey}this.domElement=b.canvasWrap;this.selector=a.selector;this.autocam=c;this.lastClickY=this.lastClickX=-1;var h=-1!=navigator.userAgent.search("Mac OS"),k=-1!=navigator.userAgent.search("Firefox");a=-1!==navigator.userAgent.search("Chrome");var l=-1!==navigator.userAgent.search("Safari")&&!a,n={},q=[],m=!1,p=-1,t=-1,r=!1,B=null,z=void 0,F=!1,C={},
w=this;this.__registerToolByName=function(a,b){n[b]=a};this.registerTool=function(a){var b=a.getNames();if(!b||0==b.length)return console.log("Cannot register tool with no name."),!1;for(var c=!1,d=0;d<b.length;++d)"default"!==b[d]&&(this.__registerToolByName(a,b[d]),c=!0);a.utilities=f;a.controller=this;a.register&&a.register();return c};this.deregisterTool=function(a){this.deactivateTool(a.getName());var b=a.getNames();if(!b||0==b.length)return!1;for(var c=b.length;0<=--c;)this.__deregisterToolName(b[c]);
a.deregister&&a.deregister();a.utilities=null;a.controller=null;return!0};this.__deregisterToolName=function(a){if(a in n){for(var b=q.length;0<=--b;)q[b]===a&&(n[a].deactivate(a),q.splice(b,1));delete n[a]}};this.getTool=function(a){return n[a]};this.getActiveToolName=function(){var a=q.length;return 0<a?q[a-1]:"default"};this.activateTool=function(a){if(m)return!1;var c=n[a];if(c){var d=null;"intercept"===q[q.length-1]&&(d=q.pop());q.push(a);c.activate(a);d&&q.push(d);b.fireEvent({type:Autodesk.Viewing.TOOL_CHANGE_EVENT,
toolName:a,active:!0});return!0}stderr("activateTool not found: "+a);return!1};this.deactivateTool=function(a){if(m)return!1;for(var c=q.length;0<=--c;)if(q[c]===a)return q.splice(c,1),n[a].deactivate(a),b.fireEvent({type:Autodesk.Viewing.TOOL_CHANGE_EVENT,toolName:a,active:!1}),!0;stderr("deactivateTool not found: "+a);return!1};this.getToolNames=function(){return Object.keys(n)};this.setDefaultTool=function(a){var b=this.getDefaultTool();return a&&a!==b?(this.__registerToolByName(a,"default"),b&&
b.deactivate("default"),a.activate("default"),!0):!1};this.getDefaultTool=function(){return n["default"]};this.setDefaultTool(d);this.setIsLocked=function(a){var b=m;m=!!a;return b};this.getIsLocked=function(){return m};this.__checkCursor=function(){for(var a=null,c=q.length;0<=--c;){var d=n[q[c]];if("getCursor"in d&&(a=d.getCursor()))break}a||(a="auto");B!=a&&(B=b.canvas.style.cursor=a)};this.update=function(a){this.__checkCursor();var c=!1;f&&f.update()&&(c=!0);for(var d=q.length;0<=--d;){var g=
n[q[d]];"update"in g&&g.update(a)&&(c=!0)}b.navigation.getCamera().dirty?(b.navigation.updateCamera(),this.cameraUpdated=c=!0):this.cameraUpdated=!1;c?(b.navigation.updateCamera(),this.moveDelay=Date.now()+150):0!==this.moveDelay&&(0<this.moveDelay-Date.now()?c=!0:this.moveDelay=0);return c};this.__clientToCanvasCoords=function(a,c,d){var f=b.navigation.getScreenViewport(),g=f.width,h=f.height,k=a.clientX-f.left,f=a.clientY-f.top;a.canvasX=k;a.canvasY=f;a.normalizedX=k/g*2-1;a.normalizedY=(h-f)/h*
2-1;c&&c.set(k/g,f/h,0);d&&d.set(k,f)};this.__invokeStack=function(a,b,c){for(var d=q.length;0<=--d;){var f=n[q[d]];if(a in f&&f[a](b,c))return!0}d=this.getDefaultTool();return a in d&&d[a](b,c)?!0:!1};this.distributeEvent=function(a,b,c){return this.__invokeStack(a,b,c)};this.handleResize=function(){b.navigation.setScreenViewport(b.container.getBoundingClientRect());for(var a=q.length;0<=--a;){var c=n[q[a]];"handleResize"in c&&c.handleResize()}};this.handleSingleClick=function(a){var b=this.applyButtonMappings(a);
this.lastClickX=a.clientX;this.lastClickY=a.clientY;this.__invokeStack("handleSingleClick",a,b)&&(a.preventDefault(),a.stopPropagation())};this.handleDoubleClick=function(a){var b=this.applyButtonMappings(a);this.__invokeStack("handleDoubleClick",a,b)&&(a.preventDefault(),a.stopPropagation())};this.handleSingleTap=function(a){this.lastClickX=a.canvasX;this.lastClickY=a.canvasY;this.__invokeStack("handleSingleTap",a)&&(a.preventDefault(),a.stopPropagation())};this.handleDoubleTap=function(a){this.lastClickX=
a.canvasX;this.lastClickY=a.canvasY;this.__invokeStack("handleDoubleTap",a)&&(a.preventDefault(),a.stopPropagation())};this.handleWheelInput=function(a,b){this.__invokeStack("handleWheelInput",a)&&(b.preventDefault(),b.stopPropagation())};this.applyButtonMappings=function(a){var c=a.button;"buttons"in a&&(a.firefoxSpoof?c=0:!r||a.buttons&1?2===c&&a.buttons&1&&(c=0,a.firefoxSpoof=r=!0):(a.firefoxSpoof=!0,r=!1,c=0));b.navigation.getUseLeftHandedInput()&&(c=0===c?2:2===c?0:c);return c};this.applyKeyMappings=
function(a,b){switch(a.keyCode){case 91:case 93:case 224:return h&&a.metaKey&&a.shiftKey?null:17;case 16:return b&&h&&a.metaKey?null:16;case 61:return 187;case 173:case 109:return 189}return a.keyCode};this.handleKeyDown=function(a){var b=this.applyKeyMappings(a,!0);b&&this.__invokeStack("handleKeyDown",a,b)&&(a.preventDefault(),a.stopPropagation())};this.handleKeyUp=function(a){var b=this.applyKeyMappings(a,!0);b&&this.__invokeStack("handleKeyUp",a,b)&&(a.preventDefault(),a.stopPropagation())};this.handleButtonDown=
function(a,b){this.__invokeStack("handleButtonDown",a,b)&&(a.preventDefault(),a.stopPropagation())};this.handleButtonUp=function(a,b){this.__invokeStack("handleButtonUp",a,b)&&(a.preventDefault(),a.stopPropagation())};this.handleMouseMove=function(a){this.__invokeStack("handleMouseMove",a)&&(a.preventDefault(),a.stopPropagation())};this.handleBlur=function(a){this.__invokeStack("handleBlur",a)&&(a.preventDefault(),a.stopPropagation())};this.keydown=function(a){if(!(!w.domElement.contains(z)||document.activeElement instanceof
HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement)){if(document.activeElement){var b=document.activeElement.getAttribute("contenteditable");if("true"===b||""===b)return}h&&a.metaKey&&91!=a.keyCode&&93!=a.keyCode||w.handleKeyDown(a)}};this.keyup=function(a){h&&a.metaKey&&91!=a.keyCode&&93!=a.keyCode||w.handleKeyUp(a)};this.mousedown=function(a){function b(a){w.applyButtonMappings(a)===c&&(document.removeEventListener("mouseup",b),w.mouseup(a))}_isIE11&&inFullscreen()||document.activeElement.blur();
w.__clientToCanvasCoords(a);var c=w.applyButtonMappings(a);w.handleButtonDown(a,c);p=a.canvasX;t=a.canvasY;if(g(c,a)){var d=void 0!==C.time&&500>a.timeStamp-C.time,f=void 0!==C.x&&void 0!==C.y&&2>=Math.abs(C.x-a.canvasX)&&2>=Math.abs(C.y-a.canvasY);if(!d||!f||C.clickCount&&2<=C.clickCount)C.clickCount=0;C.clickCount?1===C.clickCount&&(C.clickCount=2):(C.clickCount=1,C.x=a.canvasX,C.y=a.canvasY,C.time=a.timeStamp)}document.addEventListener("mouseup",b,!1)};this.mousemove=function(a){w.__clientToCanvasCoords(a);
var b=t-a.canvasY;if(2<Math.abs(p-a.canvasX)||2<Math.abs(b))t=p=-1;w.handleMouseMove(a)};this.mouseup=function(a){w.__clientToCanvasCoords(a);var b=w.applyButtonMappings(a);w.handleButtonUp(a,b);var c=p-a.canvasX,d=t-a.canvasY;t=p=-1;2>=Math.abs(c)&&2>=Math.abs(d)&&w.handleSingleClick(a);g(b,a)&&2===C.clickCount&&(w.handleDoubleClick(a),C.clickCount=0,C.x=void 0,C.y=void 0,C.time=void 0)};this.doubleclick=function(a){w.__clientToCanvasCoords(a);p=a.canvasX;t=a.canvasY;w.handleDoubleClick(a)};this.mousewheel=
function(a){var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail);w.handleWheelInput(b,a)};this.blur=function(a){w.handleBlur(a)};this.mouseover=function(a){z=a.target};this.enableMouseButtons=function(a){a&&!F?(this.domElement.addEventListener("mousedown",this.mousedown,!1),this.domElement.addEventListener("dblclick",this.doubleclick,!1),window.addEventListener("mousemove",this.mousemove,!1),window.addEventListener("mouseover",this.mouseover,!1)):!a&&F&&(this.domElement.removeEventListener("mousedown",
this.mousedown),this.domElement.removeEventListener("dblclick",this.doubleclick),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseover",this.mouseover));var b=F;F=a;return b};this.enableMouseButtons(!0);this.domElement.addEventListener("mousewheel",this.mousewheel,!1);this.domElement.addEventListener("DOMMouseScroll",this.mousewheel,!1);window.addEventListener("keydown",this.keydown,!1);window.addEventListener("keyup",this.keyup,!1);window.addEventListener("blur",
this.blur,!1);this.uninitialize=function(){F&&(window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseover",this.mouseover));window.removeEventListener("keydown",this.keydown);window.removeEventListener("keyup",this.keyup);window.removeEventListener("blur",this.blur);w=q=n=this.autocam=this.selector=this.domElement=null};this.set2DMode=function(a){};this.setAutocam=function(a){};this.syncCamera=function(){};this.recordHomeView=function(){var a=b.navigation.getCamera();
c.sync(a);c.setHomeViewFrom(a)}};AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.ViewingUtilities=function(a,b,c){this.autocam=b;var f=c.getCamera(),d={},g={},h=new function(a){var b=0,c=new THREE.SphereGeometry(1),d=new THREE.MeshPhongMaterial({color:32512,ambient:32512,opacity:.6,transparent:!0}),f=new THREE.Mesh(c,d);a.createOverlayScene("pivot");a.addOverlay("pivot",f);f.visible=!1;this.shown=function(){return f.visible};this.show=function(c,g,h){f.scale.x=g;f.scale.y=g;f.scale.z=g;f.position.set(c.x,c.y,c.z);d.opacity=.6;f.visible=!0;a.invalidate(!1,!1,!0);
b=h?Date.now()+500:0};this.hide=function(){f.visible&&(f.visible=!1,a.invalidate(!1,!1,!0),b=0)};this.fade=function(){if(0<b){var a=b-Date.now();if(0>=a)return this.hide(),!0;d.opacity=a/500*.6;return!0}return!1};this.fading=function(){return 0<b}}(a);this.transitionView=function(a,d,g,h,m,p){m=m||c.getWorldUpVector();if(p)if(h=m,p=d.clone().sub(a),0===p.lengthSq())h=p.copy(h);else{var t=p.clone().cross(h);0===t.lengthSq()&&(h.z>h.y?p.y-=1E-4:p.z-=1E-4,t.crossVectors(p,h));h=t.cross(p).normalize()}h||
(h=f.up);b.goToView({position:a,center:d,pivot:d,fov:g,up:h,worldUp:m,isOrtho:!1===f.isPerspective})};this.goHome=function(){b.goHome()};this.getHitPoint=function(b,c){c=2*(1-c)-1;var d=new THREE.Vector3(2*b-1,c,1);return(d=a.hitTestViewport(d,!1))?d.intersectPoint:null};this.activatePivot=function(a){var b=f.isPerspective?c.getPivotPlaneDistance():c.getEyeVector().length(),d=c.getVerticalFov(),b=2*b*Math.tan(THREE.Math.degToRad(.5*d)),d=c.getScreenViewport(),b=5*b/(d.height*(window.devicePixelRatio||
1));h.show(c.getPivotPoint(),b,a)};this.pivotActive=function(a,b){a=a&&!c.getIs2D();b=b||!1;!a&&h.shown()?h.hide():a&&this.activatePivot(b)};this.pivotUpdate=function(){h.shown()&&h.fade()&&a.invalidate(!1,!1,!0)};this.setPivotPoint=function(a,b,d){c.setPivotPoint(a);b||c.setTarget(a);d&&c.setPivotSetFlag(!0);this.setTemporaryPivot(null);c.getIs2D()||h.shown()&&this.activatePivot(h.fading())};this.savePivot=function(a){a||(a="default");d[a]=c.getPivotPoint();g[a]=c.getPivotSetFlag()};this.restorePivot=
function(a){a||(a="default");if(d[a]){var b=g[a];this.setPivotPoint(d[a],!0,b);b||c.setPivotSetFlag(!1);delete d[a];delete g[a]}};this.setTemporaryPivot=function(a){if(a){var b=c.getPivotPoint(),f=c.getPivotSetFlag();this.setPivotPoint(a,!0,f);d.TEMP=b;g.TEMP=f}else delete d.TEMP,delete g.TEMP};this.removeTemporaryPivot=function(){this.restorePivot("TEMP")};this.getBoundingBox=function(b){return a.getFitBounds(b)};this.fitToView=function(b){b=c.fitBounds(b,a.getFitBounds(!1));this.activatePivot(!0);
return b};this.update=function(){c.getRequestFitToView()&&!c.getTransitionActive()&&(c.setRequestFitToView(!1),this.fitToView());c.getRequestHomeView()&&!c.getTransitionActive()&&(c.setRequestHomeView(!1),this.goHome());var a=c.getRequestTransition();a&&!c.getTransitionActive()&&(c.setRequestTransition(!1),this.transitionView(a.position,a.coi,a.fov,a.up,a.worldUp,a.reorient));return!1}};AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.DefaultHandler=function(a,b,c){this.clickConfig=null;this.getNames=function(){return["default"]};this.getName=function(){return this.getNames()[0]};this.setClickBehavior=function(a){this.clickConfig=a};this.getClickBehavior=function(){return this.clickConfig};this.activate=function(a){};this.deactivate=function(a){};this.handleAction=function(b,d){for(var g=0;g<b.length;++g)switch(b[g]){case "selectOnly":a.selector&&d&&a.selector.setSelection([d.dbId]);break;case "deselectAll":a.selector&&
a.selector.setSelection([]);break;case "selectToggle":a.selector&&d&&a.selector.toggleSelection(d.dbId);break;case "isolate":d&&a.isolate(d.dbId);break;case "showAll":a.showAll();break;case "setCOI":d&&d.intersectPoint&&(c.setPivotPoint(d.intersectPoint,!0,!0),c.pivotActive(!0,!0));break;case "hide":d&&a.hideMultiple([d.dbId]);break;case "show":d&&a.showMultiple([d.dbId]);break;case "toggleVisibility":d&&a.toggleVisibility(d.dbId);break;case "focus":a.selector&&(d?a.selector.setSelection([d.dbId]):
a.selector.setSelection([]),c.fitToView())}};this.handleSingleClick=function(b,d){var g=b.ctrlKey||b.metaKey,h=b.shiftKey,k=b.altKey;if(0===d){var l=new THREE.Vector3(b.normalizedX,b.normalizedY,1),l=a.hitTestViewport(l,!1),n="click";g&&(n+="Ctrl");h&&(n+="Shift");k&&(n+="Alt");g=l?"onObject":"offObject";if(this.clickConfig&&this.clickConfig[n]&&this.clickConfig[n][g])return this.handleAction(this.clickConfig[n][g],l),!0}else if(1===d&&h&&!k&&!g&&(l=new THREE.Vector3(b.normalizedX,b.normalizedY,1),
(l=a.hitTestViewport(l,!1))&&l.intersectPoint))return c.setPivotPoint(l.intersectPoint,!0,!0),c.pivotActive(!0,!0),!0;return!1};this.handleDoubleClick=function(f,d){if(null!=a.selector&&0===d){var g=new THREE.Vector3(f.normalizedX,f.normalizedY,1);(g=a.hitTestViewport(g,!1))?a.selector.setSelection([g.dbId]):a.selector.clearSelection();c.fitToView();return!0}return 1===d?(b.fitBounds(!1,c.getBoundingBox(!0)),b.setPivotSetFlag(!1),!0):!1};this.handleSingleTap=function(c){return c.hasOwnProperty("pointers")&&
2===c.pointers.length?(b.setRequestHomeView(!0),!0):null!=a.selector?(c=new THREE.Vector3(c.normalizedX,c.normalizedY,1),(c=a.hitTestViewport(c,!1))?a.selector.setSelection([c.dbId]):a.selector.clearSelection(),!0):!1};this.handleDoubleTap=function(a){a=this.handleSingleTap(a,0);c.fitToView();return a};this.handlePressHold=function(b){return"press"===b.type?(b.clientX=b.pointers[0].clientX,b.clientY=b.pointers[0].clientY,a.api.triggerContextMenu(b)):!1}};AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.GestureHandler=function(a){var b=a.navigation,c=["gestures"],f=this,d=!0,g=null,h=isTouchDevice();b.setIsTouchDevice(h);h&&(g=new Hammer.Manager(a.canvasWrap,{recognizers:[[Hammer.Tap,{event:"doubletap2",pointers:2,taps:2,interval:400,threshold:6,posThreshold:40}],[Hammer.Tap,{event:"doubletap",taps:2,interval:400,threshold:6,posThreshold:30}],[Hammer.Tap,{event:"singletap2",pointers:2,threshold:6}],[Hammer.Tap,{event:"singletap",threshold:6}],[Hammer.Pan,{event:"drag3",pointers:3,
threshold:15}],[Hammer.Pan,{event:"pan",pointers:2,threshold:20}],[Hammer.Pan,{event:"drag",pointers:1}],[Hammer.Rotate,{enable:!0,threshold:7}],[Hammer.Pinch,{enable:!0,threshold:.05}],[Hammer.Press,{event:"press",time:500}]],inputClass:Hammer.TouchInput}),a.canvasWrap.addEventListener("touchstart",function(a){a.preventDefault()},!1));this.getNames=function(){return c};this.getName=function(){return c[0]};this.__clientToCanvasCoords=function(a){var c=b.getScreenViewport(),d=c.width,f=c.height,g;
a.hasOwnProperty("center")?(g=a.center.x-c.left,c=a.center.y-c.top):(g=a.pointers[0].clientX-c.left,c=a.pointers[0].clientY-c.top);a.canvasX=g;a.canvasY=c;a.normalizedX=g/d*2-1;a.normalizedY=(f-c)/f*2-1};this.distributeGesture=function(a){f.__clientToCanvasCoords(a);f.controller.distributeEvent("handleGesture",a)&&a.preventDefault();a=a.type;-1!==a.indexOf("end",a.length-3)&&g.stop()};this.onSingleTap=function(a){f.__clientToCanvasCoords(a);f.controller.distributeEvent("handleSingleTap",a)&&a.preventDefault()};
this.onDoubleTap=function(a){f.__clientToCanvasCoords(a);f.controller.distributeEvent("handleDoubleTap",a)&&a.preventDefault()};this.onPressHold=function(a){f.__clientToCanvasCoords(a);"press"===a.type?d=f.controller.enableMouseButtons(!1):f.controller.enableMouseButtons(d);f.controller.distributeEvent("handlePressHold",a)&&a.preventDefault()};this.activate=function(a){g&&(g.on("dragstart dragmove dragend",this.distributeGesture),g.on("panstart panmove panend",this.distributeGesture),g.on("pinchstart pinchmove pinchend",
this.distributeGesture),g.on("rotatestart rotatemove rotateend",this.distributeGesture),g.on("drag3start drag3move drag3end",this.distributeGesture),g.on("singletap",this.onSingleTap),g.on("singletap2",this.onSingleTap),g.on("doubletap",this.onDoubleTap),g.on("doubletap2",this.onDoubleTap),g.on("press pressup",this.onPressHold),g.get("doubletap2").recognizeWith("doubletap"),g.get("singletap2").recognizeWith("singletap"),g.get("singletap").requireFailure("doubletap"))};this.deactivate=function(a){g&&
(g.off("dragstart dragmove dragend",this.distributeGesture),g.off("panstart panmove panend",this.distributeGesture),g.off("pinchstart pinchmove pinchend",this.distributeGesture),g.off("rotatestart rotatemove rotateend",this.distributeGesture),g.off("drag3start drag3move drag3end",this.distributeGesture),g.off("singletap",this.onSingleTap),g.off("singletap2",this.onSingleTap),g.off("doubletap",this.onDoubleTap),g.off("doubletap2",this.onDoubleTap),g.off("press pressup",this.onPressHold))};this.update=
function(){return!1};this.handleBlur=function(a){return!1}};AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.OrbitDollyPanTool=function(a,b){function c(a,b){var c=window.innerWidth,d=window.innerHeight;Z.set((a-.5*c-0)/(.5*c),(.5*d+0-b)/(.5*d),0);c=Z.length();1<c?Z.normalize():Z.z=Math.sqrt(1-c*c);P.copy(h.position).sub(h.pivot);Y.copy(h.up).setLength(Z.y);Y.add(U.copy(h.up).cross(P).setLength(Z.x));Y.add(P.setLength(Z.z));return Y}var f=this,d=-1!=navigator.userAgent.search("Mac OS"),g=b.navigation,h=g.getCamera(),k=["orbit","freeorbit","dolly","pan"],l=k[0],n=[l],q=l,m=null,p=0,t=0,r=
!1,B=null,z=!1,F,C,w=null,E=-5,A=new THREE.Vector3,D=new THREE.Vector3,I=new THREE.Vector2,G=new THREE.Vector2,H=new THREE.Vector2,K=new THREE.Vector2,J=new THREE.Vector3,M=new THREE.Vector3,L=new THREE.Vector3,P=new THREE.Vector3,S=new THREE.Vector3,Y=new THREE.Vector3,U=new THREE.Vector3,Z=new THREE.Vector3,da=new THREE.Vector3,V=new THREE.Quaternion,O=[!1,!1,!1,!1,!1,!1],ca=0,W=0,N=0,ea=0,ba=1,fa=5,X=.025;this.getNames=function(){return k};this.getName=function(){return k[0]};this.activate=function(a){n.push(a);
q=a};this.deactivate=function(a){var b=n.length-1;0<b&&n[b]===a&&(n.pop(),q=n[b-1])};this.adjustDollyLookSpeed=function(a){0===a?(X=.025,fa=5):(X*=0<a?1.1:.9,fa*=0<a?1.1:.9,1E-6>X&&(X=1E-6),1E-6>fa&&(fa=1E-6))};this.getDollySpeed=function(a){var b=g.getEyeVector(),c=g.getPosition();a=a.clone().sub(c).dot(b.normalize())*X;return.01>Math.abs(a)?0>a?-.01:.01:a};this.getLookSpeed=function(){return fa};this.coiIsActive=function(){return g.getPivotSetFlag()&&g.isPointVisible(g.getPivotPoint())};this.adjustSpeed=
function(a){this.adjustDollyLookSpeed(a);this.utilities.autocam&&(this.utilities.autocam.orbitMultiplier=this.getLookSpeed())};this.initTracking=function(a,b){var c;if(h.isPerspective){c=.5*(h.near+h.far);var d=this.utilities.getHitPoint(a,b),f=g.getPosition();d&&d.sub?(c=d.sub(f),d=g.getEyeVector().normalize(),c=Math.abs(d.dot(c))):g.getPivotSetFlag()&&g.isPointVisible(g.getPivotPoint())&&(d=g.getPivotPlaneDistance(),1E-5<d&&(c=d))}else c=g.getEyeVector().length();ba=c};this.initOrbit=function(){this.utilities.setTemporaryPivot(0>=
g.getPivotPoint().sub(g.getPosition()).dot(g.getEyeVector())?g.getTarget():null)};this.getCursor=function(){switch(l){case "freeorbit":case "orbit":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto";
case "dolly":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAgVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8mJiYAAADNzc2/v7+fn59paWlPT08MDAwICAj6+vqpqak7Ozv29vby8vLp6em2traAgIBkZGRZWVlAQEAaGhpISEgkS7tbAAAAFHRSTlMAOvhpZD8mkQWegMy9qY1YVE01EYiqlE0AAADZSURBVCjPbY9ZloMgEAAbEbfsmRZZXbJn7n/AAX2RQVN/VD26AXLOeZLDGo6IbfI9tHq8cdxuj1HwvgCoaiHqKoRk+M3hB9jueUW8PnfsE/bJ3vms7nCkq7NoE3s99AXxoh8vFoXCpknrn5faAuJCenT0xPkYqnxQFJaU0gdZrsKm8aHZrAIffBj40mc1jsTfIJRWegq6opTMvlfqLqYg7kr1ZB7jFgeaMC59N//8O4WZ1IiPF8b5wMHcJn8zB4g4mc77zpxgAbMSUVoGK4iV0hL4wrksz+H0Bw5+E+HrniDQAAAAAElFTkSuQmCC), auto";
case "pan":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABHVBMVEUAAABPTk4AAAAAAAAJCQkRERE0MzQQEBAODg4QEBB4d3dbWlo9PDw/Pj4vLy8sLCwZGBgWFhYcHBwKCgoSEhIAAAAKCgoICAgKCgoQEBAODg4EBAQICAgPDw8REREMDAx2dnY0NDQvLy9QUFAaGhomJSYjIyM7OjokJCQNDA0mJiYNDQ0AAAAUFBQJCQkQEBAEBAQNDQ0PDw8VFRX///+amJkAAAD5+fnz8/PKycn9/f339vbi4eLR0dDNzMyAgIB8e3xycHH7+/vw7+/o6OjX1ta7urq4t7iwsLCnp6eioqKbmppva21OTk74+Pjl5eXc3Nzb29vLy8vDw8PDwsKrqqqdnZ2WlpaSkpKTkZKMiouEg4NkZGRISEgxLzBpgbsEAAAANHRSTlMA+fiQXgngKSYG/vX17uvBuqackpCNg3BpUkpAPBwTDvj18+vl0s/NwrOwoZZ+TDg4NBkBGrzX8QAAAP5JREFUKM99j9Vuw0AQRdeuKZyGkyZNmbnXDLHDVGb8/8/oy7paK1bO0+oc7WiGnGiaxq+QRTQAOh8f9Jv4H/Ge8PZPrCdlvkxfYluUT2WyyCq3mZ7unwlKVLcqOzA/Mf71j0TWJ/Ym6rPeca05Ni4iIevYc7yoUD2zQFhq71BdI9nvBeBabFDSPe8DswlUc1Riw3VxbH0NHBUPQ0jrbDnPYDjALQBMq9E7nkC5y7VDKTZlUg8Q0lmjvl74zlYErgvKa42GPKf3/a0kQmYCDY1SYMDosqMoiWrGwz/uAbNvc/fNon4kXRKGq+PUo2Mb96afV0iUxqGU2s4VBbKUP65NL/LKF+7ZAAAAAElFTkSuQmCC), auto"}return null};
this.getMotionDelta=function(a,b){var c=g&&g.getReverseZoomDirection()?-1.5:1.5;d&&(c*=-1);O[0]&&(D.x+=.01,H.x+=20);O[1]&&(D.x-=.01,H.x-=20);O[2]&&(D.y+=.01,H.y+=20);O[3]&&(D.y-=.01,H.y-=20);O[4]&&(D.z+=c);O[5]&&(D.z-=c);var c=D.x-A.x,f=D.y-A.y,h=D.z-A.z;.001>Math.abs(c)&&(c=0);.001>Math.abs(f)&&(f=0);.001>Math.abs(h)&&(h=0);a.set(c,f,h);b&&b.set(H.x-G.x,H.y-G.y)};this.stepMotionDelta=function(a,b){b?(A.x+=.6*a.x,A.y+=.6*a.y,A.z+=.6*a.z):A.copy(D);G.copy(H)};this.update=function(){var a=!1,c=!1,d;
this.getMotionDelta(J,K);d=J.x;var f=J.y,n=J.z;r||this.checkInteractionMode();(r=-1<E)&&this.controller.setIsLocked(!0);if(0!==d||0!==f||0!==n){switch(l){case "orbit":this.utilities.autocam&&this.utilities.autocam.startState&&(K.x=-K.x,B&&this.utilities.autocam.orbit(H,B,K.multiplyScalar(2),this.utilities.autocam.startState));break;case "freeorbit":P.subVectors(h.position,h.pivot);S.subVectors(h.position,h.target);c=S.length();S.normalize();if(d=Math.acos(M.dot(L)/M.length()/L.length()))d*=2,da.crossVectors(M,
L).normalize(),V.setFromAxisAngle(da,-d),P.applyQuaternion(V),h.up.applyQuaternion(V),L.applyQuaternion(V),S.applyQuaternion(V),M.copy(L);h.position.addVectors(h.pivot,P);h.target.subVectors(h.position,S.multiplyScalar(c));h.dirty=!0;break;case "dolly":n*=.6;0<=E?(f=-f,n=Math.abs(d)>Math.abs(f)?d:f,n*=100,c=d=.5):(d=g.getScreenViewport(),c=F/d.width,d=C/d.height);c=!g.getIs2D()&&g.getZoomTowardsPivot()?this.coiIsActive()?g.getPivotPoint():g.getWorldPoint(.5,.5):g.getWorldPoint(c,d);g.dollyFromPoint(n*
this.getDollySpeed(c),c);break;case "pan":g.panRelative(-d,f,ba);break;case "dollypan":0===d&&0===f||g.panRelative(-d,f,ba),d=g.getScreenViewport(),c=F/d.width,d=C/d.height,c=g.getWorldPoint(c,d),d=g.getPosition(),d=g.getIs2D()?d.sub(c).length():ba,f=(p/t-1)*d,g.dollyFromPoint(f,c),p=t,ba=d+f}c=!0}this.stepMotionDelta(J,"pan"!==l&&"dollypan"!==l);-1===E&&1E-5>Math.abs(n)&&(this.interactionEnd(-1),c=a=!0);(ca||W)&&-1!==k.indexOf(b.getActiveNavigationTool())&&(c=!0);!z&&(a||-5<E)&&(-1<E&&(A.copy(D),
this.utilities.removeTemporaryPivot()),this.utilities.autocam.endInteraction(),E=-5,r&&this.controller.setIsLocked(!1),r=!1,m=B=null);c?this.utilities.pivotActive(g.getPivotSetFlag(),-1>=E):this.utilities.pivotUpdate();return h.dirty};this.checkInteractionMode=function(){var a;a=1===E&&ca?n[1]:2===E&&ca&&!W&&!N||2===E&&W&&!ca&&!N||"dolly"===q&&!W&&"pinch"!==m||0!==J.z?N||W||ca||2!==E&&1!==E?"dolly":"pan":!(2!==E||ca||W^N)||2===E&&ca&&N||1===E&&!ca&&!N||1===E&&W||1===E&&N&&!W||0===E&&ca&&!N&&!W||"pan"===
q&&1!==E&&!W&&"pinch"!==m||ea?"pan":"pan"===m||"pinch"===m?"dollypan":q;a!==l&&(l=a,("pan"===l&&-1<E||"dollypan"===l)&&this.initTracking(A.x,A.y))};this.interactionStart=function(a,b){if(b||a>E)E=a,z=!0,-1<a&&("pan"===l&&this.initTracking(A.x,A.y),"orbit"===l&&this.initOrbit()),this.utilities.pivotActive(g.getPivotSetFlag(),-1===a),this.utilities.autocam&&(this.utilities.autocam.sync(h),this.utilities.autocam.startInteraction(G.x,G.y),B=G.clone())};this.interactionCheck=function(){(O[0]||O[1]||O[2]||
O[3]||O[4]||O[5]||ca||N||W||ea)&&this.interactionStart(-4,!0)};this.interactionEnd=function(a){a===E&&(-1!==a&&this.utilities.pivotActive(!1),z=!1)};this.handleWheelInput=function(b){if(this.isDragging)return!1;if(g.getIs2D()){var c=g.getScreenViewport(),c=a.intersectGround(F+c.width,C+c.height);this.utilities.setPivotPoint(c,!0,!0)}g.getReverseZoomDirection()&&(b*=-1);D.z+=b;c=Date.now();w||(w=c);0!=b&&this.interactionStart(-1);return!0};this.resetKeys=function(){this.autoMove(-1,!1);ea=W=N=ca=0};
this.autoMove=function(a,b){b&&this.isDragging||(0>a?O[0]=O[1]=O[2]=O[3]=O[4]=O[5]=b:O[a]=b,b||this.interactionEnd(-4),this.interactionCheck())};this.updateModifierState=function(a){N=d&&a.metaKey||a.ctrlKey?1:0;ca=a.shiftKey?1:0;W=a.altKey?1:0};this.handleKeyDown=function(a,b){this.updateModifierState(a);var c=!1;switch(b){case 187:this.adjustSpeed(1);c=!0;break;case 189:this.adjustSpeed(-1);c=!0;break;case 48:this.adjustSpeed(0);c=!0;break;case 37:this.autoMove(0,!0);c=!0;break;case 39:this.autoMove(1,
!0);c=!0;break;case 33:this.autoMove(2,!0);c=!0;break;case 34:this.autoMove(3,!0);c=!0;break;case 38:this.autoMove(4,!0);c=!0;break;case 40:this.autoMove(5,!0);c=!0;break;default:return!1}this.isDragging||this.interactionStart(-4);return c};this.handleKeyUp=function(a,b){this.updateModifierState(a);var c=!1;switch(b){case 37:this.autoMove(0,!1);c=!0;break;case 39:this.autoMove(1,!1);c=!0;break;case 33:this.autoMove(2,!1);c=!0;break;case 34:this.autoMove(3,!1);c=!0;break;case 38:this.autoMove(4,!1);
c=!0;break;case 40:this.autoMove(5,!1);c=!0;break;default:return!1}c&&(this.interactionEnd(-4),z||this.interactionCheck());return c};this.handleDollyPan=function(a){F=a.canvasX;C=a.canvasY;var b=g.getScreenViewport();H.x=I.x+a.deltaX;H.y=I.y+a.deltaY;D.x=H.x/b.width;D.y=H.y/b.height;var b=a.pointers[1].clientX-a.pointers[0].clientX,c=a.pointers[1].clientY-a.pointers[0].clientY;t=Math.sqrt(b*b+c*c);a=a.type;-1!==a.indexOf("start",a.length-5)&&(p=t)};this.handleGesture=function(a){switch(a.type){case "dragstart":return m=
"drag",this.handleButtonDown(a,0);case "dragmove":return"drag"===m?this.handleMouseMove(a):!1;case "dragend":if("drag"===m)return this.handleButtonUp(a,0),m=null,!0;break;case "panstart":return m="pan",this.isDragging=!0,A.x=.5*(a.normalizedX+1),A.y=1-.5*(a.normalizedY+1),I.set(a.canvasX,a.canvasY),G.set(a.canvasX,a.canvasY),this.interactionStart(3),this.handleDollyPan(a),!0;case "panmove":return"pan"===m?this.handleDollyPan(a):!1;case "panend":if("pan"===m)return this.isDragging=!1,this.handleDollyPan(a),
this.interactionEnd(3),!0;break;case "pinchstart":return this.isDragging=!0,m="pinch",A.x=.5*(a.normalizedX+1),A.y=1-.5*(a.normalizedY+1),I.set(a.canvasX,a.canvasY),G.set(a.canvasX,a.canvasY),this.interactionStart(3),this.handleDollyPan(a),!0;case "pinchmove":return"pinch"===m?this.handleDollyPan(a):!1;case "pinchend":if("pinch"===m)return this.isDragging=!1,this.handleDollyPan(a),this.interactionEnd(3),!0}return!1};this.handleButtonDown=function(a,b){this.updateModifierState(a);A.x=.5*(a.normalizedX+
1);A.y=1-.5*(a.normalizedY+1);G.set(a.canvasX,a.canvasY);D.copy(A);H.copy(G);M.copy(c(a.canvasX,a.canvasY));L.copy(M);F=a.canvasX;C=a.canvasY;this.isDragging=!0;this.interactionStart(b);return!0};this.handleButtonUp=function(a,b){this.updateModifierState(a);D.x=.5*(a.normalizedX+1);D.y=1-.5*(a.normalizedY+1);H.set(a.canvasX,a.canvasY);L.copy(c(a.canvasX,a.canvasY));M.copy(L);F=a.canvasX;C=a.canvasY;this.interactionEnd(b);this.isDragging=!1;return!0};this.handleMouseMove=function(b){this.updateModifierState(b);
if(!this.isDragging)return A.x=.5*(b.normalizedX+1),A.y=1-.5*(b.normalizedY+1),G.set(b.canvasX,b.canvasY),D.x=A.x,D.y=A.y,H.copy(G),F=b.canvasX,C=b.canvasY,a.rolloverObject(F,C),!1;D.x=.5*(b.normalizedX+1);D.y=1-.5*(b.normalizedY+1);H.set(b.canvasX,b.canvasY);L.copy(c(b.canvasX,b.canvasY));F=b.canvasX;C=b.canvasY;return!0};this.handleBlur=function(a){this.resetKeys();this.interactionEnd(E)};b.addEventListener(Autodesk.Viewing.ESCAPE_EVENT,function(a){f.handleBlur(a)})};AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.HotGestureTool=function(a){navigator.userAgent.search("Mac OS");a.navigation.getCamera();var b=["hottouch"],c=null,f=null,d=!1,g=!1,h=null;this.getNames=function(){return b};this.getName=function(){return b[0]};this.activate=function(a){};this.deactivate=function(a){};this.__checkStart=function(){h&&(this.controller.distributeEvent("handleGesture",h),h=null)};this.update=function(){if(this.controller.getIsLocked())return!1;var b=a.getActiveNavigationTool(),h=!1===d&&!0===g,n=!0===
d&&!1===g;if(h||n){h=h?"worldup":"fov";if(b===h)return!1;if(b===c)return a.setActiveNavigationTool(h),c=h,this.__checkStart(),!1;f=b;a.setActiveNavigationTool(h);c=h;this.__checkStart()}else c&&(a.setActiveNavigationTool(f),f=c=null);return!1};this.resetKeys=function(){};this.updateModifierState=function(a){};this.handleGesture=function(a){if(a===h)return!1;switch(a.type){case "drag3start":h=a;d=!0;break;case "drag3end":d=!1;break;case "rotatestart":h=a;g=!0;break;case "rotateend":g=!1}return!1};
this.handleKeyDown=function(a,b){this.updateModifierState(a);return!1};this.handleKeyUp=function(a,b){this.updateModifierState(a);return!1};this.handleButtonDown=function(a,b){this.updateModifierState(a);return!1};this.handleButtonUp=function(a,b){this.updateModifierState(a);return!1};this.handleMouseMove=function(a){this.updateModifierState(a);return!1};this.handleBlur=function(a){this.resetKeys();return!1}};"use strict";AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.HotkeyManager=function(){function a(a,b){return a-b}function b(){var a=d.join(),b,c;for(c=0;c<h.length;)b=h[c],b.keys===a?h.splice(c,1):c++;for(c=0;c<g.length;)b=g[c],b.keys!==a?g.splice(c,1):c++}function c(a,c){var k=d.join(),m=d.slice(0),p=d.indexOf(c);-1<p&&d.splice(p,1);var t=d.join(),r=d.slice(0);b();for(var B=[],z=[],F,p=f.length-1;0<=p;p--)F=f[p],F.keys===k&&F.onRelease?B.unshift(F):F.keys===t&&F.onPress&&z.unshift(F);for(p=B.length-1;0<=p&&(F=B[p],!F.onRelease(m));p--)F.options.tryUntilSuccess&&
h.unshift(F);for(p=z.length-1;0<=p&&(F=z[p],!F.onPress(r));p--)F.options.tryUntilSuccess&&g.unshift(F)}var f=[],d=[],g=[],h=[],k=["hotkeys"];return{pushHotkeys:function(b,c,d){if(f.some(function(a){return a.id===b}))return!1;for(var g=0;g<c.length;g++)f.push({id:b,keys:c[g].keycodes.sort(a).join(),onPress:c[g].onPress,onRelease:c[g].onRelease,options:d||{}});return!0},popHotkeys:function(a){for(var b=!1,c=f.length-1;0<=c;c--)f[c].id===a&&(f.splice(c,1),b=!0);return b},handleKeyDown:function(a,c){if(-1===
d.indexOf(c)){for(var k=d.join(),m=d.slice(0),p=0;p<d.length&&d[p]<c;)p++;d.splice(p,0,c);var t=d.join(),r=d.slice(0);b();for(var B=[],z=[],F,p=f.length-1;0<=p;p--)F=f[p],F.keys===k&&F.onRelease?B.unshift(F):F.keys===t&&F.onPress&&z.unshift(F);for(p=B.length-1;0<=p&&(F=B[p],!F.onRelease(m));p--)F.options.tryUntilSuccess&&h.unshift(F);for(p=z.length-1;0<=p&&(F=z[p],!F.onPress(r));p--)F.options.tryUntilSuccess&&g.unshift(F)}},handleKeyUp:c,handleBlur:function(){for(var a=d.length-1;0<=a;a--)c(null,
d[a])},getName:function(){return k[0]},getNames:function(){return k},activate:function(){},deactivate:function(){},update:function(){var a,b;for(b=0;b<h.length;)a=h[b],!0===a.onRelease(a.keys.split())?h.splice(b,1):b++;for(b=0;b<g.length;)a=g[b],!0===a.onPress(a.keys.split())?g.splice(b,1):b++;return!1},KEYCODES:{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,ZERO:48,a:65,b:66,c:67,d:68,
e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SEMICOLON:186,EQUALS:187,COMMA:188,DASH:189,PERIOD:190,SLASH:191,LBRACKET:219,RBRACKET:221,SINGLEQUOTE:222}}};Autodesk.Viewing.theHotkeyManager=new Autodesk.Viewing.HotkeyManager;AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.FovTool=function(a){var b=a.navigation,c=b.getCamera(),f=["fov"],d=!1,g=0,h=null,k=null,l=!1,n=0,q=-5,m=new THREE.Vector3,p=new THREE.Vector3,t=new THREE.Vector3,r=null;this.getNames=function(){return f};this.getName=function(){return f[0]};this.activate=function(a){n=0};this.deactivate=function(a){q=-5};this.getCursor=function(){return 0!==n&&-5===q?null:"url(data:image/x-icon;base64,AAACAAEAGBgAAAAAAACICQAAFgAAACgAAAAYAAAAMAAAAAEAIAAAAAAAYAkAABMLAAATCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAACEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnAwMD/yEhIf8AAABmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAGknJyf/goKC/8/Pz/8aGhr/AAAALQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAABTFBQU/2lpaf/MzMz///////////+Wlpb/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAOAAAAKFTU1P/t7e3////////////8PDw////////////AQEB/wAAAAEAAAAAAAAAFAAAAH0KCgr/AAAAYwAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAjCwsL/6Ghof/t7e3///////Dw8P9MTEz/LS0t//Pz8///////Ghoa/wAAABoAAAANDQ0N/319ff+rq6v/Y2Nj/wAAAK8AAABGAAAA////////////AAAA/wAAAF0hISH/jIyM////////////sLCw/xEREf8AAACHAAAArKysrP//////V1dX/wAAAFcAAABSUlJS//f39///////8PDw/6+vr/86Ojr/LS0t////////////FRUV/1xcXP/Gxsb/+Pj4//Hx8f9MTEz/AAAAsAAAAEcAAAAAAAAAZ2dnZ///////pKSk/wAAAKQAAACtra2t///////////////////////m5ub/kZGR/wAAAP8AAAD/q6ur//Hx8f//////vb29/x0dHf8AAACIAAAAAAAAAAAAAAAAAAAAOjo6Ov//////5+fn/wAAAOcAAADd3d3d////////////////////////////+/v7/9bW1v/i4uL//v7+//Pz8/9hYWH/AAAAvQAAAFQAAAAAAAAAAAAAAAAAAAAAAAAAJycnJ//6+vr//////wMDA/8AAADv7+/v/////////////////////////////////////////////////7y8vP8ODg7/AAAAKwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJiYmJv/6+vr//////wkJCf8AAADv7+/v//////////////////////////////////f39//9/f3//////+np6f+UlJT/GBgY/wAAAH0AAAACAAAAAAAAAAAAAAAAAAAAKSkpKf///////v7+/w0NDf8AAADd3d3d////////////////////////////29vb/39/f/+Xl5f/5+fn////////////5ubm/1RUVP8CAgL/AAAAPwAAAAAAAAAAAAAAOTk5Of//////8PDw/wgICP8AAAChoaGh/////////////////+np6f+YmJj/QkJC/wAAAP8AAAD/UFBQ/7e3t//39/f///////////+oqKj/EBAQ/wAAAIgAAAAAAAAAZ2dnZ///////29vb/wEBAf8AAAA4NTU1/9zc3P/t7e3/tbW1/01NTf8AAACYAAAA////////////AwMD/wsLC/9oaGj/y8vL////////////8fHx/zg4OP8AAACWAAAApaWlpf//////n5+f/wAAAJ8AAAAAAAAAczg4OP9LS0v/EhIS/wAAAE0AAAAAAAAA////////////FRUV/wAAABUAAABoJSUl/4GBgf/i4uL///////////9+fn7/Pz8///b29v//////SkpK/wAAAEoAAAAAAAAAAAAAADgAAABLAAAAEgAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAJQAAAIE8PDz/np6e//z8/P/////////////////8/Pz/CQkJ/wAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAA8DAwM/09PT/+7u7v///////////+QkJD/AAAAkwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////Dw8P/wAAAA8AAAAAAAAAAAAAAAAAAAAAAAAADAAAAFIYGBj/aGho/729vf8WFhb/AAAAJwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////FRUV/wAAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAQEB/w8PD/8AAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////DAwM/wAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8x/h/nO/4fw1D+HwFy/h4BRu4YAHOGEABkAAAAXAAAIFwAAOBnAAHgIAAD4GUAAOB4AABgXAAAIGMAAABtggAAVMYYAHT+HgE7/g8BcP4Pw2/+D+dc/h//XP///2c=), auto"};
this.getMotionDelta=function(a){var b=p.x-m.x,c=p.y-m.y,d=p.z-m.z;.001>Math.abs(b)&&(b=0);.001>Math.abs(c)&&(c=0);.001>Math.abs(d)&&(d=0);a.set(b,c,d)};this.stepMotionDelta=function(a,b){b?(m.x+=.6*a.x,m.y+=.6*a.y,m.z+=.6*a.z):m.copy(p)};this.getAccumulatedWheelDelta=function(){var a=Date.now(),b=0;k&&100<a-k?(b=0>g&&-3<g?-3:0<g&&3>g?3:g,g=0,k=h=null,l=!1):h&&100<a-h&&(l?3<=Math.abs(g)&&(b=g,g=0):(b=0>g&&-3<g?-3:0<g&&3>g?3:g,l=!0,g=0));return b};this.update=function(){var a=!1,f=-5<q;if(-5<q){this.controller.setIsLocked(!0);
this.getMotionDelta(t);var g=t.x,h=t.y,k=t.z;if(0!==g||0!==h||0!==k)f=!0,0<=q?(h=-h,k=Math.abs(g)>Math.abs(h)?g:h,0!==k&&(k*=-1,b.setVerticalFov(b.getVerticalFov()*(1+k),!0))):(g=this.getAccumulatedWheelDelta()/3,0!==g&&b.setFocalLength(b.getFocalLength()+g,!0));this.stepMotionDelta(t,!0);-1===q&&1E-5>Math.abs(k)&&(this.interactionEnd(-1),a=!0)}f?this.utilities.pivotActive(b.getPivotSetFlag(),!0):this.utilities.pivotUpdate();!d&&(a||-5<q)&&(-1<q&&m.copy(p),q=-5,this.controller.setIsLocked(!1));return c.dirty};
this.interactionStart=function(a,c){if(c||a>q)q=a,d=!0;b.toPerspective()};this.interactionEnd=function(a){a===q&&(-1!==a&&this.utilities.pivotActive(!1),d=!1)};this.handleWheelInput=function(a){if(-1<q)return!1;b.getReverseZoomDirection()&&(a*=-1);p.z+=a;g+=a;var c=Date.now();h||(h=c);k=c;0!=a&&this.interactionStart(-1);return!0};this.handleGesture=function(a){switch(a.type){case "dragstart":return this.handleButtonDown(a,0);case "dragmove":return this.handleMouseMove(a);case "dragend":return this.handleButtonUp(a,
0);case "drag3start":return r="drag",this.handleButtonDown(a,0);case "drag3move":return"drag"===r?this.handleMouseMove(a):!1;case "drag3end":"drag"===r&&this.handleButtonUp(a,0),r=null}return!1};this.handleButtonDown=function(a,b){n+=1<<b;return 2!==b?(m.x=.5*(a.normalizedX+1),m.y=1-.5*(a.normalizedY+1),p.copy(m),this.interactionStart(b),!0):!1};this.handleButtonUp=function(a,b){n-=1<<b;return 2!==b?(p.x=.5*(a.normalizedX+1),p.y=1-.5*(a.normalizedY+1),this.interactionEnd(b),!0):!1};this.handleMouseMove=
function(a){p.x=.5*(a.normalizedX+1);p.y=1-.5*(a.normalizedY+1);return-1<q};this.handleBlur=function(a){this.interactionEnd(q);return!1}};AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.WorldUpTool=function(a,b){var c=b.navigation,f=c.getCamera(),d=["worldup"],g=this,h=function(){var a=new THREE.Vector3;return function(b,c,d,f){b=new THREE.Vector3(b,c,d);c=f.dot(b);a.copy(f);a.multiplyScalar(c);return b.sub(a)}}(),k=2*Math.PI,l=!1,n=!1,q=!1,m=new function(a,b){function d(a,b){var c=Math.abs(a-b);return c>k?c:Math.min(k-c,c)}function f(a,b){var c=n(a);if(1E-5>c.distanceToSquared(b))return!0;B.set(-b.x,-b.y,-b.z);return 1E-5>c.distanceToSquared(B)}function g(a){return a>
k?a:0>=a?a+Math.PI:a-Math.PI}function n(a){r.set(0,0,0);if(0<=a){var b=3<=a?-1:1;a%=3;0===a&&(r.x=b);1===a&&(r.y=b);2===a&&(r.z=b)}aa&&r.multiplyScalar(-1);return r}function m(a,b){for(var c=d(X[0],a),f=0,g=1;6>g;++g){var h=d(X[g],a);h<c&&(c=h,f=g)}return c<b?f:-1}function l(a){if(0!==a){var b=30*Math.PI/180,d=B.copy(Y.position).sub(da).normalize();S.setFromAxisAngle(d,a);a=c.getWorldUpVector();d=Math.abs(d.angleTo(a));(d<b||Math.PI-d<b)&&a.copy(c.getCameraUpVector());a.applyQuaternion(S);c.setIsLocked(!1);
c.setWorldUpVector(a,!0);c.setIsLocked(!0)}}function q(a,b){0>a.dot(b)&&(b=b.clone().multiplyScalar(-1));c.orient(ea,da,Y.position,b);ea.position.copy(b.multiplyScalar(.495));for(var f=!1,g=R?la:ha,h=0;6>h;++h){var k=d(X[h],ia),m;m=a;m=k<g?1E-5>n(h).distanceToSquared(m):!1;m&&(f=!0);k=m?4:3*(1-3*k/Math.PI);1>k&&(k=1);k*=U;fa[h].visible=m;m=ba[h];m.scale.x=k;m.scale.y=k;m.scale.z=k}O.visible=f;ca.visible=f;return W.visible=f}function t(a){ia+=a;ia>Math.PI?ia-=k:ia<=-Math.PI&&(ia=k+ia);var b;a:{if(!R&&
(b=m(ia,ha),0<=b)){R=!0;ia=X[b];b=n(b);break a}b=!1}if(b)pa=ia,a=b,c.setIsLocked(!1),c.setWorldUpVector(a,!0),c.setIsLocked(!0);else if(R&&0>m(ia,la)?(R=!1,b=!0):b=!1,b)l(ia-pa),pa=0;else{if(R)return!1;l(a)}return!0}var p=2*Math.tan(THREE.Math.degToRad(15)),z=new THREE.MeshPhongMaterial({color:12303291,ambient:12303291,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1}),r=new THREE.Vector3,B=new THREE.Vector3,S=new THREE.Quaternion,Y=new THREE.PerspectiveCamera(30,b.aspect,b.near,b.far),U=1,Z=
1,da=null,V=null,O=null,ca=null,W=null,N=null,ea=null,ba=null,fa=null,X=Array(6),ia=0,aa=!1,R=!0,pa=0,ha=5*Math.PI/180,la=7*Math.PI/180,za=1;a.createOverlayScene("roll",null,null,Y);this.updateRollCamera=function(a,c){Y.position.copy(b.position);Y.quaternion.copy(b.quaternion);Y.up.copy(b.up);Y.aspect=b.aspect;a&&c&&(Y.near=c-a,Y.far=c+a);Y.updateProjectionMatrix()};this.isSnapped=function(){return R};this.resize=function(){var a=za*p,c=a*b.aspect,a=(1>b.aspect?c:a)*Z;N.scale.x=a;N.scale.y=a;N.scale.z=
a};this.start=function(b,c){this.updateHUD(b,c);a.addOverlay("roll",N)};this.updateHUD=function(a,k){da=a;.35>k?k=.35:.8<k&&(k=.8);Z=k;U=.8/k;var n=r.copy(a).sub(b.position);za=n.length();var m=za*p,l=m*b.aspect,m=(1>b.aspect?l:m)*k;this.updateRollCamera(m,za);var l=c.getWorldUpVector(),t=c.getCameraUpVector();if(!N){N=new THREE.Object3D;var F=new THREE.RingGeometry(.5-.01*U,.5,60);V=F=new THREE.Mesh(F,z);var D=.007*U,I=new THREE.BoxGeometry(.93,D,D),G=new THREE.BoxGeometry(D,.93,D),D=new THREE.BoxGeometry(D,
D,.93);O=new THREE.Mesh(I,z);ca=new THREE.Mesh(G,z);W=new THREE.Mesh(D,z);N.add(O);N.add(ca);N.add(W);ea=new THREE.Mesh(new THREE.CircleGeometry(.005),z);N.add(ea);ba=Array(6);fa=Array(6);for(I=0;6>I;++I)G=.0025*U,ba[I]=new THREE.Mesh(new THREE.CircleGeometry(.005*U,16),z),fa[I]=new THREE.Mesh(new THREE.CircleGeometry(G,16),z),fa[I].visible=!1,ba[I].add(fa[I]),F.add(ba[I]);N.add(F)}c.orient(V,a,Y.position,l);F=n.clone().normalize();I=Array(3);n=Array(6);I[0]=h(1,0,0,F);I[1]=h(0,1,0,F);I[2]=h(0,0,
1,F);G=t.clone().cross(F).normalize();for(F=0;3>F;++F)D=I[F],n[F]=D.length(),.1>n[F]?X[F]=1E3:(D.multiplyScalar(1/n[F]),X[F]=Math.atan2(G.dot(D),t.dot(D)));X[3]=g(X[0]);X[4]=g(X[1]);X[5]=g(X[2]);n[3]=n[0];n[4]=n[1];n[5]=n[2];F=ha+la+2*Math.PI/180;for(I=0;6>I;++I)if(1E3!==X[I])for(G=I+1;6>G;++G)if(1E3!==X[G]&&d(X[I],X[G])<F)if(n[I]<n[G]&&!f(I,l)||f(G,l)){X[I]=1E3;break}else X[G]=1E3;for(F=0;6>F;++F)1E3!==X[F]?(n=B.set(0,0,1),S.setFromAxisAngle(n,X[F]),n=B.set(0,.54,0),n.applyQuaternion(S),ba[F].position.copy(n),
ba[F].visible=!0):ba[F].visible=!1;N.scale.x=m;N.scale.y=m;N.scale.z=m;N.position.copy(a);pa=ia=0;aa=0>l.dot(t);R=q(l,t)};this.handleRoll=function(a,b,d){this.updateRollCamera();q(c.getWorldUpVector(),c.getCameraUpVector());return 0!==a||0!==b?(a=d.x-a-.5,b=d.y-b-.5,t(Math.atan2(d.y-.5,d.x-.5)-Math.atan2(b,a))):!1};this.handleRollTouch=function(a){this.updateRollCamera();q(c.getWorldUpVector(),c.getCameraUpVector());a-=ia;return.001<Math.abs(a)?t(a):!1};this.end=function(){a.removeOverlay("roll",
N)}}(a,f),p=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3,B=null,z=0;this.getNames=function(){return d};this.getName=function(){return d[0]};this.activate=function(a){b.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange);q=!1};this.deactivate=function(a){m.end();c.setIsLocked(!1);b.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange);this.utilities.restorePivot();B=null;q=l=!1};this.getCursor=function(){return"auto"};this.getMotionDelta=
function(a){var b=t.x-p.x,c=t.y-p.y,d=t.z-p.z;.001>Math.abs(b)&&(b=0);.001>Math.abs(c)&&(c=0);.001>Math.abs(d)&&(d=0);a.set(b,c,d)};this.stepMotionDelta=function(){p.copy(t)};this.update=function(){if(!q){var a=c.getEyeVector(),b=.5*(f.near+f.far);a.normalize().multiplyScalar(b);a=a.add(f.position);this.utilities.savePivot();this.utilities.setPivotPoint(a,!0,!0);this.utilities.pivotActive(!0);m.start(a,.65);q=!0}a=n;this.getMotionDelta(r);var b=r.x,d=r.y,g=r.z;if(n||"roll"===B||l&&(0!==b||0!==d||
0!==g))n="roll"===B?m.handleRollTouch(z):m.handleRoll(b,d,t);this.stepMotionDelta();f.dirty&&(a=!0);return a};this.handleResize=function(){m.resize();n=!0};this.handleGesture=function(a){switch(a.type){case "dragstart":return B="drag",this.handleButtonDown(a,0);case "dragmove":return this.handleMouseMove(a);case "dragend":return B=null,this.handleButtonUp(a,0);case "rotatestart":c.setIsLocked(!0);b.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange);B="roll";z=THREE.Math.degToRad(a.rotation);
var d=a.pointers[1].clientX-a.pointers[0].clientX;a=a.pointers[1].clientY-a.pointers[0].clientY;Math.sqrt(d*d+a*a);d=c.getScreenViewport();Math.min(d.width,d.height);return!0;case "rotatemove":return z=THREE.Math.degToRad(a.rotation),"roll"===B;case "rotateend":c.setIsLocked(!1),b.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),z=THREE.Math.degToRad(a.rotation),B=null}return!1};this.handleWheelInput=function(a){return!0};this.handleCameraChange=function(){var a=c.getEyeVector(),
b=.5*(f.near+f.far);a.normalize().multiplyScalar(b);a=a.add(f.position);m.updateHUD(a,.65)};this.handleButtonDown=function(a,d){p.x=.5*(a.normalizedX+1);p.y=1-.5*(a.normalizedY+1);t.copy(p);l=!0;B=null;c.setIsLocked(!0);this.controller.setIsLocked(!0);b.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,g.handleCameraChange);return!0};this.handleButtonUp=function(a,d){t.x=.5*(a.normalizedX+1);t.y=1-.5*(a.normalizedY+1);l=!1;n=!0;c.setIsLocked(!1);this.controller.setIsLocked(!1);b.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,
g.handleCameraChange);return!0};this.handleMouseMove=function(a){t.x=.5*(a.normalizedX+1);t.y=1-.5*(a.normalizedY+1);return!0};this.handleBlur=function(a){l=!1;B=null;return!1}};AutodeskNamespace("Autodesk.Viewing.Private");
(function(){var a=Autodesk.Viewing,b=a.Private;a.SelectionMode={LEAF_OBJECT:0,FIRST_OBJECT:1,LAST_OBJECT:2};b.Selector=function(b){function f(a,b){if(0<l[b])l[b]--,0==l[b]&&k.viewer.highlightObjectNode(k.model,b,!1);else if(0>l[b])throw"Selection State machine broken. Negatively selected object!";a&&a.enumNodeChildren(b,function(b){f(a,b)},!1)}function d(a,b,c){l[b]?l[b]++:(k.viewer.highlightObjectNode(k.model,b,!0,c),l[b]=1);a&&a.enumNodeChildren(b,function(b){d(a,b,!0)},!1)}function g(b){"number"!==
typeof b&&(console.warn("Deprecated use of select. Use dbId instead of node."),b=b.dbId);var c=b;if(k.selectionMode===a.SelectionMode.LEAF_OBJECT)b=c;else if(b=c,k.selectionMode===a.SelectionMode.FIRST_OBJECT){for(var f=[],g=k.getInstanceTree(),h=c;h;)f.push(h),h=g.getNodeParentId(h);for(h=f.length-1;0<=h;h--)if(c=g.getNodeType(f[h]),c!==NODE_TYPE_MODEL&&c!==NODE_TYPE_LAYER&&c!==NODE_TYPE_COLLECTION){b=f[h];break}}else if(k.selectionMode===a.SelectionMode.LAST_OBJECT)for(g=k.getInstanceTree(),h=c;h;){c=
g.getNodeType(h);if(c===NODE_TYPE_COMPOSITE){b=h;break}h=g.getNodeParentId(h)}k.isSelected(b)||(k.selectedObjectIds[b]=b,k.selectionCount++,f=k.getInstanceTree(),d(f,b,!1))}function h(a){"number"!==typeof a&&(console.warn("Deprecated use of deselect. Use dbId instead of node."),a=a.dbId);if(k.isSelected(a)){var b=a,c=k.getInstanceTree();f(c,b);k.selectedObjectIds[a]=0;k.selectionCount--}}var k=this;this.viewer=b;this.model=null;this.selectedObjectIds={};this.selectionCount=0;this.selectionMode=a.SelectionMode.LEAF_OBJECT;
var l={};b.api.addEventListener(a.ISOLATE_EVENT,function(a){k.deselectInvisible()});b.api.addEventListener(a.HIDE_EVENT,function(a){k.deselectInvisible()});this.setModel=function(a){this.model=a};this.getInstanceTree=function(){return this.model?this.model.getData().instanceTree:null};this.getSelectionLength=function(){return k.selectionCount};this.getSelection=function(){var a=[],b=k.selectedObjectIds,c;for(c in b)b=parseInt(c),a.push(b);return a};this.clearSelection=function(a){if(0<this.selectionCount){var b=
k.selectedObjectIds,c;for(c in b)if(b=parseInt(c),void 0!==b){var d=k.getInstanceTree();f(d,b)}k.selectedObjectIds={};k.selectionCount=0;a||this.fireSelectionChangedEvent()}};this.fireSelectionChangedEvent=function(){var b=[],c=[],d=k.selectedObjectIds,f=this.getInstanceTree(),g;for(g in d)if(d=parseInt(g))b.push(d),f&&f.enumNodeFragments(d,function(a){c.push(a)},!1);this.viewer.api.fireEvent({type:a.SELECTION_CHANGED_EVENT,fragIdsArray:c,dbIdArray:b,nodeArray:b})};this.isSelected=function(a){"number"!==
typeof a&&(console.warn("Deprecated use of isSelected. Use dbId instead of node."),a=a.dbId);if(void 0!==a&&this.selectedObjectIds[a])return!0};this.toggleSelection=function(a){"number"!==typeof a&&(console.warn("Deprecated use of deselect. Use dbId instead of node."),a=a.dbId);a?(this.isSelected(a)?h(a):g(a),k.fireSelectionChangedEvent()):console.error("Attempting to select a null node.")};this.setSelectionIds=function(a){this.setSelection(a)};this.selectionIsEqual=function(a){if(this.selectionCount!==
a.length)return!1;for(var b=0;b<a.length;b++)if(!this.isSelected(a[b]))return!1;return!0};this.setSelectionMode=function(a){this.clearSelection(!0);this.selectionMode=a};this.setSelection=function(a){a&&a.length&&"number"!==typeof a[0]&&(console.warn("Deprecated use of setSelection. Use dbId instead of node."),a=a.map(function(a){return a.dbId}));if(!this.selectionIsEqual(a)&&(this.clearSelection(!0),null!=a)){for(var b=0;b<a.length;b++)g(a[b]);this.fireSelectionChangedEvent()}};this.deselectInvisible=
function(){var a=!1,b=k.selectedObjectIds,c=this.getInstanceTree(),d;for(d in b){var b=parseInt(d),f=c.isNodeHidden(b);b&&f&&(h(b),a=!0)}a&&this.fireSelectionChangedEvent()};this.isSelectedOrParentIsSelected=function(a){for(var b=this.getInstanceTree();a;){if(this.isSelected(a))return!0;a=b.getNodeParentId(a)}return!1};this.getSelectionBounds=function(){var a=new THREE.Box3,b=new THREE.Box3,c=this.getInstanceTree(),d=this.viewer.modelQueue().getFragmentList(),f=k.selectedObjectIds,g;for(g in f)f=
parseInt(g),c.enumNodeFragments(f,function(c){d.getWorldBounds(c,b);a.union(b)},!0);return a};this.getSelectionVisibility=function(){var a=!1,b=!1,c=k.selectedObjectIds,d;for(d in c)if(c=parseInt(d))if(this.getInstanceTree().isNodeHidden(c)?b=!0:a=!0,a&&b)break;return{hasVisible:a,hasHidden:b}};this.uninitialize=function(){this.selectedObjectIds=this.model=this.viewer=null}}})();AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.Private.VisibilityManager=function(a){this.viewerImpl=a;this.model=null;this.isolatedNodes=[];this.hiddenNodes=[]};Autodesk.Viewing.Private.VisibilityManager.prototype.setModel=function(a){this.model=a};Autodesk.Viewing.Private.VisibilityManager.prototype.getInstanceTree=function(){return this.model?this.model.getData().instanceTree:null};Autodesk.Viewing.Private.VisibilityManager.prototype.getIsolatedNodes=function(){return this.isolatedNodes.slice(0)};
Autodesk.Viewing.Private.VisibilityManager.prototype.getHiddenNodes=function(){return this.hiddenNodes.slice(0)};Autodesk.Viewing.Private.VisibilityManager.prototype.isolate=function(a){var b=this.getInstanceTree().getRootId(),b="number"==typeof a&&a===b||a.dbId===b;a&&!b?this.isolateMultiple(Array.isArray(a)?a:[a]):this.isolateNone()};
Autodesk.Viewing.Private.VisibilityManager.prototype.isolateNone=function(){this.viewerImpl.setModelVisibility(this.model,!0);var a=this.model?this.model.getRootId():null;a&&this.setVisibilityOnNode(a,!0);this.hiddenNodes=[];this.isolatedNodes=[];this.viewerImpl.resetIsolation(this.model);this.viewerImpl.api.fireEvent({type:Autodesk.Viewing.ISOLATE_EVENT,nodeIdArray:[]})};
Autodesk.Viewing.Private.VisibilityManager.prototype.isolateMultiple=function(a){if(a&&0!=a.length){"number"!==typeof a[0]&&(console.warn("Deprecated use of isolateMultiple. Use dbId instead of node object."),a=a.map(function(a){return a.dbId}));var b=this.model?this.model.getRootId():null;b&&this.setVisibilityOnNode(b,!1);this.viewerImpl.setModelVisibility(this.model,!1);this.isolatedNodes=a.slice(0);this.hiddenNodes=[];for(b=0;b<a.length;b++)this.setVisibilityOnNode(a[b],!0),this.viewerImpl.needGhostedPass=
!0;this.viewerImpl.api.fireEvent({type:Autodesk.Viewing.ISOLATE_EVENT,nodeIdArray:a})}else this.isolateNone();this.viewerImpl.invalidate(!0)};Autodesk.Viewing.Private.VisibilityManager.prototype.hideMultiple=function(a){for(var b=0;b<a.length;++b)this.setVisibilityOnNode(a[b],!1);0<a.length&&this.viewerImpl.api.fireEvent({type:Autodesk.Viewing.HIDE_EVENT,nodeIdArray:a})};
Autodesk.Viewing.Private.VisibilityManager.prototype.hide=function(a){this.setVisibilityOnNode(a,!1);this.viewerImpl.api.fireEvent({type:Autodesk.Viewing.HIDE_EVENT,nodeIdArray:[a]})};Autodesk.Viewing.Private.VisibilityManager.prototype.showMultiple=function(a){for(var b=0;b<a.length;++b)this.setVisibilityOnNode(a[b],!0);0<a.length&&this.viewerImpl.api.fireEvent({type:Autodesk.Viewing.SHOW_EVENT,nodeIdArray:a})};
Autodesk.Viewing.Private.VisibilityManager.prototype.show=function(a){this.setVisibilityOnNode(a,!0);this.viewerImpl.api.fireEvent({type:Autodesk.Viewing.SHOW_EVENT,nodeIdArray:[a]})};
Autodesk.Viewing.Private.VisibilityManager.prototype.toggleVisibility=function(a){"number"!==typeof a&&(a=a.dbId,console.warn("Deprecated use of toggleVisibility. Use dbId instead of node object."));var b=this.getInstanceTree().isNodeHidden(a);this.setVisibilityOnNode(a,b);this.viewerImpl.api.fireEvent({type:b?Autodesk.Viewing.SHOW_EVENT:Autodesk.Viewing.HIDE_EVENT,nodeIdArray:[a]})};
Autodesk.Viewing.Private.VisibilityManager.prototype.setVisibilityOnNode=function(a,b){"number"!==typeof a&&(a=a.dbId,console.warn("Deprecated use of setVisibilityOnNode. Use dbId instead of node object."));var c=this.viewerImpl,f=this.model,d=this,g=this.getInstanceTree(),h=!b;g.enumNodeChildren(a,function(a){if(!g.isNodeHidden(a)&&h)for(var k=0,q=d.isolatedNodes.length;k<q;++k)if(d.isolatedNodes[k]===a){d.isolatedNodes.splice(k,1);break}g.setNodeHidden(a,h);g.enumNodeFragments(a,function(a){c.setFragmentVisibility(f,
a,b)},!1)},!0);this.viewerImpl.needGhostedPass=!0;var k=this.hiddenNodes.indexOf(a);b&&-1!==k?this.hiddenNodes.splice(k,1):b||-1!==k||this.hiddenNodes.push(a)};AutodeskNamespace("Autodesk.Viewing.Private");LMV_WORKER_URL||(LMV_WORKER_URL="src/workers/MainWorker.js");void 0==ENABLE_INLINE_WORKER&&(ENABLE_INLINE_WORKER=!1);
(function(){var a=Autodesk.Viewing.Private,b=null;a.initWorkerScript=function(c,f){if(ENABLE_INLINE_WORKER&&!b){var d=new XMLHttpRequest,g=LMV_WORKER_URL,h=a.getResourceUrl(LMV_WORKER_URL);h&&(g=h);d.open("GET",g,!0);d.withCredentials=!1;d.onload=function(){var a;window.URL=window.URL||window.webkitURL;try{a=new Blob([d.responseText],{type:"application/javascript"})}catch(f){a=new BlobBuilder,a.append(d.responseText),a=a.getBlob()}b=URL.createObjectURL(a);c&&c()};d.send()}else c&&c()};a.createWorker=
function(){return ENABLE_INLINE_WORKER?new Worker(b):new Worker(a.getResourceUrl(LMV_WORKER_URL))};a.createWorkerWithTokenRefresh=function(){var b=a.createWorker();b.checkTokenRefresh=function(f){return f.data&&f.data.refreshToken?((new a.TokenRefreshHandler).refreshToken(function(){stderr("Token refreshed in thread");b.postMessage({tokenRefreshed:!0})},function(){stderr("Failed token refresh in thread");b.postMessage({tokenRefreshed:!1})}),!0):f.data&&f.data.assetRequest?(a.assets&&a.assets.push(f.data.assetRequest),
!0):!1};b.addEventListenerWithTokenRefresh=function(a){var d=function(d){b.checkTokenRefresh(d)||a(d)};b.addEventListener("message",d,!1);return d};b.removeEventListener=function(a){b.removeEventListener("message",a)};return b}})();AutodeskNamespace("Autodesk.Viewing.Private");
var NUM_WORKER_THREADS=isMobileDevice()?2:6,WORKER_LOAD_GEOMETRY="LOAD_GEOMETRY",WORKER_LOAD_SVF="LOAD_SVF",WORKER_LOAD_SVF_CONTD="LOAD_SVF_CONTD",WORKER_GET_PROPERTIES="GET_PROPERTIES",WORKER_SEARCH_PROPERTIES="SEARCH_PROPERTIES",WORKER_BUILD_EXTERNAL_ID_MAPPING="BUILD_EXTERNAL_ID_MAPPING",WORKER_GET_OBJECT_TREE="GET_OBJECT_TREE",WORKER_PARSE_F2D="PARSE_F2D",WORKER_STREAM_F2D="STREAM_F2D",WORKER_PARSE_F2D_FRAME="PARSE_F2D_FRAME";
(function(){function a(){n=new THREE.BufferAttribute(void 0,1);q=function(){THREE.BufferGeometry.call(this);this.name=this.uuid=null;this.numInstances=void 0;this.streamingIndex=this.streamingDraw=!1;this.svfid=void 0;this.vb=null;this.vbbuffer=void 0;this.ib=null;this.ibbuffer=void 0;this.vaos=null;this.vbNeedsUpdate=!1;this.byteSize=this.vbstride=0;this.attributesKeys=void 0;this.__webglInit=!1};q.prototype=Object.create(THREE.BufferGeometry.prototype);q.prototype.constructor=q}function b(b){q||
a();var c=b.mesh,d=new q;d.byteSize=0;d.vb=c.vb;d.vbbuffer=void 0;d.vbNeedsUpdate=!0;d.byteSize+=c.vb.byteLength;d.vbstride=c.vbstride;c.isLines&&(d.isLines=c.isLines);b.is2d&&(d.is2d=!0);d.numInstances=c.numInstances;for(var f in c.vblayout){var g=d.attributes,m=f,p;a:{var E=f;p=c.vblayout[f];var A=d.numInstances,D=void 0;if(p.array)D=new THREE.BufferAttribute(p.array,p.itemSize);else{E=E+"|"+p.bytesPerItem+"|"+p.normalize+"|"+p.isPattern+"|"+p.divisor+"|"+p.offset;if(D=k[E]){p=D;break a}D=new THREE.BufferAttribute(void 0,
p.itemSize);k[E]=D}D.bytesPerItem=p.bytesPerItem;D.normalize=p.normalize;D.isPattern=p.isPattern;A&&(D.divisor=p.divisor);p.array?geometry.byteSize+=p.array.byteLength:p.hasOwnProperty("offset")?D.itemOffset=p.offset:stderr("VB attribute is neither interleaved nor separate. Something is wrong with the buffer specificaiton.");p=D}g[m]=p}h.memoryOptimizedLoading?(d.attributes.index=n,d.ib=c.indices,d.ibbuffer=void 0):d.addAttribute("index",new THREE.BufferAttribute(c.indices,1));f="";for(var I in d.attributes)f+=
I+"|";I=l[f];I||(I=Object.keys(d.attributes),l[f]=I);d.attributesKeys=I;d.byteSize+=c.indices.byteLength;65535<c.vb.length/c.vbstride&&stderr("Mesh with >65535 vertices. It will fail to draw.");d.boundingBox=(new THREE.Box3).copy(c.boundingBox);d.boundingSphere=(new THREE.Sphere).copy(c.boundingSphere);d.drawcalls=null;d.offsets=null;b.geometry=d;b.mesh=null}function c(a,b,c){b=b.transforms;if(!b)return null;var d=a.elements;c*=12;d[0]=b[c+0];d[1]=b[c+1];d[2]=b[c+2];d[3]=0;d[4]=b[c+3];d[5]=b[c+4];
d[6]=b[c+5];d[7]=0;d[8]=b[c+6];d[9]=b[c+7];d[10]=b[c+8];d[11]=0;d[12]=b[c+9];d[13]=b[c+10];d[14]=b[c+11];d[15]=1;return a}function f(a){if((a=a.data)&&a.debug)stderr(a.message);else if(a.cbId){var b=p[a.cbId];if(a&&a.error){if(b[1])b[1](a.error)}else if(b[0])b[0](a.result);delete p[a.cbId]}}function d(a,b){var c=m++;p[c]=[a,b];return c}var g=Autodesk.Viewing,h=Autodesk.Viewing.Private;h.SvfLoader=function(a){this.viewer3DImpl=a;this.next_pack=0;this.loading=!1;this.loadedPacksCount=0;this.loadedPacks=
[];this.tmpMatrix=new THREE.Matrix4;this.logger=h.logger;this.loadTime=0;this.domainParam=auth?"domain="+encodeURIComponent(window.location.origin):"";this.pageOutGeometryEnabled=this.cullGeometryOnLoading=this.onDemandLoading=!1};h.SvfLoader.prototype.uninitialize=function(){this.viewer3DImpl=this.svf=null};h.SvfLoader.prototype.pathToURL=function(a){if("http://"==a.substr(0,7)||"https://"==a.substr(0,8)||"file:///"==a.substr(0,8)||"urn:"==a.substr(0,4))return a;var b=window.location.pathname,c=
b.lastIndexOf("/"),b=b.substr(0,c+1);return window.location.protocol+"//"+window.location.host+b+a};h.SvfLoader.prototype.loadFile=function(a,b,c,d,f){if(this.loading)return console.log("Loading of SVF already in progress. Ignoring new request."),!1;this.svfWorker&&(this.svfWorker.terminate(),this.svfWorker=null);this.parsingWorker&&(this.parsingWorker.terminate(),this.parsingWorker=null);this.streamingWorker&&(this.streamingWorker.terminate(),this.streamingWorker=null);this.propWorker&&(this.propWorker.terminate(),
this.propWorker=null);if(this.pack_workers){for(var g=0;g<this.pack_workers.length;g++)this.pack_workers[g].terminate();this.pack_workers=null}g=a.indexOf("urn:");if(-1!=g){a=decodeURIComponent(a);g=a.substr(g,a.substr(g).indexOf("/"));stderr("Extracted URN: "+g);var k=g.lastIndexOf(":");this.svfUrn=g.substr(k+1)}else this.svfUrn=a;this.sharedDbPath=c;this.currentLoadPath=a;var l=this.isf2d=-1!=a.indexOf(".f2d"),m=this;h.initWorkerScript(function(){l?m.loadFydoCB(a,b,d,f):m.loadSvfCB(a,b,d,f)});return!0};
h.SvfLoader.prototype.interceptManifest=void 0;h.SvfLoader.prototype.loadSvfCB=function(a,b,c,d){this.t0=(new Date).getTime();this.failedToLoadSomeGeometryPacks=null;var f=this,k={url:f.pathToURL(a),headers:g.HTTP_REQUEST_HEADERS,objectIds:b,auth:auth,viewing_url:VIEWING_URL,queryParams:this.domainParam,bvhOptions:{isWeakDevice:isAndroidDevice()||isIOSDevice()}},l=this.svfWorker=h.createWorkerWithTokenRefresh("SVF Load");l.addEventListenerWithTokenRefresh(function(a){var b=function(){l.terminate();
l=null};if(a.data&&a.data.manifest)f.interceptManifest(a.data.manifest),k.operation=WORKER_LOAD_SVF_CONTD,k.manifest=a.data.manifest,l.postMessage(k);else if(a.data&&a.data.svf){var m=f.svf=a.data.svf;f.failedToLoadSomeGeometryPacks&&(d&&d(f.failedToLoadSomeGeometryPacks.code,f.failedToLoadSomeGeometryPacks.msg),f.failedToLoadSomeGeometryPacks=null);f.onSvfLoadDone(m);c&&c(m);f.viewer3DImpl.api.fireEvent({type:g.MODEL_ROOT_LOADED_EVENT,svf:m});var n=m.geompacks.length;f.svf.loadDone=!1;if(0==n)f.onGeomLoadDone();
else if(m.fragments.length>h.FRAGS_PERSISTENT_MAX_COUNT?(f.onDemandLoading=h.onDemandLoading,f.cullGeometryOnLoading=h.cullGeometryOnLoading,f.pageOutGeometryEnabled=h.pageOutGeometryEnabled):(f.onDemandLoading=!1,f.cullGeometryOnLoading=!1,f.pageOutGeometryEnabled=!1),stderr("SVF on demand loading: "+f.onDemandLoading),stderr("SVF culling geometry on loading: "+f.cullGeometryOnLoading),stderr("SVF page out geometry: "+f.pageOutGeometryEnabled),f.onDemandLoading)f.loadedPacksCount=0;else if(n)for(var n=
Math.min(n,NUM_WORKER_THREADS),p=0;p<n;p++){var q=m.geompacks[p];q.loading=!0;f.loadGeometryPack(q.id,q.uri);f.next_pack=p+1}1==a.data.progress&&(f.loading=!1,b());m.fragments.polygonCounts||(m.fragments.polygonCounts=new Int32Array(m.fragments.length))}else a.data&&a.data.bvh?1==a.data.progress&&(f.svf.bvh||(f.svf.bvh=a.data.bvh,f.viewer3DImpl.setBVH(new NodeArray(f.svf.bvh.nodes,f.svf.bvh.useLeanNodes),f.svf.bvh.primitives),f.viewer3DImpl.invalidate(!1,!0)),f.loading=!1,b()):a.data&&a.data.progress?
1==a.data.progress&&(f.loading=!1,b()):a.data&&a.data.error?(f.loading=!1,b(),d&&d(a.data.error.code,a.data.error.msg)):a.data&&a.data.debug?stderr(a.data.message):(stderr("SVF download failed."),f.loading=!1,b())});k.operation=WORKER_LOAD_SVF;k.interceptManifest=!!this.interceptManifest;l.postMessage(k);return!0};h.SvfLoader.prototype.loadFydoCB=function(a,b,c,d){this.t0=Date.now();var f=this.pathToURL(a),k=this.streamingWorker=h.createWorker(),l=this.parsingWorker=h.createWorker(),m=this,n={};k.addEventListener("message",
function(a){if(a.data&&"F2DBLOB"==a.data.type){var b={operation:WORKER_PARSE_F2D,data:a.data.buffer,metadata:a.data.metadata,manifest:a.data.manifest,basePath:a.data.basePath,f2dLoadOptions:n,url:f};l.postMessage(b,[b.data]);k.terminate()}else a.data&&"F2DSTREAM"==a.data.type?(b={operation:WORKER_PARSE_F2D_FRAME,data:a.data.frames,url:f,f2dLoadOptions:n},a.data.metadata&&(b.metadata=a.data.metadata,b.manifest=a.data.manifest),a.data.finalFrame&&(b.finalFrame=!0),a.data.progress&&m.viewer3DImpl.signalProgress(100*
a.data.progress),l.postMessage(b,b.data?[b.data]:void 0),a.data.finalFrame&&k.terminate()):a.data&&"F2DAssetURL"==a.data.type?h.assets=h.assets.concat(a.data.urls):a.data&&a.data.debug?stderr(a.data.message):a.data&&a.data.error?(m.loading=!1,k.terminate(),d&&d.call(this,a.data.error.code,a.data.error.msg)):(stderr("F2D download failed."),m.loading=!1,k.terminate())},!1);l.addEventListener("message",function(a){if(a.data&&a.data.f2d){var b=m.svf=a.data.f2d;l.terminate();stderr("Num polylines: "+b.numPolylines);
stderr("Line segments: "+b.numLineSegs);stderr("Circular arcs: "+b.numCircles);stderr("Ellipitcal arcs:"+b.numEllipses);stderr("Plain triangles:"+b.numTriangles);stderr("Total # of op codes generated by fydo.parse: "+b.opCount);m.onSvfLoadDone(m.svf);c&&c(m.svf);m.viewer3DImpl.api.fireEvent({type:g.MODEL_ROOT_LOADED_EVENT,svf:m.svf});for(var f=0;f<b.meshes.length;f++)m.processReceivedMesh2D(b.meshes[f],f);b.meshes=null;m.onGeomLoadDone();m.loading=!1}else if(a.data&&a.data.f2dframe){var h=0;a.data.meshes?
(b=a.data.bbox,m.svf.bbox=new THREE.Box3(b.min,b.max)):m.svf=a.data.f2dframe;h=a.data.baseIndex;b=m.svf;b.fragments&&b.fragments.initialized?b.maxObjectNumber=a.data.maxObjectNumber:(m.onSvfLoadDone(b),c&&c(b),m.viewer3DImpl.api.fireEvent({type:g.MODEL_ROOT_LOADED_EVENT,svf:b}));if(a.data.meshes&&a.data.meshes.length){for(f=0;f<a.data.meshes.length;f++)m.processReceivedMesh2D(a.data.meshes[f],h+f);a.data.finalFrame&&(m.onGeomLoadDone(),m.loading=!1,l.terminate())}}else a.data&&a.data.progress||(a.data&&
a.data.debug?stderr(a.data.message):a.data&&a.data.error?(m.loading=!1,l.terminate(),stderr("Error while parsing F2d: "+JSON.stringify(a.data.error.args)),d&&d.call(this,a.data.error.code,a.data.error.msg)):(stderr("F2D download failed."),m.loading=!1,l.terminate()))},!1);k.postMessage({operation:WORKER_STREAM_F2D,url:f,headers:g.HTTP_REQUEST_HEADERS,objectIds:b,auth:auth,viewing_url:VIEWING_URL,queryParams:this.domainParam});return!0};h.SvfLoader.prototype.loadGeometryPackOnDemand=function(a){var b=
this;if(b.onDemandLoading){var c=b.svf.geompacks[a];if(!c.loading){var d,f=function(a){if(a.data&&a.data.mesh){if(b.processReceivedMesh(a.data),1<=a.data.progress){--b.pack_workers[a.data.workerId].queued;b.svf.geompacks[a.data.packId].loading=!1;var c=b.viewer3DImpl.modelQueue().geomPacksMissingLastFrame(),f=c.indexOf(a.data.packId);0<=f&&c.splice(f,1);c=!0;for(j=0;j<b.pack_workers.length;j++)if(0!=b.pack_workers[j].queued){c=!1;break}-1==b.loadedPacks.indexOf(a.data.packId)&&b.loadedPacks.push(a.data.packId);
if(c&&0==b.viewer3DImpl.modelQueue().geomPacksMissingLastFrame().length)if(b.loadedPacks.length==b.svf.geompacks.length)b.onGeomLoadDone();else b.onGeomPackFilesLoadDone()}}else if(a.data&&a.data.progress){--b.pack_workers[a.data.workerId].queued;b.loadedPacksCount++;a=null;c=b.viewer3DImpl.modelQueue().geomPacksMissingLastFrame();for(d=0;d<c.length&&(f=c[d],a=b.svf.geompacks[f],a.loading);++d);a&&!a.loading&&b.loadGeometryPackOnDemand(f);b.viewer3DImpl.signalProgress(100*b.loadedPacks.length/b.svf.geompacks.length)}else a.data&&
a.data.debug?stderr(a.data.message):a.data&&a.data.error?b.failedToLoadSomeGeometryPacks={code:a.data.error.code,msg:a.data.error.msg}:(b.pack_workers[a.data.workerId].queued-=2,b.svf.geompacks[a.data.packId].loading=!1)};if(!this.pack_workers)for(this.pack_workers=[],d=0;d<NUM_WORKER_THREADS;d++){var k=h.createWorkerWithTokenRefresh("Mesh Load");k.addEventListenerWithTokenRefresh(f);k.queued=0;this.pack_workers.push(k)}k=0;f=this.pack_workers[0].queued;for(d=1;d<NUM_WORKER_THREADS;d++)this.pack_workers[d].queued<
f&&(k=d,f=this.pack_workers[d].queued);if(2<f)b.viewer3DImpl.modelQueue().addGeomPackMissingLastFrame(a);else{var m=c.uri,f=this.pack_workers[k];f.queued+=2;stderr("Loading pack "+a);c.loading=!0;b.svf.partPacksLoadDone=!1;c=this.pathToURL(this.svf.basePath+m);a={operation:WORKER_LOAD_GEOMETRY,url:c,packId:parseInt(a),headers:g.HTTP_REQUEST_HEADERS,workerId:k,auth:auth,viewing_url:VIEWING_URL,queryParams:this.domainParam};f.postMessage(a)}}}};h.SvfLoader.prototype.loadGeometryPack=function(a,b){var c,
d,f,k,m=this;stderr("Loading pack "+a);c=function(a){if(a.data&&a.data.mesh){if(m.processReceivedMesh(a.data),1<=a.data.progress){--m.pack_workers[a.data.workerId].queued;a=!0;for(k=0;k<m.pack_workers.length;k++)if(0!=m.pack_workers[k].queued){a=!1;break}if(a){for(k=0;k<NUM_WORKER_THREADS;k++)m.pack_workers[k].terminate();m.pack_workers=null}m.svf.fragments.numLoaded==m.svf.fragments.length&&(m.svf.proteinMaterials&&PROTEIN_ROOT&&PRISM_ROOT||m.viewer3DImpl.matman().loadTextures(m.svf),m.onGeomLoadDone())}}else if(a.data&&
a.data.progress){--m.pack_workers[a.data.workerId].queued;if(m.next_pack<m.svf.geompacks.length){a=null;var b=m.viewer3DImpl.modelQueue().geomPacksMissingLastFrame();for(f=0;f<b.length&&(a=m.svf.geompacks[b[f]],a.loading);++f);if(!a||a.loading)for(;m.next_pack<m.svf.geompacks.length&&(a=m.svf.geompacks[m.next_pack++],a.loading););a&&!a.loading?(a.loading=!0,m.loadGeometryPack(a.id,a.uri)):(m.viewer3DImpl.modelQueue().enforceBvh=!1,m.svf.fragments.packIds=null)}m.viewer3DImpl.signalProgress(100*m.next_pack/
m.svf.geompacks.length)}else a.data&&a.data.debug?stderr(a.data.message):a.data&&a.data.error?m.failedToLoadSomeGeometryPacks={code:a.data.error.code,msg:a.data.error.msg}:m.pack_workers[a.data.workerId].queued-=2};if(!this.pack_workers)for(this.pack_workers=[],f=0;f<NUM_WORKER_THREADS;f++)d=h.createWorkerWithTokenRefresh("Mesh Load"),d.addEventListenerWithTokenRefresh(c),d.queued=0,this.pack_workers.push(d);d=0;c=this.pack_workers[0].queued;for(f=1;f<NUM_WORKER_THREADS;f++)this.pack_workers[f].queued<
c&&(d=f,c=this.pack_workers[f].queued);c=this.pack_workers[d];c.queued+=2;var l=this.pathToURL(this.svf.basePath+b);d={operation:WORKER_LOAD_GEOMETRY,url:l,packId:parseInt(a),headers:g.HTTP_REQUEST_HEADERS,workerId:d,auth:auth,viewing_url:VIEWING_URL,queryParams:this.domainParam};c.postMessage(d)};var k={},l={},n,q;h.SvfLoader.meshToGeometry=b;h.SvfLoader.prototype.processReceivedMesh=function(a){var d=a.packId+":"+a.meshIndex,f=this.svf,g=f.fragments,k=g.mesh2frag[d];if(void 0===k)stderr("Mesh "+
d+" was not referenced by any fragments.");else{var m=Array.isArray(k);if(this.cullGeometryOnLoading&&!this.isf2d){var l=!0;m||(k=[k]);for(var n=0;n<k.length;++n){if(k[n]<h.FRAGS_PERSISTENT_COUNT){l=!1;break}l=l&&this.viewer3DImpl.modelQueue().checkCull(k[n],!0,!0);if(!l)break}if(l){a.mesh=null;return}}b(a);n=Array.isArray(k)?k.length:1;l=m?k[0]:k;l=this.viewer3DImpl.modelQueue().getFragmentList().geomids[l];l=this.viewer3DImpl.addGeometry(a.geometry,n,l);this.cullGeometryOnLoading&&!this.isf2d&&
1<n&&null==this.viewer3DImpl.modelQueue().getFragmentList().geomidsmap[l]&&(this.viewer3DImpl.modelQueue().getFragmentList().geomidsmap[l]={n:n,t:0});a=(a.geometry.attributes.index.array||a.geometry.ib).length/3;if(m)for(n=0;n<k.length;n++){var p=0|k[n],m=g.materials[p].toString();g.polygonCounts&&(g.polygonCounts[p]=a);this.viewer3DImpl.addMeshInstance(l,p,m,c(this.tmpMatrix,g,p))}else n=c(this.tmpMatrix,g,0|k),m=g.materials[k].toString(),g.polygonCounts&&(g.polygonCounts[0|k]=a),this.viewer3DImpl.addMeshInstance(l,
0|k,m,n);this.onDemandLoading||(g.mesh2frag[d]=null);g.numLoaded+=k.length||1;d=g.numLoaded;f.geomPolyCount>f.nextRepaintPolys&&(f.numRepaints++,f.nextRepaintPolys+=1E4*Math.pow(1.5,f.numRepaints),this.viewer3DImpl.invalidate(!1,!0));this.isf2d&&0==d%20&&this.viewer3DImpl.invalidate(!1,!0)}};h.SvfLoader.prototype.processReceivedMesh2D=function(a,b){var c={mesh:a,is2d:!0,packId:"0",meshIndex:b},d="0:"+b,f=this.svf.fragments,g=Object.keys(c.mesh.dbIds).map(function(a){return parseInt(a)});f.fragId2dbId[b]=
g;for(var h=0;h<g.length;h++){var k=g[h],m=f.dbId2fragId[k];Array.isArray(m)?m.push(b):f.dbId2fragId[k]="undefined"!==typeof m?[m,b]:b}f.mesh2frag[d]=b;f.materials[b]=this.viewer3DImpl.matman().create2DMaterial(this.svf,a.material);f.length++;this.processReceivedMesh(c)};h.SvfLoader.prototype.onSvfLoadDone=function(a){this.isf2d&&(a.fragments={},a.fragments.mesh2frag={},a.fragments.materials=[],a.fragments.fragId2dbId=[],a.fragments.dbId2fragId=[],a.fragments.length=0,a.fragments.initialized=!0);
a.geomPolyCount=0;a.instancePolyCount=0;a.geomMemory=0;a.fragments.numLoaded=0;a.meshCount=0;a.gpuNumMeshes=0;a.gpuMeshMemory=0;a.nextRepaintPolys=1E4;a.numRepaints=0;a.basePath="";var b=this.currentLoadPath.lastIndexOf("/");-1!=b&&(a.basePath=this.currentLoadPath.substr(0,b+1));b=Date.now();this.loadTime+=b-this.t0;stderr("SVF load: "+(b-this.t0));this.isf2d||this.loadPropertyDb();this.viewer3DImpl.matman().convertMaterials(a);this.t0=b;a.bbox=(new THREE.Box3).copy(a.bbox);if(a.cameras)for(b=0;b<
a.cameras.length;b++){var c=a.cameras[b];c.position=(new THREE.Vector3).copy(c.position);c.target=(new THREE.Vector3).copy(c.target);c.up=(new THREE.Vector3).copy(c.up)}a.proteinMaterials&&PROTEIN_ROOT&&PRISM_ROOT&&this.viewer3DImpl.matman().loadTextures(a);stderr("scene bounds: "+JSON.stringify(a.bbox));this.viewer3DImpl.signalProgress(5,"Hold on, getting the model...");this.viewer3DImpl.invalidate(!1,!1)};h.SvfLoader.prototype.makeBVH=function(a){var b=performance.now();a.bvh=new BVHBuilder(a.fragments,
a.simplemats);a.bvh.build({isWeakDevice:isAndroidDevice()||isIOSDevice()});a=performance.now();stderr("BVH build time: "+(a-b))};h.SvfLoader.prototype.onGeomPackFilesLoadDone=function(){stderr("Part of geom pack files are load done.");this.svf.partPacksLoadDone=!0;this.viewer3DImpl.invalidate(!1,!0)};h.SvfLoader.prototype.onGeomLoadDone=function(){this.svf.loadDone=!0;this.onDemandLoading||(this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null);var a=Date.now(),b="Fragments load time: "+
(a-this.t0);this.loadTime+=a-this.t0;this.isf2d||this.svf.bvh||(this.makeBVH(this.svf),this.viewer3DImpl.setBVH(this.svf.bvh.nodes,this.svf.bvh.primitives));this.isf2d&&this.loadPropertyDb();stderr(b);this.logger&&(a={category:"model_load_stats",is_f2d:this.isf2d,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.viewer3DImpl.modelQueue().getGeometryList().geomMemory,meshes_count:this.viewer3DImpl.modelQueue().getGeometryList().geoms.length,urn:this.svfUrn},this.logger.log(a,
!0));h.assets&&window.webkit&&(window.webkit.messageHandlers.callbackHandler.postMessage({command:"assets",data:h.assets}),h.assets=null);this.currentLoadPath=null;this.isf2d=void 0;this.viewer3DImpl.onLoadComplete()};var m=1,p={};h.SvfLoader.prototype.loadPropertyDb=function(){var a=this;this.propWorker||(this.propWorker=h.createWorkerWithTokenRefresh("Property"),this.propWorker.addEventListenerWithTokenRefresh(f));var b=d(function(b){var c=b.instanceTree,d=b.instanceBoxes;c?(a.svf.instanceTree=
new InstanceTree(c,d,b.objectCount,b.maxTreeDepth),a.svf.fragToNodeDone=!0):b.objectCount&&(a.svf.hasObjectProperties=b.objectCount);a.viewer3DImpl.api.fireEvent({type:g.OBJECT_TREE_CREATED_EVENT,svf:a.svf})},function(b){a.svf.propertyDbError=b;a.viewer3DImpl.api.fireEvent({type:g.OBJECT_TREE_UNAVAILABLE_EVENT,svf:a.svf})}),c=this.pathToURL(this.svf.basePath);this.sharedDbPath&&!this.svf.propertydb.values.length&&(c=this.sharedDbPath,stderr("Using shared property db: "+c));this.propWorker.postMessage({operation:WORKER_GET_OBJECT_TREE,
url:c,propertydb:this.svf.propertydb,headers:g.HTTP_REQUEST_HEADERS,fragToDbId:this.svf.fragments.fragId2dbId,fragBoxes:this.svf.fragments.boxes,auth:auth,viewing_url:VIEWING_URL,cbId:b,queryParams:this.domainParam})};h.SvfLoader.prototype.asyncPropertyOperation=function(a,b,c){var f=this;if(f.svf.instanceTree||f.svf.hasObjectProperties){var h=d(b,c);a.cbId=h;this.propWorker.postMessage(a)}else if(f.svf.propertyDbError)c(f.svf.propertyDbError);else{var k=function(d){f.viewer3DImpl.api.removeEventListener(g.OBJECT_TREE_CREATED_EVENT,
k);f.viewer3DImpl.api.removeEventListener(g.OBJECT_TREE_UNAVAILABLE_EVENT,k);d.svf.instanceTree||d.svf.hasObjectProperties||d.svf.propertyDbError?f.asyncPropertyOperation(a,b,c):c({code:g.UNKNOWN_FAILURE,msg:"Failed to load properties."})};f.viewer3DImpl.api.addEventListener(g.OBJECT_TREE_CREATED_EVENT,k);f.viewer3DImpl.api.addEventListener(g.OBJECT_TREE_UNAVAILABLE_EVENT,k)}};h.SvfLoader.prototype.getProperties=function(a,b,c){this.asyncPropertyOperation({operation:WORKER_GET_PROPERTIES,dbId:a},
b,c)};h.SvfLoader.prototype.searchProperties=function(a,b,c,d){this.asyncPropertyOperation({operation:WORKER_SEARCH_PROPERTIES,searchText:a,attributeNames:b},c,d)};h.SvfLoader.prototype.getExternalIdMapping=function(a,b){this.asyncPropertyOperation({operation:WORKER_BUILD_EXTERNAL_ID_MAPPING},a,b)};h.SvfLoader.prototype.getObjectTree=function(a,b){var c=this;if(c.svf.instanceTree)a(c.svf.instanceTree);else if(c.svf.propertyDbError||"hasObjectProperties"in c.svf)b(c.svf.propertyDbError);else{var d=
function(){c.viewer3DImpl.api.removeEventListener(g.OBJECT_TREE_CREATED_EVENT,d);c.viewer3DImpl.api.removeEventListener(g.OBJECT_TREE_UNAVAILABLE_EVENT,d);c.getObjectTree(a,b)};c.viewer3DImpl.api.addEventListener(g.OBJECT_TREE_CREATED_EVENT,d);c.viewer3DImpl.api.addEventListener(g.OBJECT_TREE_UNAVAILABLE_EVENT,d)}}})();
var VBB_LINE_SEGMENT=16,VBB_ARC_CIRCULAR=32,VBB_ARC_ELLIPTICAL=48,VBB_TEX_QUAD=64,VBB_ONE_TRIANGLE=80,VBB_INSTANCED_FLAG=0,VBB_SEG_START_RIGHT=1,VBB_SEG_START_LEFT=2,VBB_SEG_END_RIGHT=3,VBB_SEG_END_LEFT=4,TAU=2*Math.PI,VBB_COLOR_OFFSET=6,VBB_DBID_OFFSET=7,VBB_FLAGS_OFFSET=8;
function VertexBufferBuilder(a,b){var c=b||65536;this.useInstancing=a;this.stride=12;this.vb=new ArrayBuffer(4*this.stride*(this.useInstancing?c/4:c));this.vbf=new Float32Array(this.vb);this.vbi=new Int32Array(this.vb);this.vcount=0;this.ib=this.useInstancing?null:new Uint16Array(c);this.icount=0;this.minx=this.miny=Infinity;this.maxx=this.maxy=-Infinity;this.dbIds={};this.numTriangleGeoms=this.numCirculars=this.numEllipticals=0}
VertexBufferBuilder.prototype.expandStride=function(){var a=this.stride;if(!(12<=a)){for(var b=this.stride+3,c=new ArrayBuffer(this.vb.byteLength/a*b),f=new Uint8Array(this.vb),d=new Uint8Array(c),g=0,h=this.vcount;g<h;g++)for(var k=g*a*4,l=g*b*4,n=0;n<4*a;n++)d[l+n]=f[k+n];this.vb=c;this.vbf=new Float32Array(c);this.vbi=new Int32Array(c);this.stride=b}};
VertexBufferBuilder.prototype.addToBounds=function(a,b){a<this.minx&&(this.minx=a);a>this.maxx&&(this.maxx=a);b<this.miny&&(this.miny=b);b>this.maxy&&(this.maxy=b)};VertexBufferBuilder.prototype.setVertexFlag=function(a,b,c,f){this.vbi[a*this.stride+VBB_FLAGS_OFFSET]=f|c|b<<16};
VertexBufferBuilder.prototype.addVertexTriangleGeom=function(a,b,c,f,d,g,h,k){for(var l=this.vcount,n=this.useInstancing?1:4,q=0;q<n;q++){var m=(l+q)*this.stride,p=this.vbf;p[m]=a;p[m+1]=b;p[m+2]=c;p[m+3]=f;p[m+4]=d;p[m+5]=g;this.vbi[m+VBB_COLOR_OFFSET]=h;this.vbi[m+VBB_DBID_OFFSET]=k;this.vcount++;this.dbIds[k]=1}return l};
VertexBufferBuilder.prototype.addVertexLine=function(a,b,c,f,d,g,h){for(var k=this.vcount,l=this.useInstancing?1:4,n=0;n<l;n++){var q=(k+n)*this.stride,m=this.vbf;m[q]=a;m[q+1]=b;m[q+2]=c;m[q+3]=f;m[q+4]=d;m[q+5]=0;this.vbi[q+VBB_COLOR_OFFSET]=g;this.vbi[q+VBB_DBID_OFFSET]=h;this.dbIds[h]=1;this.vcount++}return k};
VertexBufferBuilder.prototype.addVertexArc=function(a,b,c,f,d,g,h,k,l,n){for(var q=this.vcount,m=this.useInstancing?1:4,p=0;p<m;p++){var t=(q+p)*this.stride,r=this.vbf;r[t]=a;r[t+1]=b;r[t+2]=c;r[t+3]=f;r[t+4]=k;r[t+5]=d;this.vbi[t+VBB_COLOR_OFFSET]=l;this.vbi[t+VBB_DBID_OFFSET]=n;d!=g&&(r[t+9]=g,r[t+10]=h);this.dbIds[n]=1;this.vcount++}return q};
VertexBufferBuilder.prototype.addVertex=function(a,b,c,f,d,g,h,k){if(!this.useInstancing){var l=this.vcount,n=l*this.stride,q=this.vbf;q[n]=a;q[n+1]=b;q[n+2]=c;q[n+3]=f;q[n+4]=d;q[n+5]=0;this.vbi[n+VBB_COLOR_OFFSET]=g;this.vbi[n+VBB_DBID_OFFSET]=h;this.setVertexFlag(l,k,0,0);this.vcount++;this.dbIds[h]=1;return l}};VertexBufferBuilder.prototype.addVertexPolytriangle=function(a,b,c,f,d,g,h,k){this.useInstancing||(this.addVertex(a,b,c,f,d,g,h,k),this.addToBounds(a,b))};
VertexBufferBuilder.prototype.setVertexColor=function(a,b){this.useInstancing||(this.vbi[a*this.stride+VBB_COLOR_OFFSET]=b)};VertexBufferBuilder.prototype.addTriangle=function(a,b,c){if(!this.useInstancing){var f=this.ib,d=this.icount;if(d+3>=f.length){for(var g=new Uint16Array(2*f.length),h=0;h<d;h++)g[h]=f[h];this.ib=f=g}f[d]=a;f[d+1]=b;f[d+2]=c;this.icount+=3}};
VertexBufferBuilder.prototype.finalizeQuad=function(a,b,c){this.useInstancing?this.setVertexFlag(a,c,VBB_INSTANCED_FLAG,b):(this.addTriangle(a,a+1,a+2),this.addTriangle(a,a+2,a+3),this.setVertexFlag(a,c,VBB_SEG_START_RIGHT,b),this.setVertexFlag(a+1,c,VBB_SEG_END_RIGHT,b),this.setVertexFlag(a+2,c,VBB_SEG_END_LEFT,b),this.setVertexFlag(a+3,c,VBB_SEG_START_LEFT,b))};
VertexBufferBuilder.prototype.addSegment=function(a,b,c,f,d,g,h,k){var l=c-a,n=f-b,q=0;if(l||n)q=Math.atan2(n,l);l=Math.sqrt(l*l+n*n);d=this.addVertexLine(a,b,q,l,.5*d,g,h);this.finalizeQuad(d,VBB_LINE_SEGMENT,k);this.addToBounds(a,b);this.addToBounds(c,f)};
VertexBufferBuilder.prototype.addTriangleGeom=function(a,b,c,f,d,g,h,k,l){this.numTriangleGeoms++;h=this.addVertexTriangleGeom(a,b,c,f,d,g,h,k,l);this.finalizeQuad(h,VBB_ONE_TRIANGLE,l);this.addToBounds(a,b);this.addToBounds(c,f);this.addToBounds(d,g)};
VertexBufferBuilder.prototype.addCircularArc=function(a,b,c,f,d,g,h,k,l){this.numCirculars++;0==c&&0==f&&(f=TAU);var n=Math.abs(c-f);if(1E-4<n&&1E-4<Math.abs(n-TAU)){var n=a+d*Math.cos(c),q=b+d*Math.sin(c);this.addSegment(n,q,n,q,g,h,k,l);n=a+d*Math.cos(f);q=b+d*Math.sin(f);this.addSegment(n,q,n,q,g,h,k,l)}else this.addToBounds(a-d,b-d),this.addToBounds(a+d,b+d);a=this.addVertexArc(a,b,c,f,d,d,0,.5*g,h,k);this.finalizeQuad(a,VBB_ARC_CIRCULAR,l)};
VertexBufferBuilder.prototype.addEllipticalArc=function(a,b,c,f,d,g,h,k,l,n,q){this.expandStride();this.numEllipticals++;0==c&&0==f&&(f=TAU);var m=Math.abs(c-f);if(1E-4<Math.abs(m-TAU)){var m=a+d*Math.cos(c),p=b+g*Math.sin(c);this.addSegment(m,p,m,p,k,l,n,q);m=a+d*Math.cos(f);p=b+g*Math.sin(f);this.addSegment(m,p,m,p,k,l,n,q)}else this.addToBounds(a-d,b-g),this.addToBounds(a+d,b+g);a=this.addVertexArc(a,b,c,f,d,g,h,.5*k,l,n);this.finalizeQuad(a,VBB_ARC_ELLIPTICAL,q)};
VertexBufferBuilder.prototype.addTexturedQuad=function(a,b,c,f,d,g){var h=.5*f;d=this.addVertexLine(a,b+h,0,c,h,4278255615,d);this.finalizeQuad(d,VBB_TEX_QUAD,g);this.addToBounds(a,b);this.addToBounds(a+c,b+f)};VertexBufferBuilder.prototype.isFull=function(a){a||(a=3);return this.useInstancing?32767<4*this.vcount+a:32767<this.vcount+a};
VertexBufferBuilder.prototype.toMesh=function(){var a={};a.vb=new Float32Array(this.vb.slice(0,this.vcount*this.stride*4));a.vbstride=this.stride;var b=this.useInstancing?1:0;a.vblayout={fields1:{offset:0,itemSize:3,bytesPerItem:4,divisor:b},fields2:{offset:3,itemSize:3,bytesPerItem:4,divisor:b},color4b:{offset:VBB_COLOR_OFFSET,itemSize:4,bytesPerItem:1,divisor:b,normalize:!0},dbId4b:{offset:VBB_DBID_OFFSET,itemSize:4,bytesPerItem:1,divisor:b,normalize:!0},flags4b:{offset:VBB_FLAGS_OFFSET,itemSize:4,
bytesPerItem:1,divisor:b,normalize:!1}};9<this.stride&&(a.vblayout.extraParams={offset:9,itemSize:3,bytesPerItem:4,divisor:b,normalize:!1});if(this.useInstancing){for(var c in a.vblayout)a.vblayout[c].divisor=1;a.numInstances=this.vcount;b=new Int32Array(4);b[0]=VBB_SEG_START_RIGHT;b[1]=VBB_SEG_END_RIGHT;b[2]=VBB_SEG_END_LEFT;b[3]=VBB_SEG_START_LEFT;a.vblayout.instFlags4b={offset:0,itemSize:4,bytesPerItem:1,normalize:!1,divisor:0};a.vblayout.instFlags4b.array=b.buffer;b=a.indices=new Uint16Array(6);
b[0]=0;b[1]=1;b[2]=2;b[3]=0;b[4]=2;b[5]=3}else a.indices=new Uint16Array(this.ib.buffer.slice(0,2*this.icount));a.dbIds=this.dbIds;b=this.maxx-this.minx;c=this.maxy-this.miny;var f=Math.max(b,c);a.boundingBox={min:{x:this.minx,y:this.miny,z:.001*-f},max:{x:this.maxx,y:this.maxy,z:.001*f}};f=a.boundingSphere={};f.center={x:.5*(this.minx+this.maxx),y:.5*(this.miny+this.maxy),z:0};f.radius=.5*Math.sqrt(b*b+c*c);return a};
function init_three_triangulator(){Autodesk.Viewing.Private.Triangulator||(Autodesk.Viewing.Private.Triangulator=function(){function a(){this.bbox=new THREE.Box2;this.right=this.left=null;this.node_edges=[]}function b(a,b,c){this.pts=a;this.edges=b;this.bbox=c;this.pipResult=!1}function c(a,b){this.edges=a;this.bbox=b;this.pts=[];this.idmap={};this.xymap={};this.contours=[];this.scale=1E6/this.bbox.size().length()}function f(a){this.indices=[];this.cset=a;var c=this.pts=a.pts;this.intervalTree=new b(a.pts,
a.edges,a.bbox);this.intervalTree.build();for(var f=0;f<c.length;f++)c[f].id=f;var k=new lmv_poly2tri.SweepContext([]);k.points_=c.slice();if(a.contours)for(f=this.cset.contours,a=0;a<f.length;a++){for(var l=f[a],n=l[0]!==l[l.length-1],q=[],m=0;m<l.length-1;m++)q.push(c[l[m]]);k.initEdges(q,n)}else for(a=this.cset.edges,f=0;f<a.length;f++)l=a[f],l.p1!=l.p2&&k.initEdges([c[l.p1],c[l.p2]],!0);this.triangulate(k);this.processResult(k)}b.prototype.splitNode=function(b){if(!(b.bbox.min.y>=b.bbox.max.y||
3>b.node_edges.length)){var c=.5*(b.bbox.min.y+b.bbox.max.y);b.left=new a;b.right=new a;for(var f=this.pts,k=b.node_edges,l=[],n=new THREE.Vector2,q=0;q<k.length;q++){var m=this.edges[k[q]],p=f[m.p1].y,t=f[m.p2].y;if(p>t)var r=p,p=t,t=r;r=null;t<c?(b.left.node_edges.push(k[q]),r=b.left.bbox):p>c?(b.right.node_edges.push(k[q]),r=b.right.bbox):l.push(k[q]);r&&(n.set(f[m.p1].x,f[m.p1].y),r.expandByPoint(n),n.set(f[m.p2].x,f[m.p2].y),r.expandByPoint(n))}b.node_edges=l;b.left.node_edges.length&&this.splitNode(b.left);
b.right.node_edges.length&&this.splitNode(b.right)}};b.prototype.build=function(){this.root=new a;for(var b=this.root.node_edges,c=0;c<this.edges.length;c++)b.push(c);this.root.bbox.copy(this.bbox);this.splitNode(this.root)};b.prototype.pointInPolygonRec=function(a,b,c){if(a.bbox.min.y<=c&&a.bbox.max.y>=c)for(var f=this.pts,l=a.node_edges,n=0,q=l.length;n<q;n++){var m=this.edges[l[n]],p=f[m.p1],t=p.x,p=p.y,r=f[m.p2],m=r.x,r=r.y,B=r>=c;p>=c!=B&&(r-c)*(t-m)>=(m-b)*(p-r)==B&&(this.pipResult=!this.pipResult)}(f=
a.left)&&f.bbox.min.y<=c&&f.bbox.max.y>=c&&this.pointInPolygonRec(f,b,c);(a=a.right)&&a.bbox.min.y<=c&&a.bbox.max.y>=c&&this.pointInPolygonRec(a,b,c)};b.prototype.pointInPolygon=function(a,b){this.pipResult=!1;this.pointInPolygonRec(this.root,a,b);return this.pipResult};c.prototype.getPointIndex=function(a,b,c){var f=this.idmap[c];if(void 0!==f)return f;var l=0|a*this.scale,f=0|b*this.scale,n=this.xymap[l];void 0===n?(this.xymap[l]=n={},l=void 0):l=n[f];void 0===l&&(n[f]=l=this.pts.length,this.idmap[c]=
l,this.pts.push({x:a,y:b}));return l};c.prototype.snapEdges=function(){for(var a=0;a<this.edges.length;a++){var b=this.edges[a];b.p1=this.getPointIndex(b.pt1.x,b.pt1.y,b.eid1);b.p2=this.getPointIndex(b.pt2.x,b.pt2.y,b.eid2)}};c.prototype.stitchContours=function(){for(var a={},b=0;b<this.edges.length;b++){var c=this.edges[b];c.p1!==c.p2&&(void 0!==a[c.p1]?a[c.p1].push(c.p2):a[c.p1]=[c.p2],void 0!==a[c.p2]?a[c.p2].push(c.p1):a[c.p2]=[c.p1])}var c=[],f;for(f in a)if(2!==a[f].length){stderr("Incomplete edge table");
break}for(;;){var l=void 0;for(f in a)if(1<a[f].length){l=f;break}if(!l)for(f in a)if(0<a[f].length){l=f;break}if(!l)break;var b=-1,n=parseInt(l),l=a[l];for(c.push(n);l&&l.length;){var q=l.shift();q===b&&(q=l.shift());if(void 0===q){delete a[n];break}c.push(q);0==l.length?delete a[n]:l[0]===b&&delete a[n];b=n;n=q;l=a[q]}c.length&&(this.contours.push(c),c=[])}a=[];for(b=0;b<this.contours.length;b++)l=this.contours[b],l[0]!==l[l.length-1]&&a.push(l);if(a.length)for(a=!0;a;){a=!1;n={};c=this.contours;
for(b=0;b<c.length;b++)l=c[b],q=l[0],l=l[l.length-1],q!==l&&(n[q]?n[q].push(-b-1):n[q]=[-b-1],n[l]?n[l].push(b):n[l]=[b]);for(f in n)if(b=n[f],2==b.length){n=void 0;0>b[0]&&0>b[1]&&(n=-b[0]-1,l=-b[1]-1,c[l].shift(),Array.prototype.push.apply(c[n].reverse(),c[l]),n=l);0>b[0]&&0<b[1]&&(n=-b[0]-1,l=b[1],c[l].pop(),Array.prototype.push.apply(c[l],c[n]));0<b[0]&&0>b[1]&&(n=b[0],l=-b[1]-1,c[n].pop(),Array.prototype.push.apply(c[n],c[l]),n=l);0<b[0]&&0<b[1]&&(n=b[0],l=b[1],c[n].pop(),Array.prototype.push.apply(c[n],
c[l].reverse()),n=l);void 0!==n&&(c.splice(n,1),a=!0);break}}};f.prototype.triangulate=function(a){try{a.triangulate()}catch(b){}};f.prototype.processResult=function(a){for(var b=0;b<a.map_.length;b++){var c=a.map_[b],f=c.points_[0],l=c.points_[1],c=c.points_[2];void 0!==f.id&&void 0!==l.id&&void 0!==c.id&&this.filterFace(f.id,l.id,c.id)}};f.prototype.pointInEdgeList=function(a,b){for(var c,f,l,n,q,m,p=this.cset.pts,t=this.cset.edges,r=!1,B=0,z=t.length;B<z;++B)f=t[B],l=p[f.p1].x,n=p[f.p1].y,c=n>=
b,q=p[f.p2].x,m=p[f.p2].y,f=m>=b,c!=f&&(m-b)*(l-q)>=(q-a)*(n-m)==f&&(r=!r);return r};f.prototype.pointInContour=function(a,b,c){var f,l,n,q,m,p,t=!1,r=this.cset.pts;n=r[c[c.length-1]].x;q=r[c[c.length-1]].y;f=q>=b;for(var B=0,z=c.length;B<z;++B)m=r[c[B]].x,p=r[c[B]].y,l=p>=b,f!=l&&(p-b)*(n-m)>=(m-a)*(q-p)==l&&(t=!t),f=l,n=m,q=p;return t};f.prototype.pointInPolygon=function(a,b){for(var c=!1,f=0;f<this.cset.contours.length;f++)this.pointInContour(a,b,this.cset.contours[f])&&(c=!c);return c};f.prototype.filterFace=
function(a,b,c){var f=this.pts[a],l=this.pts[b],n=this.pts[c];this.intervalTree.pointInPolygon((f.x+l.x+n.x)/3,(f.y+l.y+n.y)/3)&&(0<(l.x-f.x)*(n.y-f.y)-(n.x-f.x)*(l.y-f.y)?this.indices.push(a,b,c):this.indices.push(a,c,b))};return{TriangulatedSurface:f,ContourSet:c,Edge:function(a,b,c,f,l,n,q){this.pt1=a;this.pt2=b;this.p2=this.p1=-1;this.eid1=q+":"+(c<f?c+":"+f:f+":"+c);this.eid2=q+":"+(l<n?l+":"+n:n+":"+l)}}}())}
function init_three_intersector(){Autodesk.Viewing.Private.Intersector||(Autodesk.Viewing.Private.Intersector=function(){function a(a,b,c,d,g){var h=f.subVectors(c,b),k=a.normal.dot(h);if(1E-10>Math.abs(k))return d.copy(b),g.copy(c),2;k=1/k;a=-(b.dot(a.normal)*k+a.constant*k);if(-1E-10>a||a>1+1E-10)return 0;b=h.multiplyScalar(a).add(b);d.copy(b);return 1}function b(b,f,h,k,m,l,n,q,E){var A=b.distanceToPoint(f),D=b.distanceToPoint(h),I=b.distanceToPoint(k);if(0>A&&0>D&&0>I||0<A&&0<D&&0<I)return null;
var A=Math.sign(A),D=Math.sign(D),I=Math.sign(I),G,H,K,J,M,L;if(A!==D){var P=a(b,f,h,d,g);if(2==P){q.push(new c(f.clone(),h.clone(),m,m,l,l,E));return}1==P?(K=m,J=l,G=d.clone()):console.warn("Unexpected zero intersections where at least one was expected")}if(D!==I){P=a(b,h,k,d,g);if(2==P){q.push(new c(h.clone(),k.clone(),l,l,n,n,E));return}1==P?G?(M=l,L=n,H=d.clone()):(K=l,J=n,G=d.clone()):console.warn("Unexpected zero intersections where at least one was expected")}if(I!==A){P=a(b,k,f,d,g);if(2==
P){q.push(new c(k.clone(),f.clone(),n,n,m,m,E));return}1==P?G?(M=n,L=m,H=d.clone()):console.warn("Unexpected single intersection point"):console.warn("Unexpected zero intersections where at least one was expected")}G&&H?q.push(new c(G,H,K,J,M,L,E)):console.warn("Unexpected one intersection where two were expected")}var c=Autodesk.Viewing.Private.Triangulator.Edge,f=new THREE.Vector3,d=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector3,n=new THREE.Vector3,
q=new THREE.Matrix4,m=new THREE.Plane;return{makePlaneBasis:function(a){var b=new THREE.Vector3(0,0,1),c=a.normal.clone().cross(b),c=c.normalize(),b=b.dot(a.normal),d=new THREE.Matrix4;if(!(1E-10>Math.abs(c.x)&&1E-10>Math.abs(c.y)&&1E-10>Math.abs(c.z))){var f=c,c=Math.sqrt(1-b*b),g=1-b,h=f.x,k=f.y,f=f.z,m=g*h,l=g*k;d.set(m*h+b,m*k-c*f,m*f+c*k,0,m*k+c*f,l*k+b,l*f-c*h,0,m*f-c*k,l*f+c*h,g*f*f+b,0,0,0,0,1)}d.elements[14]=a.constant;return d},convertToPlaneCoords:function(a,b,c){for(var d=0;d<b.length;d++){var f=
b[d];f.pt1.applyMatrix4(a);f.pt2.applyMatrix4(a);c.expandByPoint(f.pt1);c.expandByPoint(f.pt2)}},intersectTrianglePlane:b,intersectMeshPlane:function(a,c,d){var f=c.geometry,g=d.length,h=f.attributes,C=c.matrixWorld;q.getInverse(C);m.copy(a).applyMatrix4(q);var w,E,A;if(void 0!==h.index){a=h.index.array||f.ib;var h=f.vb?f.vb:h.position.array,D=f.vb?f.vbstride:3;(f=f.offsets)&&0!==f.length||(f=[{start:0,count:a.length,index:0}]);for(var I=0,G=f.length;I<G;++I){w=f[I].start;for(var H=f[I].index,K=w,
J=w+f[I].count;K<J;K+=3)w=H+a[K],E=H+a[K+1],A=H+a[K+2],k.x=h[w*D],k.y=h[w*D+1],k.z=h[w*D+2],l.x=h[E*D],l.y=h[E*D+1],l.z=h[E*D+2],n.x=h[A*D],n.y=h[A*D+1],n.z=h[A*D+2],b(m,k,l,n,w,E,A,d,c.fragId)}}else for(h=f.vb?f.vb:h.position.array,D=f.vb?f.vbstride:3,K=0,J=h.length;K<J;K+=3)w=K,E=K+1,A=K+2,k.x=h[w*D],k.y=h[w*D+1],k.z=h[w*D+2],l.x=h[E*D],l.y=h[E*D+1],l.z=h[E*D+2],n.x=h[A*D],n.y=h[A*D+1],n.z=h[A*D+2],b(m,k,l,n,w,E,A,d,c.fragId);for(K=g;K<d.length;K++)d[K].pt1.applyMatrix4(C),d[K].pt2.applyMatrix4(C)},
intersectBoxPlane:function(a,b){h.set(b.min.x,b.min.y,b.min.z);var c=a.distanceToPoint(h),c=Math.sign(c);h.set(b.min.x,b.min.y,b.max.z);var d=a.distanceToPoint(h);if(Math.sign(d)!==c)return!0;h.set(b.min.x,b.max.y,b.min.z);d=a.distanceToPoint(h);if(Math.sign(d)!==c)return!0;h.set(b.min.x,b.max.y,b.max.z);d=a.distanceToPoint(h);if(Math.sign(d)!==c)return!0;h.set(b.max.x,b.min.y,b.min.z);d=a.distanceToPoint(h);if(Math.sign(d)!==c)return!0;h.set(b.max.x,b.min.y,b.max.z);d=a.distanceToPoint(h);if(Math.sign(d)!==
c)return!0;h.set(b.max.x,b.max.y,b.min.z);d=a.distanceToPoint(h);if(Math.sign(d)!==c)return!0;h.set(b.max.x,b.max.y,b.max.z);d=a.distanceToPoint(h);return Math.sign(d)!==c?!0:!1}}}())}
function NodeArray(a,b){this.bytes_per_node=b?32:36;var c,f;a instanceof ArrayBuffer?(c=a.byteLength/this.bytes_per_node,f=a,this.nodeCount=c):(c=a|0,f=new ArrayBuffer(this.bytes_per_node*c),this.nodeCount=0);this.nodeCapacity=c;this.nodesRaw=f;this.is_lean_node=b;this.node_stride=this.bytes_per_node/4;this.node_stride_short=this.bytes_per_node/2;this.nodesF=new Float32Array(this.nodesRaw);this.nodesI=new Int32Array(this.nodesRaw);this.nodesS=new Uint16Array(this.nodesRaw)}
NodeArray.prototype.setLeftChild=function(a,b){this.nodesI[a*this.node_stride+6]=b};NodeArray.prototype.getLeftChild=function(a){return this.nodesI[a*this.node_stride+6]};NodeArray.prototype.setPrimStart=function(a,b){this.is_lean_node?this.nodesI[a*this.node_stride+6]=b:this.nodesI[a*this.node_stride+8]=b};NodeArray.prototype.getPrimStart=function(a){return this.is_lean_node?this.nodesI[a*this.node_stride+6]:this.nodesI[a*this.node_stride+8]};
NodeArray.prototype.setPrimCount=function(a,b){this.nodesS[a*this.node_stride_short+14]=b};NodeArray.prototype.getPrimCount=function(a){return this.nodesS[a*this.node_stride_short+14]};NodeArray.prototype.setFlags=function(a,b,c,f){this.nodesS[a*this.node_stride_short+15]=f<<3|c<<2|b&3};NodeArray.prototype.getFlags=function(a){return this.nodesS[a*this.node_stride_short+15]};
NodeArray.prototype.setBox0=function(a,b){var c=a*this.node_stride,f=this.nodesF;f[c]=b[0];f[c+1]=b[1];f[c+2]=b[2];f[c+3]=b[3];f[c+4]=b[4];f[c+5]=b[5]};NodeArray.prototype.getBoxThree=function(a,b){var c=a*this.node_stride,f=this.nodesF;b.min.x=f[c];b.min.y=f[c+1];b.min.z=f[c+2];b.max.x=f[c+3];b.max.y=f[c+4];b.max.z=f[c+5]};NodeArray.prototype.setBoxThree=function(a,b){var c=a*this.node_stride,f=this.nodesF;f[c]=b.min.x;f[c+1]=b.min.y;f[c+2]=b.min.z;f[c+3]=b.max.x;f[c+4]=b.max.y;f[c+5]=b.max.z};
NodeArray.prototype.makeEmpty=function(a){a*=this.node_stride;var b=this.nodesI;b[a+6]=-1;b[a+7]=0;this.is_lean_node||(b[a+8]=-1)};NodeArray.prototype.realloc=function(a){if(this.nodeCount+a>this.nodeCapacity){var b=0|3*this.nodeCapacity/2;b<this.nodeCount+a&&(b=this.nodeCount+a);a=new ArrayBuffer(b*this.bytes_per_node);var c=new Int32Array(a);c.set(this.nodesI);this.nodeCapacity=b;this.nodesRaw=a;this.nodesF=new Float32Array(a);this.nodesI=c;this.nodesS=new Uint16Array(a)}};
NodeArray.prototype.nextNodes=function(a){this.realloc(a);var b=this.nodeCount;this.nodeCount+=a;for(var c=0;c<a;c++)this.makeEmpty(b+c);return b};NodeArray.prototype.getRawData=function(){return this.nodesRaw.slice(0,this.nodeCount*this.bytes_per_node)};
var BOX_STRIDE=6,POINT_STRIDE=3,BOX_EPSILON=1E-5,BOX_SCALE_EPSILON=1E-5,MAX_DEPTH=15,MAX_BINS=16,BVHModule=function(){function a(a,b,c){a[0]>b[c]&&(a[0]=b[c]);a[3]<b[c]&&(a[3]=b[c]);a[1]>b[c+1]&&(a[1]=b[c+1]);a[4]<b[c+1]&&(a[4]=b[c+1]);a[2]>b[c+2]&&(a[2]=b[c+2]);a[5]<b[c+2]&&(a[5]=b[c+2])}function b(a,b,c){a[0]>b[c]&&(a[0]=b[c]);a[1]>b[c+1]&&(a[1]=b[c+1]);a[2]>b[c+2]&&(a[2]=b[c+2]);a[3]<b[c+3]&&(a[3]=b[c+3]);a[4]<b[c+4]&&(a[4]=b[c+4]);a[5]<b[c+5]&&(a[5]=b[c+5])}function c(a,b){a[0]>b[0]&&(a[0]=b[0]);
a[1]>b[1]&&(a[1]=b[1]);a[2]>b[2]&&(a[2]=b[2]);a[3]<b[3]&&(a[3]=b[3]);a[4]<b[4]&&(a[4]=b[4]);a[5]<b[5]&&(a[5]=b[5])}function f(a,b,c,d){for(var f=0;3>f;f++)a[b+f]=c[d+3+f]-c[d+f]}function d(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5]}function g(a){a[0]=Infinity;a[1]=Infinity;a[2]=Infinity;a[3]=-Infinity;a[4]=-Infinity;a[5]=-Infinity}function h(a){var b=a[3]-a[0],c=a[4]-a[1];a=a[5]-a[2];return 0>b||0>c||0>a?0:2*(b*c+c*a+a*b)}function k(){this.vb_left=new Float32Array(6);this.vb_right=
new Float32Array(6);this.cb_left=new Float32Array(6);this.cb_right=new Float32Array(6);this.num_left=0;this.num_bins=this.best_cost=this.best_split=-1}function l(){this.box_bbox=new Float32Array(6);this.box_centroid=new Float32Array(6);this.num_prims=0}function n(){this.BL=new Float32Array(6);this.CL=new Float32Array(6);this.AL=this.NL=0}k.prototype.reset=function(){this.num_left=0;this.num_bins=this.best_cost=this.best_split=-1};l.prototype.reset=function(){this.num_prims=0;g(this.box_bbox);g(this.box_centroid)};
n.prototype.reset=function(){this.AL=this.NL=0;g(this.BL);g(this.CL)};for(var q=[],m=0;m<MAX_BINS;m++)q.push(new l);for(var p=[],m=0;m<MAX_BINS-1;m++)p.push(new n);var t=new Float32Array(6),r=new Float32Array(6),B=new Float32Array(3);return{bvh_subdivide:function(m,l,n,w,E,A,D,I){f(B,0,A,0);var G=m.nodes,H=D?m.frags_per_leaf_node_transparent:m.frags_per_leaf_node,K=D?m.frags_per_inner_node_transparent:m.frags_per_inner_node,J=m.max_polys_per_node,M=0;B[1]>B[0]&&(M=1);B[2]>B[M]&&(M=2);G.setBox0(l,
E);var L=0;E=0;if(m.polygonCounts)for(var P=n;P<=w&&!(L+=m.polygonCounts[m.primitives[P]],E++,L>J);P++);P=w-n+1;if(P<=H&&L<J||1===P||I>MAX_DEPTH||B[M]<m.scene_epsilon)G.setLeftChild(l,-1),G.setPrimStart(l,n),G.setPrimCount(l,w-n+1),G.setFlags(l,0,0,D?1:0);else{if(K){K=n;M=m.primitives;H=m.centroids;J=w-K+1;J>m.frags_per_inner_node&&(J=m.frags_per_inner_node);J>E&&(J=E);G.setPrimStart(l,K);G.setPrimCount(l,J);K+=J;g(A);for(E=K;E<=w;E++)a(A,H,3*M[E]);f(B,0,A,0);M=0;B[1]>B[0]&&(M=1);B[2]>B[M]&&(M=2);
n+=G.getPrimCount(l)}E=new k;var S=n,K=M;if(B[K]<m.scene_epsilon)E.best_cost=Infinity;else{H=MAX_BINS;H>w-S+1&&(H=w-S+1);for(J=0;J<H;J++)q[J].reset();for(J=0;J<H-1;J++)p[J].reset();var J=E.num_bins=H,L=m.centroids,P=m.primitives,Y=m.boxes,U=J*(1-BOX_SCALE_EPSILON)/B[K];A=A[K];for(var Z=m.sort_prims;S<=w;S++){var da=P[S]|0,V=U*(L[3*da+K]-A)|0;0>V?V=0:V>=J&&(V=J-1);Z[S]=V;q[V].num_prims++;b(q[V].box_bbox,Y,6*da);a(q[V].box_centroid,L,3*da)}d(p[0].BL,q[0].box_bbox);d(p[0].CL,q[0].box_centroid);p[0].AL=
h(p[0].BL);p[0].NL=q[0].num_prims;for(J=1;J<H-1;J++)A=q[J],K=p[J],d(K.BL,p[J-1].BL),c(K.BL,A.box_bbox),K.AL=h(K.BL),d(K.CL,p[J-1].CL),c(K.CL,A.box_centroid),K.NL=p[J-1].NL+A.num_prims;J=H-1;d(t,q[J].box_bbox);d(r,q[J].box_centroid);P=h(t);H=q[J].num_prims;K=J;L=P*H+p[J-1].AL*p[J-1].NL;d(E.vb_right,t);d(E.cb_right,q[J].box_centroid);d(E.vb_left,p[J-1].BL);d(E.cb_left,p[J-1].CL);E.num_left=p[J-1].NL;for(--J;1<=J;J--)A=q[J],c(t,A.box_bbox),c(r,A.box_centroid),P=h(t),H+=A.num_prims,A=P*H+p[J-1].AL*p[J-
1].NL,A<=L&&(L=A,K=J,d(E.vb_right,t),d(E.cb_right,r),d(E.vb_left,p[J-1].BL),d(E.cb_left,p[J-1].CL),E.num_left=p[J-1].NL);E.best_split=K;E.best_cost=L}if(0>E.num_bins)G.setPrimCount(l,G.getPrimCount(l)+w-n+1);else{A=m.primitives;H=m.sort_prims;K=0;J=n|0;P=E.best_split|0;for(L=n;L<=w;L++)Y=A[L]|0,H[L]<P?A[J++]=Y:H[K++]=Y;for(L=0;L<K;L++)A[J+L]=H[L];A=G.nextNodes(2);G.setFlags(l,M,.5*(E.vb_left[3+M]+E.vb_left[M])<.5*(E.vb_right[3+M]+E.vb_right[M])?0:1,D?1:0);G.setLeftChild(l,A);m.recursion_stack.push([m,
A+1,n+E.num_left,w,E.vb_right,E.cb_right,D,I+1]);m.recursion_stack.push([m,A,n,n+E.num_left-1,E.vb_left,E.cb_left,D,I+1])}}},compute_boxes:function(c){var d=c.boxv_o,h=c.boxc_o,k=c.boxv_t,m=c.boxc_t;g(d);g(h);g(k);g(m);for(var l=c.centroids,n=c.boxes,p=0,q=c.prim_count;p<q;p++){var t=l,r=3*p,J=n,M=6*p;t[r]=.5*(J[M]+J[M+3]);t[r+1]=.5*(J[M+1]+J[M+4]);t[r+2]=.5*(J[M+2]+J[M+5]);p>=c.first_transparent?(a(m,l,3*p),b(k,n,6*p)):(a(h,l,3*p),b(d,n,6*p))}f(B,0,c.boxv_o,0);d=Math.max(B[0],B[1],B[2]);c.scene_epsilon=
BOX_EPSILON*d},box_area:function(a,b){var c=a[b+3]-a[b],d=a[b+4]-a[b+1],f=a[b+5]-a[b+2];return 0>c||0>d||0>f?0:2*(c*d+d*f+f*c)}}}();
function BVHBuilder(a,b){this.boxes=a.boxes;this.polygonCounts=a.polygonCounts;this.materials=a.materials;this.materialDefs=b;this.prim_count=a.length;this.frags_per_inner_node=this.frags_per_leaf_node=-1;this.nodes=null;this.work_buf=new ArrayBuffer(4*this.prim_count);this.sort_prims=new Int32Array(this.work_buf);this.primitives=new Int32Array(this.prim_count);this.centroids=new Float32Array(POINT_STRIDE*this.prim_count);this.boxv_o=new Float32Array(6);this.boxc_o=new Float32Array(6);this.boxv_t=
new Float32Array(6);this.boxc_t=new Float32Array(6);this.recursion_stack=[]}
BVHBuilder.prototype.sortPrimitives=function(){for(var a=new Float32Array(this.work_buf),b=this.materialDefs,c=this.materials,f=this.primitives,d=0,g=0,h=this.prim_count;g<h;g++){f[g]=g;var k=b[c[g]]?b[c[g]].transparent:!1;k&&d++;l?(a[g]=BVHModule.box_area(this.boxes,BOX_STRIDE*g),k&&(a[g]=-a[g])):a[g]=k?-1:1}var l=!1;if(d&&d<this.prim_count){b=new Int32Array(d);g=k=c=0;for(h=this.prim_count;g<h;g++)0<=a[g]?f[c++]=f[g]:b[k++]=f[g];f.set(b,this.prim_count-d)}this.first_transparent=this.prim_count-
d};
BVHBuilder.prototype.build=function(a){var b=a&&!!a.useSlimNodes;if(b)this.frags_per_leaf_node=1,this.frags_per_inner_node=0,this.frags_per_leaf_node_transparent=1,this.frags_per_inner_node_transparent=0,this.max_polys_per_node=Infinity;else{var c=a.isWeakDevice?.5:1;this.frags_per_leaf_node=0|32*c;this.frags_per_inner_node=0|this.frags_per_leaf_node;this.frags_per_leaf_node_transparent=this.frags_per_leaf_node;this.frags_per_inner_node_transparent=0;this.max_polys_per_node=0|1E4*c}if(this.nodes&&this.nodes.is_lean_node==
b)this.nodes.nodeCount=0;else{b=this.prim_count/this.frags_per_leaf_node;for(c=1;c<b;)c*=2;this.nodes=new NodeArray(c,a?a.useSlimNodes:!1)}this.sortPrimitives();BVHModule.compute_boxes(this);a=this.nodes.nextNodes(2);for(BVHModule.bvh_subdivide(this,a,0,this.first_transparent-1,this.boxv_o,this.boxc_o,!1,0);this.recursion_stack.length;)b=this.recursion_stack.pop(),BVHModule.bvh_subdivide(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7]);for(BVHModule.bvh_subdivide(this,a+1,this.first_transparent,this.prim_count-
1,this.boxv_t,this.boxc_t,!0,0);this.recursion_stack.length;)b=this.recursion_stack.pop(),BVHModule.bvh_subdivide(b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7])};AutodeskNamespace("Autodesk.Viewing.Private");
(function(){var a=Autodesk.Viewing.Private;a.VertexBufferReader=function(a){this.vb=a.vb.buffer;this.vbf=new Float32Array(this.vb);this.vbi=new Int32Array(this.vb);this.stride=a.vbstride;this.vcount=this.vbf.length/this.stride;this.useInstancing=!1};a.VertexBufferReader.prototype.getIdAt=function(a){return this.vbi[a*this.stride+7]};a.VertexBufferReader.prototype.getVertexFlagAt=function(a){return this.vbi[a*this.stride+8]};a.VertexBufferReader.prototype.decodeLineAt=function(a,c,f){var d=this.stride*
a;a=this.vbf[d];c=this.vbf[d+1];var g=this.vbf[d+2],h=this.vbf[d+3],d=a+h*Math.cos(g),g=c+h*Math.sin(g);if(f.onLineSegment)f.onLineSegment(a,c,d,g)};a.VertexBufferReader.prototype.decodeCircularArcAt=function(a,c,f){var d=this.stride*a;a=this.vbf[d];c=this.vbf[d+1];var g=this.vbf[d+2],h=this.vbf[d+3],d=this.vbf[d+5];if(f.onCircularArc)f.onCircularArc(a,c,g,h,d)};a.VertexBufferReader.prototype.decodeEllipticalArcAt=function(a,c,f){var d=this.stride*a;a=this.vbf[d];c=this.vbf[d+1];var g=this.vbf[d+
2],h=this.vbf[d+3],k=this.vbf[d+5],l=this.vbf[d+9],d=this.vbf[d+10];if(f.onEllipticalArc)f.onEllipticalArc(a,c,g,h,k,l,d)};a.VertexBufferReader.prototype.enumGeomsForObject=function(a,c){for(var f=0;f<this.vcount;){var d=this.getVertexFlagAt(f),g=d&240,h=d&15,d=d>>16&255;if(this.getIdAt(f)===a)switch(g){case 16:this.decodeLineAt(f,d,c);break;case 32:this.decodeCircularArcAt(f,d,c);break;case 48:this.decodeEllipticalArcAt(f,d,c)}f+=h&&g?4:1}}})();var OUTSIDE=0,INTERSECTS=1,CONTAINS=2;
function FrustumIntersector(){this.frustum=new THREE.Frustum;this.viewProj=new THREE.Matrix4;this.viewDir=[0,0,1];this.ar=1;this.viewport=new THREE.Vector3(1,1,1);this.areaCullThreshold=this.areaConv=1}
FrustumIntersector.prototype.reset=function(a){this.viewProj.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse);this.frustum.setFromMatrix(this.viewProj);var b=a.matrixWorldInverse.elements;this.ar=a.aspect;this.viewDir[0]=-b[2];this.viewDir[1]=-b[6];this.viewDir[2]=-b[10];this.areaConv=a.right*a.top};
FrustumIntersector.prototype.projectedArea=function(){var a,b;return function(c){a||(a=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],b=new THREE.Box2);var f=this.viewProj;a[0].set(c.min.x,c.min.y,c.min.z);a[1].set(c.min.x,c.min.y,c.max.z);a[2].set(c.min.x,c.max.y,c.min.z);a[3].set(c.min.x,c.max.y,c.max.z);a[4].set(c.max.x,c.min.y,c.min.z);a[5].set(c.max.x,c.min.y,c.max.z);a[6].set(c.max.x,c.max.y,c.min.z);
a[7].set(c.max.x,c.max.y,c.max.z);for(c=0;8>c;c++){var d=a[c],g=d.x,h=d.y,k=d.z,l=f.elements,n=l[3]*g+l[7]*h+l[11]*k+l[15];0>n&&(n=-n);n=1/n;d.x=(l[0]*g+l[4]*h+l[8]*k+l[12])*n;d.y=(l[1]*g+l[5]*h+l[9]*k+l[13])*n}b.makeEmpty();b.setFromPoints(a);-1>b.min.x&&(b.min.x=-1);1<b.min.x&&(b.min.x=1);-1>b.min.y&&(b.min.y=-1);1<b.min.y&&(b.min.y=1);1<b.max.x&&(b.max.x=1);-1>b.max.x&&(b.max.x=-1);1<b.max.y&&(b.max.y=1);-1>b.max.y&&(b.max.y=-1);return(b.max.x-b.min.x)*(b.max.y-b.min.y)}}();
FrustumIntersector.prototype.estimateDepth=function(a){var b=this.viewProj.elements,c=a.min.x,f=a.min.y,d=a.min.z,g=1/(b[3]*c+b[7]*f+b[11]*d+b[15]),h=(b[2]*c+b[6]*f+b[10]*d+b[14])*g,c=a.max.x,f=a.max.y,d=a.max.z,g=1/(b[3]*c+b[7]*f+b[11]*d+b[15]);return Math.min(h,(b[2]*c+b[6]*f+b[10]*d+b[14])*g)};
FrustumIntersector.prototype.intersectsBox=function(){var a,b;return function(c){a||(a=new THREE.Vector3,b=new THREE.Vector3);for(var f=this.frustum.planes,d=0,g=0;6>g;g++){var h=f[g];a.x=0<h.normal.x?c.min.x:c.max.x;b.x=0<h.normal.x?c.max.x:c.min.x;a.y=0<h.normal.y?c.min.y:c.max.y;b.y=0<h.normal.y?c.max.y:c.min.y;a.z=0<h.normal.z?c.min.z:c.max.z;b.z=0<h.normal.z?c.max.z:c.min.z;var k=h.distanceToPoint(a),h=h.distanceToPoint(b);if(0>k&&0>h)return OUTSIDE;0<k&&0<h&&d++}return 6==d?CONTAINS:INTERSECTS}}();
var VBIntersector=function(){function a(){f||(f=new THREE.Matrix4,d=new THREE.Ray,g=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3)}function b(b,c,q){a();var m=b.geometry,p=b.material,t=p?p.side:THREE.FrontSide,r=m.attributes;f.getInverse(b.matrixWorld);d.copy(c.ray).applyMatrix4(f);var B,z,F,C=c.precision;if(void 0!==r.index){var p=r.index.array||m.ib,r=m.vb?m.vb:r.position.array,w=m.vb?m.vbstride:3,E=m.offsets;E&&0!==E.length||(E=[{start:0,count:p.length,index:0}]);for(var A=0,D=E.length;A<
D;++A){B=E[A].start;for(var I=E[A].index,m=B,G=B+E[A].count;m<G;m+=3){B=I+p[m];z=I+p[m+1];F=I+p[m+2];g.fromArray(r,B*w);h.fromArray(r,z*w);k.fromArray(r,F*w);var H;H=t===THREE.BackSide?d.intersectTriangle(k,h,g,!0):d.intersectTriangle(g,h,k,t!==THREE.DoubleSide);if(null!==H){H.applyMatrix4(b.matrixWorld);var K=c.ray.origin.distanceTo(H);K<C||K<c.near||K>c.far||q.push({distance:K,point:H,face:new THREE.Face3(B,z,F,THREE.Triangle.normal(g,h,k)),faceIndex:null,fragId:b.fragId})}}}}else for(r=m.vb?m.vb:
r.position.array,w=m.vb?m.vbstride:3,m=0,G=r.length;m<G;m+=3)B=m,z=m+1,F=m+2,g.fromArray(r,B*w),h.fromArray(r,z*w),k.fromArray(r,F*w),H=p.side===THREE.BackSide?d.intersectTriangle(k,h,g,!0):d.intersectTriangle(g,h,k,p.side!==THREE.DoubleSide),null!==H&&(H.applyMatrix4(b.matrixWorld),K=c.ray.origin.distanceTo(H),K<C||K<c.near||K>c.far||q.push({distance:K,point:H,face:new THREE.Face3(B,z,F,THREE.Triangle.normal(g,h,k)),faceIndex:null,fragId:b.fragId}))}function c(b,c,g){a();var h=c.linePrecision,h=
h*h,k=b.geometry;f.getInverse(b.matrixWorld);d.copy(c.ray).applyMatrix4(f);var t=new THREE.Vector3,r=new THREE.Vector3,B=new THREE.Vector3,z=new THREE.Vector3,F=b.mode===THREE.LineStrip?1:2;if(k instanceof THREE.BufferGeometry){var C=k.attributes;if(void 0!==C.index){var w=k.ib?k.ib:C.index.array,C=k.vb?k.vb:C.position.array,E=k.vb?k.vbstride:3;(k=k.offsets)&&0!==k.length||(k=[{start:0,count:w.length,index:0}]);for(var A=0;A<k.length;A++)for(var D=k[A].start,I=k[A].count,G=k[A].index,H=D;H<D+I-1;H+=
F){var K=G+w[H+1];t.fromArray(C,(G+w[H])*E);r.fromArray(C,K*E);K=d.distanceSqToSegment(t,r,z,B);K>h||(K=d.origin.distanceTo(z),K<c.near||K>c.far||g.push({distance:K,point:B.clone().applyMatrix4(b.matrixWorld),face:null,faceIndex:null,fragId:b.fragId}))}}else for(C=k.vb?k.vb:C.position.array,E=k.vb?k.vbstride:3,H=0;H<C.length/E-1;H+=F)t.fromArray(C,E*H),r.fromArray(C,E*H+E),K=d.distanceSqToSegment(t,r,z,B),K>h||(K=d.origin.distanceTo(z),K<c.near||K>c.far||g.push({distance:K,point:B.clone().applyMatrix4(b.matrixWorld),
face:null,faceIndex:null,fragId:b.fragId}))}}var f,d,g,h,k;return{meshRayCast:b,lineRayCast:c,rayCast:function(a,d,f){a.isLine?c(a,d,f):b(a,d,f)}}}();
function GeometryList(a){this.geoms=[];this.instancePolyCount=this.geomPolyCount=this.gpuNumMeshes=this.gpuMeshMemory=this.geomMemory=this.numGeomsInMemory=0;this.is2d=a.is2d();this.svf=a.getData();a=this.svf.geomMetadata?this.svf.geomMetadata.primCounts.length:0;this.geomBoxes=new Float32Array(6*Math.max(1,a));this.svf.packFileTotalSize&&this.svf.packFileTotalSize-6*this.svf.primitiveCount<=Autodesk.Viewing.Private.GPU_MEMORY_LIMIT&&a<Autodesk.Viewing.Private.GPU_OBJECT_LIMIT&&(this.svf.disableStreaming=
!0)}GeometryList.prototype.getGeometry=function(a){return this.geoms[a]};
GeometryList.prototype.addGeometry=function(a,b,c){var f=Autodesk.Viewing.Private.GPU_MEMORY_LIMIT,d=2*f,g=Autodesk.Viewing.Private.GPU_OBJECT_LIMIT;this.isf2d&&(d*=2);this.disableStreaming||this.gpuMeshMemory<f&&this.geoms.length<g?(a.streamingDraw=!1,a.streamingIndex=!1):this.gpuMeshMemory>=d?(a.streamingDraw=!0,a.streamingIndex=!0):1E5>(this.is2d?100001:a.byteSize*(b||1))&&(a.streamingDraw=!0,a.streamingIndex=!0);a.streamingDraw||(this.gpuMeshMemory+=a.byteSize,this.gpuNumMeshes+=1);this.numGeomsInMemory++;
!c||0>c?(c=this.geoms.length,this.geoms.push(a),this.geomBoxes.length/6<this.geoms.length&&(f=new Float32Array(3*this.geoms.length/2*6),f.set(this.geomBoxes),this.geomBoxes=f),f=a.boundingBox,this.geomBoxes[6*c]=f.min.x,this.geomBoxes[6*c+1]=f.min.y,this.geomBoxes[6*c+2]=f.min.z,this.geomBoxes[6*c+3]=f.max.x,this.geomBoxes[6*c+4]=f.max.y,this.geomBoxes[6*c+5]=f.max.z,Autodesk.Viewing.Private.memoryOptimizedLoading&&!this.is2d&&(a.boundingBox=null,a.boundingSphere=null),this.geomMemory+=a.byteSize,
f=(a.attributes.index.array||a.ib).length/3,this.svf.geomPolyCount=this.geomPolyCount+=f,this.instancePolyCount+=f*(b||1)):this.geoms[c]=a;a.svfid=c;return a.svfid};GeometryList.prototype.removeGeometry=function(a){var b=this.getGeometry(a);if(!b)return 0;b=b.byteSize;this.geoms[a]=null;this.numGeomsInMemory--;return b};
GeometryList.prototype.getModelBox=function(a,b){if(this.geoms[a]){var c=6*a,f=this.geomBoxes;b.min.x=f[c];b.min.y=f[c+1];b.min.z=f[c+2];b.max.x=f[c+3];b.max.y=f[c+4];b.max.z=f[c+5]}else b.makeEmpty()};GeometryList.prototype.dispose=function(a){for(var b=0,c=this.geoms.length;b<c;b++)this.geoms[b]&&a.deallocateGeometry(this.geoms[b])};
GeometryList.prototype.printStats=function(){stderr("Total geometry size: "+this.geomMemory/1048576+" MB");stderr("Number of meshes: "+this.geoms.length);stderr("Num Meshes on GPU: "+this.gpuNumMeshes);stderr("Net GPU geom memory used: "+this.gpuMeshMemory)};var NODE_TYPE_ASSEMBLY=0,NODE_TYPE_INSERT=1,NODE_TYPE_LAYER=2,NODE_TYPE_COLLECTION=3,NODE_TYPE_COMPOSITE=4,NODE_TYPE_MODEL=5,NODE_TYPE_GEOMETRY=6,NODE_TYPE_BITS=7,NODE_FLAG_HIDE=2147483648;
function InstanceTree(a,b,c,f){this.root=a;this.rootId=a.dbId;this.maxDepth=f;this.boxes=b;this.objectCount=c;this.nodeflags=new Int32Array(c);this.numHidden=0;this.createDbIdToNodeMapping()}InstanceTree.prototype.createDbIdToNodeMapping=function(){if(this.root){var a=this.dbIdToNode=Array(this.objectCount),b=this.nodeflags;(function f(d){a[d.dbId]=d;var g=d.children,h=d.flags;void 0!==h?b[d.dbId]=h:d.flags=b[d.dbId]=g?NODE_TYPE_ASSEMBLY:NODE_TYPE_GEOMETRY;if(g)for(d=0;d<g.length;d++)f(g[d])})(this.root)}};
InstanceTree.prototype.setFlagNode=function(a,b,c){var f=this.nodeflags[a];if(!!(f&b)==c)return!1;this.nodeflags[a]=c?f|b:f&~b;return!0};InstanceTree.prototype.setFlagGlobal=function(a,b){var c=this.nodeflags,f=0,d=c.length;if(b)for(;f<d;f++)c[f]|=a;else for(var g=~a;f<d;f++)c[f]&=g};InstanceTree.prototype.setNodeHidden=function(a,b){var c=this.setFlagNode(a,NODE_FLAG_HIDE,b);c&&(b?this.numHidden++:this.numHidden--);return c};
InstanceTree.prototype.isNodeHidden=function(a){return!!(this.nodeflags[a]&NODE_FLAG_HIDE)};InstanceTree.prototype.getNodeType=function(a){return this.nodeflags[a]&NODE_TYPE_BITS};InstanceTree.prototype.getNodeParentId=function(a){return this.dbIdToNode[a].parent};InstanceTree.prototype.getRootId=function(){return this.rootId};InstanceTree.prototype.getNodeName=function(a){return this.dbIdToNode[a].name};
InstanceTree.prototype.getChildCount=function(a){return(a=this.dbIdToNode[a])&&a.children?a.children.length:0};InstanceTree.prototype.enumNodeFragments=function(a,b,c){function f(a){var h=d.dbIdToNode[a];if(void 0!==h){h=h.fragIds;if(void 0!==h){Array.isArray(h)||b(h);for(var k=0;k<h.length;++k)b(h[k])}c&&d.enumNodeChildren(a,function(a){f(a)})}}var d=this;f("number"==typeof a?a:a.dbId)};
InstanceTree.prototype.enumNodeChildren=function(a,b,c){function f(a){a=d.dbIdToNode[a];if(void 0!==a&&a.children)for(var h=0;h<a.children.length;h++){var k=a.children[h].dbId;b(k);c&&f(k)}}a="number"==typeof a?a:a.dbId;var d=this;c&&b(a);f(a)};var MESH_VISIBLE=1,MESH_HIGHLIGHTED=2,MESH_HIDE=4,MESH_ISLINE=8,MESH_MOVED=16,MESH_TRAVERSED=32,MESH_RENDERFLAG=128;
function FragmentList(a,b){this.fragments=a.getData().fragments;this.svf=a.getData();this.svfLoader=a.myLoader;var c=this.fragments.length;this.geoms=b;(this.isFixedSize=0<this.fragments.length)?(this.boxes=this.fragments.boxes,this.transforms=this.fragments.transforms,this.useThreeMesh=!Autodesk.Viewing.Private.memoryOptimizedLoading):(this.transforms=this.boxes=null,this.useThreeMesh=!0);0>=c&&(c=1);this.vizmeshes=Array(c);this.vizflags=new Uint8Array(c);this.geomids=new Int32Array(c);this.materialids=
new Int32Array(c);this.materialmap={};this.reachLimit=!1;this.traversedGeom=[];this.culledGeom=[];this.geomidsmap={};this.animxforms=null;for(var f=0;f<c;f++)this.vizflags[f]=1,this.geomids[f]=-1;this.allVisible=!0;this.allVisibleDirty=!1}FragmentList.prototype.requireGeometry=function(a){var b=null,c=this.geomids[a];0<=c&&(b=this.geoms.getGeometry(c));null!=b||this.reachLimit||this.svfLoader.loadGeometryPackOnDemand(this.fragments.packIds[a]);return b};
FragmentList.prototype.setMesh=function(a,b){var c=this.vizmeshes[a];c&&(stderr("duplicate fragment."),c.parent.remove(c));this.useThreeMesh?(this.vizmeshes[a]=b,b.fragId=a,b.dbId=this.fragments.fragId2dbId[a]|0):(this.geomids[a]=b.geometry.svfid,this.materialids[a]=b.material.id,this.materialmap[b.material.id]||(this.materialmap[b.material.id]=b.material));this.vizflags.length<=a&&(this.isFixedSize&&(console.warn("Attempting to resize a fragments list that was initialized with fixed data. This will have a performance impact."),
this.transforms=this.boxes=null,this.isFixedSize=!1),c=2*this.vizflags.length,c<this.vizmeshes.length&&(c=this.vizmeshes.length),c=new Uint8Array(c),c.set(this.vizflags),this.vizflags=c);this.vizflags[a]=1|(b.isLine?MESH_ISLINE:0)};FragmentList.prototype.isFlagSet=function(a,b){return!!(this.vizflags[a]&b)};FragmentList.prototype.setFlagFragment=function(a,b,c){var f=this.vizflags[a];if(!!(f&b)==c)return!1;this.vizflags[a]=c?f|b:f&~b;return!0};
FragmentList.prototype.setFlagGlobal=function(a,b){var c=this.vizflags,f=0,d=c.length;if(b)for(;f<d;f++)c[f]|=a;else for(var g=~a;f<d;f++)c[f]&=g};FragmentList.prototype.hideLines=function(a){var b=MESH_HIDE,c=this.vizflags,f=0,d=c.length;if(a)for(;f<d;f++)c[f]&MESH_ISLINE&&(c[f]|=b);else for(a=~b;f<d;f++)c[f]&MESH_ISLINE&&(c[f]&=a);this.allVisibleDirty=!0};FragmentList.prototype.isFragVisible=function(a){return 1==(this.vizflags[a]&3)};
FragmentList.prototype.isLine=function(a){return!!(this.vizflags[a]&MESH_ISLINE)};FragmentList.prototype.areAllVisible=function(){if(this.allVisibleDirty){for(var a=this.vizflags,b=!0,c=0,f=a.length;c<f;c++)if(0===(a[c]&1)){b=!1;break}this.allVisible=b;this.allVisibleDirty=!1}return this.allVisible};
FragmentList.prototype.getVizmesh=function(){var a;return function(b){if(this.useThreeMesh)return this.vizmeshes[b];a||(a=new THREE.Mesh(void 0,void 0,!0),a.isTemp=!0,a.dbId=0,a.fragId=-1);a.geometry=this.getGeometry(b);a.material=this.getMaterial(b);a.dbId=this.getDbIds(b);a.fragId=b;a.visible=!0;a.isLine=this.isLine(b);this.getWorldMatrix(b,a.matrixWorld);return a}}();FragmentList.prototype.getMaterialId=function(a){return this.useThreeMesh?this.vizmeshes[a].material.id:this.materialids[a]};
FragmentList.prototype.getMaterial=function(a){return this.useThreeMesh?this.vizmeshes[a].material:this.materialmap[this.materialids[a]]};FragmentList.prototype.getGeometry=function(a){return this.geoms.getGeometry(this.geomids[a])};FragmentList.prototype.setMaterial=function(a,b){this.useThreeMesh?this.vizmeshes[a].material=b:(this.materialids[a]=b.id,this.materialmap[b.id]=b)};FragmentList.prototype.getCount=function(){return this.vizflags.length};FragmentList.prototype.getDbIds=function(a){return this.fragments.fragId2dbId[a]};
FragmentList.prototype.dispose=function(a){var b={type:"dispose"};if(this.useThreeMesh){a={type:"removed"};for(var c=0;c<this.vizmeshes.length;c++){var f=this.vizmeshes[c];f&&(f.dispatchEvent(a),f.geometry.dispatchEvent(b))}}else this.geoms.dispose(a)};FragmentList.prototype.setVisibility=function(a,b){this.setFlagFragment(a,MESH_VISIBLE,b);this.allVisibleDirty=!0};FragmentList.prototype.setAllVisibility=function(a){this.setFlagGlobal(MESH_VISIBLE,a);this.allVisible=a;this.allVisibleDirty=!1};
FragmentList.prototype.updateAnimTransform=function(a,b,c,f){var d=this.animxforms;if(!d)for(var g=this.getCount(),d=this.animxforms=new Float32Array(10*g),h=0;h<g;h++){var k=10*h;d[k]=1;d[k+1]=1;d[k+2]=1;d[k+3]=0;d[k+4]=0;d[k+5]=0;d[k+6]=1;d[k+7]=0;d[k+8]=0;d[k+9]=0}k=10*a;g=!1;b&&(d[k]=b.x,d[k+1]=b.y,d[k+2]=b.z,g=!0);c&&(d[k+3]=c.x,d[k+4]=c.y,d[k+5]=c.z,d[k+6]=c.w,g=!0);f&&(d[k+7]=f.x,d[k+8]=f.y,d[k+9]=f.z,g=!0);this.setFlagFragment(a,MESH_MOVED,g);g||(d[k]=1,d[k+1]=1,d[k+2]=1,d[k+3]=0,d[k+4]=0,
d[k+5]=0,d[k+6]=1,d[k+7]=0,d[k+8]=0,d[k+9]=0)};FragmentList.prototype.getAnimTransform=function(a,b,c,f){if(!this.animxforms||!this.isFlagSet(a,MESH_MOVED))return!1;a*=10;var d=this.animxforms;b&&(b.x=d[a],b.y=d[a+1],b.z=d[a+2]);c&&(c.x=d[a+3],c.y=d[a+4],c.z=d[a+5],c.w=d[a+6]);f&&(f.x=d[a+7],f.y=d[a+8],f.z=d[a+9]);return!0};
FragmentList.prototype.getOriginalWorldMatrix=function(a,b){var c=12*a,f=b.elements,d=this.transforms;d?(f[0]=d[c],f[1]=d[c+1],f[2]=d[c+2],f[3]=0,f[4]=d[c+3],f[5]=d[c+4],f[6]=d[c+5],f[7]=0,f[8]=d[c+6],f[9]=d[c+7],f[10]=d[c+8],f[11]=0,f[12]=d[c+9],f[13]=d[c+10],f[14]=d[c+11],f[15]=1):b.identity()};
FragmentList.prototype.getWorldMatrix=function(){var a,b,c,f;return function(d,g){a||(a=new THREE.Matrix4,b=new THREE.Vector3,c=new THREE.Quaternion,f=new THREE.Vector3);this.getOriginalWorldMatrix(d,g);this.isFlagSet(d,MESH_MOVED)&&(this.getAnimTransform(d,f,c,b),a.compose(b,c,f),g.multiplyMatrices(a,g))}}();
FragmentList.prototype.getWorldBounds=function(){var a;return function(b,c){a||(a=new THREE.Matrix4);if(this.boxes&&!this.isFlagSet(b,MESH_MOVED)){var f=this.boxes,d=6*b;c.min.x=f[d];c.min.y=f[d+1];c.min.z=f[d+2];c.max.x=f[d+3];c.max.y=f[d+4];c.max.z=f[d+5]}else this.getWorldMatrix(b,a),this.useThreeMesh?(f=this.getVizmesh(b))&&f.geometry&&c.copy(f.geometry.boundingBox):this.geoms.getModelBox(this.geomids[b],c),c.empty()||c.applyMatrix4(a)}}();
function FragmentPointer(a,b){this.frags=a;this.fragId=b;this.position=this.quaternion=this.scale=null}FragmentPointer.prototype.getWorldMatrix=function(a){return this.frags.getWorldMatrix(this.fragId,a)};FragmentPointer.prototype.getWorldBounds=function(a){return this.frags.getWorldBounds(this.fragId,a)};
FragmentPointer.prototype.getAnimTransform=function(){this.scale||(this.scale=new THREE.Vector3(1,1,1),this.quaternion=new THREE.Quaternion(0,0,0,1),this.position=new THREE.Vector3(0,0,0));return this.frags.getAnimTransform(this.fragId,this.scale,this.quaternion,this.position)};
FragmentPointer.prototype.updateAnimTransform=function(){this.scale||(this.scale=new THREE.Vector3(1,1,1),this.quaternion=new THREE.Quaternion(0,0,0,1),this.position=new THREE.Vector3(0,0,0));return this.frags.updateAnimTransform(this.fragId,this.scale,this.quaternion,this.position)};FragmentPointer.prototype.getMaterial=function(){return this.frags.getMaterial(this.fragId)};FragmentPointer.prototype.setMaterial=function(a){return this.frags.setMaterial(this.fragId,a)};
function RenderBatch(a,b,c,f){this.frags=a;this.indices=b;this.start=c;this.count=f;this.lastItem=c;this.overrideMaterial=null;this.sortDone=!1;this.avgFrameTime=void 0;this.numAdded=0;this.boundingBox=new THREE.Box3;this.boundingBoxHidden=new THREE.Box3;this.sortDone=this.sortObjects=!1;this.indicesView=this.depths=null;this.frustumCulled=!0;this.forceVisible=!1;this.renderImmediate=!a.useThreeMesh;this.tmpBox=new THREE.Box3}
RenderBatch.prototype.getIndices=function(){return Array.isArray(this.indices)?this.indices[0]:this.indices};RenderBatch.prototype.sortByMaterial=function(){if(!(this.numAdded<this.count)){var a=this.frags,b=this.getIndices();b||stderr("Only indexed RenderSubsets can be sorted.");var c=b.subarray(this.start,this.start+this.count);Array.prototype.sort.call(c,function(c,d){var g=a.getMaterialId(b[c]),h=a.getMaterialId(b[d]);return void 0===g?h?1:0:void 0===h?-1:g-h});this.numAdded=0;this.sortDone=!0}};
RenderBatch.prototype.sortByDepth=function(){function a(a,b){c.getGeometry(a)?(c.getWorldBounds(a,g),h[b]=d.estimateDepth(g)):h[b]=-Infinity}function b(a,b){return h[b]-h[a]}var c,f,d,g,h;return function(k){c=this.frags;f=this.getIndices();d=k;g=this.tmpBox;f||stderr("Only indexed RenderSubsets can be sorted.");if(!this.indicesView||this.indicesView.length<this.count)this.indicesView=f.subarray(this.start,this.start+this.count);if(!this.depths||this.depths.length<this.count)this.depths=new Float32Array(this.count);
h=this.depths;this.forEachNoMesh(a);Array.prototype.sort.call(this.indicesView,b)}}();RenderBatch.prototype.onFragmentAdded=function(){return function(a){this.frags.getWorldBounds(a,this.tmpBox);this.boundingBox.union(this.tmpBox);this.numAdded++;this.sortDone=!1;this.lastItem<=a&&(this.lastItem=a+1)}}();
RenderBatch.prototype.forEach=function(a,b,c){for(var f=this.getIndices(),d=this.frags,g=d.svfLoader.pageOutGeometryEnabled,h=this.start,k=this.lastItem;h<k;h++){var l=f?f[h]:h,n=d.getVizmesh(l);if(!c&&b&&d.isFlagSet(l,b))if(n.geometry){if(b==MESH_RENDERFLAG&&d.setFlagFragment(l,MESH_TRAVERSED,!0),g&&l>Autodesk.Viewing.Private.FRAGS_PERSISTENT_COUNT){var q=d.geomids[l],m=!0,p=d.geomidsmap[q];null!=p&&(p.t++,m=p.n==p.t);m&&d.traversedGeom.push(q)}}else n.geometry=d.requireGeometry(l);!(c||n&&n.geometry)||
b&&!d.isFlagSet(l,b)||a(n,l)}};RenderBatch.prototype.forEachNoMesh=function(a,b,c){for(var f=this.getIndices(),d=this.frags,g=this.start,h=this.lastItem;g<h;g++){var k=f?f[g]:g,l;if(d.useThreeMesh){var n=d.getVizmesh(k);n&&(l=n.geometry)}else l=d.getGeometry(k);!c&&!l||b&&!d.isFlagSet(k,b)||a(k,g-this.start)}};
RenderBatch.prototype.raycast=function(){return function(a,b){if(!1!==a.ray.isIntersectionBox(this.boundingBox)){var c=this,f=this.tmpBox;this.forEach(function(d,g){c.frags.getWorldBounds(g,f);a.ray.isIntersectionBox(f)&&VBIntersector.rayCast(d,a,b)},MESH_VISIBLE)}}}();
RenderBatch.prototype.calculateBounds=function(){function a(a){d.getWorldBounds(a,g);b[a]&1?c.union(g):f.union(g)}var b,c,f,d,g;return function(){this.boundingBox.makeEmpty();this.boundingBoxHidden.makeEmpty();b=this.frags.vizflags;c=this.boundingBox;f=this.boundingBoxHidden;d=this.frags;g=this.tmpBox;this.forEachNoMesh(a)}}();
RenderBatch.prototype.applyVisibility=function(){function a(a,q){if(!a&&b.useThreeMesh||!Autodesk.Viewing.Private.onDemandLoading&&!a.geometry)g&&g(q);else{var m=!1;b.getWorldBounds(q,l);if(h&&!f.intersectsBox(l))m=!0;else{var p=f.projectedArea(l),p=p*f.areaConv;p<f.areaCullThreshold&&(m=!0)}if(m)a?a.visible=!1:stderr("Unexpected null mesh"),c[q]&=~MESH_RENDERFLAG,b.svfLoader.pageOutGeometryEnabled&&q>Autodesk.Viewing.Private.FRAGS_PERSISTENT_COUNT&&(m=b.geomids[q],b.geoms.getGeometry(m)&&(b.geomidsmap[m]||
b.culledGeom.push(m)));else{p=c[q]&127;switch(d){case RENDER_HIDDEN:m=!(p&MESH_VISIBLE);break;case RENDER_HIGHLIGHTED:m=p&MESH_HIGHLIGHTED;break;default:m=1==(p&(MESH_VISIBLE|MESH_HIGHLIGHTED|MESH_HIDE))}a&&(a.visible=!!m);c[q]=p|(m?MESH_RENDERFLAG:0);k=k&&!m}}}var b,c,f,d,g,h,k,l;return function(n,q,m){k=!0;f=q;d=n;g=m;n=f.intersectsBox(d===RENDER_HIDDEN?this.boundingBoxHidden:this.boundingBox);if(n===OUTSIDE)return k;c=this.frags.vizflags;b=this.frags;h=n!==CONTAINS;l=this.tmpBox;this.forEach(a,
null,g);return k}}();var MAX_FRAGS_PER_GROUP=333;
function RenderQueue(a){function b(a){ca.length<NUM_WORKER_THREADS&&(a=C.fragments.packIds[a],-1==ca.indexOf(a)&&ca.push(a))}function c(a){for(var b=K[a],c=M;c>J&&K[H[c-1]]>b;)H[c]=H[c-1],c--;H[c]=a;M++}function f(a){var b=D.getLeftChild(a);-1!==b&&(f(b),f(b+1));z.makeEmpty();-1!==b&&(D.getBoxThree(b,W),z.union(W),D.getBoxThree(b+1,W),z.union(W));D.getPrimCount(a)&&(z.union(G[a].boundingBox),z.union(G[a].boundingBoxHidden));D.setBoxThree(a,z)}var d=a.is2d(),g=Autodesk.Viewing.Private.PAGEOUT_NONE,
h=0,k=!1,l=!1,n=0,q=0,m=null,p=!0,t=0,r=new THREE.Box3,B=new THREE.Box3;this.visibleBoundsDirty=!1;for(var z=new THREE.Box3,F=new GeometryList(a),C=new FragmentList(a,F),w=a.getData().fragments,E=[new Int32Array(w.length)],A=0;A<w.length;A++)E[0][A]=A;var D=null,I=null,G=null,H=null,K=null,J,M,L=!1,P=!1,S=new FrustumIntersector,Y=new THREE.Raycaster,U=RENDER_NORMAL,Z=!1,da=0,A=MAX_FRAGS_PER_GROUP;a.is2d()&&(A/=6);if(isIOSDevice()||isAndroidDevice())A/=3;for(var A=A|0,V=0<A?A:MAX_FRAGS_PER_GROUP,w=
0|(w.length+V-1)/V,O=Array(w),A=0;A<w;A++)O[A]=new RenderBatch(C,E,A*V,V);if(a=a.getBoundingBox())r.copy(a),B.copy(a);var ca=[];this.checkCull=function(){var a=new THREE.Box3;return function(b,c,d){C.getWorldBounds(b,a);return c&&!S.intersectsBox(a)||d&&(b=S.projectedArea(a),b*=S.areaConv,b<S.areaCullThreshold)?!0:!1}}();this.pageOutStatus=function(){return g};this.needsRender=function(){return k};this.resetNeedsRender=function(){k=!1};this.addMeshInstance=function(a,b){C.setMesh(a,b);if(E[0].length<=
a){var c=2*E[0].length;c<=a&&(c=a+1);c=new Int32Array(c);c.set(E[0]);E[0]=c;this.visibleBoundsDirty=!0}E[0][a]=a;c=0|a/V;if(O){var d=O[c];d||(O[c]=d=new RenderBatch(C,E,c*V,V))}C.getWorldBounds(a,z);r.union(z);B.union(z);b.frustumCulled=!1;if(d)d.onFragmentAdded(a)};this.renderSome=function(a,c){var f=performance.now(),k,q=0===n;p&&q&&!Z&&(m=null,Z=!0);for(var M;M=L?this.nextBatchBVH():this.nextBatch();){d||(M.sortObjects&&!C.useThreeMesh?M.sortByDepth(S):M.sortDone||M.sortByMaterial());M.applyVisibility(U,
S,C.fragments.packIds?b:null)||a(M);n++;k=performance.now();var t=k-f,f=k;M.avgFrameTime=void 0===M.avgFrameTime?t:.9*M.avgFrameTime+.1*t;c-=M.avgFrameTime;k=!1;p&&q&&null!==m?M==m&&(k=!0):0>=c&&(k=!0);if(k)break}(f=C.svfLoader.pageOutGeometryEnabled)&&!q&&(g==avp.PAGEOUT_FAIL?C.traversedGeom.length>.5*Autodesk.Viewing.Private.GEOMS_PAGEOUT_COUNT&&(g=this.pageOutIfNeeded()):g=this.pageOutIfNeeded());M||(l=!0,f&&(g=this.pageOutIfNeeded(),g==Autodesk.Viewing.Private.PAGEOUT_FAIL&&0==h&&this.pageOutIfNeeded(!0)));
p&&q&&null==m&&(m=M);M&&q||(m=null,Z=!1);return c};this.enforceBvh=!1;this.reset=function(a,b,c){q=0;da++;l=!1;U=b;L=!1;n=0;this.resetNeedsRender();h=0;if(c){ca=[];g=Autodesk.Viewing.Private.PAGEOUT_NONE;C.traversedGeom=[];C.culledGeom=[];b=C.vizflags.length;for(c=0;c<b;++c)C.setFlagFragment(c,MESH_TRAVERSED,!1);for(var d in C.geomidsmap)C.geomidsmap.hasOwnProperty(d)&&(C.geomidsmap[d].t=0)}S.reset(a);H&&(this.enforceBvh||!O?L=!0:(d=B.size().length(),b=B.center(),a.position.distanceTo(b)<.5*d&&(L=
!0)));!0===L&&(M=J=0,H[M++]=0,P=!1,n=0)};this.nextBatch=function(){return q==O.length?null:O[q++]};this.nextBatchBVH=function(){P||J!==M||(H[M++]=1,P=!0);for(;J!==M;){var a=H[--M];D.getBoxThree(a,z);if(S.intersectsBox(z)!==OUTSIDE){var b=D.getLeftChild(a);if(-1!==b){var d=D.getFlags(a),f=0>S.viewDir[d&3]?1:0,g=d>>2&1,h=d>>3&1,k=d=0;P?(f^1^h&&(g=1-g),H[M++]=b+g,H[M++]=b+(1-g)):(f=b+g,b=b+1-g,D.getBoxThree(f,z),K[f]=d=S.projectedArea(z),D.getBoxThree(b,z),K[b]=k=S.projectedArea(z),0<d&&c(f),0<k&&c(b))}if(0!==
D.getPrimCount(a))return G[a]}P||J!==M||(H[M++]=1,P=!0)}return null};this.isDone=function(){return l};this.setHighlighted=function(a,b){var c=C.setFlagFragment(a,MESH_HIGHLIGHTED,b);c&&(b?t++:t--);return c};this.setVisibility=function(a,b){C.setVisibility(a,b);this.visibleBoundsDirty=!0};this.setAllVisibility=function(a){C.setAllVisibility(a);this.visibleBoundsDirty=!0};this.hideLines=function(a){C.hideLines(a)};this.hasHighlighted=function(){return!!t};this.isFragVisible=function(a){return C.isFragVisible(a)};
this.areAllVisible=function(){return C.areAllVisible()};var W=new THREE.Box3;this.getVisibleBounds=function(a){if(this.visibleBoundsDirty){r.makeEmpty();B.makeEmpty();if(D){for(var b=0;b<G.length;b++){var c=G[b];c&&(c.calculateBounds(),r.union(c.boundingBox),B.union(c.boundingBox),B.union(c.boundingBoxHidden))}f(0);f(1);if(O)for(b=0;b<O.length;b++)O[b].calculateBounds()}else for(b=0;b<O.length;b++)O[b].calculateBounds(),r.union(O[b].boundingBox),B.union(O[b].boundingBox),B.union(O[b].boundingBoxHidden);
this.visibleBoundsDirty=!1}return a?B:r};this.rayIntersect=function(a,b,c,d){this.visibleBoundsDirty&&this.getVisibleBounds();Y.set(a,b);a=[];if(d)for(b=0;b<d.length;b++){var f=C.getVizmesh(d[b]);VBIntersector.rayCast(f,Y,a)}else if(L)for(b=[1,0],d=new THREE.Vector3;b.length;){if(f=b.pop(),D.getBoxThree(f,z),null!==Y.ray.intersectBox(z,d)){var g=D.getLeftChild(f);-1!==g&&(b.push(g),b.push(g+1));0!==D.getPrimCount(f)&&G[f].raycast(Y,a)}}else for(b=0;b<O.length;b++)O[b].raycast(Y,a);if(!a.length)return null;
a.sort(function(a,b){return a.distance-b.distance});var f=d=null,h;for(b=0;b<a.length;b++)if(h=a[b].fragId,d=a[b].point,f=a[b].face,!F.is2d&&this.isFragVisible(h)&&(g=C.getMaterial(h),!c||!g.transparent)){var k=!1;if(g.cutplanes)for(var m=0;m<g.cutplanes.length;m++)k|=0>g.cutplanes[m].dot(new THREE.Vector4(d.x,d.y,d.z,1));if(k)f=d=null;else break}return[h,d,f]};this.getRenderProgress=function(){return L?n/G.length:q/O.length};this.getFragmentList=function(){return C};this.getGeometryList=function(){return F};
this.getSceneCount=function(){return L?G.length:O.length};this.cleanup=function(a){C.dispose(a)};this.setBVH=function(a,b){I=b;G=Array(a.nodeCount);D=a;H=new Int32Array(a.nodeCount+1);K=new Float32Array(a.nodeCount);for(var c=0;c<a.nodeCount;c++){var d=a.getPrimCount(c);d&&(G[c]=new RenderBatch(C,I,a.getPrimStart(c),d),G[c].lastItem=G[c].start+d,a.getFlags(c)&8&&(G[c].sortObjects=!0),a.getBoxThree(c,G[c].boundingBox))}p=!1;C.useThreeMesh||(O=null)};this.getGeomScenes=function(){return O||G};this.geomPacksMissingLastFrame=
function(){return ca};this.addGeomPackMissingLastFrame=function(a){-1==ca.indexOf(a)&&ca.push(a)};this.pageOutIfNeeded=function(a){var b=F.numGeomsInMemory;if(b>Autodesk.Viewing.Private.GEOMS_COUNT_LIMIT){var c=0,d=0,b=0,f,g,m=Autodesk.Viewing.Private.GEOMS_PAGEOUT_COUNT;f=C.culledGeom.length;f=f>m?m:f;for(b=0;b<f;b++)g=C.culledGeom[b],g=F.removeGeometry(g),0<g&&(c+=g,d++);C.culledGeom.splice(0,f);m-=f;if(0<m){f=C.traversedGeom.length;for(b=f>m?f-m:0;b<f;++b)g=C.traversedGeom[b],g=F.removeGeometry(g),
0<g&&(c+=g,d++);f=f>m?m:f;C.traversedGeom.splice(-f,f)}b=F.numGeomsInMemory;if(a&&b>Autodesk.Viewing.Private.GEOMS_COUNT_LIMIT){f=F.geoms.length;for(b=0;b<f&&!(g=F.removeGeometry(b),0<g&&(c+=g,d++),F.numGeomsInMemory<GEOMS_COUNT_LIMIT);++b);stderr("A force page out occur. ")}h+=d;stderr("Page out geometry count: "+d+" , size: "+c/1048576+"MB");if(F.numGeomsInMemory>Autodesk.Viewing.Private.GEOMS_COUNT_LIMIT)return C.reachLimit=!0,ca=[],k=!0,Autodesk.Viewing.Private.PAGEOUT_FAIL}C.reachLimit=!1;return Autodesk.Viewing.Private.PAGEOUT_SUCCESS}}
function RenderContext(){function a(){function a(b){b.material.blending=THREE.NoBlending;b.material.depthWrite=!1;b.material.depthTest=!1}var b=NormalsShader;c=new THREE.ShaderMaterial({fragmentShader:b.fragmentShader,vertexShader:b.vertexShader,uniforms:THREE.UniformsUtils.clone(b.uniforms)});c.blending=THREE.NoBlending;c.packedNormals=!0;l=new LmvShaderPass(SAOShader);a(l);k=new LmvShaderPass(SAOBlurShader);a(k);q=new LmvShaderPass(SAOMinifyFirstShader);a(q);n=new LmvShaderPass(SAOMinifyShader);
a(n);m=new LmvShaderPass(FXAAShader);a(m);p=new LmvShaderPass(CelShader);a(p);t=new LmvShaderPass(BlendShader);a(t);h=new LmvShaderPass(BackgroundShader);a(h);r=new LmvShaderPass(CopyShader);a(r)}var b,c,f,d,g,h,k,l,n,q,m,p,t,r,B=!1,z,F=null,C=null,w=null,E=null,A=null,D=null,I=0,G=0,H=1,K,J,M=!1,L=new Uint8Array(4),P=(new THREE.Color).setRGB(1,1,1),S=(new THREE.Color).setRGB(0,0,0),Y=null,U=!1,Z=!1,da=!1,V=!1,O=0,ca=0,W=[.42,0,1,1],N={antialias:!0,sao:!1,useHdrTarget:!1,haveTwoSided:!1,useSSAA:!1,
idbuffer:!0,customPresentPass:!1,toonShaded:!1},ea,ba,fa;this.settings=N;this.init=function(c,d,f){init_FireflyPhongShader();init_BackgroundShader();init_BlendShader();init_CelShader();init_CopyShader();init_FXAAShader();init_LineShader();init_NormalsShader();init_SAOBlurShader();init_SAOMinifyShader();init_SAOShader();c?(U=-1!=window.navigator.userAgent.indexOf("Firefox")&&-1!=window.navigator.userAgent.indexOf("Mac OS"),Z=isAndroidDevice()||isIOSDevice(),N.idbuffer=!Z,K=d,J=f,b=c,a(),this.initPostPipeline(N.sao,
N.antialias,!1)):console.error("You need a gl context to make a renderer. Things will go downhill from here.")};this.overlayUpdate=function(a){if(0===O||-1===O)return!1;a=t.uniforms.highlightIntensity.value;var b=.004*(performance.now()-ca),b=Math.min(b,1),c=3*W[1],d=3*(W[3]-W[1])-c,b=(((1-c-d)*b+d)*b+c)*b;return a!=b?(t.uniforms.highlightIntensity.value=b,!0):!1};this.beginScene=function(a,c,f,k){d=c;g=f;B=!1;if(C){k&&(Y?(b.setClearColor(Y,1),b.clearTarget(C,!0,!0,!1)):(b.clearTarget(C,!1,!0,!1),
h.render(b,C,null)));D&&(b.setClearColor(P,1),b.clearTarget(D,!0,!1,!1));if(N.sao||N.toonShaded)k&&(b.setClearColor(S,0),b.clearTarget(z,!0,!1,!1)),f=c.near,k=c.far,l.uniforms.cameraNear.value=f,l.uniforms.cameraFar.value=k,p.uniforms.cameraNear.value=f,p.uniforms.cameraFar.value=k,q.uniforms.cameraNear.value=f,q.uniforms.cameraInvNearFar.value=1/(f-k),f=c.projectionMatrix.elements,c.isPerspective?(l.uniforms.projInfo.value.set(-2/(C.width*f[0]),-2/(C.height*f[5]),(1-f[8])/f[0],(1+f[9])/f[5]),p.uniforms.projInfo.value.copy(l.uniforms.projInfo.value),
l.uniforms.isOrtho.value=0,p.uniforms.isOrtho.value=0):(l.uniforms.projInfo.value.set(-2/(C.width*f[0]),-2/(C.height*f[5]),(1-f[12])/f[0],(1-f[13])/f[5]),p.uniforms.projInfo.value.copy(l.uniforms.projInfo.value),l.uniforms.isOrtho.value=1,p.uniforms.isOrtho.value=1),l.uniforms.projScale.value=.125*C.height*f[5];this.renderScenePart(a,!0,!0,!1,!0)}else K||M||(console.error("Rendering to a canvas that was resized to zero. If you see this message you may be accidentally leaking a viewer instance."),
M=!0)};this.renderScenePart=function(a,h,k,m,l){B=!1;l=l?g:void 0;da&&V?N.idbuffer&&m&&(N.sao||N.toonShaded)?b.render(a,d,[C,z,D],!1,l):N.sao||N.toonShaded?b.render(a,d,[C,z],!1,l):N.idbuffer&&m?b.render(a,d,[C,D]):b.render(a,d,C,!1,l):(V?N.idbuffer&&m?b.render(a,d,[C,D],!1,l):b.render(a,d,C,!1,l):(h&&b.render(a,d,C,!1,l),N.idbuffer&&m&&f&&(h=a.overrideMaterial,a.overrideMaterial=f,b.render(a,d,D,!1,void 0),a.overrideMaterial=h)),(N.sao||N.toonShaded)&&k&&(h=a.overrideMaterial,a.overrideMaterial=
c,b.render(a,d,z,!1,void 0),a.overrideMaterial=h))};this.clearAllOverlays=function(){b.clearTarget(w,!0,!1,!1)};this.renderOverlays=function(a,c){var f=0,g;for(g in a)if(a.hasOwnProperty(g)){var h=a[g],k=h.scene,m=h.camera?h.camera:d;k.children.length&&(f||(f=1,b.setClearColor(S,0),b.clearTarget(w,!0,!1,!1)),h.materialPre&&(k.overrideMaterial=h.materialPre),b.render(k,m,w,!1,c),h.materialPost&&(k.overrideMaterial=h.materialPost,b.context.depthFunc(b.context.GREATER),b.render(k,m,w,!1,c),b.context.depthFunc(b.context.LEQUAL)),
k.overrideMaterial=null)}t.uniforms.useOverlay.value=f};this.computeSSAO=function(a){if(a||!N.sao||N.toonShaded)t.uniforms.useAO.value=0;else{if(!B){if(F){a=F[0];q.uniforms.resolution.value.set(1/a.width,1/a.height);q.render(b,a,z);for(var c=1;c<F.length;c++){var d=F[c];n.uniforms.resolution.value.set(1/d.width,1/d.height);n.render(b,d,a);a=d}}l.render(b,A,C);k.uniforms.axis.value.set(1,0);k.render(b,E,A);k.uniforms.axis.value.set(0,1);k.render(b,A,E);B=!0}t.uniforms.useAO.value=1}};this.presentBuffer=
function(a){!a&&!N.antialias||N.sao||t.uniforms.useOverlay.value||t.uniforms.objID.value?N.antialias?(t.render(b,E,C),a?(m.render(b,A,E),a.render(b,null,A)):N.toonShaded?(p.render(b,A,E),m.render(b,null,A)):m.render(b,null,E)):a?(t.render(b,E,C),a.render(b,null,E)):N.toonShaded?(t.render(b,E,C),p.render(b,A,E),r.render(b,null,A)):t.render(b,null,C):N.antialias?a?(m.render(b,E,C),a.render(b,null,E)):N.toonShaded?(p.render(b,E,C),m.render(b,null,E)):m.render(b,null,C):a.render(b,null,C)};this.composeFinalFrame=
function(a,b,c){N.sao&&!N.toonShaded&&this.computeSSAO(a);c||this.presentBuffer()};this.cleanup=function(){C&&(C.dispose(),C=null);z&&(z.dispose(),z=null);w&&(w.dispose(),w=null);E&&(E.dispose(),E=null);A&&(A.dispose(),A=null);if(F){for(var a=0;a<F.length;a++)F[a].dispose();F=[]}};this.setSize=function(a,c,d){K=a;J=c;var f=0|a*b.getPixelRatio(),g=0|c*b.getPixelRatio();N.logicalWidth=a;N.logicalHeight=c;N.deviceWidth=f;N.deviceHeight=g;if(0==a&&0==c)this.cleanup();else{b.setSize(a,c);stderr("width: "+
f+" height: "+g);a=1/f;c=1/g;if(N.useSSAA||N.toonShaded&&1>=b.getPixelRatio())f*=2,g*=2,d=!0;if(d||!C||C.width!=f||C.height!=g)stderr("Reallocating render targets."),this.cleanup(),C=new THREE.WebGLRenderTarget(f,g,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,type:N.useHdrTarget?THREE.FloatType:THREE.UnsignedByteType,stencilBuffer:!1,generateMipmaps:!1}),w=new THREE.WebGLRenderTarget(f,g,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,
stencilBuffer:!1,generateMipmaps:!1}),w.shareDepthFrom=C,A=E=z=null,F=[];if(N.antialias||N.sao||N.customPresentPass||N.toonShaded)if(d||!E||E.width!=f||E.height!=g)E=new THREE.WebGLRenderTarget(f,g,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1});if(N.sao||N.toonShaded){if(d||!z||z.width!=f||z.height!=g){var h=THREE.FloatType;isMobileDevice()&&(h=THREE.HalfFloatType);z=new THREE.WebGLRenderTarget(f,g,{minFilter:THREE.NearestFilter,
magFilter:THREE.NearestFilter,format:THREE.RGBFormat,type:h,stencilBuffer:!1});z.shareDepthFrom=C;F=[];for(h=0;5>h;h++){var n=new THREE.WebGLRenderTarget(0|f/(2<<h),0|g/(2<<h),{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,depthBuffer:!1,stencilBuffer:!1});n.generateMipmaps=!1;F.push(n);l.uniforms["tDepth_mip"+(h+1)].value=n}da=!U&&b.verifyMRTWorks([C,z]);A=E.clone()}!A&&N.antialias&&N.customPresentPass&&(A=E.clone());l.uniforms.size.value.set(f,g);l.uniforms.tDepth.value=
z;k.uniforms.size.value.set(f,g);k.uniforms.resolution.value.set(a,c);p.uniforms.tDepth.value=z}if(N.idbuffer){if(d||!D||D.width!=f||D.height!=g)D=new THREE.WebGLRenderTarget(f,g,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBFormat,type:THREE.UnsignedByteType,stencilBuffer:!1,generateMipmaps:!1}),D.shareDepthFrom=C,(V=!U&&b.verifyMRTWorks([C,D]))||console.warn("ID buffer requested, but MRT is not supported. Some features will not work.");p.uniforms.tID.value=D}else D&&
(D.dispose(),D=null);m.uniforms.resolution.value.set(a,c);p.uniforms.resolution.value.set(a,c);t.uniforms.tOverlay.value=w;t.uniforms.tAO.value=A;t.uniforms.useAO.value=N.sao?1:0;t.uniforms.resolution.value.set(a,c);t.uniforms.tID.value=D}};this.getMaxAnisotropy=function(){return b.getMaxAnisotropy()};this.hasMRT=function(){return!U&&b.supportsMRT()};this.applyMRTFlags=function(a){var b=a.mrtNormals,c=a.mrtIdBuffer;a.mrtNormals=this.hasMRT()&&da&&(N.sao||N.toonShaded);a.mrtIdBuffer=this.hasMRT()&&
V&&N.idbuffer;if(a.mrtNormals!==b||a.mrtIdBuffer!==c)a.needsUpdate=!0};this.initPostPipeline=function(a,b){N.sao=a&&!_isIE11;N.antialias=b&&!_isIE11;N.sao&&(N.toonShaded=!1);N.haveTwoSided&&(c.side=THREE.DoubleSide);c.needsUpdate=!0;l.material.needsUpdate=!0;k.material.needsUpdate=!0;q.material.needsUpdate=!0;n.material.needsUpdate=!0;m.material.needsUpdate=!0;p.material.needsUpdate=!0;t.material.needsUpdate=!0;h.material.needsUpdate=!0;r.material.needsUpdate=!0;this.setSize(K,J)};this.setClearColors=
function(a,b){Y=b?a.equals(b)||Z?new THREE.Color(.5*(a.x+b.x),.5*(a.y+b.y),.5*(a.z+b.z)):void 0:a.clone();Y||(h.uniforms.color1.value.copy(a),h.uniforms.color2.value.copy(b))};this.setAOOptions=function(a,b){void 0!==a&&(l.uniforms.radius.value=a);void 0!==b&&(l.uniforms.intensity.value=b);B=!1};this.getAORadius=function(){return l.uniforms.radius.value};this.getAOIntensity=function(){return l.uniforms.intensity.value};this.setTonemapExposureBias=function(a){I=a};this.getExposureBias=function(){return I};
this.setTonemapMethod=function(a){G=a;b.gammaInput=0===a?!1:!0};this.getToneMapMethod=function(){return G};this.toggleTwoSided=function(a){N.haveTwoSided!=a&&c&&(c.side=a?THREE.DoubleSide:THREE.FrontSide,c.needsUpdate=!0);N.haveTwoSided=a};this.toggleCelShading=function(a){N.sao=!a;N.toonShaded=a;N.idbuffer=a;this.initPostPipeline(N.sao,N.antialias)};this.enter2DMode=function(a){f=a;ea=N.sao;ba=N.antialias;fa=N.idbuffer;N.idbuffer=!0;t.material.defines.IS_2D="";this.initPostPipeline(!1,!1)};this.exit2DMode=
function(){f=null;N.idbuffer=fa;delete t.material.defines.IS_2D;this.initPostPipeline(ea,ba)};this.idAtPixel=function(a,c){if(!D)return 0;b.readRenderTargetPixels(D,.5*(a+1)*D.width,.5*(c+1)*D.height,1,1,L);var d=L[2]<<16|L[1]<<8|L[0];return d<<8>>8};this.rolloverObjectViewport=function(a,b){var c=this.idAtPixel(a,b);if(c==O)return!1;t.uniforms.highlightIntensity.value=0;ca=performance.now();O=c;0>=c&&(c=0,L[0]=L[1]=L[2]=L[3]=0);t.uniforms.objID.value=c;t.uniforms.objIDv3.value.set(L[0]/255,L[1]/
255,L[2]/255);return!0};this.setUnitScale=function(a){H=a};this.getUnitScale=function(){return H};this.getBlendPass=function(){return t};this.getColorTarget=function(){return C};this.getDepthMaterial=function(){return c}}
function init_FXAAShader(){"undefined"===typeof FXAAShader&&(FXAAShader={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nvarying vec2 vUv;\n#define FXAA_SPAN_MAX     8.0\n#define FXAA_EDGE_THRESHOLD_MIN (1.0/24.0)\n#define FXAA_EDGE_THRESHOLD (1.0/8.0)\n#define FXAA_SEARCH_THRESHOLD (1.0/4.0)\n#define FXAA_SEARCH_STEPS 16\n#define FXAA_SUBPIX_TRIM (1.0/8.0)\n#define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n#define FXAA_SUBPIX_CAP (7.0/8.0)\nvec4 getColor(sampler2D tex, vec2 uv) {\nvec4 c = texture2D(tex, uv);\nreturn c;\n}\nfloat FxaaLuma(vec3 rgb) {\nreturn rgb.y * (0.587/0.299) + rgb.x; }\nvec4 FxaaFilterReturn(vec4 rgba) {\nreturn rgba;}\nvec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\nreturn (vec3(-amountOfA) * b) +\n((a * vec3(amountOfA)) + b); }\nvec4 FxaaTex(sampler2D tex, vec2 pos) {\nreturn getColor(tex, pos.xy);}\nvec4 FxaaTexOff(sampler2D tex, vec2 pos, vec2 offset, vec2 resolution) {\nvec2 uv = pos.xy + offset * resolution;\nreturn getColor(tex, uv);}\nvoid main() {\nvec3 rgbN = FxaaTexOff( tDiffuse, vUv, vec2(0.0,-1.0), resolution ).xyz;\nvec3 rgbE = FxaaTexOff( tDiffuse, vUv, vec2(1.0, 0.0), resolution ).xyz;\nvec3 rgbW = FxaaTexOff( tDiffuse, vUv, vec2(-1.0,0.0), resolution ).xyz;\nvec3 rgbS = FxaaTexOff( tDiffuse, vUv, vec2(0.0, 1.0), resolution ).xyz;\nvec4 rgbaM = FxaaTex( tDiffuse, vUv);\nvec3 rgbM  = rgbaM.xyz;\nfloat lumaN = FxaaLuma(rgbN);\nfloat lumaE = FxaaLuma(rgbE);\nfloat lumaW = FxaaLuma(rgbW);\nfloat lumaS = FxaaLuma(rgbS);\nfloat lumaM = FxaaLuma(rgbM);\nfloat rangeMin = min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\nfloat rangeMax = max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\nfloat range = rangeMax - rangeMin;\nif(range < max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\ngl_FragColor = FxaaFilterReturn(rgbaM); return;}\nvec3 rgbL = rgbN + rgbW + rgbM + rgbE + rgbS;\nfloat lumaL = (lumaN + lumaW + lumaE + lumaS) * 0.25;\nfloat rangeL = abs(lumaL - lumaM);\nfloat blendL = max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\nblendL = min(FXAA_SUBPIX_CAP, blendL);\nvec3 rgbNW = FxaaTexOff( tDiffuse, vUv, vec2(-1.0,-1.0), resolution ).xyz;\nvec3 rgbNE = FxaaTexOff( tDiffuse, vUv, vec2(1.0,-1.0), resolution ).xyz;\nvec3 rgbSW = FxaaTexOff( tDiffuse, vUv, vec2(-1.0,1.0), resolution ).xyz;\nvec3 rgbSE = FxaaTexOff( tDiffuse, vUv, vec2(1.0,1.0), resolution ).xyz;\nfloat opacity  = rgbaM.w;\nrgbL += (rgbNW + rgbNE + rgbSW + rgbSE);\nrgbL *= vec3(1.0/9.0);\nfloat lumaNW = FxaaLuma( rgbNW);\nfloat lumaNE = FxaaLuma( rgbNE);\nfloat lumaSW = FxaaLuma( rgbSW);\nfloat lumaSE = FxaaLuma( rgbSE);\nfloat edgeVert = abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\nabs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\nabs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\nfloat edgeHorz = abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\nabs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\nabs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\nbool horzSpan = edgeHorz >= edgeVert;\nfloat lengthSign = horzSpan ? -resolution.y : -resolution.x;\nif(!horzSpan) lumaN = lumaW;\nif(!horzSpan) lumaS = lumaE;\nfloat gradientN = abs(lumaN - lumaM);\nfloat gradientS = abs(lumaS - lumaM);\nlumaN = (lumaN + lumaM) * 0.5;\nlumaS = (lumaS + lumaM) * 0.5;\nbool pairN = gradientN >= gradientS;\nif(!pairN) lumaN = lumaS;\nif(!pairN) gradientN = gradientS;\nif(!pairN) lengthSign *= -1.0;\nvec2 posN;\nposN.x = vUv.x + (horzSpan ? 0.0 : lengthSign * 0.5);\nposN.y = vUv.y + (horzSpan ? lengthSign * 0.5 : 0.0);\ngradientN *= FXAA_SEARCH_THRESHOLD;\nvec2 posP = posN;\nvec2 offNP = horzSpan ? vec2(resolution.x, 0.0) : vec2(0.0, resolution.y);\nfloat lumaEndN = lumaN;\nfloat lumaEndP = lumaN;\nbool doneN = false;\nbool doneP = false;\nposN += offNP * vec2(-1.0, -1.0);\nposP += offNP * vec2( 1.0,  1.0);\nfor(int i = 0; i < FXAA_SEARCH_STEPS; i++) {\nif(!doneN) lumaEndN = FxaaLuma(FxaaTex( tDiffuse, posN.xy).xyz);\nif(!doneP) lumaEndP = FxaaLuma(FxaaTex( tDiffuse, posP.xy).xyz);\ndoneN = doneN || (abs(lumaEndN - lumaN) >= gradientN);\ndoneP = doneP || (abs(lumaEndP - lumaN) >= gradientN);\nif(doneN && doneP) break;\nif(!doneN) posN -= offNP;\nif(!doneP) posP += offNP; }\nfloat dstN = horzSpan ? vUv.x - posN.x : vUv.y - posN.y;\nfloat dstP = horzSpan ? posP.x - vUv.x : posP.y - vUv.y;\nbool directionN = dstN < dstP;\nlumaEndN = directionN ? lumaEndN : lumaEndP;\nif(((lumaM - lumaN) < 0.0) == ((lumaEndN - lumaN) < 0.0))\nlengthSign = 0.0;\nfloat spanLength = (dstP + dstN);\ndstN = directionN ? dstN : dstP;\nfloat subPixelOffset = (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\nvec3 rgbF = FxaaTex(tDiffuse, vec2(\nvUv.x + (horzSpan ? 0.0 : subPixelOffset),\nvUv.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\ngl_FragColor = FxaaFilterReturn(vec4(FxaaLerp3(rgbL, rgbF, blendL), opacity));\n}"})}
var PackDepthShaderChunk="vec4 packDepth( const in float depth ) {\nvec4 enc = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;\nenc = fract(enc);\nenc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);\nreturn enc;\n}\nfloat unpackDepth( const in vec4 rgba_depth ) {\nreturn dot( rgba_depth, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/160581375.0) );\n}",TonemapShaderChunk="float luminance_post(vec3 rgb) {\nreturn dot(rgb, vec3(0.299, 0.587, 0.114));\n}\nfloat luminance_pre(vec3 rgb) {\nreturn dot(rgb, vec3(0.212671, 0.715160, 0.072169));\n}\nvec3 xyz2rgb(vec3 xyz) {\nvec3 R = vec3( 3.240479, -1.537150, -0.498535);\nvec3 G = vec3(-0.969256,  1.875992,  0.041556);\nvec3 B = vec3( 0.055648, -0.204043,  1.057311);\nvec3 rgb;\nrgb.b = dot(xyz, B);\nrgb.g = dot(xyz, G);\nrgb.r = dot(xyz, R);\nreturn rgb;\n}\nvec3 rgb2xyz(vec3 rgb) {\nvec3 X = vec3(0.412453, 0.35758, 0.180423);\nvec3 Y = vec3(0.212671, 0.71516, 0.0721688);\nvec3 Z = vec3(0.0193338, 0.119194, 0.950227);\nvec3 xyz;\nxyz.x = dot(rgb, X);\nxyz.y = dot(rgb, Y);\nxyz.z = dot(rgb, Z);\nreturn xyz;\n}\nvec3 xyz2xyY(vec3 xyz) {\nfloat sum = xyz.x + xyz.y + xyz.z;\nsum = 1.0 / sum;\nvec3 xyY;\nxyY.z = xyz.y;\nxyY.x = xyz.x * sum;\nxyY.y = xyz.y * sum;\nreturn xyY;\n}\nvec3 xyY2xyz(vec3 xyY) {\nfloat x = xyY.x;\nfloat y = xyY.y;\nfloat Y = xyY.z;\nvec3 xyz;\nxyz.y = Y;\nxyz.x = x * (Y / y);\nxyz.z = (1.0 - x - y) * (Y / y);\nreturn xyz;\n}\nconst float Shift = 1.0 / 0.18;\nfloat toneMapCanonFilmic_NoGamma(float x) {\nx *= Shift;\nconst float A = 0.2;\nconst float B = 0.34;\nconst float C = 0.002;\nconst float D = 1.68;\nconst float E = 0.0005;\nconst float F = 0.252;\nconst float scale = 1.0/0.833837;\nreturn (((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F) * scale;\n}\nvec3 toneMapCanonFilmic_WithGamma(vec3 x) {\nx *= Shift;\nconst float A = 0.27;\nconst float B = 0.29;\nconst float C = 0.052;\nconst float D = 0.2;\nconst float F = 0.18;\nconst float scale = 1.0/0.897105;\nreturn (((x*(A*x+C*B))/(x*(A*x+B)+D*F))) * scale;\n}",
OrderedDitheringShaderChunk="vec3 orderedDithering(vec3 col) {\nconst vec4 m0 = vec4( 1.0, 13.0,  4.0, 16.0);\nconst vec4 m1 = vec4( 9.0,  5.0, 12.0,  8.0);\nconst vec4 m2 = vec4( 3.0, 15.0,  2.0, 14.0);\nconst vec4 m3 = vec4(11.0,  7.0, 10.0,  6.0);\nint i = int(mod(float(gl_FragCoord.x), 4.0));\nint j = int(mod(float(gl_FragCoord.y), 4.0));\nvec4 biasRow;\nif      (i==0) biasRow = m0;\nelse if (i==1) biasRow = m1;\nelse if (i==2) biasRow = m2;\nelse           biasRow = m3;\nfloat bias;\nif      (j==0) bias = biasRow.x;\nelse if (j==1) bias = biasRow.y;\nelse if (j==2) bias = biasRow.z;\nelse           bias = biasRow.w;\nreturn col + bias / 17.0 / 256.0;\n}",
CutPlanesShaderChunk="#if NUM_CUTPLANES > 0\nuniform vec4 cutplanes[NUM_CUTPLANES];\n#ifdef CUTPLANES_LINE\nuniform vec3 cutplanesOutlineColor;\nuniform float cutplanesOutlineThickness;\n#endif\nbool checkCutPlanes() {\nbool isCut = false;\n#ifdef CUTPLANES_LINE\nbool isCutEdge = false;\nfloat eyeDist = length(vViewPosition);\n#endif\nfor (int i=0; i<NUM_CUTPLANES; i++) {\nfloat dotPlane = dot(vec4(vWorldPosition, 1.0), cutplanes[i]);\nisCut = isCut || (dotPlane > 0.0);\n#ifdef CUTPLANES_LINE\nisCutEdge = isCutEdge || (dotPlane > -cutplanesOutlineThickness*eyeDist);\n#endif\n}\nif (isCut) {\ndiscard;\nreturn true;\n}\n#ifdef CUTPLANES_LINE\nelse if (isCutEdge) {\ngl_FragColor = vec4(cutplanesOutlineColor, 1.0);\nreturn true;\n}\n#endif\nreturn false;\n}\n#endif",
PackNormalsShaderChunk="#define kPI 3.14159265358979\nvec2 encodeNormal (vec3 n)\n{\nreturn (vec2(atan(n.y,n.x)/kPI, n.z)+1.0)*0.5;\n}\nvec3 decodeNormal (vec2 enc)\n{\nvec2 ang = enc * 2.0 - 1.0;\nvec2 scth = vec2(sin(ang.x * kPI), cos(ang.x * kPI));\nvec2 scphi = vec2(sqrt(1.0 - ang.y * ang.y), ang.y);\nreturn vec3(scth.y * scphi.x, scth.x * scphi.x, scphi.y);\n}";
function init_CopyShader(){"undefined"===typeof CopyShader&&(CopyShader={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\nvUv = uv;\n}",fragmentShader:"uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\ngl_FragColor = texture2D(tDiffuse, vUv);\n}"})}
function init_CelShader(){"undefined"===typeof CelShader&&(CelShader={uniforms:{tDiffuse:{type:"t",value:null},tDepth:{type:"t",value:null},tID:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},projInfo:{type:"v4",value:new THREE.Vector4(0,0,0,0)},isOrtho:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:["#extension GL_OES_standard_derivatives : enable\nuniform sampler2D tDiffuse;\nuniform sampler2D tDepth;\nuniform sampler2D tID;\nuniform vec2 resolution;\nuniform float cameraNear;\nuniform float cameraFar;\nuniform float isOrtho;\nuniform vec4 projInfo;\nvarying vec2 vUv;\nvec4 recoverNZ(vec4 nrmz) {\nfloat z = sqrt(1.0 - dot(nrmz.xy, nrmz.xy));\nnrmz.w = -(nrmz.z +cameraNear) / (cameraFar - cameraNear);\nnrmz.z = z;\nreturn nrmz;\n}",TonemapShaderChunk,"vec4 quantize(vec4 c) {\nc *= c;\nfloat L = max(c.x, max(c.y, c.z));\nc.xyz *= floor(L * 8.0 + 0.5) / (8.0 * L);\nc.w = 1.0;\nreturn sqrt(c);\n}\nvec4 quantizeRGB(vec4 c) {\nc *= c;\nc.xyz *= floor(c.xyz * 8.0 + 0.5) / 8.0;\nc.w = 1.0;\nreturn sqrt(c);\n}\nvec3 reconstructCSPosition(vec2 S, float z) {\nreturn vec3((S.xy * projInfo.xy + projInfo.zw) * mix(z, -1.0, isOrtho), z);\n}\nvec3 reconstructCSFaceNormal(vec3 C) {\nreturn normalize(cross(dFdy(C), dFdx(C)));\n}\nvec3 getPosition(ivec2 ssP, float depth) {\nvec3 P;\nP = reconstructCSPosition(vec2(ssP) + vec2(0.5), depth);\nreturn P;\n}\nint isObjectEdge() {\nvec4 MM = texture2D(tID, vUv + vec2( 0.0,  0.0));\nvec4 LL = texture2D(tID, vUv + vec2(-1.0, -1.0) * resolution);\nif (MM != LL) return 1;\nvec4 LM = texture2D(tID, vUv + vec2( 0.0, -1.0) * resolution);\nif (MM != LM) return 1;\nvec4 LR = texture2D(tID, vUv + vec2( 1.0, -1.0) * resolution);\nif (MM != LR) return 1;\nvec4 ML = texture2D(tID, vUv + vec2(-1.0,  0.0) * resolution);\nif (MM != ML) return 1;\nvec4 MR = texture2D(tID, vUv + vec2( 1.0,  0.0) * resolution);\nif (MM != MR) return 1;\nvec4 UL = texture2D(tID, vUv + vec2(-1.0,  1.0) * resolution);\nif (MM != UL) return 1;\nvec4 UM = texture2D(tID, vUv + vec2( 0.0,  1.0) * resolution);\nif (MM != UM) return 1;\nvec4 UR = texture2D(tID, vUv + vec2( 1.0,  1.0) * resolution);\nif (MM != UR) return 1;\nreturn 0;\n}\nfloat normalDiff(vec3 n1, vec3 n2) {\nfloat d = dot(n1.xyz, n2.xyz);\nreturn acos(clamp(d, -1.0, 1.0));\n}\nconst float r = 1.0;\nvoid main() {\nvec4 color = texture2D(tDiffuse, vUv);\nivec2 ssC = ivec2(gl_FragCoord.xy);\nif (isObjectEdge() == 1) {\ngl_FragColor = vec4(0,0,0,1);\nreturn;\n}\nvec4 MM = texture2D(tDepth, vUv + vec2( 0.0,  0.0));\nif (MM.z == 0.0) {\ngl_FragColor = quantize(color);\nreturn;\n}\nvec4 LL = texture2D(tDepth, vUv + vec2(-r, -r) * resolution);\nvec4 LM = texture2D(tDepth, vUv + vec2( 0.0, -r) * resolution);\nvec4 LR = texture2D(tDepth, vUv + vec2( r, -r) * resolution);\nvec4 ML = texture2D(tDepth, vUv + vec2(-r,  0.0) * resolution);\nvec4 MR = texture2D(tDepth, vUv + vec2( r,  0.0) * resolution);\nvec4 UL = texture2D(tDepth, vUv + vec2(-r, r) * resolution);\nvec4 UM = texture2D(tDepth, vUv + vec2( 0.0,  r) * resolution);\nvec4 UR = texture2D(tDepth, vUv + vec2( r,  r) * resolution);\nvec3 C = getPosition(ssC + ivec2(-1, -1), LL.z);\nvec3 LLz = reconstructCSFaceNormal(C);\nC = getPosition(ssC + ivec2( 0, -1), LM.z);\nvec3 LMz = reconstructCSFaceNormal(C);\nC = getPosition(ssC + ivec2( 1, -1), LR.z);\nvec3 LRz = reconstructCSFaceNormal(C);\nC = getPosition(ssC + ivec2(-1, 0), ML.z);\nvec3 MLz = reconstructCSFaceNormal(C);\nC = getPosition(ssC + ivec2( 0, 0), MM.z);\nvec3 MMz = reconstructCSFaceNormal(C);\nC = getPosition(ssC + ivec2( 1, 0), MR.z);\nvec3 MRz = reconstructCSFaceNormal(C);\nC = getPosition(ssC + ivec2(-1, 1), UL.z);\nvec3 ULz = reconstructCSFaceNormal(C);\nC = getPosition(ssC + ivec2(0, 1), UM.z);\nvec3 UMz = reconstructCSFaceNormal(C);\nC = getPosition(ssC + ivec2(1, 1), UR.z);\nvec3 URz = reconstructCSFaceNormal(C);\nLL = recoverNZ(LL);\nLM = recoverNZ(LM);\nLR = recoverNZ(LR);\nML = recoverNZ(ML);\nMM = recoverNZ(MM);\nMR = recoverNZ(MR);\nUL = recoverNZ(UL);\nUM = recoverNZ(UM);\nUR = recoverNZ(UR);\nfloat pLL = normalDiff(LL.xyz, MM.xyz);\nfloat pLM = normalDiff(LM.xyz, MM.xyz);\nfloat pLR = normalDiff(LR.xyz, MM.xyz);\nfloat pML = normalDiff(ML.xyz, MM.xyz);\nfloat pMM = normalDiff(MM.xyz, MM.xyz);\nfloat pMR = normalDiff(MR.xyz, MM.xyz);\nfloat pUL = normalDiff(UL.xyz, MM.xyz);\nfloat pUM = normalDiff(UM.xyz, MM.xyz);\nfloat pUR = normalDiff(UR.xyz, MM.xyz);\nfloat pLLz = normalDiff(LLz.xyz, MMz.xyz);\nfloat pLMz = normalDiff(LMz.xyz, MMz.xyz);\nfloat pLRz = normalDiff(LRz.xyz, MMz.xyz);\nfloat pMLz = normalDiff(MLz.xyz, MMz.xyz);\nfloat pMMz = normalDiff(MMz.xyz, MMz.xyz);\nfloat pMRz = normalDiff(MRz.xyz, MMz.xyz);\nfloat pULz = normalDiff(ULz.xyz, MMz.xyz);\nfloat pUMz = normalDiff(UMz.xyz, MMz.xyz);\nfloat pURz = normalDiff(URz.xyz, MMz.xyz);\nfloat dGx = (dFdx(UL.w) + 2.0 * dFdx(UM.w) + dFdx(UR.w)) - (dFdx(LL.w) + 2.0 * dFdx(LM.w) + dFdx(LR.w)) + (dFdx(UR.w) + 2.0 * dFdx(MR.w) - dFdx(LR.w)) - (dFdx(UL.w) + 2.0 * dFdx(ML.w) - dFdx(LL.w));\nfloat dGy = (dFdy(UL.w) + 2.0 * dFdy(UM.w) + dFdy(UR.w)) - (dFdy(LL.w) + 2.0 * dFdy(LM.w) + dFdy(LR.w)) + (dFdy(UR.w) + 2.0 * dFdy(MR.w) - dFdy(LR.w)) - (dFdy(UL.w) + 2.0 * dFdy(ML.w) - dFdy(LL.w));\nfloat Gn = (abs(pUL - pMM) + 2.0 * abs(pUM - pMM) + abs(pUR - pMM) + 2.0 * abs(pML - pMM) + 2.0 * abs(pMR - pMM) + abs(pLL - pMM) + 2.0 * abs(pLM - pMM) + abs(pLR - pMM));\nfloat Gnz = (abs(pULz - pMMz) + 2.0 * abs(pUMz - pMMz) + abs(pURz - pMMz) + 2.0 * abs(pMLz - pMMz) + 2.0 * abs(pMRz - pMMz) + abs(pLLz - pMMz) + 2.0 * abs(pLMz - pMMz) + abs(pLRz - pMMz));\nfloat G = (abs(UL.w - MM.w) + 2.0 * abs(UM.w - MM.w) + abs(UR.w - MM.w) + 2.0 * abs(ML.w - MM.w) + 2.0 * abs(MR.w - MM.w) + abs(LL.w - MM.w) + 2.0 * abs(LM.w - MM.w) + abs(LR.w - MM.w));\nfloat dd = abs(dFdx(G)) + abs(dFdy(G));\nif (dd > 0.004 || abs(Gnz) > 2.2 || abs(Gn) > 2.0)\ngl_FragColor = vec4(0.0,0.0,0.0,1.0);\nelse\ngl_FragColor = /*vec4(1.0,1.0,1.0,1.0);*/quantize(color);\n}"].join("\n")})}
function init_BlendShader(){"undefined"===typeof BlendShader&&(BlendShader={uniforms:{tDiffuse:{type:"t",value:null},tAO:{type:"t",value:null},useAO:{type:"i",value:0},tOverlay:{type:"t",value:null},useOverlay:{type:"i",value:0},tID:{type:"t",value:null},objID:{type:"i",value:0},objIDv3:{type:"v3",value:new THREE.Vector3(0,0,0)},highlightIntensity:{type:"f",value:1},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)}},defines:{},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:["uniform sampler2D tDiffuse;\nuniform sampler2D tAO;\nuniform int useAO;\nuniform sampler2D tOverlay;\nuniform int useOverlay;\nuniform vec2 resolution;\nuniform int objID;\nuniform vec3 objIDv3;\nuniform sampler2D tID;\nuniform float highlightIntensity;\nvarying vec2 vUv;",TonemapShaderChunk,"vec4 overlayEdgeDetect(vec2 vUv) {\n#define IS_SELECTION(C) ( (C).b > (C).r && (C).b > (C).g )\n#define CHECK_EDGE_ALPHA(I, J)     { vec4 c = texture2D( tOverlay, vUv+resolution*vec2((I),(J)) ); maxAlpha = max(maxAlpha, c.a); if (c.a > 0.0 && IS_SELECTION(c)) { hasEdge++; selectionPixel = c; } }\n#define CHECK_EDGE_SELECTION(I, J) { vec4 c = texture2D( tOverlay, vUv+resolution*vec2((I),(J)) ); maxAlpha = max(maxAlpha, c.a); if (c.a <= 0.0) hasEdge++; }\nint hasEdge = 0;\nvec4 center = texture2D(tOverlay, vUv);\nvec4 selectionPixel = vec4(0.0);\nfloat maxAlpha = 0.0;\nbool paintOutline = false;\nif (center.a <= 0.0) {\nCHECK_EDGE_ALPHA(-1.0,-1.0);\nCHECK_EDGE_ALPHA( 0.0,-1.0);\nCHECK_EDGE_ALPHA( 1.0,-1.0);\nCHECK_EDGE_ALPHA(-1.0, 0.0);\nCHECK_EDGE_ALPHA( 1.0, 0.0);\nCHECK_EDGE_ALPHA(-1.0, 1.0);\nCHECK_EDGE_ALPHA( 0.0, 1.0);\nCHECK_EDGE_ALPHA( 1.0, 1.0);\nif (hasEdge != 0) {\ncenter = selectionPixel;\npaintOutline = true;\n}\n}\nelse if (center.a > 0.0 && IS_SELECTION(center)) {\nCHECK_EDGE_SELECTION(-1.0,-1.0);\nCHECK_EDGE_SELECTION( 0.0,-1.0);\nCHECK_EDGE_SELECTION( 1.0,-1.0);\nCHECK_EDGE_SELECTION(-1.0, 0.0);\nCHECK_EDGE_SELECTION( 1.0, 0.0);\nCHECK_EDGE_SELECTION(-1.0, 1.0);\nCHECK_EDGE_SELECTION( 0.0, 1.0);\nCHECK_EDGE_SELECTION( 1.0, 1.0);\nif (hasEdge != 0)\npaintOutline = true;\nelse\ncenter.a = -center.a;\n}\nif (paintOutline) {\nfloat maxComponent = max(center.r, max(center.g, center.b));\ncenter.rgb /= maxComponent;\ncenter.rgb = sqrt(center.rgb);\ncenter.a = 0.5 + 0.5 * maxAlpha * 0.125 * float(hasEdge);\n}\nreturn center;\n}\nvec4 sampleColor() {\nreturn texture2D( tDiffuse, vUv );\n}\nfloat sampleAO() {\nreturn (useAO != 0) ? texture2D(tAO, vUv).r : 1.0;\n}\nvoid main() {\nvec4 texel = sampleColor();\ntexel.rgb *= sampleAO();\nif (useOverlay != 0) {\nvec4 overlay = overlayEdgeDetect(vUv);\nif (overlay.a < 0.0) {\noverlay.a = -overlay.a;\nif (overlay.a >= 0.99) {\noverlay.a = 0.75;\ntexel.rgb = vec3(luminance_post(texel.rgb));\n}\n}\ntexel.rgb = mix(texel.rgb, sqrt(overlay.rgb)/*sqrt=gamma*/, overlay.a);\n}\nif (objID != 0) {\nvec4 idAtPixel = texture2D(tID, vUv);\nvec3 idDelta = abs(idAtPixel.rgb - objIDv3.rgb);\nif (max(max(idDelta.r, idDelta.g), idDelta.b) < 1e-3) {\n#ifdef IS_2D\ntexel.rgb = mix(texel.rgb, vec3(1.0,1.0,0.0), highlightIntensity * 0.25);\n#else\ntexel.rgb += highlightIntensity * 0.2;\n#endif\n}\n}\ngl_FragColor = texel;\n}"].join("\n")})}
LmvShaderPass=function(a,b){this.textureID=void 0!==b?b:"tDiffuse";this.uniforms=THREE.UniformsUtils.clone(a.uniforms);this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,defines:THREE.UniformsUtils.clone(a.defines)});this.renderToScreen=!1;this.enabled=!0;this.clear=!1;this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);var c=new THREE.BufferGeometry,f=new Float32Array(9);f[0]=-1;f[1]=-1;f[2]=0;f[3]=3;f[4]=-1;f[5]=0;f[6]=
-1;f[7]=3;f[8]=0;var d=new Float32Array(6);d[0]=0;d[1]=0;d[2]=2;d[3]=0;d[4]=0;d[5]=2;c.addAttribute("position",new THREE.BufferAttribute(f,3));c.addAttribute("uv",new THREE.BufferAttribute(d,2));this.quad=new THREE.Mesh(c,this.material);this.scene=new THREE.Scene;this.scene.add(this.quad)};
LmvShaderPass.prototype={render:function(a,b,c,f){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=c);this.renderToScreen||!b?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)}};
function init_SAOShader(){"undefined"===typeof SAOShader&&(SAOShader={uniforms:{tDepth:{type:"t",value:null},size:{type:"v2",value:new THREE.Vector2(512,512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},radius:{type:"f",value:10},bias:{type:"f",value:.01},projScale:{type:"f",value:500},projInfo:{type:"v4",value:new THREE.Vector4(0,0,0,0)},intensity:{type:"f",value:.5},isOrtho:{type:"f",value:1},tDepth_mip1:{type:"t",value:null},tDepth_mip2:{type:"t",value:null},tDepth_mip3:{type:"t",
value:null},tDepth_mip4:{type:"t",value:null},tDepth_mip5:{type:"t",value:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:["#define USE_MIPMAP 1\nuniform float cameraNear;\nuniform float cameraFar;\nuniform vec2 size;\nuniform float lumInfluence;\nvarying vec2 vUv;\n#define NUM_SAMPLES (17)\n#define LOG_MAX_OFFSET (3)\n#define MAX_MIP_LEVEL (5)\n#define NUM_SPIRAL_TURNS (7)\nuniform float           projScale;\nuniform sampler2D tDepth;\n#ifdef USE_MIPMAP\nuniform sampler2D tDepth_mip1;\nuniform sampler2D tDepth_mip2;\nuniform sampler2D tDepth_mip3;\nuniform sampler2D tDepth_mip4;\nuniform sampler2D tDepth_mip5;\n#endif\nuniform float radius;\nuniform float bias;\nuniform float intensity;\nuniform float isOrtho;\nfloat intensityDivR6 = intensity / pow(radius, 6.0);\nvec2 tapLocation(int sampleNumber, float spinAngle, out float ssR){\nfloat alpha = float(float(sampleNumber) + 0.5) * (1.0 / float(NUM_SAMPLES));\nfloat angle = alpha * (float(NUM_SPIRAL_TURNS) * 6.28) + spinAngle;\nssR = alpha;\nreturn vec2(cos(angle), sin(angle));\n}\nfloat CSZToKey(float z) {\nreturn clamp(z * (1.0 / -cameraFar), 0.0, 1.0);\n}\nvoid packKey(float key, out vec2 p) {\nfloat temp = floor(key * 256.0);\np.x = temp * (1.0 / 256.0);\np.y = key * 256.0 - temp;\n}",
PackDepthShaderChunk,"float unpackDepthNearFar( const in vec4 rgba_depth ) {\nfloat depth = unpackDepth( rgba_depth );\nif (depth == 0.0)\nreturn -cameraFar * 1.0e10;\nreturn depth * (cameraNear - cameraFar) - cameraNear;\n}\nuniform vec4 projInfo;\nvec3 reconstructCSPosition(vec2 S, float z) {\nreturn vec3((S.xy * projInfo.xy + projInfo.zw) * mix(z, -1.0, isOrtho), z);\n}\nvec3 reconstructCSFaceNormal(vec3 C) {\nreturn normalize(cross(dFdy(C), dFdx(C)));\n}\nvec3 reconstructNonUnitCSFaceNormal(vec3 C) {\nreturn cross(dFdy(C), dFdx(C));\n}\nvec2 sizeM1 = vec2(1.0/(size.x), 1.0/(size.y));\nvec3 getPosition(ivec2 ssP, float depth) {\nvec3 P;\nP = reconstructCSPosition(vec2(ssP) + vec2(0.5), depth);\nreturn P;\n}\nvec3 getOffsetPosition(ivec2 ssC, vec2 unitOffset, float ssR) {\nivec2 ssP = ivec2(ssR * unitOffset) + ssC;\nvec3 P;\nvec2 screenUV = (vec2(ssP) + vec2(0.5)) * sizeM1;\n#ifdef USE_MIPMAP\nint mipLevel = int(max(0.0, min(floor(log2(ssR)) - float(LOG_MAX_OFFSET), float(MAX_MIP_LEVEL))));\nif (mipLevel == 0) {\nP.z = texture2D(tDepth, screenUV).z;\nif (P.z == 0.0) P.z = -cameraFar * 1.0e10;\n}\nelse if (mipLevel == 1)\nP.z = unpackDepthNearFar(texture2D(tDepth_mip1, screenUV));\nelse if (mipLevel == 2)\nP.z = unpackDepthNearFar(texture2D(tDepth_mip2, screenUV));\nelse if (mipLevel == 3)\nP.z = unpackDepthNearFar(texture2D(tDepth_mip3, screenUV));\nelse if (mipLevel == 4)\nP.z = unpackDepthNearFar(texture2D(tDepth_mip4, screenUV));\nelse if (mipLevel == 5)\nP.z = unpackDepthNearFar(texture2D(tDepth_mip5, screenUV));\n#else\nP.z = texture2D(tDepth, screenUV).z;\nif (P.z == 0.0) P.z = -cameraFar * 1.0e10;\n#endif\nP = reconstructCSPosition(vec2(ssP) + vec2(0.5), P.z);\nreturn P;\n}\nfloat radius2 = radius * radius;\nfloat invRadius2 = 1.0 / radius2;\nfloat sampleAO(in ivec2 ssC, in vec3 C, in vec3 n_C, in float ssDiskRadius, in int tapIndex, in float randomPatternRotationAngle) {\nfloat ssR;\nvec2 unitOffset = tapLocation(tapIndex, randomPatternRotationAngle, ssR);\nssR *= ssDiskRadius;\nvec3 Q = getOffsetPosition(ssC, unitOffset, ssR);\nvec3 v = Q - C;\nfloat vv = dot(v, v);\nfloat vn = dot(v, n_C);\nconst float epsilon = 0.01;\nfloat f = max(radius2 - vv, 0.0); return f * f * f * max((vn - bias) / (epsilon + vv), 0.0);\n}\nconst bool useNoise = true;\nvec2 rand( const vec2 coord ) {\nvec2 noise;\nif ( useNoise ) {\nfloat nx = dot ( coord, vec2( 12.9898, 78.233 ) );\nfloat ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );\nnoise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );\n} else {\nfloat ff = fract( 1.0 - coord.s * ( size.x / 2.0 ) );\nfloat gg = fract( coord.t * ( size.y / 2.0 ) );\nnoise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;\n}\nreturn ( noise * 2.0  - 1.0 );\n}\nfloat getRandomAngle(vec2 pos) {\nvec2 rnd = rand(pos);\nreturn atan(rnd.y, rnd.x);\n}\nvoid main() {\nivec2 ssC = ivec2(gl_FragCoord.xy);\nvec4 nrmz = texture2D(tDepth, vUv);\nif (nrmz.z == 0.0) {\ngl_FragColor.r = 1.0;\ngl_FragColor.a = 0.0;\npackKey(1.0, gl_FragColor.gb);\nreturn;\n}\nvec3 C = getPosition(ssC, nrmz.z);\npackKey(CSZToKey(C.z), gl_FragColor.gb);\nfloat randomPatternRotationAngle = getRandomAngle(vUv);\nvec3 n_C = vec3(nrmz.x, nrmz.y, sqrt(1.0 - dot(nrmz.xy, nrmz.xy)));\nfloat ssDiskRadius = -projScale * radius / mix(C.z, -1.0, isOrtho);\nfloat sum = 0.0;\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 0, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 1, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 2, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 3, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 4, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 5, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 6, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 7, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 8, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 9, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 10, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 11, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 12, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 13, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 14, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 15, randomPatternRotationAngle);\nsum += sampleAO(ssC, C, n_C, ssDiskRadius, 16, randomPatternRotationAngle);\nfloat A = max(0.0, 1.0 - sum * intensityDivR6 * (5.0 / float(NUM_SAMPLES)));\nif (abs(dFdx(C.z)) < 0.02) {\nA -= dFdx(A) * (mod(float(ssC.x), 2.0) - 0.5);\n}\nif (abs(dFdy(C.z)) < 0.02) {\nA -= dFdy(A) * (mod(float(ssC.y), 2.0) - 0.5);\n}\ngl_FragColor.r = A;\ngl_FragColor.a = 1.0;\n}"].join("\n")})}
function init_SAOBlurShader(){"undefined"===typeof SAOBlurShader&&(SAOBlurShader={uniforms:{tDiffuse:{type:"t",value:null},size:{type:"v2",value:new THREE.Vector2(512,512)},resolution:{type:"v2",value:new THREE.Vector2(1/512,1/512)},axis:{type:"v2",value:new THREE.Vector2(1,0)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#define EDGE_SHARPNESS     (1.0)\n#define SCALE               (2)\n#define R                   (4)\n#define VALUE_TYPE        float\n#define VALUE_COMPONENTS   r\n#define VALUE_IS_KEY       0\n#define KEY_COMPONENTS     gb\n#if __VERSION__ >= 330\nconst float gaussian[R + 1] =\nfloat[](0.153170, 0.144893, 0.122649, 0.092902, 0.062970);  // stddev = 2.0\n#endif\nuniform sampler2D   tDiffuse;\nuniform vec2 size;\nuniform vec2 resolution;\nuniform vec2       axis;\nivec2 axisi = ivec2(axis);\n#define  result         gl_FragColor.VALUE_COMPONENTS\n#define  keyPassThrough gl_FragColor.KEY_COMPONENTS\nfloat unpackKey(vec2 p) {\nreturn p.x * (256.0 / 257.0) + p.y * (1.0 / 257.0);\n}\nvarying vec2 vUv;\nvoid main() {\n#   if __VERSION__ < 330\nfloat gaussian[R + 1];\n#       if R == 3\ngaussian[0] = 0.153170; gaussian[1] = 0.144893; gaussian[2] = 0.122649; gaussian[3] = 0.092902;  // stddev = 2.0\n#       elif R == 4\ngaussian[0] = 0.153170; gaussian[1] = 0.144893; gaussian[2] = 0.122649; gaussian[3] = 0.092902; gaussian[4] = 0.062970;  // stddev = 2.0\n#       elif R == 6\ngaussian[0] = 0.111220; gaussian[1] = 0.107798; gaussian[2] = 0.098151; gaussian[3] = 0.083953; gaussian[4] = 0.067458; gaussian[5] = 0.050920; gaussian[6] = 0.036108;\n#       endif\n#   endif\nivec2 ssC = ivec2(gl_FragCoord.xy);\nvec4 temp = texture2D(tDiffuse, vUv);\ngl_FragColor.gb = temp.KEY_COMPONENTS;\ngl_FragColor.a = temp.a;\nVALUE_TYPE sum = temp.VALUE_COMPONENTS;\nif (temp.a == 0.0) {\nresult = sum;\nreturn;\n}\nfloat key = unpackKey(keyPassThrough);\nfloat BASE = gaussian[0];\nfloat totalWeight = BASE;\nsum *= totalWeight;\nint r = -4; {\nvec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\ntemp = texture2D(tDiffuse, ssUV);\nfloat      tapKey = unpackKey(temp.KEY_COMPONENTS);\nVALUE_TYPE value  = temp.VALUE_COMPONENTS;\nfloat weight = 0.3 + gaussian[4];\nfloat dz = tapKey - key;\nweight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));\nsum += value * weight;\ntotalWeight += weight;\n}\nr = -3; {\nvec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\ntemp = texture2D(tDiffuse, ssUV);\nfloat      tapKey = unpackKey(temp.KEY_COMPONENTS);\nVALUE_TYPE value  = temp.VALUE_COMPONENTS;\nfloat weight = 0.3 + gaussian[3];\nfloat dz = tapKey - key;\nweight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));\nsum += value * weight;\ntotalWeight += weight;\n}\nr = -2; {\nvec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\ntemp = texture2D(tDiffuse, ssUV);\nfloat      tapKey = unpackKey(temp.KEY_COMPONENTS);\nVALUE_TYPE value  = temp.VALUE_COMPONENTS;\nfloat weight = 0.3 + gaussian[2];\nfloat dz = tapKey - key;\nweight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));\nsum += value * weight;\ntotalWeight += weight;\n}\nr=-1; {\nvec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\ntemp = texture2D(tDiffuse, ssUV);\nfloat      tapKey = unpackKey(temp.KEY_COMPONENTS);\nVALUE_TYPE value  = temp.VALUE_COMPONENTS;\nfloat weight = 0.3 + gaussian[1];\nfloat dz = tapKey - key;\nweight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));\nsum += value * weight;\ntotalWeight += weight;\n}\nr = 1; {\nvec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\ntemp = texture2D(tDiffuse, ssUV);\nfloat      tapKey = unpackKey(temp.KEY_COMPONENTS);\nVALUE_TYPE value  = temp.VALUE_COMPONENTS;\nfloat weight = 0.3 + gaussian[1];\nfloat dz = tapKey - key;\nweight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));\nsum += value * weight;\ntotalWeight += weight;\n}\nr = 2; {\nvec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\ntemp = texture2D(tDiffuse, ssUV);\nfloat      tapKey = unpackKey(temp.KEY_COMPONENTS);\nVALUE_TYPE value  = temp.VALUE_COMPONENTS;\nfloat weight = 0.3 + gaussian[2];\nfloat dz = tapKey - key;\nweight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));\nsum += value * weight;\ntotalWeight += weight;\n}\nr = 3; {\nvec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\ntemp = texture2D(tDiffuse, ssUV);\nfloat      tapKey = unpackKey(temp.KEY_COMPONENTS);\nVALUE_TYPE value  = temp.VALUE_COMPONENTS;\nfloat weight = 0.3 + gaussian[3];\nfloat dz = tapKey - key;\nweight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));\nsum += value * weight;\ntotalWeight += weight;\n}\nr = 4; {\nvec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;\ntemp = texture2D(tDiffuse, ssUV);\nfloat      tapKey = unpackKey(temp.KEY_COMPONENTS);\nVALUE_TYPE value  = temp.VALUE_COMPONENTS;\nfloat weight = 0.3 + gaussian[4];\nfloat dz = tapKey - key;\nweight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));\nsum += value * weight;\ntotalWeight += weight;\n}\nconst float epsilon = 0.0001;\nresult = sum / (totalWeight + epsilon);\n}"})}
function init_SAOMinifyShader(){"undefined"===typeof SAOMinifyFirstShader&&(SAOMinifyFirstShader={uniforms:{tDiffuse:{type:"t",value:null},cameraNear:{type:"f",value:1},cameraInvNearFar:{type:"f",value:100},resolution:{type:"v2",value:new THREE.Vector2(1/512,1/512)}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:["uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nuniform float cameraNear;\nuniform float cameraInvNearFar;",
PackDepthShaderChunk,"void main() {\nvec2 ssP = vec2(gl_FragCoord.xy);\nssP = ssP * 2.0 + mod(ssP, 2.0);\nssP = (ssP + 0.5) * resolution * 0.5;\nfloat depth = texture2D(tDiffuse, ssP).z;\nif (depth != 0.0)\ndepth = (depth + cameraNear) * cameraInvNearFar;\ngl_FragColor = packDepth(depth);\n}"].join("\n")},SAOMinifyShader={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2(1/512,1/512)}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec2 resolution;\nvoid main() {\nvec2 ssP = vec2(gl_FragCoord.xy);\nssP = ssP * 2.0 + mod(ssP, 2.0);\nssP = (ssP + 0.5) * resolution * 0.5;\ngl_FragColor = texture2D(tDiffuse, ssP);\n}"})}
function init_FireflyPhongShader(){"undefined"===typeof FireflyPhongShader&&(FireflyPhongShader={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.lights,{emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},reflMipIndex:{type:"f",value:0},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)},texMatrix:{type:"m3",value:new THREE.Matrix3},texMatrixBump:{type:"m3",
value:new THREE.Matrix3},texMatrixAlpha:{type:"m3",value:new THREE.Matrix3},irradianceMap:{type:"t",value:null},exposureBias:{type:"f",value:1},envMapExposure:{type:"f",value:1},cutplanes:{type:"v4v",value:[]},cutplanesOutlineColor:{type:"v3",value:new THREE.Vector3(0,1,0)},hatchParams:{type:"v2",value:new THREE.Vector2(1,10)},cutplanesOutlineThickness:{type:"f",value:.001},dbId:{type:"v4",value:new THREE.Vector4(0,0,0,0)}}]),vertexShader:["varying vec3 vViewPosition;\nvarying vec3 vNormal;\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\nuniform mat3 texMatrix;\n#endif\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvarying vec2 vUvBump;\nuniform mat3 texMatrixBump;\n#endif\n#if defined( USE_ALPHAMAP ) || defined( USE_ALPHAMAP )\nvarying vec2 vUvAlpha;\nuniform mat3 texMatrixAlpha;\n#endif\n#if defined( USE_ENVMAP )\n#if ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nuniform float refractionRatio;\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n#ifdef USE_LOGDEPTHBUF\n#ifdef USE_LOGDEPTHBUF_EXT\nvarying float vFragDepth;\n#endif\nuniform float logDepthBufFC;\n#endif\n#ifdef MRT_NORMALS\nvarying float depth;\n#endif",
PackNormalsShaderChunk,"void main() {\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\nvUv = (texMatrix * vec3(uv, 1.0)).xy;\n#endif\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvUvBump = (texMatrixBump * vec3(uv, 1.0)).xy;\n#endif\n#if defined( USE_ALPHAMAP )\nvUvAlpha = (texMatrixAlpha * vec3(uv, 1.0)).xy;\n#endif\n#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif\n#ifdef UNPACK_NORMALS\nvec3 objectNormal = decodeNormal(normal);\n#else\nvec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\nobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\nvNormal = normalize( transformedNormal );\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\nvViewPosition = -mvPosition.xyz;\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\nvWorldPosition = worldPosition.xyz;\n#endif\n#ifdef USE_LOGDEPTHBUF\nif (projectionMatrix[3][3] == 0.0) {\ngl_Position.z = log2(max(1.0e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\nvFragDepth = 1.0 + gl_Position.w;\n#else\ngl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n#endif\n} else {\n#ifdef USE_LOGDEPTHBUF_EXT\nvFragDepth = 1.0 + vViewPosition.z;\n#else\n#endif\n}\n#endif\n#ifdef MRT_NORMALS\ndepth = mvPosition.z;\n#endif\n}"].join("\n"),
fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n#ifdef GAMMA_INPUT\nvec3 InputToLinear(vec3 c) {\nreturn c * c;\n}\nfloat InputToLinear(float c) {\nreturn c * c;\n}\n#else\nvec3 InputToLinear(vec3 c) {\nreturn c;\n}\nfloat InputToLinear(float c) {\nreturn c;\n}\n#endif\n#if defined( USE_MAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\n#endif\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvarying vec2 vUvBump;\n#endif\n#if defined( USE_ALPHAMAP )\nvarying vec2 vUvAlpha;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif\n#if defined(TONEMAP_OUTPUT)\nuniform float exposureBias;",
TonemapShaderChunk,"#endif\n#if defined(IRR_RGBM) || defined(ENV_RGBM) || defined(ENV_GAMMA) || defined(IRR_GAMMA)\nuniform float envMapExposure;\n#endif\n#if defined(MRT_ID_BUFFER) || defined(ID_COLOR)\nuniform vec4 dbId;\n#endif\nvec3 RGBMDecode(in vec4 vRGBM, in float exposure) {\nvec3 ret = vRGBM.rgb * (vRGBM.a * 16.0);\nret *= ret;\nret *= exposure;\nreturn ret;\n}\nvec3 GammaDecode(in vec4 vRGBA, in float exposure) {\nreturn vRGBA.xyz * vRGBA.xyz * exposure;\n}\n#ifdef USE_ENVMAP\nuniform float reflMipIndex;\nuniform float reflectivity;\nuniform samplerCube envMap;\nmat3 viewInverse3x3 = mat3( viewMatrixInverse[ 0 ].xyz, viewMatrixInverse[ 1 ].xyz, viewMatrixInverse[ 2 ].xyz );\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nuniform float refractionRatio;\n#endif\nvec3 sampleReflection(vec3 dir, float mipIndex) {\ndir.z = -dir.z;\n#ifdef ENV_GAMMA\n#ifdef HAVE_TEXTURE_LOD\nvec4 envTexColor = textureCubeLodEXT( envMap, dir, mipIndex );\n#else\nvec4 envTexColor = textureCube( envMap, dir, mipIndex );\n#endif\nreturn GammaDecode(envTexColor, envMapExposure);\n#elif defined(ENV_RGBM)\n#ifdef HAVE_TEXTURE_LOD\nvec4 envTexColor = textureCubeLodEXT( envMap, dir, mipIndex );\n#else\nvec4 envTexColor = textureCube( envMap, dir, mipIndex );\n#endif\nreturn RGBMDecode(envTexColor, envMapExposure);\n#else\nvec4 envTexColor = textureCube( envMap, dir );\nvec3 cubeColor = envTexColor.xyz;\n#ifdef GAMMA_INPUT\ncubeColor *= cubeColor;\n#endif\nreturn cubeColor;\n#endif\n}\n#endif\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef USE_IRRADIANCEMAP\nuniform samplerCube irradianceMap;\n#endif\n#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0\nvarying highp vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying highp vec3 vViewPosition;\nvarying highp vec3 vNormal;\n#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;\nuniform float bumpScale;\nvec2 dHdxy_fwd() {\nvec2 dSTdx = dFdx( vUvBump );\nvec2 dSTdy = dFdy( vUvBump );\nfloat Hll = bumpScale * texture2D( bumpMap, vUvBump ).x;\nfloat dBx = bumpScale * texture2D( bumpMap, vUvBump + dSTdx ).x - Hll;\nfloat dBy = bumpScale * texture2D( bumpMap, vUvBump + dSTdy ).x - Hll;\nreturn vec2( dBx, dBy );\n}\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\nvec3 vSigmaX = dFdx( surf_pos );\nvec3 vSigmaY = dFdy( surf_pos );\nvec3 vN = surf_norm;\nvec3 R1 = cross( vSigmaY, vN );\nvec3 R2 = cross( vN, vSigmaX );\nfloat fDet = dot( vSigmaX, R1 );\nvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\nreturn normalize( abs( fDet ) * surf_norm - vGrad );\n}\n#endif\n#ifdef USE_NORMALMAP\nuniform sampler2D normalMap;\nuniform vec2 normalScale;\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\nvec3 q0 = dFdx( eye_pos.xyz );\nvec3 q1 = dFdy( eye_pos.xyz );\nvec2 st0 = dFdx( vUvBump.st );\nvec2 st1 = dFdy( vUvBump.st );\nvec3 S = normalize(  q0 * st1.t - q1 * st0.t );\nvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\nvec3 N = normalize( surf_norm );\nvec3 mapN = texture2D( normalMap, vUvBump ).xyz * 2.0 - 1.0;\nmapN.xy = normalScale * mapN.xy;\nmat3 tsn = mat3( S, T, N );\nreturn normalize( tsn * mapN );\n}\n#endif\n#ifdef USE_SPECULARMAP\nuniform sampler2D specularMap;\n#endif\n#ifdef USE_ALPHAMAP\nuniform sampler2D alphaMap;\n#endif\n#ifdef HATCH_PATTERN\nuniform vec2 hatchParams;\nfloat curveGaussian(float r, float invWidth) {\nfloat amt = clamp(r * invWidth, 0.0, 1.0);\nfloat exponent = amt * 3.5;\nreturn exp(-exponent*exponent);\n}\n#endif\n#if defined(MRT_NORMALS) || defined(MRT_ID_BUFFER)",
"undefined"!==typeof _isIE11&&_isIE11?"":"#extension GL_EXT_draw_buffers : enable","varying highp float depth;\n#define gl_FragColor gl_FragData[0]\n#endif\n#ifdef USE_LOGDEPTHBUF\nuniform float logDepthBufFC;\n#ifdef USE_LOGDEPTHBUF_EXT\n#extension GL_EXT_frag_depth : enable\nvarying highp float vFragDepth;\n#endif\n#endif\nvec3 Schlick_v3(vec3 v, float cosHV) {\nfloat facing = max(1.0 - cosHV, 0.0);\nfloat facing2 = facing * facing;\nreturn v + (1.0 - v) * facing * facing2 * facing2;\n}\nfloat Schlick_f(float v, float cosHV) {\nfloat facing = max(1.0 - cosHV, 0.0);\nfloat facing2 = facing * facing;\nreturn v + ( 1.0 - v ) * facing2 * facing2 * facing;\n}",
CutPlanesShaderChunk,"void main() {\n#if NUM_CUTPLANES > 0\nif (checkCutPlanes()) return;\n#endif\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );\n#ifdef USE_MAP\nvec4 texelColor = texture2D( map, vUv );\n#ifdef GAMMA_INPUT\ntexelColor.xyz *= texelColor.xyz;\n#endif\ngl_FragColor = gl_FragColor * texelColor;\n#endif\n#ifdef USE_ALPHAMAP\nvec4 texelAlpha = texture2D( alphaMap, vUvAlpha );\ngl_FragColor.a *= texelAlpha.r;\n#endif\n#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif\nfloat specularStrength;\n#ifdef USE_SPECULARMAP\nvec4 texelSpecular = texture2D( specularMap, vUv );\nspecularStrength = texelSpecular.r;\n#else\nspecularStrength = 1.0;\n#endif\nvec3 normal = normalize( vNormal );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\nvec3 geomNormal = normal;\n#ifdef USE_NORMALMAP\nnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\nnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\nvec3 viewDirection;\nif (projectionMatrix[3][3] == 0.0) {\nviewDirection = normalize( vViewPosition );\n} else {\nviewDirection = vec3(0.0, 0.0, 1.0);\n}\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\nfloat shininessB = shininess * 4.0;\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\npointDiffuse  += InputToLinear(diffuse) * InputToLinear(pointLightColor[ i ]) * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize( lVector + viewDirection );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininessB ), 0.0 );\nfloat specularNormalization = shininessB * 0.125 + 0.25;\nvec3 schlick = Schlick_v3(InputToLinear(specular), dot( lVector, pointHalfVector ) );\npointSpecular += schlick * InputToLinear(pointLightColor[ i ]) * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization ;\n}\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\nspotDiffuse += InputToLinear(diffuse) * InputToLinear(spotLightColor[ i ]) * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize( lVector + viewDirection );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininessB ), 0.0 );\nfloat specularNormalization = shininessB * 0.125 + 0.25;\nvec3 schlick = Schlick_v3(InputToLinear(specular), dot( lVector, spotHalfVector ) );\nspotSpecular += schlick * InputToLinear(spotLightColor[ i ]) * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n}\n}\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, dirVector );\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\ndirDiffuse  += InputToLinear(diffuse) * InputToLinear(directionalLightColor[ i ]) * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewDirection );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininessB ), 0.0 );\nfloat specularNormalization = shininessB * 0.125 + 0.25;\nvec3 schlick = Schlick_v3(InputToLinear(specular), dot( dirVector, dirHalfVector ));\ndirSpecular += schlick * InputToLinear(directionalLightColor[ i ]) * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n}\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#ifdef USE_IRRADIANCEMAP\nvec3 worldNormal = viewInverse3x3 * normal;\nvec4 cubeColor4 = textureCube(irradianceMap, vec3(worldNormal.xy, -worldNormal.z));\n#ifdef IRR_GAMMA\nvec3 indirectDiffuse = GammaDecode(cubeColor4, envMapExposure);\n#elif defined(IRR_RGBM)\nvec3 indirectDiffuse = RGBMDecode(cubeColor4, envMapExposure);\n#else\nvec3 indirectDiffuse = cubeColor4.xyz;\n#ifdef GAMMA_INPUT\nindirectDiffuse.xyz *= indirectDiffuse.xyz;\n#endif\n#endif\ntotalDiffuse += InputToLinear(diffuse) * indirectDiffuse;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( InputToLinear(emissive) + totalDiffuse + ambientLightColor * InputToLinear(diffuse) + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( InputToLinear(emissive) + totalDiffuse + ambientLightColor * InputToLinear(diffuse) ) + totalSpecular;\n#endif\n#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n#endif\n#if defined(USE_ENVMAP)\nvec3 reflectVec;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n#ifdef ENVMAP_MODE_REFLECTION\nreflectVec = reflect( -viewDirection, normal );\n#else \nreflectVec = refract( -viewDirection, normal, refractionRatio );\n#endif\n#else\nreflectVec = reflect( -viewDirection, normal );\n#endif\nreflectVec = viewInverse3x3 * reflectVec;\nfloat reflectScale = 1.0;\nvec3 cubeColor = sampleReflection(reflectVec, reflMipIndex);\ncubeColor *= reflectScale;\nfloat facing = dot( viewDirection, geomNormal );\nif (facing < -1e-2)\nfacing = 1.0;\nelse\nfacing = max(1e-6, facing);\nvec3 schlickRefl;\n#ifdef METAL\nschlickRefl = InputToLinear(specular);\n#else\nschlickRefl = Schlick_v3(InputToLinear(specular), facing);\ngl_FragColor.a = mix(gl_FragColor.a, Schlick_f(gl_FragColor.a, facing), reflectivity);\nfloat invSchlick = (1.0 - facing * 0.5);\nfloat invSchlick2 = invSchlick * invSchlick;\nfloat norm_factor = 1.0 - invSchlick * invSchlick2 * invSchlick2;\nnorm_factor = (28.0 / 23.0) * norm_factor;\ngl_FragColor.xyz *= norm_factor * (1.0 - InputToLinear(specular));\n#endif\ngl_FragColor.xyz += cubeColor.xyz * specularStrength * schlickRefl.xyz;\n#ifdef CLEARCOAT\nvec3 reflectVecClearcoat = reflect( -viewDirection, geomNormal );\nreflectVecClearcoat = viewInverse3x3 * reflectVecClearcoat;\nvec3 cubeColorClearcoat = sampleReflection(reflectVecClearcoat, 0.0);\nfloat schlickClearcoat = Schlick_f(InputToLinear(reflectivity), facing);\ngl_FragColor.xyz = mix(gl_FragColor.xyz, cubeColorClearcoat * schlickClearcoat, 0.5);\n#endif\n#endif\n#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif\n#ifdef TONEMAP_OUTPUT\ngl_FragColor.xyz = toneMapCanonFilmic_WithGamma( exposureBias * gl_FragColor.xyz );\n#endif\n#ifdef HATCH_PATTERN\nfloat hatchSlope = hatchParams.x;\nfloat hatchPeriod = hatchParams.y;\nif (abs(hatchSlope) <= 1.0) {\nfloat hatchPhase = gl_FragCoord.y - hatchSlope * gl_FragCoord.x;\nfloat dist = abs(mod((hatchPhase), (hatchPeriod)));\nif (dist < 1.0) {\ngl_FragColor = vec4(0.0,0.0,0.0,1.0);\n}\n} else {\nfloat hatchPhase = - gl_FragCoord.y / hatchSlope + gl_FragCoord.x;\nfloat dist = abs(mod((hatchPhase), (hatchPeriod)));\nif (dist < 1.0) {\ngl_FragColor = vec4(0.0,0.0,0.0,1.0);\n}\n}\n#endif\n#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\ngl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif\n#ifdef MRT_NORMALS\ngl_FragData[1] = vec4(geomNormal.x, geomNormal.y, depth, gl_FragColor.a < 1.0 ? 0.0 : 1.0);\n#endif\n#ifdef MRT_ID_BUFFER\n#ifdef MRT_NORMALS\nconst int index = 2;\n#else\nconst int index = 1;\n#endif\ngl_FragData[index] = vec4(dbId.rgb, 1.0);\n#elif defined(ID_COLOR)\ngl_FragColor = dbId;\n#endif\n}"].join("\n")},
THREE.ShaderLib.firefly_phong=FireflyPhongShader)}
function init_NormalsShader(){"undefined"===typeof NormalsShader&&(NormalsShader={uniforms:{cutplanes:{type:"v4v",value:[]}},vertexShader:["varying vec3 vNormal;\nvarying float depth;\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif",PackNormalsShaderChunk,"void main() {\n#ifdef UNPACK_NORMALS\nvec3 objectNormal = decodeNormal(normal);\n#else\nvec3 objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\nobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\nvNormal = normalize( transformedNormal );\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\ndepth = mvPosition.z;\nvec4 p_Position = projectionMatrix * mvPosition;\ngl_Position = p_Position;\n}"].join("\n"),fragmentShader:["varying highp vec3 vNormal;\nvarying highp float depth;\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif",
CutPlanesShaderChunk,"void main() {\n#if NUM_CUTPLANES > 0\nif (checkCutPlanes()) return;\n#endif\nvec3 n = vNormal;\nn = n * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\nn = normalize( n );\ngl_FragColor = vec4(n.x, n.y, depth, 1.0);\n}"].join("\n")})}
function init_BackgroundShader(){"undefined"===typeof BackgroundShader&&(BackgroundShader={uniforms:{color1:{type:"v3",value:new THREE.Vector3(41/255,76/255,120/255)},color2:{type:"v3",value:new THREE.Vector3(1/255,2/255,3/255)}},vertexShader:"uniform vec3 color1;\nuniform vec3 color2;\nvarying vec3 vColor;\nvoid main() {\nif (uv.y == 0.0)\nvColor = color2;\nelse\nvColor = color1;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:["varying vec3 vColor;",
OrderedDitheringShaderChunk,"void main() {\ngl_FragColor = vec4(orderedDithering(vColor), 1.0);\n}"].join("\n")})}
function init_LineShader(){"undefined"===typeof LineShader&&(LineShader={uniforms:{pixelsPerUnit:{type:"f",value:1},aaRange:{type:"f",value:.5},tLayerMask:{type:"t",value:null},tRaster:{type:"t",value:null},tSelectionTexture:{type:"t",value:null},vSelTexSize:{type:"v2",value:new THREE.Vector2(4096,1)}},attributes:{fields1:0,fields2:0,color4b:0,dbId4b:0,flags4b:0,extraParams:0,instFlags4b:0},defines:{},vertexShader:"#define TAU 6.28318530718\n#define PI 3.14159265358979\n#define HALF_PI 1.57079632679\n#define VBB_LINE_SEGMENT     16.0\n#define VBB_ARC_CIRCULAR     32.0\n#define VBB_ARC_ELLIPTICAL   48.0\n#define VBB_TEX_QUAD         64.0\n#define VBB_ONE_TRIANGLE     80.0\n#define VBB_INSTANCED_FLAG   0.0\n#define VBB_SEG_START_RIGHT  1.0\n#define VBB_SEG_START_LEFT   2.0\n#define VBB_SEG_END_RIGHT    3.0\n#define VBB_SEG_END_LEFT     4.0\nattribute vec3 fields1;\nattribute vec3 fields2;\nattribute vec4 color4b;\nattribute vec4 dbId4b;\nattribute vec4 flags4b;\n#ifdef HAS_ELLIPTICALS\nattribute vec3 extraParams;\n#endif\n#ifdef USE_INSTANCING\nattribute vec4 instFlags4b;\n#endif\nuniform mat4 mvpMatrix;\nuniform float pixelsPerUnit;\nuniform float aaRange;\n#ifdef HAS_LAYERS\nuniform sampler2D tLayerMask;\n#endif\n#ifdef SELECTION_RENDERER\nuniform sampler2D tSelectionTexture;\nuniform vec2 vSelTexSize;\n#endif\nvarying vec4 outColor;\nvarying vec4 dbId;\nvec2 centralVertex;\nvec2 offsetPosition;\nvarying vec2 offsetDirection;\nvarying vec4 multipurpose;\nvarying float halfWidth;\nvoid strokeLineSegment(float vertexId) {\nfloat distanceAlong = fields2.x;\nfloat isStartCapVertex = (vertexId < VBB_SEG_END_RIGHT) ? -1.0 : 1.0;\nfloat isLeftSide = (vertexId == VBB_SEG_END_LEFT || vertexId == VBB_SEG_START_LEFT) ? 1.0 : -1.0;\nfloat angleTransverse = fields1.z + isLeftSide * HALF_PI;\nfloat st = sin(angleTransverse);\nfloat ct = cos(angleTransverse);\nfloat lwAdjustment = halfWidth + aaRange;\nvec2 transverseOffset = vec2(ct, st) * lwAdjustment;\noffsetPosition.xy += transverseOffset;\nvec2 moveOffset = isStartCapVertex * isLeftSide * vec2(-transverseOffset.y, transverseOffset.x);\noffsetPosition.xy -= moveOffset;\ncentralVertex.xy -= moveOffset;\nfloat distanceFromStart = max(isStartCapVertex, 0.0) * distanceAlong;\nvec2 along = distanceFromStart * vec2(cos(fields1.z), sin(fields1.z));\noffsetPosition.xy += along;\ncentralVertex.xy += along;\nmultipurpose.x = (isStartCapVertex * lwAdjustment) + distanceFromStart;\nmultipurpose.y = distanceAlong;\nmultipurpose.z = 0.0;\n}\n#ifdef HAS_TRIANGLE_GEOMS\nvoid strokeOneTriangle(float vertexId) {\nhalfWidth = 0.0;\nif (vertexId == VBB_SEG_END_RIGHT)\noffsetPosition.xy = vec2(fields1.z, fields2.x);\nelse if (vertexId == VBB_SEG_END_LEFT)\noffsetPosition.xy = fields2.yz;\n}\n#endif\n#ifdef HAS_RASTER_QUADS\nvoid strokeTexQuad(float vertexId) {\nfloat distanceAlong = fields2.x;\nbool isStartCapVertex = (vertexId < VBB_SEG_END_RIGHT);\nfloat isLeftSide = (vertexId == VBB_SEG_END_LEFT || vertexId == VBB_SEG_START_LEFT) ? 1.0 : -1.0;\nfloat angleTransverse = fields1.z + isLeftSide * HALF_PI;\nmultipurpose.y = distanceAlong;\nfloat st = sin(angleTransverse);\nfloat ct = cos(angleTransverse);\nfloat moveDist = halfWidth;\nvec2 offset = vec2(ct, st) * moveDist;\noffsetPosition.xy += offset;\nmultipurpose.z = 1.0;\nhalfWidth = 0.0;\nif (isStartCapVertex) {\noffsetPosition.xy += isLeftSide * vec2(0.0, offset.x);\nmultipurpose.x = 0.0;\nmultipurpose.y = max(0.0, isLeftSide);\n}\nelse {\nvec2 along = vec2(cos(fields1.z), sin(fields1.z));\noffsetPosition.xy += distanceAlong * along;\ncentralVertex.xy += distanceAlong * along;\noffsetPosition.xy += isLeftSide * vec2(0.0, -offset.x);\nmultipurpose.x = 1.0;\nmultipurpose.y = max(0.0, isLeftSide);\n}\n}\n#endif\n#ifdef HAS_CIRCLES\nvoid strokeCircularArc(float vertexId) {\nvec2 angles = vec2(fields1.z, fields2.x);\nfloat r = fields2.z;\nif (r * pixelsPerUnit < 0.125)\nr = 0.25 * aaRange;\nfloat isStart = (vertexId < VBB_SEG_END_RIGHT) ? -1.0 : 1.0;\nfloat isLeft = (vertexId == VBB_SEG_END_LEFT || vertexId == VBB_SEG_START_LEFT) ? -1.0 : 1.0;\nvec2 minPt;\nvec2 maxPt;\nvec2 endsX = vec2(fields1.x) + r * cos(angles);\nvec2 endsY = vec2(fields1.y) + r * sin(angles);\nminPt = maxPt = vec2(endsX.x, endsY.x);\nminPt = min(minPt, vec2(endsX.y, endsY.y));\nmaxPt = max(maxPt, vec2(endsX.y, endsY.y));\nfloat start = angles.x;\nfloat end = angles.y;\nif (end > start) {\nif (start < (0.5 * PI) && end > (0.5 * PI)) {\nminPt = min(minPt, vec2(fields1.x, fields1.y + r));\nmaxPt = max(maxPt, vec2(fields1.x, fields1.y + r));\n}\nif (start < PI && end > PI) {\nminPt = min(minPt, vec2(fields1.x - r, fields1.y));\nmaxPt = max(maxPt, vec2(fields1.x - r, fields1.y));\n}\nif (start < (1.5 * PI) && end > (1.5 * PI)) {\nminPt = min(minPt, vec2(fields1.x, fields1.y - r));\nmaxPt = max(maxPt, vec2(fields1.x, fields1.y - r));\n}\n}\nelse {\nminPt = min(minPt, vec2(fields1.x + r, fields1.y));\nmaxPt = max(maxPt, vec2(fields1.x + r, fields1.y));\nif (start < (0.5 * PI) || end > (0.5 * PI)) {\nminPt = min(minPt, vec2(fields1.x, fields1.y + r));\nmaxPt = max(maxPt, vec2(fields1.x, fields1.y + r));\n}\nif (start < PI || end > PI) {\nminPt = min(minPt, vec2(fields1.x - r, fields1.y));\nmaxPt = max(maxPt, vec2(fields1.x - r, fields1.y));\n}\nif (start < (1.5 * PI) || end > (1.5 * PI)) {\nminPt = min(minPt, vec2(fields1.x, fields1.y - r));\nmaxPt = max(maxPt, vec2(fields1.x, fields1.y - r));\n}\n}\nminPt -= halfWidth + aaRange;\nmaxPt += halfWidth + aaRange;\nif (isStart<0.0)\noffsetPosition.x = minPt.x;\nelse\noffsetPosition.x = maxPt.x;\nif (isLeft<0.0)\noffsetPosition.y = minPt.y;\nelse\noffsetPosition.y = maxPt.y;\nmultipurpose.x = angles.x;\nmultipurpose.y = -r;\nmultipurpose.z = angles.y;\nmultipurpose.w = -r;\n}\n#endif\n#ifdef HAS_ELLIPTICALS\nvoid strokeEllipticalArc(float vertexId) {\nvec2 angles = vec2(fields1.z, fields2.x);\nfloat isStart = (vertexId < VBB_SEG_END_RIGHT) ? -1.0 : 1.0;\nfloat isLeft = (vertexId == VBB_SEG_END_LEFT || vertexId == VBB_SEG_START_LEFT) ? -1.0 : 1.0;\nfloat major = fields2.z;\nfloat minor = extraParams.x;\nvec2 minPt;\nvec2 maxPt;\nvec2 endsX = vec2(fields1.x) + major * cos(angles);\nvec2 endsY = vec2(fields1.y) + minor * sin(angles);\nminPt = maxPt = vec2(endsX.x, endsY.x);\nminPt = min(minPt, vec2(endsX.y, endsY.y));\nmaxPt = max(maxPt, vec2(endsX.y, endsY.y));\nfloat start = angles.x;\nfloat end = angles.y;\nif (end > start) {\nif (start < (0.5 * PI) && end > (0.5 * PI)) {\nminPt = min(minPt, vec2(fields1.x, fields1.y + minor));\nmaxPt = max(maxPt, vec2(fields1.x, fields1.y + minor));\n}\nif (start < PI && end > PI) {\nminPt = min(minPt, vec2(fields1.x - major, fields1.y));\nmaxPt = max(maxPt, vec2(fields1.x - major, fields1.y));\n}\nif (start < (1.5 * PI) && end > (1.5 * PI)) {\nminPt = min(minPt, vec2(fields1.x, fields1.y - minor));\nmaxPt = max(maxPt, vec2(fields1.x, fields1.y - minor));\n}\n}\nelse {\nminPt = min(minPt, vec2(fields1.x + major, fields1.y));\nmaxPt = max(maxPt, vec2(fields1.x + major, fields1.y));\nif (start < (0.5 * PI) || end > (0.5 * PI)) {\nminPt = min(minPt, vec2(fields1.x, fields1.y + minor));\nmaxPt = max(maxPt, vec2(fields1.x, fields1.y + minor));\n}\nif (start < PI || end > PI) {\nminPt = min(minPt, vec2(fields1.x - major, fields1.y));\nmaxPt = max(maxPt, vec2(fields1.x - major, fields1.y));\n}\nif (start < (1.5 * PI) || end > (1.5 * PI)) {\nminPt = min(minPt, vec2(fields1.x, fields1.y - minor));\nmaxPt = max(maxPt, vec2(fields1.x, fields1.y - minor));\n}\n}\nminPt -= halfWidth + aaRange;\nmaxPt += halfWidth + aaRange;\nif (isStart < 0.0)\noffsetPosition.x = minPt.x;\nelse\noffsetPosition.x = maxPt.x;\nif (isLeft < 0.0)\noffsetPosition.y = minPt.y;\nelse\noffsetPosition.y = maxPt.y;\nmultipurpose.x = angles.x;\nmultipurpose.y = -major;\nmultipurpose.z = angles.y;\nmultipurpose.w = minor;\n}\n#endif\n#ifdef SELECTION_RENDERER\nbool isSelected() {\nvec3 oid = dbId4b.rgb * 255.0;\nfloat id01 = oid.r + oid.g * 256.0;\nfloat t = (id01 + 0.5) * (1.0 / 4096.0);\nfloat flrt = floor(t);\nfloat texU = t - flrt;\nfloat id23 = oid.b * (65536.0 / 4096.0) + flrt;\nt = (id23 + 0.5) / vSelTexSize.y;\nfloat texV = fract(t);\nvec4 selBit = texture2D(tSelectionTexture, vec2(texU, texV));\nreturn selBit.r == 1.0;\n}\n#endif\nbool isLayerOff() {\n#ifdef HAS_LAYERS\nvec4 layerBit = texture2D(tLayerMask, flags4b.ba / 255.0);\nreturn layerBit.r == 0.0;\n#else\nreturn false;\n#endif\n}\nvoid main() {\ncentralVertex = offsetPosition = fields1.xy;\nif (isLayerOff()) {\noutColor = vec4(0.0);\n}\nelse {\nfloat vertexId = mod(flags4b.x, 16.0);\nfloat geomType = flags4b.x - vertexId;\n#ifdef USE_INSTANCING\nvertexId = instFlags4b.x;\n#endif\nfloat lineWeight = fields2.y;\nif (lineWeight > 0.0) {\nif (lineWeight * pixelsPerUnit < 0.5)\nlineWeight = aaRange;\n}\nelse {\nlineWeight = abs(lineWeight) * aaRange * 2.0;\n}\n#ifdef SELECTION_RENDERER\nif (isSelected())\noutColor = vec4(0.0,0.0,1.0,1.0);\nelse\noutColor = vec4(0.0);\n#else\noutColor = color4b;\n#endif\nhalfWidth = lineWeight;\ndbId = dbId4b;\nif (geomType == VBB_LINE_SEGMENT)\nstrokeLineSegment(vertexId);\n#ifdef HAS_CIRCLES\nelse if (geomType == VBB_ARC_CIRCULAR)\nstrokeCircularArc(vertexId);\n#endif\n#ifdef HAS_ELLIPTICALS\nelse if (geomType == VBB_ARC_ELLIPTICAL)\nstrokeEllipticalArc(vertexId);\n#endif\n#ifdef HAS_RASTER_QUADS\nelse if (geomType == VBB_TEX_QUAD)\nstrokeTexQuad(vertexId);\n#endif\n#ifdef HAS_TRIANGLE_GEOMS\nelse if (geomType == VBB_ONE_TRIANGLE)\nstrokeOneTriangle(vertexId);\n#endif\nelse {\nhalfWidth = 0.0;\nmultipurpose.z = 0.0;\n}\n}\noffsetDirection = offsetPosition - centralVertex;\ngl_Position = mvpMatrix * modelMatrix * vec4( offsetPosition.xy, 0.0, 1.0 );\n}",
fragmentShader:"#define TAU 6.28318530717958\n#define PI  3.14159265358979\nuniform float pixelsPerUnit;\nuniform float aaRange;\n#ifdef HAS_RASTER_QUADS\nuniform sampler2D tRaster;\n#endif\nvarying vec4 outColor;\nvarying vec4 dbId;\nvarying vec2 offsetDirection;\nvarying vec4 multipurpose;\nvarying float halfWidth;\nfloat curveGaussian(float r, float invWidth) {\nfloat amt = clamp(r * invWidth, 0.0, 1.0);\nfloat exponent = amt * 3.5;\nreturn exp(-exponent*exponent);\n}\nvoid fillLineSegment() {\nfloat radius = halfWidth;\nfloat parametricDistance = multipurpose.x;\nfloat segmentLength = multipurpose.y;\nfloat dist;\nfloat offsetLength2 = dot(offsetDirection, offsetDirection);\nfloat ltz = max(0.0, sign(-parametricDistance));\nfloat gtsl = max(0.0, sign(parametricDistance - segmentLength));\nfloat d = (ltz + gtsl) * (parametricDistance - gtsl * segmentLength);\ndist = sqrt(max(0.0, offsetLength2 + d*d));\nfloat range =  dist - radius;\nif (range > aaRange) {\ndiscard;\n}\ngl_FragColor = outColor;\ngl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\n}\n#ifdef HAS_CIRCLES\nvoid fillCircularArc() {\nfloat dist = length(offsetDirection);\nfloat radius = abs(multipurpose.y);\nfloat range =  abs(dist - radius);\nrange -= halfWidth;\nif (range > aaRange) {\ndiscard;\n}\nvec2 angles = multipurpose.xz;\nvec2 direction = offsetDirection;\nfloat angle = atan(direction.y, direction.x);\nif (angles.x > angles.y)\nangles.x -= TAU;\nelse if (angle < 0.0)\nangle += TAU;\nif (angle > angles.x && angle < angles.y) {\ngl_FragColor = outColor;\ngl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\n}\nelse {\ndiscard;\n}\n}\n#endif\n#ifdef HAS_ELLIPTICALS\nfloat DistancePointEllipseSpecial (vec2 e, vec2 y, out vec2 x, float width, float aaRange) {\nfloat dist;\nvec2 esqr = e * e;\nvec2 ey = e * y;\nfloat t0 = -esqr[1] + ey[1];\nfloat t1 = -esqr[1] + length(ey);\nfloat t;\nvec2 r;\nfor (int i = 0; i < 6; ++i) {\nt = mix(t0, t1, 0.5);//0.5*(t0 + t1);\nr = ey / (vec2(t) + esqr);\nvec2 rsq = r * r;\nfloat f = rsq[0] + rsq[1] - 1.0;\nfloat fsign = sign(f);\nt0 = mix(t0, t, max(0.0, fsign));\nt1 = mix(t1, t, max(0.0, -fsign));\n}\nx = e * r;\ndist = distance(x, y);\nif (dist > max(2.0 * (width + aaRange), e[0] * 0.05))\nreturn dist;\nfor (int i = 0; i < 6; ++i) {\nt = mix(t0, t1, 0.5);//0.5*(t0 + t1);\nr = ey / (vec2(t) + esqr);\nvec2 rsq = r * r;\nfloat f = rsq[0] + rsq[1] - 1.0;\nfloat fsign = sign(f);\nt0 = mix(t0, t, max(0.0, fsign));\nt1 = mix(t1, t, max(0.0, -fsign));\n}\nx = e * r;\ndist = distance(x, y);\nfloat ecc = 1.0 +  0.1 * e[0] / e[1];\nif (dist > max(ecc * (width + aaRange), e[0] * 0.001))\nreturn dist;\nif (dist < (width - aaRange) / ecc)\nreturn dist;\nfor (int i = 0; i < 10; ++i) {\nt = mix(t0, t1, 0.5);//0.5*(t0 + t1);\nr = ey / (vec2(t) + esqr);\nvec2 rsq = r * r;\nfloat f = rsq[0] + rsq[1] - 1.0;\nfloat fsign = sign(f);\nt0 = mix(t0, t, max(0.0, fsign));\nt1 = mix(t1, t, max(0.0, -fsign));\n}\nx = e * r;\ndist = distance(x, y);\nreturn dist;\n}\nfloat DistancePointEllipse(vec2 e, vec2 y, out vec2 locX, float width, float aaRange) {\nvec2 locE, locY;\nfloat diff = sign(e[0] - e[1]);\nvec2 swizzle = vec2(max(diff, 0.0), -min(diff, 0.0));\nlocE.x = dot(e, swizzle.xy);\nlocE.y = dot(e, swizzle.yx);\nlocY.x = dot(y, swizzle.xy);\nlocY.y = dot(y, swizzle.yx);\nvec2 refl = sign(locY);\nlocY *= refl;\nvec2 x;\nfloat distance = DistancePointEllipseSpecial(locE, locY, x, width, aaRange);\nx *= refl;\nlocX.x = dot(x, swizzle.xy);\nlocX.y = dot(x, swizzle.yx);\nreturn distance;\n}\nvoid fillEllipticalArc() {\nvec2 radii = abs(multipurpose.yw);\nvec2 dir = offsetDirection;\nvec2 pos;\nfloat range = DistancePointEllipse(radii, dir, pos, halfWidth, aaRange);\nrange -= halfWidth;\nif (range > aaRange)\ndiscard;\nfloat ar = radii[0] / radii[1];\nvec2 angles = multipurpose.xz;\nfloat angle = atan(ar * pos.y, pos.x);\nif (angles.x > angles.y)\nangles.x -= TAU;\nelse if (angle < 0.0)\nangle += TAU;\nif (angle > angles.x && angle < angles.y) {\ngl_FragColor = outColor;\ngl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);\n}\nelse {\ndiscard;\n}\n}\n#endif\nvoid main() {\nif (outColor.a == 0.0) {\ndiscard;\n}\nif (halfWidth == 0.0) {\n#ifdef HAS_RASTER_QUADS\nif (multipurpose.z != 0.0)\ngl_FragColor = texture2D(tRaster, multipurpose.xy);\nelse\n#endif\ngl_FragColor = outColor;\n}\nelse if (multipurpose.y < 0.0) {\n#ifdef HAS_CIRCLES\n#ifdef HAS_ELLIPTICALS\nif (multipurpose.y == multipurpose.w)\n#endif\nfillCircularArc();\n#endif\n#ifdef HAS_ELLIPTICALS\n#ifdef HAS_CIRCLES\nelse\n#endif\nfillEllipticalArc();\n#endif\n}\nelse\nfillLineSegment();\n#ifdef MRT_NORMALS\ngl_FragData[1] = vec4(0, 0, 0, 0.0);\n#endif\n#ifdef MRT_ID_BUFFER\n#ifdef MRT_NORMALS\nconst int index = 2;\n#else\nconst int index = 1;\n#endif\ngl_FragData[index] = vec4(dbId.rgb, 1.0);\n#elif defined(ID_COLOR)\ngl_FragColor = dbId;\n#endif\n}"})}
FireflyWebGLProgram=function(){var a=0;return function(b,c,f,d){var g=b.context,h=f.defines,k=f.__webglShader.uniforms,l=f.attributes,n=f.__webglShader.vertexShader,q=f.__webglShader.fragmentShader,m=f.index0AttributeName;void 0===m&&!0===d.morphTargets&&(m="position");var p="SHADOWMAP_TYPE_BASIC";d.shadowMapType===THREE.PCFShadowMap?p="SHADOWMAP_TYPE_PCF":d.shadowMapType===THREE.PCFSoftShadowMap&&(p="SHADOWMAP_TYPE_PCF_SOFT");var t=0<b.gammaFactor?b.gammaFactor:1,r,B;r=[];for(var z in h)B=h[z],!1!==
B&&(B="#define "+z+" "+B,r.push(B));r=r.join("\n");h=g.createProgram();f instanceof THREE.RawShaderMaterial?b=f="":(f=["precision "+d.precision+" float;","precision "+d.precision+" int;",r,d.supportsVertexTextures?"#define VERTEX_TEXTURES":"",b.gammaInput?"#define GAMMA_INPUT":"",b.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+t,d.mrtNormals?"#define MRT_NORMALS":"",d.mrtIdBuffer?"#define MRT_ID_BUFFER":"","#define MAX_DIR_LIGHTS "+d.maxDirLights,"#define MAX_POINT_LIGHTS "+d.maxPointLights,
"#define MAX_SPOT_LIGHTS "+d.maxSpotLights,"#define MAX_HEMI_LIGHTS "+d.maxHemiLights,"#define MAX_SHADOWS "+d.maxShadows,"#define MAX_BONES "+d.maxBones,"#define NUM_CUTPLANES "+d.numCutplanes,d.map?"#define USE_MAP":"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define ENVMAP_MODE_REFLECTION":"",d.irradianceMap?"#define USE_IRRADIANCEMAP":"",d.lightMap?"#define USE_LIGHTMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.alphaMap?
"#define USE_ALPHAMAP":"",d.vertexColors?"#define USE_COLOR":"",d.skinning?"#define USE_SKINNING":"",d.useVertexTexture?"#define BONE_TEXTURE":"",d.morphTargets?"#define USE_MORPHTARGETS":"",d.morphNormals?"#define USE_MORPHNORMALS":"",d.wrapAround?"#define WRAP_AROUND":"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"",d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+p:"",d.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",d.shadowMapCascade?"#define SHADOWMAP_CASCADE":
"",d.sizeAttenuation?"#define USE_SIZEATTENUATION":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",d.useFragDepthExt?"#define USE_LOGDEPTHBUF_EXT":"",d.packedNormals?"#define UNPACK_NORMALS":"","uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\n#ifdef UNPACK_NORMALS\nattribute vec2 normal;\n#else\nattribute vec3 normal;\n#endif\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\n\tattribute vec3 color;\n#endif\n"].join("\n"),
b=[d.bumpMap||d.normalMap?"#extension GL_OES_standard_derivatives : enable":"",d.mrtIdBuffer?"#extension GL_EXT_draw_buffers : enable":"",d.mrtIdBuffer?"#define gl_FragColor gl_FragData[0]":"",d.haveTextureLod?"#define HAVE_TEXTURE_LOD":"",r,"#define MAX_DIR_LIGHTS "+d.maxDirLights,"#define MAX_POINT_LIGHTS "+d.maxPointLights,"#define MAX_SPOT_LIGHTS "+d.maxSpotLights,"#define MAX_HEMI_LIGHTS "+d.maxHemiLights,"#define MAX_SHADOWS "+d.maxShadows,"#define NUM_CUTPLANES "+d.numCutplanes,d.alphaTest?
"#define ALPHATEST "+d.alphaTest:"",b.gammaInput?"#define GAMMA_INPUT":"",b.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+t,d.mrtNormals?"#define MRT_NORMALS":"",d.mrtIdBuffer?"#define MRT_ID_BUFFER":"",d.tonemapOutput?"#define TONEMAP_OUTPUT":"",d.useFog&&d.fog?"#define USE_FOG":"",d.useFog&&d.fogExp?"#define FOG_EXP2":"",d.map?"#define USE_MAP":"",d.envMap?"#define USE_ENVMAP":"",d.envMap?"#define ENVMAP_TYPE_CUBE":"",d.envMap?"#define ENVMAP_MODE_REFLECTION":"",d.envMap?"#define ENVMAP_BLENDING_MULTIPLY":
"",d.irradianceMap?"#define USE_IRRADIANCEMAP":"",d.envGammaEncoded?"#define ENV_GAMMA":"",d.irrGammaEncoded?"#define IRR_GAMMA":"",d.envRGBM?"#define ENV_RGBM":"",d.irrRGBM?"#define IRR_RGBM":"",d.lightMap?"#define USE_LIGHTMAP":"",d.bumpMap?"#define USE_BUMPMAP":"",d.normalMap?"#define USE_NORMALMAP":"",d.specularMap?"#define USE_SPECULARMAP":"",d.alphaMap?"#define USE_ALPHAMAP":"",d.vertexColors?"#define USE_COLOR":"",d.metal?"#define METAL":"",d.clearcoat?"#define CLEARCOAT":"",d.wrapAround?"#define WRAP_AROUND":
"",d.doubleSided?"#define DOUBLE_SIDED":"",d.flipSided?"#define FLIP_SIDED":"",d.shadowMapEnabled?"#define USE_SHADOWMAP":"",d.shadowMapEnabled?"#define "+p:"",d.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",d.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",d.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",d.hatchPattern?"#define HATCH_PATTERN":"","#ifdef USE_ENVMAP\n#ifdef HAVE_TEXTURE_LOD\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#endif\n#extension GL_OES_standard_derivatives : enable",
"precision "+d.precision+" float;","precision "+d.precision+" int;","uniform highp mat4 viewMatrix;\nuniform highp mat4 projectionMatrix;\nuniform highp vec3 cameraPosition;\n#ifdef USE_ENVMAP\nuniform mat4 viewMatrixInverse;\n#endif\n"].join("\n"));n=new THREE.WebGLShader(g,g.VERTEX_SHADER,f+n);q=new THREE.WebGLShader(g,g.FRAGMENT_SHADER,b+q);g.attachShader(h,n);g.attachShader(h,q);void 0!==m&&g.bindAttribLocation(h,0,m);g.linkProgram(h);!1===g.getProgramParameter(h,g.LINK_STATUS)&&(console.error("THREE.WebGLProgram: Could not initialise shader."),
console.error("gl.VALIDATE_STATUS",g.getProgramParameter(h,g.VALIDATE_STATUS)),console.error("gl.getError()",g.getError()));""!==g.getProgramInfoLog(h)&&console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",g.getProgramInfoLog(h));g.deleteShader(n);g.deleteShader(q);m="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition viewMatrixInverse mvpMatrix dbId".split(" ");d.logarithmicDepthBuffer&&m.push("logDepthBufFC");for(var F in k)m.push(F);d=m;k={};F=0;for(m=d.length;F<
m;F++)b=d[F],k[b]=g.getUniformLocation(h,b);this.uniforms=k;var m="position normal uv uv2 tangent color lineDistance".split(" "),C;for(C in l)m.push(C);l=m;C={};d=0;for(k=l.length;d<k;d++)F=l[d],C[F]=g.getAttribLocation(h,F);this.attributes=C;this.attributesKeys=Object.keys(this.attributes);this.id=a++;this.code=c;this.usedTimes=1;this.program=h;this.vertexShader=n;this.fragmentShader=q;return this}}();
FireflyWebGLRenderer=function(a){function b(a,b){return a.material instanceof THREE.MeshFaceMaterial?a.material.materials[b.materialIndex]:a.material}function c(a){return a instanceof THREE.MeshBasicMaterial&&!a.envMap||a instanceof THREE.MeshDepthMaterial?!1:a&&void 0!==a.shading&&a.shading===THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading}function f(a){return a.map||a.lightMap||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a instanceof THREE.ShaderMaterial?!0:!1}function d(a,b,c,
d){if(d.streamingDraw||d.offsets&&1<d.offsets.length||!Aa)return d.vaos=null,!1;void 0===d.vaos&&(d.vaos=[]);b=Aa.createVertexArrayOES();d.vaos.push({geomhash:a,vao:b});Aa.bindVertexArrayOES(b);(a=d.attributes.index)&&v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,d.ibbuffer||a.buffer);var f,g=null,h=d.vbstride,k=d.offsets&&d.offsets.length?d.offsets[0].index:0;for(f in c)if(a=d.attributes[f],b=c[f],0<=b)if(a){var m=v.FLOAT,l=a.bytesPerItem||4;1===l?m=v.UNSIGNED_BYTE:2===l&&(m=v.UNSIGNED_SHORT);v.enableVertexAttribArray(b);
void 0!==a.itemOffset?(g!=d.vbbuffer&&(v.bindBuffer(v.ARRAY_BUFFER,d.vbbuffer),g=d.vbbuffer),v.vertexAttribPointer(b,a.itemSize,m,a.normalize,4*h,4*(a.itemOffset+k*h))):(v.bindBuffer(v.ARRAY_BUFFER,a.buffer),g=a.buffer,v.vertexAttribPointer(b,a.itemSize,m,a.normalize,0,k*a.itemSize*l));Da&&d.numInstances&&Da.vertexAttribDivisorANGLE(b,a.divisor||0)}else{Aa.bindVertexArrayOES(null);for(c=0;c<d.vaos.length;c++)Aa.deleteVertexArrayOES(d.vaos[c].vao);d.vaos=null;return!1}return!0}function g(a,b){var c=
Ma[a];c||(c=v.createBuffer(),Ma[a]=c);v.bindBuffer(v.ARRAY_BUFFER,c);v.bufferData(v.ARRAY_BUFFER,b,v.DYNAMIC_DRAW);return c}function h(a,b,c,d,f){var h,k,m=0,l=void 0;f&&(!f.buffer&&c.streamingDraw?(h=Ma.index,h||(h=v.createBuffer(),Ma.index=h),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,h),v.bufferData(v.ELEMENT_ARRAY_BUFFER,f.array||c.ib,v.DYNAMIC_DRAW)):v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,c.ibbuffer||f.buffer));for(k in b)if(f=b[k],h=c.attributes[k],0<=f)if(h){var n=void 0!==h.itemOffset,q,p;n?(q=c.vbstride,
p=h.itemOffset,m!==l&&(c.streamingDraw?m=g("interleavedVB",c.vb):(m=c.vbbuffer,v.bindBuffer(v.ARRAY_BUFFER,m)),l=m)):(q=h.itemSize,p=0,c.streamingDraw?m=g(k,h.array):(m=h.buffer,v.bindBuffer(v.ARRAY_BUFFER,m)));var M=v.FLOAT,t=h.bytesPerItem||4;1===t?M=v.UNSIGNED_BYTE:2===t&&(M=v.UNSIGNED_SHORT);n&&(t=4);ka.enableAttribute(f);v.vertexAttribPointer(f,h.itemSize,M,h.normalize,q*t,(p+d*q)*t);Da&&c.numInstances&&Da.vertexAttribDivisorANGLE(f,h.divisor||0)}else a.defaultAttributeValues&&((h=a.defaultAttributeValues[k])&&
2===h.length?v.vertexAttrib2fv(f,a.defaultAttributeValues[k]):h&&3===h.length&&v.vertexAttrib3fv(f,a.defaultAttributeValues[k]));ka.disableUnusedAttributes()}function k(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function l(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function n(a){m(a,
!0)}function q(a){m(a,!1)}function m(a,b,c){if(c||!1!==a.visible){if(!(a instanceof THREE.Scene||a instanceof THREE.Group))if(a instanceof RenderBatch)a.forEach(b?n:q);else{void 0===a.__webglInit&&(a.__webglInit=!0,a.addEventListener("removed",Sa));var d=a.geometry;if(void 0!==d&&void 0===d.__webglInit&&(d.__webglInit=!0,d.addEventListener("dispose",Pa),!(d instanceof THREE.BufferGeometry)))if(a instanceof THREE.Mesh)r(a,d);else if(a instanceof THREE.Line&&void 0===d.__webglVertexBuffer){d.__webglVertexBuffer=
v.createBuffer();d.__webglColorBuffer=v.createBuffer();d.__webglLineDistanceBuffer=v.createBuffer();la.info.memory.geometries++;var f=d.vertices.length;d.__vertexArray=new Float32Array(3*f);d.__colorArray=new Float32Array(3*f);d.__lineDistanceArray=new Float32Array(1*f);d.__webglLineCount=f;var f=d.vertices.length,g=a.material;if(g.attributes){void 0===d.__webglCustomAttributesList&&(d.__webglCustomAttributesList=[]);for(var h in g.attributes){var k=g.attributes[h];if(!k.__webglInitialized||k.createUniqueBuffers){k.__webglInitialized=
!0;var l=1;"v2"===k.type?l=2:"v3"===k.type?l=3:"v4"===k.type?l=4:"c"===k.type&&(l=3);k.size=l;k.array=new Float32Array(f*l);k.buffer=v.createBuffer();k.buffer.belongsToAttribute=h;k.needsUpdate=!0}d.__webglCustomAttributesList.push(k)}}d.verticesNeedUpdate=!0;d.colorsNeedUpdate=!0;d.lineDistancesNeedUpdate=!0}if(void 0===a.__webglActive)if(a.__webglActive=!0,a instanceof THREE.Mesh)if(d instanceof THREE.BufferGeometry)B(X,d,a);else{if(d instanceof THREE.Geometry)for(d=gb[d.id],h=0,f=d.length;h<f;h++)B(X,
d[h],a)}else a instanceof THREE.Line||a instanceof THREE.PointCloud?B(X,d,a):(a instanceof THREE.ImmediateRenderObject||a.immediateRenderCallback)&&ia.push({id:null,object:a,opaque:null,transparent:null,z:0});if(a instanceof THREE.Light)fa.push(a);else if((d=X[a.id])&&(!1===a.frustumCulled||!0===oa.intersectsObject(a)))for(h=0,f=d.length;h<f;h++){var k=g=d[h],p=k.object,l=k.buffer,M=p.geometry,p=p.material;p instanceof THREE.MeshFaceMaterial?(p=p.materials[M instanceof THREE.BufferGeometry?0:l.materialIndex],
k.material=p,p.transparent?ha.push(k):pa.push(k)):p&&(k.material=p,p.transparent?ha.push(k):pa.push(k));g.render=!0;!0===b&&(ga.setFromMatrixPosition(a.matrixWorld),ga.applyProjection(qa),g.z=ga.z)}}if(a.children)for(h=0,f=a.children.length;h<f;h++)m(a.children[h],b,c)}}function p(a,b,c,d,f){for(var g,h=0,k=a.length;h<k;h++){g=a[h];var m=g.object,l=g.buffer;if(f)g=f;else{g=g.material;if(!g)continue;w(g)}la.setMaterialFaces(g);l instanceof THREE.BufferGeometry?la.renderBufferDirect(b,c,d,g,l,m):la.renderBuffer(b,
c,d,g,l,m)}}function t(a,b){if(a.visible){var c;if(Va)c=Va;else{c=a.material;if(!c)return;w(c)}la.setMaterialFaces(c);la.renderBufferDirect(lb,mb,zb,c,a.geometry,a)}}function r(a,d){var g=a.material,h=!1;if(void 0===gb[d.id]||!0===d.groupsNeedUpdate){delete X[a.id];for(var k=gb,m=d.id,g=g instanceof THREE.MeshFaceMaterial,l=ja.get("OES_element_index_uint")?4294967296:65535,n,h={},p=d.morphTargets?d.morphTargets.length:0,q=d.morphNormals?d.morphNormals.length:0,M,t={},r=[],z=0,C=d.faces.length;z<C;z++){n=
d.faces[z];var w=g?n.materialIndex:0;w in h||(h[w]={hash:w,counter:0});n=h[w].hash+"_"+h[w].counter;n in t||(M={id:yb++,faces3:[],materialIndex:w,vertices:0,numMorphTargets:p,numMorphNormals:q},t[n]=M,r.push(M));t[n].vertices+3>l&&(h[w].counter+=1,n=h[w].hash+"_"+h[w].counter,n in t||(M={id:yb++,faces3:[],materialIndex:w,vertices:0,numMorphTargets:p,numMorphNormals:q},t[n]=M,r.push(M)));t[n].faces3.push(z);t[n].vertices+=3}k[m]=r;d.groupsNeedUpdate=!1}k=gb[d.id];m=0;for(g=k.length;m<g;m++){l=k[m];
if(void 0===l.__webglVertexBuffer){h=l;h.__webglVertexBuffer=v.createBuffer();h.__webglNormalBuffer=v.createBuffer();h.__webglTangentBuffer=v.createBuffer();h.__webglColorBuffer=v.createBuffer();h.__webglUVBuffer=v.createBuffer();h.__webglUV2Buffer=v.createBuffer();h.__webglSkinIndicesBuffer=v.createBuffer();h.__webglSkinWeightsBuffer=v.createBuffer();h.__webglFaceBuffer=v.createBuffer();h.__webglLineBuffer=v.createBuffer();la.info.memory.geometries++;h=l;r=a;z=r.geometry;q=h.faces3;p=3*q.length;
t=1*q.length;C=3*q.length;q=b(r,h);n=f(q);M=c(q);w=q.vertexColors?q.vertexColors:!1;h.__vertexArray=new Float32Array(3*p);M&&(h.__normalArray=new Float32Array(3*p));z.hasTangents&&(h.__tangentArray=new Float32Array(4*p));w&&(h.__colorArray=new Float32Array(3*p));n&&(0<z.faceVertexUvs.length&&(h.__uvArray=new Float32Array(2*p)),1<z.faceVertexUvs.length&&(h.__uv2Array=new Float32Array(2*p)));r.geometry.skinWeights.length&&r.geometry.skinIndices.length&&(h.__skinIndexArray=new Float32Array(4*p),h.__skinWeightArray=
new Float32Array(4*p));r=null!==ja.get("OES_element_index_uint")&&21845<t?Uint32Array:Uint16Array;h.__typeArray=r;h.__faceArray=new r(3*t);h.__lineArray=new r(2*C);h.__webglFaceCount=3*t;h.__webglLineCount=2*C;if(q.attributes)for(t in void 0===h.__webglCustomAttributesList&&(h.__webglCustomAttributesList=[]),t=void 0,q.attributes){var r=q.attributes[t],z={},F;for(F in r)z[F]=r[F];if(!z.__webglInitialized||z.createUniqueBuffers)z.__webglInitialized=!0,C=1,"v2"===z.type?C=2:"v3"===z.type?C=3:"v4"===
z.type?C=4:"c"===z.type&&(C=3),z.size=C,z.array=new Float32Array(p*C),z.buffer=v.createBuffer(),z.buffer.belongsToAttribute=t,r.needsUpdate=!0,z.__original=r;h.__webglCustomAttributesList.push(z)}h.__inittedArrays=!0;d.verticesNeedUpdate=!0;d.morphTargetsNeedUpdate=!0;d.elementsNeedUpdate=!0;d.uvsNeedUpdate=!0;d.normalsNeedUpdate=!0;d.tangentsNeedUpdate=!0;h=d.colorsNeedUpdate=!0}else h=!1;(h||void 0===a.__webglActive)&&B(X,l,a)}a.__webglActive=!0}function B(a,b,c){var d=c.id;a[d]=a[d]||[];a[d].push({id:d,
buffer:b,object:c,material:null,z:0})}function z(a){var d=a.geometry,g,h;if(d instanceof THREE.BufferGeometry)if(d.streamingDraw){if(!d.streamingIndex){var k=d.attributes.index;k&&(k.buffer=v.createBuffer(),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,k.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,k.array||d.ib,v.STATIC_DRAW))}}else{d.vb&&void 0===d.vbbuffer&&(d.vbbuffer=v.createBuffer(),d.vbNeedsUpdate=!0);d.ib&&void 0===d.ibbuffer&&(d.ibbuffer=v.createBuffer(),v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,d.ibbuffer),
v.bufferData(v.ELEMENT_ARRAY_BUFFER,d.ib,v.STATIC_DRAW));for(var m=d.attributes,l=d.attributesKeys,n=0,q=l.length;n<q;n++){var p=l[n],M=m[p],t="index"===p;M.array&&void 0===M.buffer&&(M.buffer=v.createBuffer(),M.needsUpdate=!0);if(!0===M.needsUpdate){var z=t?v.ELEMENT_ARRAY_BUFFER:v.ARRAY_BUFFER;v.bindBuffer(z,M.buffer);v.bufferData(z,M.array,v.STATIC_DRAW);M.needsUpdate=!1}}d.vbNeedsUpdate&&(v.bindBuffer(v.ARRAY_BUFFER,d.vbbuffer),v.bufferData(v.ARRAY_BUFFER,d.vb,v.STATIC_DRAW),d.vbNeedsUpdate=!1)}else if(a instanceof
THREE.Mesh){!0===d.groupsNeedUpdate&&r(a,d);for(var w=gb[d.id],L=0,ia=w.length;L<ia;L++){var A=w[L];h=b(a,A);g=h.attributes&&F(h);if(d.verticesNeedUpdate||d.morphTargetsNeedUpdate||d.elementsNeedUpdate||d.uvsNeedUpdate||d.normalsNeedUpdate||d.colorsNeedUpdate||d.tangentsNeedUpdate||g){var aa=A,D=a,ba=v.DYNAMIC_DRAW,E=!d.dynamic,B=h;if(aa.__inittedArrays){var I=c(B),pa=B.vertexColors?B.vertexColors:!1,ha=f(B),S=I===THREE.SmoothShading,R=void 0,P=void 0,G=void 0,X=void 0,fa=void 0,J=void 0,H=void 0,
U=void 0,Z=void 0,Y=void 0,la=void 0,O=void 0,K=void 0,N=void 0,za=void 0,V=void 0,da=void 0,W=void 0,Na=void 0,ca=void 0,sa=void 0,va=void 0,ea=void 0,Ba=void 0,Ha=void 0,xa=0,ga=0,na=0,Ja=0,Ga=0,ja=0,ma=0,qa=0,oa=0,T=0,ka=void 0,Ca=aa.__vertexArray,Da=aa.__uvArray,Ia=aa.__uv2Array,Aa=aa.__normalArray,ya=aa.__tangentArray,Ea=aa.__colorArray,Ma=aa.__webglCustomAttributesList,Q=void 0,Oa=aa.__faceArray,Ka=aa.__lineArray,Ra=D.geometry,Sa=Ra.elementsNeedUpdate,Pa=Ra.uvsNeedUpdate,Ua=Ra.normalsNeedUpdate,
Ya=Ra.tangentsNeedUpdate,bb=Ra.colorsNeedUpdate,Wa=Ra.vertices,ra=aa.faces3,ab=Ra.faces,Za=Ra.faceVertexUvs[0],$a=Ra.faceVertexUvs[1];if(Ra.verticesNeedUpdate){R=0;for(P=ra.length;R<P;R++)X=ab[ra[R]],O=Wa[X.a],K=Wa[X.b],N=Wa[X.c],Ca[ga]=O.x,Ca[ga+1]=O.y,Ca[ga+2]=O.z,Ca[ga+3]=K.x,Ca[ga+4]=K.y,Ca[ga+5]=K.z,Ca[ga+6]=N.x,Ca[ga+7]=N.y,Ca[ga+8]=N.z,ga+=9;v.bindBuffer(v.ARRAY_BUFFER,aa.__webglVertexBuffer);v.bufferData(v.ARRAY_BUFFER,Ca,ba)}if(bb&&pa){R=0;for(P=ra.length;R<P;R++)X=ab[ra[R]],H=X.vertexColors,
U=X.color,3===H.length&&pa===THREE.VertexColors?(W=H[0],Na=H[1],ca=H[2]):ca=Na=W=U,Ea[oa]=W.r,Ea[oa+1]=W.g,Ea[oa+2]=W.b,Ea[oa+3]=Na.r,Ea[oa+4]=Na.g,Ea[oa+5]=Na.b,Ea[oa+6]=ca.r,Ea[oa+7]=ca.g,Ea[oa+8]=ca.b,oa+=9;0<oa&&(v.bindBuffer(v.ARRAY_BUFFER,aa.__webglColorBuffer),v.bufferData(v.ARRAY_BUFFER,Ea,ba))}if(Ya&&Ra.hasTangents){R=0;for(P=ra.length;R<P;R++)X=ab[ra[R]],Z=X.vertexTangents,za=Z[0],V=Z[1],da=Z[2],ya[ma]=za.x,ya[ma+1]=za.y,ya[ma+2]=za.z,ya[ma+3]=za.w,ya[ma+4]=V.x,ya[ma+5]=V.y,ya[ma+6]=V.z,
ya[ma+7]=V.w,ya[ma+8]=da.x,ya[ma+9]=da.y,ya[ma+10]=da.z,ya[ma+11]=da.w,ma+=12;v.bindBuffer(v.ARRAY_BUFFER,aa.__webglTangentBuffer);v.bufferData(v.ARRAY_BUFFER,ya,ba)}if(Ua&&I){R=0;for(P=ra.length;R<P;R++)if(X=ab[ra[R]],fa=X.vertexNormals,J=X.normal,3===fa.length&&S)for(sa=0;3>sa;sa++)ea=fa[sa],Aa[ja]=ea.x,Aa[ja+1]=ea.y,Aa[ja+2]=ea.z,ja+=3;else for(sa=0;3>sa;sa++)Aa[ja]=J.x,Aa[ja+1]=J.y,Aa[ja+2]=J.z,ja+=3;v.bindBuffer(v.ARRAY_BUFFER,aa.__webglNormalBuffer);v.bufferData(v.ARRAY_BUFFER,Aa,ba)}if(Pa&&
Za&&ha){R=0;for(P=ra.length;R<P;R++)if(G=ra[R],Y=Za[G],void 0!==Y)for(sa=0;3>sa;sa++)Ba=Y[sa],Da[na]=Ba.x,Da[na+1]=Ba.y,na+=2;0<na&&(v.bindBuffer(v.ARRAY_BUFFER,aa.__webglUVBuffer),v.bufferData(v.ARRAY_BUFFER,Da,ba))}if(Pa&&$a&&ha){R=0;for(P=ra.length;R<P;R++)if(G=ra[R],la=$a[G],void 0!==la)for(sa=0;3>sa;sa++)Ha=la[sa],Ia[Ja]=Ha.x,Ia[Ja+1]=Ha.y,Ja+=2;0<Ja&&(v.bindBuffer(v.ARRAY_BUFFER,aa.__webglUV2Buffer),v.bufferData(v.ARRAY_BUFFER,Ia,ba))}if(Sa){R=0;for(P=ra.length;R<P;R++)Oa[Ga]=xa,Oa[Ga+1]=xa+
1,Oa[Ga+2]=xa+2,Ga+=3,Ka[qa]=xa,Ka[qa+1]=xa+1,Ka[qa+2]=xa,Ka[qa+3]=xa+2,Ka[qa+4]=xa+1,Ka[qa+5]=xa+2,qa+=6,xa+=3;v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,aa.__webglFaceBuffer);v.bufferData(v.ELEMENT_ARRAY_BUFFER,Oa,ba);v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,aa.__webglLineBuffer);v.bufferData(v.ELEMENT_ARRAY_BUFFER,Ka,ba)}if(Ma)for(sa=0,va=Ma.length;sa<va;sa++)if(Q=Ma[sa],Q.__original.needsUpdate){T=0;if(1===Q.size)if(void 0===Q.boundTo||"vertices"===Q.boundTo)for(R=0,P=ra.length;R<P;R++)X=ab[ra[R]],Q.array[T]=
Q.value[X.a],Q.array[T+1]=Q.value[X.b],Q.array[T+2]=Q.value[X.c],T+=3;else{if("faces"===Q.boundTo)for(R=0,P=ra.length;R<P;R++)ka=Q.value[ra[R]],Q.array[T]=ka,Q.array[T+1]=ka,Q.array[T+2]=ka,T+=3}else if(2===Q.size)if(void 0===Q.boundTo||"vertices"===Q.boundTo)for(R=0,P=ra.length;R<P;R++)X=ab[ra[R]],O=Q.value[X.a],K=Q.value[X.b],N=Q.value[X.c],Q.array[T]=O.x,Q.array[T+1]=O.y,Q.array[T+2]=K.x,Q.array[T+3]=K.y,Q.array[T+4]=N.x,Q.array[T+5]=N.y,T+=6;else{if("faces"===Q.boundTo)for(R=0,P=ra.length;R<P;R++)N=
K=O=ka=Q.value[ra[R]],Q.array[T]=O.x,Q.array[T+1]=O.y,Q.array[T+2]=K.x,Q.array[T+3]=K.y,Q.array[T+4]=N.x,Q.array[T+5]=N.y,T+=6}else if(3===Q.size){var wa;wa="c"===Q.type?["r","g","b"]:["x","y","z"];if(void 0===Q.boundTo||"vertices"===Q.boundTo)for(R=0,P=ra.length;R<P;R++)X=ab[ra[R]],O=Q.value[X.a],K=Q.value[X.b],N=Q.value[X.c],Q.array[T]=O[wa[0]],Q.array[T+1]=O[wa[1]],Q.array[T+2]=O[wa[2]],Q.array[T+3]=K[wa[0]],Q.array[T+4]=K[wa[1]],Q.array[T+5]=K[wa[2]],Q.array[T+6]=N[wa[0]],Q.array[T+7]=N[wa[1]],
Q.array[T+8]=N[wa[2]],T+=9;else if("faces"===Q.boundTo)for(R=0,P=ra.length;R<P;R++)N=K=O=ka=Q.value[ra[R]],Q.array[T]=O[wa[0]],Q.array[T+1]=O[wa[1]],Q.array[T+2]=O[wa[2]],Q.array[T+3]=K[wa[0]],Q.array[T+4]=K[wa[1]],Q.array[T+5]=K[wa[2]],Q.array[T+6]=N[wa[0]],Q.array[T+7]=N[wa[1]],Q.array[T+8]=N[wa[2]],T+=9;else if("faceVertices"===Q.boundTo)for(R=0,P=ra.length;R<P;R++)ka=Q.value[ra[R]],O=ka[0],K=ka[1],N=ka[2],Q.array[T]=O[wa[0]],Q.array[T+1]=O[wa[1]],Q.array[T+2]=O[wa[2]],Q.array[T+3]=K[wa[0]],Q.array[T+
4]=K[wa[1]],Q.array[T+5]=K[wa[2]],Q.array[T+6]=N[wa[0]],Q.array[T+7]=N[wa[1]],Q.array[T+8]=N[wa[2]],T+=9}else if(4===Q.size)if(void 0===Q.boundTo||"vertices"===Q.boundTo)for(R=0,P=ra.length;R<P;R++)X=ab[ra[R]],O=Q.value[X.a],K=Q.value[X.b],N=Q.value[X.c],Q.array[T]=O.x,Q.array[T+1]=O.y,Q.array[T+2]=O.z,Q.array[T+3]=O.w,Q.array[T+4]=K.x,Q.array[T+5]=K.y,Q.array[T+6]=K.z,Q.array[T+7]=K.w,Q.array[T+8]=N.x,Q.array[T+9]=N.y,Q.array[T+10]=N.z,Q.array[T+11]=N.w,T+=12;else if("faces"===Q.boundTo)for(R=0,
P=ra.length;R<P;R++)N=K=O=ka=Q.value[ra[R]],Q.array[T]=O.x,Q.array[T+1]=O.y,Q.array[T+2]=O.z,Q.array[T+3]=O.w,Q.array[T+4]=K.x,Q.array[T+5]=K.y,Q.array[T+6]=K.z,Q.array[T+7]=K.w,Q.array[T+8]=N.x,Q.array[T+9]=N.y,Q.array[T+10]=N.z,Q.array[T+11]=N.w,T+=12;else if("faceVertices"===Q.boundTo)for(R=0,P=ra.length;R<P;R++)ka=Q.value[ra[R]],O=ka[0],K=ka[1],N=ka[2],Q.array[T]=O.x,Q.array[T+1]=O.y,Q.array[T+2]=O.z,Q.array[T+3]=O.w,Q.array[T+4]=K.x,Q.array[T+5]=K.y,Q.array[T+6]=K.z,Q.array[T+7]=K.w,Q.array[T+
8]=N.x,Q.array[T+9]=N.y,Q.array[T+10]=N.z,Q.array[T+11]=N.w,T+=12;v.bindBuffer(v.ARRAY_BUFFER,Q.buffer);v.bufferData(v.ARRAY_BUFFER,Q.array,ba)}E&&(delete aa.__inittedArrays,delete aa.__colorArray,delete aa.__normalArray,delete aa.__tangentArray,delete aa.__uvArray,delete aa.__uv2Array,delete aa.__faceArray,delete aa.__vertexArray,delete aa.__lineArray,delete aa.__skinIndexArray,delete aa.__skinWeightArray)}}}d.verticesNeedUpdate=!1;d.morphTargetsNeedUpdate=!1;d.elementsNeedUpdate=!1;d.uvsNeedUpdate=
!1;d.normalsNeedUpdate=!1;d.colorsNeedUpdate=!1;d.tangentsNeedUpdate=!1;h.attributes&&C(h)}else if(a instanceof THREE.Line){h=b(a,d);g=h.attributes&&F(h);if(d.verticesNeedUpdate||d.colorsNeedUpdate||d.lineDistancesNeedUpdate||g){var Ta=v.DYNAMIC_DRAW,Qa,pb,qb,Va,ua,Xa,cb=d.vertices,db=d.colors,fb=d.lineDistances,ib=cb.length,lb=db.length,mb=fb.length,rb=d.__vertexArray,sb=d.__colorArray,hb=d.__lineDistanceArray,nb=d.colorsNeedUpdate,ob=d.lineDistancesNeedUpdate,eb=d.__webglCustomAttributesList,tb,
kb,Fa,jb,La,ta;if(d.verticesNeedUpdate){for(Qa=0;Qa<ib;Qa++)Va=cb[Qa],ua=3*Qa,rb[ua]=Va.x,rb[ua+1]=Va.y,rb[ua+2]=Va.z;v.bindBuffer(v.ARRAY_BUFFER,d.__webglVertexBuffer);v.bufferData(v.ARRAY_BUFFER,rb,Ta)}if(nb){for(pb=0;pb<lb;pb++)Xa=db[pb],ua=3*pb,sb[ua]=Xa.r,sb[ua+1]=Xa.g,sb[ua+2]=Xa.b;v.bindBuffer(v.ARRAY_BUFFER,d.__webglColorBuffer);v.bufferData(v.ARRAY_BUFFER,sb,Ta)}if(ob){for(qb=0;qb<mb;qb++)hb[qb]=fb[qb];v.bindBuffer(v.ARRAY_BUFFER,d.__webglLineDistanceBuffer);v.bufferData(v.ARRAY_BUFFER,hb,
Ta)}if(eb)for(tb=0,kb=eb.length;tb<kb;tb++)if(ta=eb[tb],ta.needsUpdate&&(void 0===ta.boundTo||"vertices"===ta.boundTo)){ua=0;jb=ta.value.length;if(1===ta.size)for(Fa=0;Fa<jb;Fa++)ta.array[Fa]=ta.value[Fa];else if(2===ta.size)for(Fa=0;Fa<jb;Fa++)La=ta.value[Fa],ta.array[ua]=La.x,ta.array[ua+1]=La.y,ua+=2;else if(3===ta.size)if("c"===ta.type)for(Fa=0;Fa<jb;Fa++)La=ta.value[Fa],ta.array[ua]=La.r,ta.array[ua+1]=La.g,ta.array[ua+2]=La.b,ua+=3;else for(Fa=0;Fa<jb;Fa++)La=ta.value[Fa],ta.array[ua]=La.x,
ta.array[ua+1]=La.y,ta.array[ua+2]=La.z,ua+=3;else if(4===ta.size)for(Fa=0;Fa<jb;Fa++)La=ta.value[Fa],ta.array[ua]=La.x,ta.array[ua+1]=La.y,ta.array[ua+2]=La.z,ta.array[ua+3]=La.w,ua+=4;v.bindBuffer(v.ARRAY_BUFFER,ta.buffer);v.bufferData(v.ARRAY_BUFFER,ta.array,Ta)}}d.verticesNeedUpdate=!1;d.colorsNeedUpdate=!1;d.lineDistancesNeedUpdate=!1;h.attributes&&C(h)}}function F(a){for(var b in a.attributes)if(a.attributes[b].needsUpdate)return!0;return!1}function C(a){for(var b in a.attributes)a.attributes[b].needsUpdate=
!1}function w(a){!0===a.transparent&&ka.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,a.blendSrcAlpha,a.blendDstAlpha);ka.setDepthTest(a.depthTest);ka.setDepthWrite(a.depthWrite);ka.setPolygonOffset(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}function E(a,b,c,d,f){var g,h,k,m;Ja=0;if(d.needsUpdate){d.program&&xb(d);d.addEventListener("dispose",ub);var l=Ab[d.type];l?(g=THREE.ShaderLib[l],d.__webglShader={uniforms:THREE.UniformsUtils.clone(g.uniforms),
vertexShader:g.vertexShader,fragmentShader:g.fragmentShader}):d.__webglShader={uniforms:d.uniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader};for(var n=m=k=h=g=0,p=b.length;n<p;n++){var q=b[n];q.onlyShadow||(q instanceof THREE.DirectionalLight&&g++,q instanceof THREE.PointLight&&h++,q instanceof THREE.SpotLight&&k++,q instanceof THREE.HemisphereLight&&m++)}p=n=0;for(q=b.length;p<q;p++){var t=b[p];t.castShadow&&(t instanceof THREE.SpotLight&&n++,t instanceof THREE.DirectionalLight&&
!t.shadowCascade&&n++)}g={precision:Z,supportsVertexTextures:$a,haveTextureLod:!!ja.get("EXT_shader_texture_lod"),map:!!d.map,envMap:!!d.envMap,irradianceMap:!!d.irradianceMap,envIsSpherical:d.envMap&&d.envMap.mapping==THREE.SphericalReflectionMapping,envGammaEncoded:d.envMap&&d.envMap.GammaEncoded,irrGammaEncoded:d.irradianceMap&&d.irradianceMap.GammaEncoded,envRGBM:d.envMap&&d.envMap.RGBM,irrRGBM:d.irradianceMap&&d.irradianceMap.RGBM,lightMap:!!d.lightMap,bumpMap:ja.get("OES_standard_derivatives")&&
!!d.bumpMap,normalMap:ja.get("OES_standard_derivatives")&&!!d.normalMap,specularMap:!!d.specularMap,alphaMap:!!d.alphaMap,vertexColors:d.vertexColors,fog:c,useFog:d.fog,fogExp:c instanceof THREE.FogExp2,sizeAttenuation:d.sizeAttenuation,logarithmicDepthBuffer:N,maxDirLights:g,maxPointLights:h,maxSpotLights:k,maxHemiLights:m,maxShadows:n,shadowMapEnabled:la.shadowMapEnabled&&f.receiveShadow,shadowMapType:la.shadowMapType,shadowMapDebug:la.shadowMapDebug,shadowMapCascade:la.shadowMapCascade,alphaTest:d.alphaTest,
metal:d.metal,clearcoat:d.clearcoat,wrapAround:d.wrapAround,doubleSided:d.side===THREE.DoubleSide,flipSided:d.side===THREE.BackSide,mrtNormals:d.mrtNormals,mrtIdBuffer:d.mrtIdBuffer,tonemapOutput:d.tonemapOutput,packedNormals:d.packedNormals,hatchPattern:!!d.hatchParams,numCutplanes:d.cutplanes?d.cutplanes.length:0};h=[];l?h.push(l):(h.push(d.fragmentShader),h.push(d.vertexShader));for(var r in d.defines)h.push(r),h.push(d.defines[r]);for(var z in g)h.push(z),h.push(g[z]);var l=h.join(),w;z=0;for(r=
za.length;z<r;z++)if(h=za[z],h.code===l){w=h;w.usedTimes++;break}void 0===w&&(w=new FireflyWebGLProgram(la,l,d,g),za.push(w),la.info.memory.programs=za.length);d.program=w;d.uniformsList=[];for(u in d.__webglShader.uniforms)(z=d.program.uniforms[u])&&d.uniformsList.push([d.__webglShader.uniforms[u],z]);d.needsUpdate=!1}h=g=r=!1;z=d.program;w=z.uniforms;l=d.__webglShader.uniforms;z.id!==Na&&(v.useProgram(z.program),Na=z.id,h=g=r=!0);d.id!==va&&(-1===va&&(h=!0),va=d.id,g=!0);if(r||a!==Ba)if(v.uniformMatrix4fv(w.projectionMatrix,
!1,a.projectionMatrix.elements),N&&v.uniform1f(w.logDepthBufFC,2/(Math.log(a.far+1)/Math.LN2)),a!==Ba&&(Ba=a),(d instanceof THREE.ShaderMaterial||d instanceof THREE.MeshPhongMaterial||d.envMap)&&null!==w.cameraPosition&&(ga.setFromMatrixPosition(a.matrixWorld),v.uniform3f(w.cameraPosition,ga.x,ga.y,ga.z)),d instanceof THREE.MeshPhongMaterial||d instanceof THREE.MeshLambertMaterial||d instanceof THREE.ShaderMaterial||d.skinning)null!==w.viewMatrix&&v.uniformMatrix4fv(w.viewMatrix,!1,a.matrixWorldInverse.elements),
null!==w.viewMatrixInverse&&v.uniformMatrix4fv(w.viewMatrixInverse,!1,na.elements),w.mvpMatrix&&v.uniformMatrix4fv(w.mvpMatrix,!1,qa.elements),h?(D(l,d),I(l,!0)):I(l,!1);if(g){c&&d.fog&&(l.fogColor.value=c.color,c instanceof THREE.Fog?(l.fogNear.value=c.near,l.fogFar.value=c.far):c instanceof THREE.FogExp2&&(l.fogDensity.value=c.density));if(d instanceof THREE.MeshPhongMaterial||d instanceof THREE.MeshLambertMaterial||d.lights)ya&&(h=!0,J(b),ya=!1),h?(c=Oa,l.ambientLightColor.value=c.ambient,l.directionalLightColor.value=
c.directional.colors,l.directionalLightDirection.value=c.directional.positions,l.pointLightColor.value=c.point.colors,l.pointLightPosition.value=c.point.positions,l.pointLightDistance.value=c.point.distances,l.spotLightColor.value=c.spot.colors,l.spotLightPosition.value=c.spot.positions,l.spotLightDistance.value=c.spot.distances,l.spotLightDirection.value=c.spot.directions,l.spotLightAngleCos.value=c.spot.anglesCos,l.spotLightExponent.value=c.spot.exponents,l.hemisphereLightSkyColor.value=c.hemi.skyColors,
l.hemisphereLightGroundColor.value=c.hemi.groundColors,l.hemisphereLightDirection.value=c.hemi.positions,G(l,!0)):G(l,!1);if(d instanceof THREE.MeshBasicMaterial||d instanceof THREE.MeshLambertMaterial||d instanceof THREE.MeshPhongMaterial)A(l,d),D(l,d);d instanceof THREE.LineBasicMaterial?(l.diffuse.value=d.color,l.opacity.value=d.opacity):d instanceof THREE.LineDashedMaterial?(l.diffuse.value=d.color,l.opacity.value=d.opacity,l.dashSize.value=d.dashSize,l.totalSize.value=d.dashSize+d.gapSize,l.scale.value=
d.scale):d instanceof THREE.MeshPhongMaterial?(l.shininess.value=d.shininess,c=Math.log(Math.max(1+1E-10,d.shininess)),l.reflMipIndex.value=Math.max(0,-.72134752*c+5.5),l.emissive.value.copy(d.emissive),l.specular.value.copy(d.specular),d.wrapAround&&l.wrapRGB.value.copy(d.wrapRGB),l.exposureBias.value=d.exposureBias):d instanceof THREE.MeshLambertMaterial?(l.emissive.value.copy(d.emissive),d.wrapAround&&l.wrapRGB.value.copy(d.wrapRGB)):d instanceof THREE.MeshDepthMaterial?(l.mNear.value=a.near,l.mFar.value=
a.far,l.opacity.value=d.opacity):d instanceof THREE.MeshNormalMaterial&&(l.opacity.value=d.opacity);if(f.receiveShadow&&!d._shadowPass&&l.shadowMatrix)for(r=c=0,g=b.length;r<g;r++)h=b[r],h.castShadow&&(h instanceof THREE.SpotLight||h instanceof THREE.DirectionalLight&&!h.shadowCascade)&&(l.shadowMap.value[c]=h.shadowMap,l.shadowMapSize.value[c]=h.shadowMapSize,l.shadowMatrix.value[c]=h.shadowMatrix,l.shadowDarkness.value[c]=h.shadowDarkness,l.shadowBias.value[c]=h.shadowBias,c++);d.cutplanes&&0<d.cutplanes.length&&
(l.cutplanes.value=d.cutplanes,l.cutplanesOutlineColor&&d.cutplanesOutlineColor&&(l.cutplanesOutlineColor.value=d.cutplanesOutlineColor),l.cutplanesOutlineThickness&&d.cutplanesOutlineThickness&&(l.cutplanesOutlineThickness.value=d.cutplanesOutlineThickness));d.hatchParams&&l.hatchParams&&l.hatchParams.value.copy(d.hatchParams);b=d.uniformsList;d=0;for(c=b.length;d<c;d++)if(l=b[d][0],!1!==l.needsUpdate)switch(h=l.type,g=l.value,r=b[d][1],h){case "1i":v.uniform1i(r,g);break;case "1f":v.uniform1f(r,
g);break;case "2f":v.uniform2f(r,g[0],g[1]);break;case "3f":v.uniform3f(r,g[0],g[1],g[2]);break;case "4f":v.uniform4f(r,g[0],g[1],g[2],g[3]);break;case "1iv":v.uniform1iv(r,g);break;case "3iv":v.uniform3iv(r,g);break;case "1fv":v.uniform1fv(r,g);break;case "2fv":v.uniform2fv(r,g);break;case "3fv":v.uniform3fv(r,g);break;case "4fv":v.uniform4fv(r,g);break;case "Matrix3fv":v.uniformMatrix3fv(r,!1,g);break;case "Matrix4fv":v.uniformMatrix4fv(r,!1,g);break;case "i":v.uniform1i(r,g);break;case "f":v.uniform1f(r,
g);break;case "v2":v.uniform2f(r,g.x,g.y);break;case "v3":v.uniform3f(r,g.x,g.y,g.z);break;case "v4":v.uniform4f(r,g.x,g.y,g.z,g.w);break;case "c":v.uniform3f(r,g.r,g.g,g.b);break;case "iv1":v.uniform1iv(r,g);break;case "iv":v.uniform3iv(r,g);break;case "fv1":v.uniform1fv(r,g);break;case "fv":v.uniform3fv(r,g);break;case "v2v":void 0===l._array&&(l._array=new Float32Array(2*g.length));h=0;for(k=g.length;h<k;h++)m=2*h,l._array[m]=g[h].x,l._array[m+1]=g[h].y;v.uniform2fv(r,l._array);break;case "v3v":void 0===
l._array&&(l._array=new Float32Array(3*g.length));h=0;for(k=g.length;h<k;h++)m=3*h,l._array[m]=g[h].x,l._array[m+1]=g[h].y,l._array[m+2]=g[h].z;v.uniform3fv(r,l._array);break;case "v4v":void 0===l._array&&(l._array=new Float32Array(4*g.length));h=0;for(k=g.length;h<k;h++)m=4*h,l._array[m]=g[h].x,l._array[m+1]=g[h].y,l._array[m+2]=g[h].z,l._array[m+3]=g[h].w;v.uniform4fv(r,l._array);break;case "m3":v.uniformMatrix3fv(r,!1,g.elements);break;case "m3v":void 0===l._array&&(l._array=new Float32Array(9*
g.length));h=0;for(k=g.length;h<k;h++)g[h].flattenToArrayOffset(l._array,9*h);v.uniformMatrix3fv(r,!1,l._array);break;case "m4":v.uniformMatrix4fv(r,!1,g.elements);break;case "m4v":void 0===l._array&&(l._array=new Float32Array(16*g.length));h=0;for(k=g.length;h<k;h++)g[h].flattenToArrayOffset(l._array,16*h);v.uniformMatrix4fv(r,!1,l._array);break;case "t":m=g;g=H();v.uniform1i(r,g);if(!m)continue;if(m instanceof THREE.CubeTexture||m.image instanceof Array&&6===m.image.length){if(l=m,r=g,6===l.image.length)if(l.needsUpdate){l.image.__webglTextureCube||
(l.addEventListener("dispose",Ua),l.image.__webglTextureCube=v.createTexture(),la.info.memory.textures++);v.activeTexture(v.TEXTURE0+r);v.bindTexture(v.TEXTURE_CUBE_MAP,l.image.__webglTextureCube);v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,l.flipY);r=l instanceof THREE.CompressedTexture;g=l.image[0]instanceof THREE.DataTexture;h=[];for(k=0;6>k;k++)h[k]=!la.autoScaleCubemaps||r||g?g?l.image[k].image:l.image[k]:L(l.image[k],hb);k=h[0];m=THREE.Math.isPowerOfTwo(k.width)&&THREE.Math.isPowerOfTwo(k.height);n=
S(l.format);p=S(l.type);M(v.TEXTURE_CUBE_MAP,l,m);for(k=0;6>k;k++)if(r)for(var t=h[k].mipmaps,C=0,F=t.length;C<F;C++)q=t[C],l.format!==THREE.RGBAFormat&&l.format!==THREE.RGBFormat?-1<Qa().indexOf(n)?v.compressedTexImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+k,C,n,q.width,q.height,0,q.data):console.warn("Attempt to load unsupported compressed texture format"):v.texImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+k,C,n,q.width,q.height,0,n,p,q.data);else g?v.texImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+k,0,n,h[k].width,
h[k].height,0,n,p,h[k].data):v.texImage2D(v.TEXTURE_CUBE_MAP_POSITIVE_X+k,0,n,n,p,h[k]);l.generateMipmaps&&m&&v.generateMipmap(v.TEXTURE_CUBE_MAP);l.needsUpdate=!1;if(l.onUpdate)l.onUpdate()}else v.activeTexture(v.TEXTURE0+r),v.bindTexture(v.TEXTURE_CUBE_MAP,l.image.__webglTextureCube)}else m instanceof THREE.WebGLRenderTargetCube?(l=m,v.activeTexture(v.TEXTURE0+g),v.bindTexture(v.TEXTURE_CUBE_MAP,l.__webglTexture)):la.setTexture(m,g);break;case "tv":void 0===l._array&&(l._array=[]);h=0;for(k=l.value.length;h<
k;h++)l._array[h]=H();v.uniform1iv(r,l._array);h=0;for(k=l.value.length;h<k;h++)m=l.value[h],g=l._array[h],m&&la.setTexture(m,g);break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+h)}}aa.multiplyMatrices(a.matrixWorldInverse,f.matrixWorld);v.uniformMatrix4fv(w.modelViewMatrix,!1,aa.elements);w.normalMatrix&&(R.getNormalMatrix(aa),v.uniformMatrix3fv(w.normalMatrix,!1,R.elements));null!==w.modelMatrix&&v.uniformMatrix4fv(w.modelMatrix,!1,f.matrixWorld.elements);null!==w.dbId&&
(a=f.dbId||f.fragId||0,v.uniform4f(w.dbId,(a&255)/255,(a>>8&255)/255,(a>>16&255)/255,(a>>24&255)/255));return z}function A(a,b){function c(a,b,d){var f=d.offset,g=d.repeat;b?(a=b.value,d.matrix?a.copy(d.matrix):a.identity(),a.elements[6]+=f.x,a.elements[7]+=f.y,a.elements[0]*=g.x,a.elements[3]*=g.x,a.elements[1]*=g.y,a.elements[4]*=g.y):a.offsetRepeat.value.set(f.x,f.y,g.x,g.y)}a.opacity.value=b.opacity;a.diffuse.value.copy(b.color);a.map.value=b.map;a.lightMap.value=b.lightMap;a.specularMap.value=
b.specularMap;a.alphaMap.value=b.alphaMap;b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale);b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale));b.alphaMap&&c(a,a.texMatrixAlpha,b.alphaMap);var d;b.normalMap?d=b.normalMap:b.bumpMap&&(d=b.bumpMap);void 0!==d&&c(a,a.texMatrixBump,d);var f;b.map?f=b.map:b.specularMap&&(f=b.specularMap);void 0!==f&&c(a,a.texMatrix,f);a.envMap.value=b.envMap;a.irradianceMap&&(a.irradianceMap.value=b.irradianceMap);a.reflectivity.value=
b.reflectivity;a.refractionRatio.value=b.refractionRatio}function D(a,b){a.envMap&&(a.envMap.value=b.envMap);a.irradianceMap&&(a.irradianceMap.value=b.irradianceMap);a.envMapExposure&&(a.envMapExposure.value=b.envMapExposure)}function I(a,b){a.envMap&&(a.envMap.needsUpdate=b);a.irradianceMap&&(a.irradianceMap.needsUpdate=b);a.envMapExposure&&(a.envMapExposure.needsUpdate=b)}function G(a,b){a.ambientLightColor.needsUpdate=b;a.directionalLightColor.needsUpdate=b;a.directionalLightDirection.needsUpdate=
b;a.pointLightColor.needsUpdate=b;a.pointLightPosition.needsUpdate=b;a.pointLightDistance.needsUpdate=b;a.spotLightColor.needsUpdate=b;a.spotLightPosition.needsUpdate=b;a.spotLightDistance.needsUpdate=b;a.spotLightDirection.needsUpdate=b;a.spotLightAngleCos.needsUpdate=b;a.spotLightExponent.needsUpdate=b;a.hemisphereLightSkyColor.needsUpdate=b;a.hemisphereLightGroundColor.needsUpdate=b;a.hemisphereLightDirection.needsUpdate=b}function H(){var a=Ja;a>=Za&&console.warn("WebGLRenderer: trying to use "+
a+" texture units while this GPU supports only "+Za);Ja+=1;return a}function K(a,b,c,d){a[b]=c.r*d;a[b+1]=c.g*d;a[b+2]=c.b*d}function J(a){var b,c,d,f=0,g=0,h=0,k,l,m,n=Oa,q=n.directional.colors,p=n.directional.positions,M=n.point.colors,r=n.point.positions,t=n.point.distances,z=n.spot.colors,w=n.spot.positions,C=n.spot.distances,F=n.spot.directions,L=n.spot.anglesCos,aa=n.spot.exponents,ia=n.hemi.skyColors,A=n.hemi.groundColors,v=n.hemi.positions,ba=0,D=0,R=0,B=0,E=0,I=0,pa=0,P=0,ha=d=0;b=m=ha=0;
for(c=a.length;b<c;b++)d=a[b],d.onlyShadow||(k=d.color,l=d.intensity,m=d.distance,d instanceof THREE.AmbientLight?d.visible&&(f+=k.r,g+=k.g,h+=k.b):d instanceof THREE.DirectionalLight?(E+=1,d.visible&&(ma.setFromMatrixPosition(d.matrixWorld),ga.setFromMatrixPosition(d.target.matrixWorld),ma.sub(ga),ma.normalize(),d=3*ba,p[d]=ma.x,p[d+1]=ma.y,p[d+2]=ma.z,K(q,d,k,l),ba+=1)):d instanceof THREE.PointLight?(I+=1,d.visible&&(ha=3*D,K(M,ha,k,l),ga.setFromMatrixPosition(d.matrixWorld),r[ha]=ga.x,r[ha+1]=
ga.y,r[ha+2]=ga.z,t[D]=m,D+=1)):d instanceof THREE.SpotLight?(pa+=1,d.visible&&(ha=3*R,K(z,ha,k,l),ga.setFromMatrixPosition(d.matrixWorld),w[ha]=ga.x,w[ha+1]=ga.y,w[ha+2]=ga.z,C[R]=m,ma.copy(ga),ga.setFromMatrixPosition(d.target.matrixWorld),ma.sub(ga),ma.normalize(),F[ha]=ma.x,F[ha+1]=ma.y,F[ha+2]=ma.z,L[R]=Math.cos(d.angle),aa[R]=d.exponent,R+=1)):d instanceof THREE.HemisphereLight&&(P+=1,d.visible&&(ma.setFromMatrixPosition(d.matrixWorld),ma.normalize(),m=3*B,v[m]=ma.x,v[m+1]=ma.y,v[m+2]=ma.z,
k=d.color,d=d.groundColor,K(ia,m,k,l),K(A,m,d,l),B+=1)));b=3*ba;for(c=Math.max(q.length,3*E);b<c;b++)q[b]=0;b=3*D;for(c=Math.max(M.length,3*I);b<c;b++)M[b]=0;b=3*R;for(c=Math.max(z.length,3*pa);b<c;b++)z[b]=0;b=3*B;for(c=Math.max(ia.length,3*P);b<c;b++)ia[b]=0;b=3*B;for(c=Math.max(A.length,3*P);b<c;b++)A[b]=0;n.directional.length=ba;n.point.length=D;n.spot.length=R;n.hemi.length=B;n.ambient[0]=f;n.ambient[1]=g;n.ambient[2]=h}function M(a,b,c){c?(v.texParameteri(a,v.TEXTURE_WRAP_S,S(b.wrapS)),v.texParameteri(a,
v.TEXTURE_WRAP_T,S(b.wrapT)),v.texParameteri(a,v.TEXTURE_MAG_FILTER,S(b.magFilter)),v.texParameteri(a,v.TEXTURE_MIN_FILTER,S(b.minFilter))):(v.texParameteri(a,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(a,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),b.wrapS===THREE.ClampToEdgeWrapping&&b.wrapT===THREE.ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+b.sourceFile+" )"),v.texParameteri(a,v.TEXTURE_MAG_FILTER,
P(b.magFilter)),v.texParameteri(a,v.TEXTURE_MIN_FILTER,P(b.minFilter)),b.minFilter!==THREE.NearestFilter&&b.minFilter!==THREE.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+b.sourceFile+" )"));(c=ja.get("EXT_texture_filter_anisotropic"))&&b.type!==THREE.FloatType&&b.type!==THREE.HalfFloatType&&(1<b.anisotropy||b.__oldAnisotropy)&&(v.texParameterf(a,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(b.anisotropy,
la.getMaxAnisotropy())),b.__oldAnisotropy=b.anisotropy)}function L(a,b){if(a.width<=b&&a.height<=b)return a;var c=Math.max(a.width,a.height),d=Math.floor(a.width*b/c),c=Math.floor(a.height*b/c),f=document.createElement("canvas");f.width=d;f.height=c;f.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,d,c);return f}function P(a){return a===THREE.NearestFilter||a===THREE.NearestMipMapNearestFilter||a===THREE.NearestMipMapLinearFilter?v.NEAREST:v.LINEAR}function S(a){var b;if(a===THREE.RepeatWrapping)return v.REPEAT;
if(a===THREE.ClampToEdgeWrapping)return v.CLAMP_TO_EDGE;if(a===THREE.MirroredRepeatWrapping)return v.MIRRORED_REPEAT;if(a===THREE.NearestFilter)return v.NEAREST;if(a===THREE.NearestMipMapNearestFilter)return v.NEAREST_MIPMAP_NEAREST;if(a===THREE.NearestMipMapLinearFilter)return v.NEAREST_MIPMAP_LINEAR;if(a===THREE.LinearFilter)return v.LINEAR;if(a===THREE.LinearMipMapNearestFilter)return v.LINEAR_MIPMAP_NEAREST;if(a===THREE.LinearMipMapLinearFilter)return v.LINEAR_MIPMAP_LINEAR;if(a===THREE.UnsignedByteType)return v.UNSIGNED_BYTE;
if(a===THREE.UnsignedShort4444Type)return v.UNSIGNED_SHORT_4_4_4_4;if(a===THREE.UnsignedShort5551Type)return v.UNSIGNED_SHORT_5_5_5_1;if(a===THREE.UnsignedShort565Type)return v.UNSIGNED_SHORT_5_6_5;if(a===THREE.ByteType)return v.BYTE;if(a===THREE.ShortType)return v.SHORT;if(a===THREE.UnsignedShortType)return v.UNSIGNED_SHORT;if(a===THREE.IntType)return v.INT;if(a===THREE.UnsignedIntType)return v.UNSIGNED_INT;if(a===THREE.FloatType)return v.FLOAT;if(a===THREE.HalfFloatType)return 36193;if(a===THREE.AlphaFormat)return v.ALPHA;
if(a===THREE.RGBFormat)return v.RGB;if(a===THREE.RGBAFormat)return v.RGBA;if(a===THREE.LuminanceFormat)return v.LUMINANCE;if(a===THREE.LuminanceAlphaFormat)return v.LUMINANCE_ALPHA;if(a===THREE.AddEquation)return v.FUNC_ADD;if(a===THREE.SubtractEquation)return v.FUNC_SUBTRACT;if(a===THREE.ReverseSubtractEquation)return v.FUNC_REVERSE_SUBTRACT;if(a===THREE.ZeroFactor)return v.ZERO;if(a===THREE.OneFactor)return v.ONE;if(a===THREE.SrcColorFactor)return v.SRC_COLOR;if(a===THREE.OneMinusSrcColorFactor)return v.ONE_MINUS_SRC_COLOR;
if(a===THREE.SrcAlphaFactor)return v.SRC_ALPHA;if(a===THREE.OneMinusSrcAlphaFactor)return v.ONE_MINUS_SRC_ALPHA;if(a===THREE.DstAlphaFactor)return v.DST_ALPHA;if(a===THREE.OneMinusDstAlphaFactor)return v.ONE_MINUS_DST_ALPHA;if(a===THREE.DstColorFactor)return v.DST_COLOR;if(a===THREE.OneMinusDstColorFactor)return v.ONE_MINUS_DST_COLOR;if(a===THREE.SrcAlphaSaturateFactor)return v.SRC_ALPHA_SATURATE;b=ja.get("WEBGL_compressed_texture_s3tc");if(null!==b){if(a===THREE.RGB_S3TC_DXT1_Format)return b.COMPRESSED_RGB_S3TC_DXT1_EXT;
if(a===THREE.RGBA_S3TC_DXT1_Format)return b.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT3_Format)return b.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===THREE.RGBA_S3TC_DXT5_Format)return b.COMPRESSED_RGBA_S3TC_DXT5_EXT}b=ja.get("WEBGL_compressed_texture_pvrtc");if(null!==b){if(a===THREE.RGB_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===THREE.RGB_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===THREE.RGBA_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;
if(a===THREE.RGBA_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}b=ja.get("EXT_blend_minmax");if(null!==b){if(a===THREE.MinEquation)return b.MIN_EXT;if(a===THREE.MaxEquation)return b.MAX_EXT}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION);a=a||{};var Y=void 0!==a.canvas?a.canvas:document.createElement("canvas"),U=window.devicePixelRatio||1,Z=void 0!==a.precision?a.precision:"highp",da=void 0!==a.alpha?a.alpha:!1,V=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,O=void 0!==
a.antialias?a.antialias:!1,ca=void 0!==a.stencil?a.stencil:!0,W=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!0,N=void 0!==a.logarithmicDepthBuffer?a.logarithmicDepthBuffer:!1,ea=new THREE.Color(0),ba=0,fa=[],X={},ia=[],aa=new THREE.Matrix4,R=new THREE.Matrix3,pa=[],ha=[];this.domElement=Y;this.context=null;this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0;this.shadowMapEnabled=this.gammaOutput=this.gammaInput=!1;this.shadowMapAutoUpdate=
!0;this.shadowMapType=THREE.PCFShadowMap;this.shadowMapCullFace=THREE.CullFaceFront;this.shadowMapCascade=this.shadowMapDebug=!1;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=!0;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var la=this,za=[],Na=null,sa=null,va=-1,Ba=null,xa="";new THREE.Frustum;new THREE.Matrix4;new THREE.Matrix4;var Ja=0,Ha=0,Ga=0,Ca=Y.width,Ea=Y.height,Ma={},oa=new THREE.Frustum,qa=new THREE.Matrix4,na=
new THREE.Matrix4,ga=new THREE.Vector3,ma=new THREE.Vector3,ya=!0,Oa={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},v,Ia,Da,Aa;try{var bb={alpha:da,premultipliedAlpha:V,antialias:O,stencil:ca,preserveDrawingBuffer:W};v=Y.getContext("webgl",bb)||Y.getContext("experimental-webgl",bb);
if(null===v){if(null!==Y.getContext("webgl"))throw"Error creating WebGL context with your selected attributes.";throw"Error creating WebGL context.";}Y.addEventListener("webglcontextlost",function(a){a.preventDefault();db();cb();X={}},!1)}catch(Ya){console.error(Ya)}var ka=new THREE.WebGLState(v,S);void 0===v.getShaderPrecisionFormat&&(v.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var ja=new THREE.WebGLExtensions(v);ja.get("OES_texture_float");ja.get("OES_texture_float_linear");
ja.get("OES_texture_half_float");ja.get("OES_texture_half_float_linear");ja.get("OES_standard_derivatives");ja.get("EXT_shader_texture_lod");ja.get("EXT_texture_filter_anisotropic");ja.get("WEBGL_compressed_texture_s3tc");Ia=ja.get("WEBGL_draw_buffers");Da=null;Aa=ja.get("OES_vertex_array_object");N&&ja.get("EXT_frag_depth");var Wa=function(a,b,c,d){!0===V&&(a*=d,b*=d,c*=d);v.clearColor(a,b,c,d)},cb=function(){v.clearColor(0,0,0,1);v.clearDepth(1);v.clearStencil(0);v.enable(v.DEPTH_TEST);v.depthFunc(v.LEQUAL);
v.frontFace(v.CCW);v.cullFace(v.BACK);v.enable(v.CULL_FACE);v.enable(v.BLEND);v.blendEquation(v.FUNC_ADD);v.blendFunc(v.SRC_ALPHA,v.ONE_MINUS_SRC_ALPHA);v.viewport(Ha,Ga,Ca,Ea);Wa(ea.r,ea.g,ea.b,ba)},db=function(){Ba=Na=null;xa="";va=-1;ya=!0;ka.reset()};cb();this.context=v;this.state=ka;var Za=v.getParameter(v.MAX_TEXTURE_IMAGE_UNITS),Xa=v.getParameter(v.MAX_VERTEX_TEXTURE_IMAGE_UNITS),ob=v.getParameter(v.MAX_TEXTURE_SIZE),hb=v.getParameter(v.MAX_CUBE_MAP_TEXTURE_SIZE),$a=0<Xa;$a&&ja.get("OES_texture_float");
var eb=v.getShaderPrecisionFormat(v.VERTEX_SHADER,v.HIGH_FLOAT),nb=v.getShaderPrecisionFormat(v.VERTEX_SHADER,v.MEDIUM_FLOAT);v.getShaderPrecisionFormat(v.VERTEX_SHADER,v.LOW_FLOAT);var fb=v.getShaderPrecisionFormat(v.FRAGMENT_SHADER,v.HIGH_FLOAT),ib=v.getShaderPrecisionFormat(v.FRAGMENT_SHADER,v.MEDIUM_FLOAT);v.getShaderPrecisionFormat(v.FRAGMENT_SHADER,v.LOW_FLOAT);var Qa=function(){var a;return function(){if(void 0!==a)return a;a=[];if(ja.get("WEBGL_compressed_texture_pvrtc")||ja.get("WEBGL_compressed_texture_s3tc"))for(var b=
v.getParameter(v.COMPRESSED_TEXTURE_FORMATS),c=0;c<b.length;c++)a.push(b[c]);return a}}(),Ta=0<eb.precision&&0<fb.precision,Ka=0<nb.precision&&0<ib.precision;"highp"!==Z||Ta||(Ka?(Z="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(Z="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp")));"mediump"!==Z||Ka||(Z="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp"));this.getContext=function(){return v};this.forceContextLoss=function(){ja.get("WEBGL_lose_context").loseContext()};
this.supportsVertexTextures=function(){return $a};this.supportsFloatTextures=function(){return ja.get("OES_texture_float")};this.supportsHalfFloatTextures=function(){return ja.get("OES_texture_half_float_linear")};this.supportsStandardDerivatives=function(){return ja.get("OES_standard_derivatives")};this.supportsCompressedTextureS3TC=function(){return ja.get("WEBGL_compressed_texture_s3tc")};this.supportsMRT=function(){return Ia};this.supportsBlendMinMax=function(){return ja.get("EXT_blend_minmax")};
this.getMaxAnisotropy=function(){var a;return function(){if(void 0!==a)return a;var b=ja.get("EXT_texture_filter_anisotropic");return a=null!==b?v.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}();this.getPrecision=function(){return Z};this.getPixelRatio=function(){return U};this.setPixelRatio=function(a){U=a};this.setSize=function(a,b,c){Y.width=a*U;Y.height=b*U;!1!==c&&(Y.style.width=a+"px",Y.style.height=b+"px");this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){Ha=a*U;Ga=b*U;Ca=
c*U;Ea=d*U;v.viewport(Ha,Ga,Ca,Ea)};this.setScissor=function(a,b,c,d){v.scissor(a*U,b*U,c*U,d*U)};this.enableScissorTest=function(a){a?v.enable(v.SCISSOR_TEST):v.disable(v.SCISSOR_TEST)};this.getClearColor=function(){return ea};this.setClearColor=function(a,b){ea.set(a);ba=void 0!==b?b:1;Wa(ea.r,ea.g,ea.b,ba)};this.getClearAlpha=function(){return ba};this.setClearAlpha=function(a){ba=a;Wa(ea.r,ea.g,ea.b,ba)};this.clear=function(a,b,c){var d=0;if(void 0===a||a)d|=v.COLOR_BUFFER_BIT;if(void 0===b||
b)d|=v.DEPTH_BUFFER_BIT;if(void 0===c||c)d|=v.STENCIL_BUFFER_BIT;v.clear(d)};this.clearColor=function(){v.clear(v.COLOR_BUFFER_BIT)};this.clearDepth=function(){v.clear(v.DEPTH_BUFFER_BIT)};this.clearStencil=function(){v.clear(v.STENCIL_BUFFER_BIT)};this.clearTarget=function(a,b,c,d){this.setRenderTarget(a);this.clear(b,c,d)};this.resetGLState=db;this.updateShadowMap=function(a,b){Na=null;_oldDepthWrite=_oldDepthTest=_oldBlending=-1;xa="";va=-1;ya=!0;_oldFlipSided=_oldDoubleSided=-1;initObjects(a)};
var Sa=function(a){a.target.traverse(function(a){a.removeEventListener("remove",Sa);if(a instanceof THREE.Mesh||a instanceof THREE.PointCloud||a instanceof THREE.Line)delete X[a.id];else if(a instanceof THREE.ImmediateRenderObject||a.immediateRenderCallback)for(var b=ia,c=b.length-1;0<=c;c--)b[c].object===a&&b.splice(c,1);delete a.__webglInit;delete a.__webglActive})},Pa=function(a){a=a.target;a.removeEventListener("dispose",Pa);wb(a)},Ua=function(a){a=a.target;a.removeEventListener("dispose",Ua);
a.image&&a.image.__webglTextureCube?v.deleteTexture(a.image.__webglTextureCube):a.__webglInit&&(a.__webglInit=!1,v.deleteTexture(a.__webglTexture));la.info.memory.textures--},kb=function(a){a=a.target;a.removeEventListener("dispose",kb);a&&a.__webglTexture&&(v.deleteTexture(a.__webglTexture),v.deleteFramebuffer(a.__webglFramebuffer),v.deleteRenderbuffer(a.__webglRenderbuffer));la.info.memory.textures--},ub=function(a){a=a.target;a.removeEventListener("dispose",ub);xb(a)},vb=function(a){void 0!==a.__webglVertexBuffer&&
v.deleteBuffer(a.__webglVertexBuffer);void 0!==a.__webglNormalBuffer&&v.deleteBuffer(a.__webglNormalBuffer);void 0!==a.__webglTangentBuffer&&v.deleteBuffer(a.__webglTangentBuffer);void 0!==a.__webglColorBuffer&&v.deleteBuffer(a.__webglColorBuffer);void 0!==a.__webglUVBuffer&&v.deleteBuffer(a.__webglUVBuffer);void 0!==a.__webglUV2Buffer&&v.deleteBuffer(a.__webglUV2Buffer);void 0!==a.__webglSkinIndicesBuffer&&v.deleteBuffer(a.__webglSkinIndicesBuffer);void 0!==a.__webglSkinWeightsBuffer&&v.deleteBuffer(a.__webglSkinWeightsBuffer);
void 0!==a.__webglFaceBuffer&&v.deleteBuffer(a.__webglFaceBuffer);void 0!==a.__webglLineBuffer&&v.deleteBuffer(a.__webglLineBuffer);void 0!==a.__webglLineDistanceBuffer&&v.deleteBuffer(a.__webglLineDistanceBuffer);if(void 0!==a.__webglCustomAttributesList)for(var b in a.__webglCustomAttributesList)v.deleteBuffer(a.__webglCustomAttributesList[b].buffer);la.info.memory.geometries--},wb=function(a){a.__webglInit=void 0;if(a instanceof THREE.BufferGeometry){void 0!==a.vbbuffer&&v.deleteBuffer(a.vbbuffer);
void 0!==a.ibbuffer&&v.deleteBuffer(a.ibbuffer);if(a.vaos)for(var b=0;b<a.vaos.length;b++)Aa.deleteVertexArrayOES(a.vaos[b].vao);a=a.attributes;for(var c in a)void 0!==a[c].buffer&&v.deleteBuffer(a[c].buffer);la.info.memory.geometries--}else if(c=gb[a.id],void 0!==c){for(var b=0,d=c.length;b<d;b++){var f=c[b];if(void 0!==f.numMorphTargets){for(var g=0,h=f.numMorphTargets;g<h;g++)v.deleteBuffer(f.__webglMorphTargetsBuffers[g]);delete f.__webglMorphTargetsBuffers}if(void 0!==f.numMorphNormals){g=0;
for(h=f.numMorphNormals;g<h;g++)v.deleteBuffer(f.__webglMorphNormalsBuffers[g]);delete f.__webglMorphNormalsBuffers}vb(f)}delete gb[a.id]}else vb(a)};this.deallocateGeometry=wb;var xb=function(a){var b=a.program.program;if(void 0!==b){a.program=void 0;var c,d,f=!1;a=0;for(c=za.length;a<c;a++)if(d=za[a],d.program===b){d.usedTimes--;0===d.usedTimes&&(f=!0);break}if(!0===f){f=[];a=0;for(c=za.length;a<c;a++)d=za[a],d.program!==b&&f.push(d);za=f;v.deleteProgram(b);la.info.memory.programs--}}};this.renderBufferDirect=
function(a,b,c,f,g,k){if(!1!==f.visible){z(k);c=E(a,b,c,f,k);a=c.attributes;var l=g.attributes;b=!1;c="direct_"+g.id+"_"+c.id+"_"+(f.wireframe?1:0);c!==xa&&(xa=c,b=!0);a:{var m=g.vaos;if(m)for(var n=0;n<m.length;n++)if(m[n].geomhash===c){Aa.bindVertexArrayOES(m[n].vao);c=!0;break a}c=null===m?!1:d(c,f,a,g)}(b=b&&!c)&&ka.initAttributes();if(k instanceof THREE.Mesh)if(k=l.index){n=k.array?k.array:g.ib;n instanceof Uint32Array&&ja.get("OES_element_index_uint")?(l=v.UNSIGNED_INT,m=4):(l=v.UNSIGNED_SHORT,
m=2);var q=g.offsets;q&&1<q.length&&(b=!0);var p=0;do{var M,r,t;q&&q.length?(M=q[p].index,r=q[p].start,t=q[p].count):(r=M=0,t=n.length);b&&h(f,a,g,M,k);g.numInstances?Da.drawElementsInstancedANGLE(g.isLines?v.LINES:v.TRIANGLES,t,l,r*m,g.numInstances):v.drawElements(g.isLines?v.LINES:v.TRIANGLES,t,l,r*m)}while(q&&++p<q.length)}else b&&h(f,a,g,M),f=g.attributes.position,g.numInstances?Da.drawArraysInstancedANGLE(g.isLines?v.LINE_STRIP:v.TRIANGLES,0,f.array.length/3,g.numInstances):v.drawArrays(g.isLines?
v.LINE_STRIP:v.TRIANGLES,0,f.array.length/f.itemSize);else console.log("Only THREE.Mesh can be rendered by the Firefly renderer. Use THREE.Mesh to draw lines.");c&&Aa.bindVertexArrayOES(null)}};this.renderBuffer=function(a,b,c,d,f,g){if(!1!==d.visible){z(g);c=E(a,b,c,d,g);b=c.attributes;a=!1;c=f.id+"_"+c.id+"_"+(d.wireframe?1:0);c!==xa&&(xa=c,a=!0);a&&ka.initAttributes();!d.morphTargets&&0<=b.position&&a&&(v.bindBuffer(v.ARRAY_BUFFER,f.__webglVertexBuffer),ka.enableAttribute(b.position),v.vertexAttribPointer(b.position,
3,v.FLOAT,!1,0,0));if(a){if(f.__webglCustomAttributesList){c=0;for(var h=f.__webglCustomAttributesList.length;c<h;c++){var k=f.__webglCustomAttributesList[c];0<=b[k.buffer.belongsToAttribute]&&(v.bindBuffer(v.ARRAY_BUFFER,k.buffer),ka.enableAttribute(b[k.buffer.belongsToAttribute]),v.vertexAttribPointer(b[k.buffer.belongsToAttribute],k.size,v.FLOAT,!1,0,0))}}0<=b.color&&(0<g.geometry.colors.length||0<g.geometry.faces.length?(v.bindBuffer(v.ARRAY_BUFFER,f.__webglColorBuffer),ka.enableAttribute(b.color),
v.vertexAttribPointer(b.color,3,v.FLOAT,!1,0,0)):d.defaultAttributeValues&&v.vertexAttrib3fv(b.color,d.defaultAttributeValues.color));0<=b.normal&&(v.bindBuffer(v.ARRAY_BUFFER,f.__webglNormalBuffer),ka.enableAttribute(b.normal),v.vertexAttribPointer(b.normal,3,v.FLOAT,!1,0,0));0<=b.tangent&&(v.bindBuffer(v.ARRAY_BUFFER,f.__webglTangentBuffer),ka.enableAttribute(b.tangent),v.vertexAttribPointer(b.tangent,4,v.FLOAT,!1,0,0));0<=b.uv&&(g.geometry.faceVertexUvs[0]?(v.bindBuffer(v.ARRAY_BUFFER,f.__webglUVBuffer),
ka.enableAttribute(b.uv),v.vertexAttribPointer(b.uv,2,v.FLOAT,!1,0,0)):d.defaultAttributeValues&&v.vertexAttrib2fv(b.uv,d.defaultAttributeValues.uv));0<=b.uv2&&(g.geometry.faceVertexUvs[1]?(v.bindBuffer(v.ARRAY_BUFFER,f.__webglUV2Buffer),ka.enableAttribute(b.uv2),v.vertexAttribPointer(b.uv2,2,v.FLOAT,!1,0,0)):d.defaultAttributeValues&&v.vertexAttrib2fv(b.uv2,d.defaultAttributeValues.uv2));0<=b.lineDistance&&(v.bindBuffer(v.ARRAY_BUFFER,f.__webglLineDistanceBuffer),ka.enableAttribute(b.lineDistance),
v.vertexAttribPointer(b.lineDistance,1,v.FLOAT,!1,0,0))}ka.disableUnusedAttributes();g instanceof THREE.Mesh?(g=f.__typeArray===Uint32Array?v.UNSIGNED_INT:v.UNSIGNED_SHORT,d.wireframe?(ka.setLineWidth(d.wireframeLinewidth*U),a&&v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,f.__webglLineBuffer),v.drawElements(v.LINES,f.__webglLineCount,g,0)):(a&&v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,f.__webglFaceBuffer),v.drawElements(v.TRIANGLES,f.__webglFaceCount,g,0))):g instanceof THREE.Line&&(g=g.mode===THREE.LineStrip?v.LINE_STRIP:
v.LINES,ka.setLineWidth(d.linewidth*U),v.drawArrays(g,0,f.__webglLineCount))}};this.render=function(a,b,c,d,f){if(!1===b instanceof THREE.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{xa="";va=-1;Ba=null;void 0!==f&&(fa.length=0,ya=!0);var g=a.fog;!0===a.autoUpdate&&a.updateMatrixWorld();void 0===b.parent&&b.updateMatrixWorld();b.matrixWorldInverse.getInverse(b.matrixWorld);b.worldUpTransform?na.multiplyMatrices(b.worldUpTransform,b.matrixWorld):
na.copy(b.matrixWorld);qa.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse);oa.setFromMatrix(qa);var h=a instanceof RenderBatch&&a.renderImmediate;h||(pa.length=0,ha.length=0,m(a,!0===la.sortObjects,!0===a.forceVisible),!0===la.sortObjects&&(pa.sort(l),ha.sort(k)));ya&&(f&&f.length&&(fa=f.slice()),J(fa));this.resetGLState();this.setRenderTarget(c);(this.autoClear||d)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);if(a.overrideMaterial){var n=a.overrideMaterial;
w(n);h?(d=fa,lb=b,mb=d,Va=n||null,a.forEach(t,a.forceVisible?1:128,!1)):(p(pa,b,fa,g,n),p(ha,b,fa,g,n))}else h?(d=fa,lb=b,mb=d,Va=n||null,a.forEach(t,a.forceVisible?1:128,!1)):(ka.setBlending(THREE.NoBlending),p(pa,b,fa,g,null),p(ha,b,fa,g,null));this.resetGLState();c&&c.generateMipmaps&&c.minFilter!==THREE.NearestFilter&&c.minFilter!==THREE.LinearFilter&&(v.bindTexture(v.TEXTURE_2D,c.__webglTexture),v.generateMipmap(v.TEXTURE_2D),v.bindTexture(v.TEXTURE_2D,null));ka.setDepthTest(!0);ka.setDepthWrite(!0)}};
var lb,mb,zb,Va,gb={},yb=0,Ab={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"firefly_phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointCloudMaterial:"particle_basic"};this.setFaceCulling=function(a,b){a===THREE.CullFaceNone?v.disable(v.CULL_FACE):(b===THREE.FrontFaceDirectionCW?v.frontFace(v.CW):v.frontFace(v.CCW),a===THREE.CullFaceBack?v.cullFace(v.BACK):a===THREE.CullFaceFront?v.cullFace(v.FRONT):
v.cullFace(v.FRONT_AND_BACK),v.enable(v.CULL_FACE))};this.setMaterialFaces=function(a){ka.setDoubleSided(a.side===THREE.DoubleSide);ka.setFlipSided(a.side===THREE.BackSide)};this.uploadTexture=function(a){void 0===a.__webglInit&&(a.__webglInit=!0,a.addEventListener("dispose",Ua),a.__webglTexture=v.createTexture(),la.info.memory.textures++);v.bindTexture(v.TEXTURE_2D,a.__webglTexture);v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,a.flipY);v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha);v.pixelStorei(v.UNPACK_ALIGNMENT,
a.unpackAlignment);a.image=L(a.image,ob);var b=a.image,c=THREE.Math.isPowerOfTwo(b.width)&&THREE.Math.isPowerOfTwo(b.height),d=S(a.format),f=S(a.type);M(v.TEXTURE_2D,a,c);var g=a.mipmaps;if(a instanceof THREE.DataTexture)if(0<g.length&&c){for(var h=0,k=g.length;h<k;h++)b=g[h],v.texImage2D(v.TEXTURE_2D,h,d,b.width,b.height,0,d,f,b.data);a.generateMipmaps=!1}else v.texImage2D(v.TEXTURE_2D,0,d,b.width,b.height,0,d,f,b.data);else if(a instanceof THREE.CompressedTexture)for(h=0,k=g.length;h<k;h++)b=g[h],
a.format!==THREE.RGBAFormat&&a.format!==THREE.RGBFormat?-1<Qa().indexOf(d)?v.compressedTexImage2D(v.TEXTURE_2D,h,d,b.width,b.height,0,b.data):console.warn("Attempt to load unsupported compressed texture format"):v.texImage2D(v.TEXTURE_2D,h,d,b.width,b.height,0,d,f,b.data);else if(0<g.length&&c){h=0;for(k=g.length;h<k;h++)b=g[h],v.texImage2D(v.TEXTURE_2D,h,d,d,f,b);a.generateMipmaps=!1}else v.texImage2D(v.TEXTURE_2D,0,d,d,f,a.image);a.generateMipmaps&&c&&v.generateMipmap(v.TEXTURE_2D);a.needsUpdate=
!1;if(a.onUpdate)a.onUpdate()};this.setTexture=function(a,b){v.activeTexture(v.TEXTURE0+b);a.needsUpdate?la.uploadTexture(a):v.bindTexture(v.TEXTURE_2D,a.__webglTexture)};this.initFrameBufferMRT=function(a,b){var c=a[0],d=!1;if(c&&!c.__webglFramebuffer){void 0===c.depthBuffer&&(c.depthBuffer=!0);void 0===c.stencilBuffer&&(c.stencilBuffer=!0);c.__webglFramebuffer=v.createFramebuffer();v.bindFramebuffer(v.FRAMEBUFFER,c.__webglFramebuffer);var f;c.shareDepthFrom?f=c.__webglRenderbuffer=c.shareDepthFrom.__webglRenderbuffer:
c.depthBuffer&&!c.stencilBuffer?(f=c.__webglRenderbuffer=v.createRenderbuffer(),v.bindRenderbuffer(v.RENDERBUFFER,f),v.renderbufferStorage(v.RENDERBUFFER,v.DEPTH_COMPONENT16,c.width,c.height)):c.depthBuffer&&c.stencilBuffer&&(f=c.__webglRenderbuffer=v.createRenderbuffer(),v.bindRenderbuffer(v.RENDERBUFFER,f),v.renderbufferStorage(v.RENDERBUFFER,v.DEPTH_STENCIL,c.width,c.height));c.depthBuffer&&!c.stencilBuffer?v.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_ATTACHMENT,v.RENDERBUFFER,f):c.depthBuffer&&
c.stencilBuffer&&v.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_STENCIL_ATTACHMENT,v.RENDERBUFFER,f);d=!0}f=sa;v.bindFramebuffer(v.FRAMEBUFFER,c.__webglFramebuffer);for(var g=0;g<a.length;g++){var h=a[g];if(!h.__webglTexture){var k=THREE.Math.isPowerOfTwo(h.width)&&THREE.Math.isPowerOfTwo(h.height),l=S(h.format),m=S(h.type);h.addEventListener("dispose",kb);h.__webglTexture=v.createTexture();la.info.memory.textures++;v.bindTexture(v.TEXTURE_2D,h.__webglTexture);M(v.TEXTURE_2D,h,k);v.texImage2D(v.TEXTURE_2D,
0,l,h.width,h.height,0,l,m,null);k&&h.generateMipmaps&&v.generateMipmap(v.TEXTURE_2D)}v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0+g,v.TEXTURE_2D,h.__webglTexture,0)}if(Ia){h=[Ia.COLOR_ATTACHMENT0_WEBGL];for(g=1;g<a.length;g++)h.push(Ia.COLOR_ATTACHMENT0_WEBGL+g);Ia.drawBuffersWEBGL(h)}b&&(g=v.checkFramebufferStatus(v.FRAMEBUFFER),g!==v.FRAMEBUFFER_COMPLETE&&(console.log("Can't use multiple render targets. Falling back to two passes. "+g),delete c.__webglFramebuffer,b=!1));v.bindFramebuffer(v.FRAMEBUFFER,
f);d&&(v.bindTexture(v.TEXTURE_2D,null),v.bindRenderbuffer(v.RENDERBUFFER,null),v.bindFramebuffer(v.FRAMEBUFFER,null));return b};this.setRenderTarget=function(a){var b;Array.isArray(a)?(this.initFrameBufferMRT(a),b=a[0]):a&&(this.initFrameBufferMRT([a]),b=a);var c,d,f;b?(a=b.__webglFramebuffer,c=b.width,b=b.height,f=d=0):(a=null,c=Ca,b=Ea,d=Ha,f=Ga);a!==sa&&(v.bindFramebuffer(v.FRAMEBUFFER,a),v.viewport(d,f,c,b),sa=a)};this.verifyMRTWorks=function(a){return Ia?this.initFrameBufferMRT(a,!0):!1};this.readRenderTargetPixels=
function(a,b,c,d,f,g){if(!(a instanceof THREE.WebGLRenderTarget))console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");else if(a.__webglFramebuffer){var h=!1;a.__webglFramebuffer!==sa&&(v.bindFramebuffer(v.FRAMEBUFFER,a.__webglFramebuffer),h=!0);v.checkFramebufferStatus(v.FRAMEBUFFER)===v.FRAMEBUFFER_COMPLETE?v.readPixels(b,c,d,f,v.RGBA,v.UNSIGNED_BYTE,g):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.");
h&&v.bindFramebuffer(v.FRAMEBUFFER,sa)}}};AutodeskNamespace("Autodesk.Viewing.Private");
(function(){function a(a){d[0]=a;var b=g[0];a=0;if(0==(b&2147483647))k[a++]=b>>16;else{var c=b&2147483648,f=b&2139095040,b=b&8388607;if(0==f)k[a++]=c>>16;else if(2139095040==f)0==b?k[a++]=c>>16|31744:k[a++]=65024;else{var l=c>>16,f=(0|f>>23)-127+15;31<=f?k[a++]=c>>16|31744:0>=f?(24<14-f?c=0:(b|=8388608,h[0]=b>>14-f,c=h[0],b>>13-f&1&&(c+=1)),k[a++]=l|c):(h[0]=f<<10,f=h[0],h[0]=b>>13,c=h[0],b&4096?k[a++]=(l|f|c)+1:k[a++]=l|f|c)}}return k[0]}var b=Autodesk.Viewing.Private;b.BackgroundPresets={"Fusion Grey":[230,
230,230,150,150,150],"Sky Blue":[226,244,255,156,172,180],Midnight:[41,76,120,1,2,3],White:[255,255,255,255,255,255],AutoCADModel:[30,40,48,30,40,48],"Dark Grey":[51,51,51,51,51,51],"Infinity Pool":[164,175,179,164,175,179],Tranquility:[0,84,166,0,84,166],"Grey Room":[129,129,129,129,129,129],"Photo Booth":[237,237,237,237,237,237],"RaaS SBS":[1,1,1,90,90,90],Plaza:[79,102,130,79,102,130],Custom:[230,230,230,150,150,150]};var c=b.BackgroundPresets;b.LightPresets=[{name:"Simple Grey",path:null,tonemap:0,
E_bias:0,directLightColor:[1,.84,.67],ambientColor:[.8,.9,1],lightMultiplier:1,bgColorGradient:c["Fusion Grey"],darkerFade:!1},{name:"Sharp Highlights",path:"SharpHighlights",type:"logluv",tonemap:1,E_bias:-7.145705069544681,directLightColor:[.5,.5,.5],ambientColor:[.03125,.03125,.03125],lightMultiplier:0,bgColorGradient:c["Photo Booth"],darkerFade:!0},{name:"Dark Sky",path:"DarkSky",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.03125,.03125,.03125],lightMultiplier:1,lightDirection:[.1,
-.55,-1],bgColorGradient:c["Dark Grey"],darkerFade:!1},{name:"Grey Room",path:"GreyRoom",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.03125,.03125,.03125],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:c["Grey Room"],darkerFade:!0},{name:"Photo Booth",path:"PhotoBooth",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],ambientColor:[.03125,.03125,.03125],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:c["Photo Booth"],darkerFade:!0},
{name:"Tranquility",path:"TranquilityBlue",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.03125,.03125,.03125],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:c.Tranquility,darkerFade:!1},{name:"Infinity Pool",path:"InfinityPool",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,.84,.67],ambientColor:[.03125,.03125,.03125],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:c["Infinity Pool"],darkerFade:!1},{name:"Simple White",path:null,tonemap:0,
E_bias:0,directLightColor:[1,1,1],ambientColor:[.9,.9,.9],lightMultiplier:1,bgColorGradient:c.White,saoRadius:.06,saoIntensity:.15,darkerFade:!0},{name:"Riverbank",path:"riverbank",type:"logluv",tonemap:1,E_bias:-5.7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:c["Sky Blue"],darkerFade:!1},{name:"Contrast",path:"IDViz",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:c.Midnight,darkerFade:!1},{name:"Rim Highlights",path:"RimHighlights",type:"logluv",
tonemap:1,E_bias:-8.133084111281999,directLightColor:[.5,.5,.5],ambientColor:[.03125,.03125,.03125],lightMultiplier:0,bgColorGradient:c["Photo Booth"],darkerFade:!0},{name:"Cool Light",path:"CoolLight",type:"logluv",tonemap:1,E_bias:-8.152868970258611,directLightColor:[1,1,1],ambientColor:[.03125,.03125,.03125],lightMultiplier:0,bgColorGradient:c["Fusion Grey"],darkerFade:!0},{name:"Warm Light",path:"WarmLight",type:"logluv",tonemap:1,E_bias:-8.152965210880433,directLightColor:[1,1,1],ambientColor:[.03125,
.03125,.03125],lightMultiplier:0,bgColorGradient:c["Fusion Grey"],darkerFade:!0},{name:"Soft Light",path:"SoftLight",type:"logluv",tonemap:1,E_bias:-8.092194064376047,directLightColor:[1,1,1],ambientColor:[.03125,.03125,.03125],lightMultiplier:0,bgColorGradient:c["Fusion Grey"],darkerFade:!0},{name:"Grid Light",path:"GridLight",type:"logluv",tonemap:1,E_bias:-7.8601965561109175,directLightColor:[1,1,1],ambientColor:[.03125,.03125,.03125],lightMultiplier:0,bgColorGradient:c["Fusion Grey"],darkerFade:!0},
{name:"Plaza",path:"Plaza",type:"logluv",tonemap:1,E_bias:-13,directLightColor:[.9,.9,1],ambientColor:[.03125,.03125,.03125],lightMultiplier:0,bgColorGradient:c.Plaza,darkerFade:!1},{name:"Snow Field",path:"SnowField",type:"logluv",tonemap:1,E_bias:-11.5,directLightColor:[1,1,1],ambientColor:[.03125,.03125,.03125],lightMultiplier:0,bgColorGradient:c["Sky Blue"],darkerFade:!1}];b.DebugEnvironments=[{name:"Field",path:"field",type:"logluv",tonemap:1,E_bias:-2.9,directLightColor:[1,1,1],lightMultiplier:0,
bgColorGradient:c["Sky Blue"],darkerFade:!1},{name:"Crossroads",path:"crossroads",type:"logluv",tonemap:1,E_bias:-5.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:c["Sky Blue"],darkerFade:!1},{name:"Seaport",path:"seaport",type:"logluv",tonemap:1,E_bias:-6.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:c["Sky Blue"],darkerFade:!1},{name:"Glacier",path:"glacier",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:c.Midnight,darkerFade:!1},
{name:"Boardwalk",path:"boardwalk",type:"logluv",tonemap:1,E_bias:-7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:c["Sky Blue"],darkerFade:!1},{name:"RaaS Test Env",path:"Reflection",type:"logluv",tonemap:2,E_bias:-1.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:c["RaaS SBS"],darkerFade:!1}];ENABLE_DEBUG&&(b.LightPresets=b.LightPresets.concat(b.DebugEnvironments));b.CreateCubeMapFromColors=function(a,b){for(var c=255*a.x,d=255*a.y,f=255*a.z,g=255*b.x,h=255*b.y,k=255*b.z,
l=new Uint8Array(16),n=new Uint8Array(16),E=new Uint8Array(16),A=0;4>A;A++)l[4*A]=c,l[4*A+1]=d,l[4*A+2]=f,l[4*A+3]=255,n[4*A]=g,n[4*A+1]=h,n[4*A+2]=k,n[4*A+3]=255,0|A/2?(E[4*A]=c,E[4*A+1]=d,E[4*A+2]=f):(E[4*A]=g,E[4*A+1]=h,E[4*A+2]=k),E[4*A+3]=255;c=new THREE.DataTexture(E,2,2,THREE.RGBAFormat);d=new THREE.DataTexture(E,2,2,THREE.RGBAFormat);n=new THREE.DataTexture(n,2,2,THREE.RGBAFormat);l=new THREE.DataTexture(l,2,2,THREE.RGBAFormat);f=new THREE.DataTexture(E,2,2,THREE.RGBAFormat);E=new THREE.DataTexture(E,
2,2,THREE.RGBAFormat);g=new THREE.Texture(null,THREE.CubeReflectionMapping,THREE.RepeatWrapping,THREE.RepeatWrapping,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBAFormat);g.image=[d,c,l,n,E,f];g.needsUpdate=!0;return g};var f=[6.0014,-2.7008,-1.7996,-1.332,3.1029,-5.7721,.3008,-1.0882,5.6268],d=new Float32Array(1),g=new Uint32Array(d.buffer),h=new Uint16Array(1),k=new Uint16Array(1),l=new Float32Array(4),n=new Float32Array(4);b.DecodeEnvMap=function(b,c,d){if(b.LogLuv){c=Math.pow(2,c);for(var g=
Array.isArray(b.image)?b.image:[k],h=0;h<g.length;h++)for(var k=g[h],z=0;z<k.mipmaps.length;z++){var F=k.mipmaps[z],C=F.data,w;d?(w=new Uint16Array(C.length/4*3),F.data=w):w=C.buffer;for(var E=F=0;E<C.length;E+=4){l[0]=C[E]/255;l[1]=C[E+1]/255;l[2]=C[E+2]/255;l[3]=C[E+3]/255;var A=n,D=l,I=Math.pow(2,(255*D[2]+D[3]-127)/2),G=I/D[1],H=D[0]*G,D=f[0]*H+f[3]*I+f[6]*G,K=f[1]*H+f[4]*I+f[7]*G,I=f[2]*H+f[5]*I+f[8]*G;0>D&&(D=0);0>K&&(K=0);0>I&&(I=0);A[0]=D;A[1]=K;A[2]=I;d?(A=l,D=n,K=c,I=Math.sqrt(D[0]*K),G=
Math.sqrt(D[1]*K),D=Math.sqrt(D[2]*K),65504<I&&(I=65504),65504<G&&(G=65504),65504<D&&(D=65504),A[0]=I,A[1]=G,A[2]=D,w[F++]=a(l[0]),w[F++]=a(l[1]),w[F++]=a(l[2])):(A=l,D=n,K=c,I=.0625*Math.sqrt(D[0]*K),G=.0625*Math.sqrt(D[1]*K),D=.0625*Math.sqrt(D[2]*K),K=Math.max(Math.max(I,G),Math.max(D,1E-6)),1<K&&(K=1),K=Math.ceil(255*K)/255,1<I&&(I=1),1<G&&(G=1),1<D&&(D=1),A[3]=K,K=1/K,A[0]=I*K,A[1]=G*K,A[2]=D*K,C[E]=Math.round(255*l[0]),C[E+1]=Math.round(255*l[1]),C[E+2]=Math.round(255*l[2]),C[E+3]=Math.round(255*
l[3]))}}b.LogLuv=!1;d?(b.type=THREE.HalfFloatType,b.format=THREE.RGBFormat,b.RGBM=!1,b.GammaEncoded=!0):b.RGBM=!0}else stderr("Environment map expected to be in LogLuv format.")};b.DefaultLightPreset=8;b.DefaultLightPreset2d=0})();AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.Private.MaterialManager=function(a){function b(a){if("http://"==a.substr(0,7)||"https://"==a.substr(0,8)||"file:///"==a.substr(0,8)||"urn:"==a.substr(0,4))return a;var b=window.location.pathname,c=b.lastIndexOf("/"),b=b.substr(0,c+1);return window.location.protocol+"//"+window.location.host+b+a}function c(a){return-1!=a.indexOf("__lineMaterial__")}function f(a,b){return c(b)?b:a.basePath+"|mat|"+b}function d(a,b,c){auth&&(-1!=a.indexOf("/items/")?THREE.ImageUtils.crossOrigin="use-credentials":
THREE.ImageUtils.crossOrigin="");return THREE.ImageUtils.loadTexture(a,b,c)}var g=Autodesk.Viewing.Private,h=this,k=this.materials={},l=this.materialsNonHDR={};this.textures={};this.irradianceMap=this.reflectionCube=this.layerMaskTex=null;var n=1,q=[];this.hasPrism=!1;var m=[],p=new THREE.Vector3(0,1,0);this.defaultMaterial=new THREE.MeshPhongMaterial({ambient:197379,color:7829367,specular:3355443,shininess:30,shading:THREE.SmoothShading,reflectivity:0});this.findMaterial=function(a,b){var c=k[f(a,
b)];c||(stderr("Unknown material "+b+". Using default."),c=this.defaultMaterial);return c};this.convertMaterials=function(a){if(a.materials){var b=a.materials.materials,c;for(c in b){var d=a.simplemats[c],g=f(a,c);if(d){var h=d.color=(new THREE.Color).copy(d.color),k=d.specular=(new THREE.Color).copy(d.specular),l=d.ambient=(new THREE.Color).copy(d.ambient),m=d.emissive=(new THREE.Color).copy(d.emissive);0==h.r&&0==h.g&&0==h.b&&0==k.r&&0==k.g&&0==k.b&&0==l.r&&0==l.g&&0==l.b&&0==m.r&&0==m.g&&0==m.b&&
(h.r=h.g=h.b=.4);h=new THREE.MeshPhongMaterial(d);h.proteinType=d.proteinType;h.proteinMat=b[c];h.simplemat=d;h.metal=d.metal;h.packedNormals=!0;_isIE11||!d.doubleSided&&!a.doubleSided||(h.side=THREE.DoubleSide)}else h=new THREE.MeshPhongMaterial({ambient:197379,color:7829367,specular:3355443,shininess:30,shading:THREE.SmoothShading}),h.proteinMat=b[c];this.addMaterial(g,h)}}};this.updateMaterials=function(){for(;q.length;)for(var b=q.pop(),c=0;c<b.mats.length;c++)b.mats[c][b.slot]=b.tex,b.mats[c].needsUpdate=
!0,a.invalidate(!0,!1,!1)};this.resizeImage=function(a){var b=a.width,c=a.height;if(0===(b&b-1)&&0===(c&c-1))return a;for(var d=1;2*d<b;)d*=2;for(b=1;2*b<c;)b*=2;var c=document.createElement("canvas"),f=c.getContext("2d");c.width=d;c.height=b;f.drawImage(a,0,0,d,b);return c};this.loadTextures=function(c){for(var f in k){var g=k[f];if(g){var l=["map","bumpMap","specularMap","normalMap","alphaMap"];g.bumpScale&&1<=g.bumpScale&&(g.bumpScale=.03);for(var m=0;m<l.length;m++){var n=l[m],p=g.simplemat?g.simplemat["tex_"+
n]:void 0,E=p?p.uri:void 0;if(E){var E=E.replace(/\\/g,"/"),A=g.proteinType&&g.proteinType.length,D=A&&0===g.proteinType.indexOf("Prism"),I=(D&&PRISM_ROOT||A&&PROTEIN_ROOT)&&(0===E.indexOf("1/Mats")||0===E.indexOf("2/Mats")||0===E.indexOf("3/Mats")),A=c.basePath+E,G=h.textures[A];if(G)G.tex?(g[n]=G.tex,g.needsUpdate=!0):(h.textures[A].mats.push(g),h.textures[A].slots.push(n));else{var H=null;if(I)H=D?PRISM_ROOT+E:PROTEIN_ROOT+E;else{for(D=0;D<c.manifest.assets.length;++D)if(I=c.manifest.assets[D],
I.id==E){H=b(c.basePath+I.URI);break}H||(H=b(A))}E=H.indexOf("urn:");-1!=E&&(H=H.substr(0,E)+encodeURIComponent(H.substr(E)),H+="?domain="+encodeURIComponent(window.location.origin),Autodesk.Viewing.ACM_SESSION_ID&&(H+="&acmsession="+Autodesk.Viewing.ACM_SESSION_ID));h.textures[A]={mats:[g],slots:[n],tex:null};E=function(a){return d(H,THREE.UVMapping,function(b){b.image=h.resizeImage(b.image);var c=h.textures[a];if(c){c.tex||(c.tex=b);for(var d=0;d<c.mats.length;d++)c.mats[d][c.slots[d]]=b;q.push(c)}})}(A);
"alphaMap"==n&&(g.transparent=!0);E.anisotropy="bumpMap"==n||"normalMap"==n?0:a.renderer().getMaxAnisotropy();E.flipY=p.flipY;E.wrapS=p.wrapS?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;E.wrapT=p.wrapT?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;E.matrix=p.matrix}}}}}};this.create2DMaterial=function(b,c,g,l){var m="__lineMaterial__";c.image&&(m+="|image:"+c.image.name);c.clip&&(m+="|clip:"+JSON.stringify(c.clip));g&&(m+="|id");l&&(m+="|selection");c.skipEllipticals&&(m+="|skipEllipticals");
c.skipCircles&&(m+="|skipCircles");c.skipTriangleGeoms&&(m+="|skipTriangleGeoms");c.useInstancing&&(m+="|useInstancing");b&&(m+="|"+b?b.basePath:"runtime");m=f(null,m);if(!k.hasOwnProperty(m)){var n=new THREE.ShaderMaterial({fragmentShader:LineShader.fragmentShader,vertexShader:LineShader.vertexShader,uniforms:THREE.UniformsUtils.clone(LineShader.uniforms),attributes:LineShader.attributes,defines:THREE.UniformsUtils.clone(LineShader.defines),transparent:!0});n.depthWrite=!1;n.depthTest=!1;n.side=
THREE.DoubleSide;n.blending=THREE.NormalBlending;g?(n.defines.ID_COLOR=1,n.blending=THREE.NoBlending):l?n.defines.SELECTION_RENDERER=1:a.renderer().hasMRT()&&(n.mrtIdBuffer=1);c.skipEllipticals||(n.defines.HAS_ELLIPTICALS=1);c.skipCircles||(n.defines.HAS_CIRCLES=1);c.skipTriangleGeoms||(n.defines.HAS_TRIANGLE_GEOMS=1);c.useInstancing&&(n.defines.USE_INSTANCING=1);this.layerMaskTex&&(n.defines.HAS_LAYERS=1,n.uniforms.tLayerMask.value=h.layerMaskTex);if(c.image){n.defines.HAS_RASTER_QUADS=1;var p=this;
d(c.image.dataURI,THREE.UVMapping,function(b){b.image=p.resizeImage(b.image);b.wrapS=THREE.ClampToEdgeWrapping;b.wrapT=THREE.ClampToEdgeWrapping;b.minFilter=THREE.LinearMipMapLinearFilter;b.magFilter=THREE.LinearFilter;b.anisotropy=1;b.flipY=!0;b.generateMipmaps=!0;b.needsUpdate=!0;n.uniforms.tRaster.value=b;-1!=c.image.dataURI.indexOf("png")&&(n.transparent=!0);n.needsUpdate=!0;a.invalidate(!1,!0,!1)})}k[m]=n}return m};this.addMaterial=function(b,c,d){function f(a){return.299*a.r+.587*a.g+.114*a.b}
var g=c.proteinMat?c.proteinMat:null,l=c.proteinType&&-1!=c.proteinType.indexOf("Prism");this.hasPrism=l||this.hasPrism;if(!d){if(c.metal){if(c.reflectivity||(c.reflectivity=f(c.specular)),g&&(1===c.reflectivity&&(c.reflectivity=f(c.specular)),0!==c.color.r||0!==c.color.g||0!==c.color.b))c.color.r*=.1,c.color.g*=.1,c.color.b*=.1}else g?l?(d=!1,"PrismLayered"==c.proteinType&&(c.clearcoat=!0,c.reflectivity=.06,g&&(g=g.materials[g.userassets[0]].categories)&&g.length&&-1!=g[0].indexOf("Metal")&&(d=!0)),
c.reflectivity=Math.sqrt(c.reflectivity),d?c.specular.copy(c.color):(c.specular.r=c.reflectivity,c.specular.g=c.reflectivity,c.specular.b=c.reflectivity)):(c.reflectivity||(c.reflectivity=.01+.06*f(c.specular)),c.specular.r*=c.reflectivity,c.specular.g*=c.reflectivity,c.specular.b*=c.reflectivity,1>c.opacity&&(c.reflectivity=1)):c.reflectivity?(c.metal=!0,c.specular.r=c.color.r*c.reflectivity,c.specular.g=c.color.g*c.reflectivity,c.specular.b=c.color.b*c.reflectivity,c.color.r*=.1,c.color.g*=.1,c.color.b*=
.1):1!==c.color.r||1!==c.color.g||1!==c.color.b||1!==c.specular.r||1!==c.specular.g||1!==c.specular.b||c.uri_map||c.uri_specularMap||(c.metal=!0,c.reflectivity=.7,c.specular.r=c.specular.g=c.specular.b=c.reflectivity,c.color.r*=.1,c.color.g*=.1,c.color.b*=.1);if(c.transparent||c.uri_map&&-1!=c.uri_map.toLowerCase().indexOf(".png")||c.uri_opacityMap)c.alphaTest=.01}if(c.uri_normalMap){g=c.bumpScale;if(void 0===g||1<=g)g=1;c.normalScale=new THREE.Vector2(g,g)}else void 0===c.bumpScale&&(c.uri_map||
c.uri_bumpMap)?c.bumpScale=.03:1<=c.bumpScale&&(c.bumpScale=.03);c.shininess*=.25;h.reflectionCube&&(c.envMap=h.reflectionCube);h.irradianceMap&&(c.irradianceMap=h.irradianceMap);c.exposureBias=Math.pow(2,a.renderer().getExposureBias());c.tonemapOutput=a.renderer().getToneMapMethod();c.envMapExposure=n;a.renderer().applyMRTFlags(c);c.side==THREE.DoubleSide&&a.renderer().toggleTwoSided(!0);c.cutplanes=m;c.cutplanesOutlineColor=p;k[b]=c};this.addMaterialNonHDR=function(a,b){b.cutplanes=m;b.cutplanesOutlineColor=
p;l[a]=b};this.togglePolygonOffset=function(a){for(var b in k){var c=k[b];c instanceof THREE.MeshPhongMaterial&&(c.polygonOffset=!0,c.polygonOffsetFactor=a?1:0,c.polygonOffsetUnits=a?1:0,c.needsUpdate=!0)}};this.applyGeometryFlagsToMaterial=function(a,b){b.attributes.color&&(a.vertexColors=THREE.VertexColors,a.needsUpdate=!0);!a.proteinType&&b.attributes.uv&&b.attributes.uv.isPattern&&(a.map&&!a.bumpMap&&(a.bumpMap=a.map,a.needsUpdate=!0),a.uri_map&&!a.uri_bumpMap&&(a.uri_bumpMap=a.uri_map,a.needsUpdate=
!0))};this.toggleMRTSetting=function(){for(var b in k){var d=k[b];c(b)||a.renderer().applyMRTFlags(d)}};this.updatePixelScale=function(a){var b=k,d;for(d in b)c(d)&&(b[d].uniforms.aaRange.value=.5/a,b[d].uniforms.pixelsPerUnit.value=a)};this.setCubeMapFromColors=function(b,c){var d=g.CreateCubeMapFromColors(b,c);h.reflectionCube=d;h.reflectionCube.isBgColor=!0;for(var f in k){var l=k[f];l.envMap=d;l.needsUpdate=!0}a.invalidate(!0)};this.setCubeMap=function(b,c){var d=function(d){d&&(d.mapping=THREE.CubeReflectionMapping,
d.LogLuv=-1!=b.indexOf("logluv"),d.RGBM=-1!=b.indexOf("rgbm"),g.DecodeEnvMap(d,c,!1));h.reflectionCube=d;if(h.reflectionCube)for(var f in k)d=k[f],d.envMap=h.reflectionCube,d.needsUpdate=!0;else h.setCubeMapFromColors(a.clearColorTop,a.clearColorBottom);a.invalidate(!0)};Array.isArray(b)?(h.reflectionCube=THREE.ImageUtils.loadTextureCube(b,THREE.CubeReflectionMapping,d),h.reflectionCube.format=THREE.RGBFormat):"string"==typeof b?-1!=b.toLowerCase().indexOf(".dds")?h.reflectionCube=(new THREE.DDSLoader).load(b,
d):(h.reflectionCube=THREE.ImageUtils.loadTexture(b,THREE.SphericalReflectionMapping,d),h.reflectionCube.format=THREE.RGBFormat):b?d(b):d(null)};this.setIrradianceMap=function(b,c){var d=function(d){if(d){d.mapping=THREE.CubeReflectionMapping;d.LogLuv=-1!=b.indexOf("logluv");d.RGBM=-1!=b.indexOf("rgbm");g.DecodeEnvMap(d,c,!1);for(var f in k){var l=k[f];l.irradianceMap=d;l.needsUpdate=!0}h.irradianceMap=d}else if(h.irradianceMap){for(f in k)l=k[f],l.irradianceMap=null,l.needsUpdate=!0;h.irradianceMap=
null}a.invalidate(!0)};THREE.ImageUtils.crossOrigin="";Array.isArray(b)?(h.irradianceMap=THREE.ImageUtils.loadTextureCube(b,THREE.CubeReflectionMapping,d),h.irradianceMap.format=THREE.RGBFormat):"string"==typeof b?-1!=b.toLowerCase().indexOf(".dds")&&(h.irradianceMap=(new THREE.DDSLoader).load(b,d)):b?d(b):d(null)};this.setTonemapMethod=function(a){for(var b in k){var c=k[b];c.tonemapOutput=a;c.needsUpdate=!0}};this.setEnvExposure=function(a){n=a=Math.pow(2,a);for(var b in k){var c=k[b];c.envMapExposure=
a;c.needsUpdate=!0}};this.setTonemapExposureBias=function(a){a=Math.pow(2,a);for(var b in k){var c=k[b];c.exposureBias=a;c.needsUpdate=!0}};this.initLayersTexture=function(a){for(var b=a.getData().layerCount,c=new Uint8Array(65536),d=0;d<b;d++)c[d]=255;b=new THREE.DataTexture(c,256,256,THREE.LuminanceFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter,0);b.generateMipmaps=!1;b.flipY=!1;b.needsUpdate=!0;this.layerMaskTex=
b;this.layersMap=a.getData().layersMap};this.init2DSelectionMaterial=function(a){for(var b=a.myData.maxObjectNumber||1,c=0|Math.ceil(b/4096),d=1;d<c;)d*=2;for(var c=d,d=new Uint8Array(4096*c),f=0;f<b;f++)d[f]=0;b=new THREE.DataTexture(d,4096,c,THREE.LuminanceFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter,0);b.generateMipmaps=!1;b.flipY=!1;b.needsUpdate=!0;this.selectionTex=b;a=this.create2DMaterial(a.getData(),
{},!1,!0);a=k[a];a.uniforms.tSelectionTexture.value=this.selectionTex;a.uniforms.vSelTexSize.value.set(4096,c);a.needsUpdate=!0;return a};this.setLayerVisible=function(b,d){for(var f=this.layerMaskTex,g=f.image.data,h=this.layersMap,l=d?255:0,m=0;m<b.length;++m)g[h[b[m]]]=l;f.needsUpdate=!0;for(var n in k)c(n)&&(k[n].needsUpdate=!0);a.invalidate(!0)};this.isLayerVisible=function(a){return!!this.layerMaskTex.image.data[this.layersMap[a]]};this.highlightObject2D=function(b,c){this.selectionTex.image.data[b]=
c?255:0;this.selectionTex.needsUpdate=!0;a.invalidate(!1,!1,!0)};this.cloneMaterial=function(b){var c=b.clone();c instanceof THREE.MeshPhongMaterial&&(c.exposureBias=b.exposureBias,c.irradianceMap=b.irradianceMap,c.envMapExposure=b.envMapExposure,c.proteinType=b.proteinType,c.proteinMat=b.proteinMat,c.simplemat=b.simplemat,c.tonemapOutput=b.tonemapOutput,c.cutplanes=b.cutplanes,c.cutplanesOutlineColor=b.cutplanesOutlineColor,c.cutplanesOutlineThickness=b.cutplanesOutlineThickness);a.renderer().applyMRTFlags(c);
return c};this.getCutPlanes=function(){return m.slice()};this.getCutPlanesRaw=function(){return m};this.setCutPlanes=function(a){if(m.length!==(a?a.length||0:0)){for(var b in k)k[b].needsUpdate=!0,a&&0<a.length&&(k[b].side=THREE.DoubleSide);for(b in l)l[b].needsUpdate=!0}for(;0<m.length;)m.pop();if(a)for(b=0;b<a.length;b++)m.push(a[b].clone())};this.setCutPlanesOutlineColor=function(a){p.set(a.r,a.g,a.b)};this.setCutPlanesOutlineThickness=function(a){for(var b in k)k[b].cutplanesOutlineThickness=
a;for(b in l)l[b].cutplanesOutlineThickness=a};this.cleanup=function(a){var b={},c;for(c in this.textures){var d=this.textures[c];-1===c.indexOf(a.basePath)?b[c]=d:d.tex&&d.tex.dispose()}this.textures=b;b={};c={type:"dispose"};for(var f in k)-1===f.indexOf(a.basePath)?b[f]=k[f]:(d=k[f],d.dispatchEvent(c),d.needsUpdate=!0);k=this.materials=b};this.addMaterial("__defaultMaterial__",this.defaultMaterial)};
function init_GroundShader(){"undefined"===typeof GroundDepthShader&&(GroundDepthShader={uniforms:{cutplanes:{type:"v4v",value:[]}},vertexShader:"#ifdef USE_LOGDEPTHBUF\n    #ifdef USE_LOGDEPTHBUF_EXT\n        varying float vFragDepth;\n    #endif\n    uniform float logDepthBufFC;\n#endif\n#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );;\n#if NUM_CUTPLANES > 0\n    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n    vWorldPosition = worldPosition.xyz;\n#endif\n#ifdef USE_LOGDEPTHBUF\n    gl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n    #ifdef USE_LOGDEPTHBUF_EXT\n        vFragDepth = 1.0 + gl_Position.w;\n    #else\n        gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n    #endif\n#endif\n}",
fragmentShader:["#ifdef USE_LOGDEPTHBUF\n    uniform float logDepthBufFC;\n    #ifdef USE_LOGDEPTHBUF_EXT\n        #extension GL_EXT_frag_depth : enable\n        varying float vFragDepth;\n    #endif\n#endif",PackDepthShaderChunk,"#if NUM_CUTPLANES > 0\nvarying vec3 vWorldPosition;\n#endif",CutPlanesShaderChunk,"void main() {\n#if NUM_CUTPLANES > 0\nif (checkCutPlanes()) return;\n#endif\n#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\ngl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif\n#ifdef USE_LOGDEPTHBUF_EXT\nfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n#else\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#endif\ndepth = 1.0 - depth;\ngl_FragColor = packDepth(depth);\n}"].join("\n")},
GroundShadowAOShader={uniforms:{tDepth:{type:"t",value:null},worldSize:{type:"v3",value:new THREE.Vector3(1,1,1)}},defines:{},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2(uv.x, uv.y);\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:["#define NUM_SAMPLES 29.0\n#define NUM_SPIRAL_TURNS 7.0\nuniform sampler2D tDepth;\nuniform vec3 worldSize;\nvarying vec2 vUv;\n#ifdef PRESET_2\n#define SAMPLE_RADIUS 0.3\n#define AO_GAMMA 1.0\n#define AO_INTENSITY 1.0\n#else\n#define SAMPLE_RADIUS 0.2\n#define AO_GAMMA 3.0\n#define AO_INTENSITY 0.8\n#endif",
PackDepthShaderChunk,"#define PI 3.14159265358979\nfloat rand(vec2 co) {\nreturn fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\nfloat getRandomAngle(vec2 pos) {\nreturn rand(pos) * (2.0 * PI);\n}\nvec2 tapLocation(float sampleNumber, float spinAngle, out float ssR){\nfloat alpha = float(sampleNumber + 0.5) * (1.0 / NUM_SAMPLES);\nfloat angle = alpha * (NUM_SPIRAL_TURNS * PI * 2.0) + spinAngle;\nssR = alpha;\nreturn vec2(cos(angle), sin(angle));\n}\nvec2 sampleAO(vec2 unitDirection, float radius) {\nvec2 sampleOffset = unitDirection * radius;\nfloat idepth = unpackDepth(texture2D(tDepth, vUv + sampleOffset));\nfloat depth = 1.0 - idepth;\nif (depth < 1e-6) {\nif (radius == 0.0)\nreturn vec2(1.0, 1.0);\nelse\nreturn vec2(0.0, 1.0);\n}\nvec3 dir = vec3(sampleOffset.x, depth, sampleOffset.y) * worldSize;\nfloat distance2 = dot(dir,dir);\nfloat idistance = 1.0 / sqrt(distance2);\nvec3 ndir = dir * idistance;\n#ifdef PRESET_2\nfloat importance = ndir.y * idistance;\n#else\nfloat importance = ndir.y / distance2;\n#endif\nvec2 ret;\nret.x = (idepth == 0.0) ? 0.0 : importance;\nret.y = importance;\nreturn ret;\n}\nvoid main() {\nvec2 sum = vec2(0.0);\nfloat angle = getRandomAngle(vUv);\nfor (float i = 0.0; i<NUM_SAMPLES; i+= 1.0) {\nfloat ssR;\nvec2 uv = tapLocation(i, angle, ssR);\nsum += sampleAO(uv, ssR * SAMPLE_RADIUS);\n}\nfloat ao = sum.x / sum.y;\ngl_FragColor = packDepth(AO_INTENSITY * clamp(pow(ao, AO_GAMMA), 0.0, 0.9999));\n}"].join("\n")},
GroundShadowBlurShader={uniforms:{tDepth:{type:"t",value:null}},defines:{},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2(uv.x, uv.y);\ngl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:["uniform sampler2D tDepth;\nvarying vec2 vUv;\n#ifdef HORIZONTAL\n#define GET_UV(X) vec2(vUv.x + KERNEL_SCALE*(X), vUv.y)\n#else\n#define GET_UV(Y) vec2(vUv.x, vUv.y + KERNEL_SCALE*(Y))\n#endif",PackDepthShaderChunk,"#define PI 3.14159265358979\n#define SIGMA ((2.0 * KERNEL_RADIUS+1.0) / 6.0)\n#define SIGMASQ2 (2.0 * SIGMA * SIGMA)\n#ifdef BOX\n#define KERNEL_VAL(X) 1.0\n#else\n#define KERNEL_VAL(X) ( (1.0 / sqrt(PI * SIGMASQ2)) * exp(-(X)*(X)/SIGMASQ2) )\n#endif\nvoid main() {\nfloat depthVal = 0.0;\nfloat sum = 0.0;\nfor (float x=-KERNEL_RADIUS; x<=KERNEL_RADIUS; x+=1.0) {\ndepthVal += unpackDepth(texture2D(tDepth, GET_UV(x))) * KERNEL_VAL(x);\nsum += KERNEL_VAL(x);\n}\ngl_FragColor = packDepth(depthVal/sum);\n}"].join("\n")},
GroundShadowColorShader={uniforms:{tDepth:{type:"t",value:null},uShadowColor:{type:"v4",value:new THREE.Vector4(0,0,0,1)}},vertexShader:"varying vec2 vUv;\nvoid main() {\n    vUv = vec2(uv.x, uv.y);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:["uniform sampler2D tDepth;\nuniform vec4 uShadowColor;\nvarying vec2 vUv;",PackDepthShaderChunk,"void main() {\nfloat depthVal = unpackDepth(texture2D(tDepth, vUv));\ngl_FragColor = vec4(uShadowColor.rgb, uShadowColor.a * depthVal);\n}"].join("\n")})}
var GroundShadow=function(a,b){function c(a){return new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,defines:THREE.UniformsUtils.clone(a.defines)})}init_GroundShader();var f,d,g,h,k,l,n,q,m,p,t,r,B=!1,z={texSize:64,pixScale:1,blurRadius:7,debug:!1};this.setTransform=function(a,b,c,d){f.left=-b.z/2;f.right=b.z/2;f.top=b.x/2;f.bottom=-b.x/2;f.near=1;f.far=b.y+f.near;f.updateProjectionMatrix();f.position.addVectors(a,
c.clone().multiplyScalar(-b.y/2-f.near));d&&f.up.set(d.x,d.y,d.z);f.lookAt(a);g.position.set(a.x,a.y,a.z);g.rotation.set(f.rotation.x,f.rotation.y,f.rotation.z);g.scale.set(b.z,b.x,b.y);z.debug&&(r.position.set(a.x,a.y,a.z),r.rotation.set(f.rotation.x,f.rotation.y,f.rotation.z),r.scale.set(b.z,b.x,b.y));t.uniforms.worldSize.value.copy(b)};this.renderIntoShadow=function(b){if(!b.overrideMaterial||!b.overrideMaterial.transparent){var c=b.overrideMaterial;b.overrideMaterial=n;a.render(b,f,k,!1);b.overrideMaterial=
c}};this.renderShadow=function(b,c){B&&(c?a.render(d,b,c,!1):a.render(d,b))};this.postprocess=function(){p.render(a,l,k);m.render(a,k,l);B=!0};this.clear=function(){var b=a.getClearColor().getHex(),c=a.getClearAlpha();a.setClearColor(0,0);a.clearTarget(k,!0,!0,!1);a.setClearColor(b,c);B=!1};this.setColor=function(a){q.uniforms.uShadowColor.value.x=a.r;q.uniforms.uShadowColor.value.y=a.g;q.uniforms.uShadowColor.value.z=a.b};this.getColor=function(){return new THREE.Color(q.uniforms.uShadowColor.value.x,
q.uniforms.uShadowColor.value.y,q.uniforms.uShadowColor.value.z)};this.setAlpha=function(a){q.uniforms.uShadowColor.value.w=a};this.getAlpha=function(){return q.uniforms.uShadowColor.value.w};this.isValid=function(){return B};this.getDepthMaterial=function(){return n};if(b)for(h in z)z[h]=b[h]||z[h];d=new THREE.Scene;f=new THREE.OrthographicCamera;k=new THREE.WebGLRenderTarget(z.texSize,z.texSize,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1});
k.generateMipmaps=!1;l=new THREE.WebGLRenderTarget(z.texSize,z.texSize,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1});l.generateMipmaps=!1;n=c(GroundDepthShader);n.side=THREE.DoubleSide;n.blending=THREE.NoBlending;m=new LmvShaderPass(GroundShadowBlurShader,"tDepth");p=new LmvShaderPass(GroundShadowBlurShader,"tDepth");t=new LmvShaderPass(GroundShadowAOShader,"tDepth");m.material.defines.KERNEL_SCALE=p.material.defines.KERNEL_SCALE=(z.pixScale/
z.texSize).toFixed(4);m.material.defines.KERNEL_RADIUS=p.material.defines.KERNEL_RADIUS=z.blurRadius.toFixed(2);t.material.blending=m.material.blending=p.material.blending=THREE.NoBlending;t.material.depthWrite=m.material.depthWrite=p.material.depthWrite=!1;t.material.depthTest=m.material.depthTest=p.material.depthTest=!1;m.material.defines.HORIZONTAL=1;q=c(GroundShadowColorShader);q.uniforms.tDepth.value=k;q.depthWrite=!1;q.transparent=!0;h=new THREE.BufferGeometry;h.addAttribute("position",new THREE.BufferAttribute(new Float32Array([-.5,
-.5,.5,-.5,.5,.5,.5,.5,.5,.5,-.5,.5]),3));h.addAttribute("uv",new THREE.BufferAttribute(new Float32Array([0,0,0,1,1,1,1,0]),2));h.addAttribute("index",new THREE.BufferAttribute(new Uint16Array([0,1,2,2,3,0]),1));g=new THREE.Mesh(h,q);d.add(g);z.debug&&(r=new THREE.Mesh(new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:65280,wireframe:!0})),d.add(r));this.setTransform(new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,1,0))};GroundShadow.prototype.constructor=GroundShadow;
function init_GroundReflectionShader(){"undefined"===typeof GroundReflectionCompShader&&(GroundReflectionCompShader={uniforms:{tDiffuse:{type:"t",value:null},tBackground:{type:"t",value:null},uColor:{type:"v4",value:new THREE.Vector4(1,1,1,1)}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform sampler2D tBackground;\nuniform vec4 uColor;\nvarying vec2 vUv;\nvoid main() {\nvec4 bgCol = texture2D( tBackground, vUv );\nvec4 diffCol = uColor * texture2D( tDiffuse, vUv );\ngl_FragColor = mix(bgCol, diffCol, diffCol.a);\n}"},
GroundReflectionDrawShader={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D tDiffuse;\nvarying vec2 vUv;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = texel;\n}"})}
var createShaderMaterial=function(a){return new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,defines:THREE.UniformsUtils.clone(a.defines)})},GroundReflection=function(a,b,c,f){init_GroundReflectionShader();var d=a.getContext(),g=b||512,h=c||512,k,l,n,q,m,p=!1,t=new THREE.Color(0,0,0),r,B=!1;this.outTarget=this.inTarget=void 0;var z={color:new THREE.Color(1,1,1),alpha:.3,texScale:.5,blurRadius:2,blurTexScale:.5,fadeAngle:Math.PI/
18};this.setTransform=function(a,b,c){q=a;n.normal=b;n.constant=-a.dot(b)};this.cleanup=function(){k&&k.cleanup();this.inTarget&&this.inTarget.dispose();this.outTarget&&this.outTarget.dispose()};this.setSize=function(a,b){g=a;h=b;this.cleanup();this.inTarget=new THREE.WebGLRenderTarget(g*z.texScale,h*z.texScale,{magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1});this.inTarget.generateMipmaps=!1;this.outTarget=new THREE.WebGLRenderTarget(g*z.texScale,
h*z.texScale,{magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1});this.outTarget.generateMipmaps=!1;k?k.setSize(g*z.texScale*z.blurTexScale,h*z.texScale*z.blurTexScale):k=new GaussianPass(g*z.texScale*z.blurTexScale,h*z.texScale*z.blurTexScale,z.blurRadius,1,{hasAlpha:!0,blending:!0,flipUV:!0})};this.updateCamera=function(a){var b=a.position.clone().sub(q).normalize(),b=Math.PI/2-b.angleTo(n.normal);p=0>b;if(!p){0<z.fadeAngle&&(b=Math.min(z.fadeAngle,
b)/z.fadeAngle,k.setAlpha(b*z.alpha));var b=n.normal,c=n.constant,b=(new THREE.Matrix4).set(1-2*b.x*b.x,-2*b.y*b.x,-2*b.x*b.z,-2*c*b.x,-2*b.x*b.y,1-2*b.y*b.y,-2*b.y*b.z,-2*c*b.y,-2*b.x*b.z,-2*b.y*b.z,1-2*b.z*b.z,-2*c*b.z,0,0,0,1);m=a.clone();m.applyMatrix(b);m.projectionMatrix.elements[5]*=-1;m.matrixWorldNeedsUpdate=!0;m.worldUpTransform=a.worldUpTransform?a.worldUpTransform.clone():new THREE.Matrix4}};this.renderIntoReflection=function(b){p||a.render(b,m,this.inTarget)};this.renderReflection=function(b,
c){p||(d.depthRange(.9999,1),l.render(a,c,this.outTarget),d.depthRange(0,1))};this.postprocess=function(){p||(B?(r.render(a,this.outTarget),a.clearTarget(this.outTarget,!1,!0,!1)):(a.setClearColor(t,1),a.clearTarget(this.outTarget,!0,!0,!1)),k.render(a,this.outTarget,this.inTarget))};this.clear=function(){a.setClearColor(t,0);a.clearTarget(this.inTarget,!0,!0,!1)};this.setClearColors=function(a,b){b?(t.setRGB(.5*(a.x+b.x),.5*(a.y+b.y),.5*(a.z+b.z)),B=!a.equals(b)&&!isAndroidDevice()&&!isIOSDevice()):
(t.copy(a),B=!1);B&&(r.uniforms.color1.value.copy(a),r.uniforms.color2.value.copy(b))};this.isGroundCulled=function(){return p};this.setColor=function(a){k.setColor(z.color);z.color.set(a)};this.setAlpha=function(a){k.setAlpha(z.alpha);z.alpha=a};if(f)for(var F in z)z[F]=void 0!==f[F]?f[F]:z[F];l=new LmvShaderPass(GroundReflectionDrawShader);l.material.blending=THREE.NoBlending;l.material.depthTest=!0;l.material.depthWrite=!1;r=new LmvShaderPass(BackgroundShader);r.material.blending=THREE.NoBlending;
r.material.depthWrite=!1;r.material.depthTest=!1;this.setSize(g,h);k.setAlpha(z.color);k.setAlpha(z.alpha);n=new THREE.Plane(new THREE.Vector3(0,1,0),0);q=new THREE.Vector3(0,0,0)};GroundReflection.prototype.constructor=GroundReflection;
function init_GaussianShader(){"undefined"===typeof GaussianShader&&(GaussianShader={uniforms:{tDiffuse:{type:"t",value:null},uColor:{type:"v4",value:new THREE.Vector4(1,1,1,1)}},vertexShader:"varying vec2 vUv;\nvoid main() {\n#if defined(HORIZONTAL) && defined(FLIP_UV)\n    vUv = vec2(uv.x, 1.0-uv.y);\n#else\n    vUv = vec2(uv.x, uv.y);\n#endif\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec4 uColor;\nvarying vec2 vUv;\n#ifdef HORIZONTAL\n    #define GET_UV(X) vec2(vUv.x + KERNEL_SCALE_H*(X), vUv.y)\n#else\n    #define GET_UV(Y) vec2(vUv.x, vUv.y + KERNEL_SCALE_V*(Y))\n#endif\n#define PI 3.14159265358979\n#define SIGMA ((KERNEL_RADIUS+KERNEL_RADIUS+1.0) / 6.0)\n#define SIGMASQ2 (2.0 * SIGMA * SIGMA)\n#define GAUSSIAN(X) ( (1.0 / sqrt(PI * SIGMASQ2)) * exp(-(X)*(X)/SIGMASQ2) )\nvoid main() {\n    vec4 texColSum = vec4(0.0);\n    float gaussSum = 0.0;\n    for (float x=-KERNEL_RADIUS; x<=KERNEL_RADIUS; x+=1.0) {\n        float gauss = GAUSSIAN(x);\n        vec4 texCol = texture2D(tDiffuse, GET_UV(x));\n        #ifdef HAS_ALPHA\n            texCol.rgb *= texCol.a;\n        #endif\n        texColSum += texCol * gauss;\n        gaussSum += gauss;\n    }\n    #ifdef HAS_ALPHA\n        texColSum.rgb /= texColSum.a;\n    #endif\n#ifdef HORIZONTAL\n    gl_FragColor = texColSum/gaussSum;\n#else\n    gl_FragColor = texColSum/gaussSum * uColor;\n#endif\n}"})}
var GaussianPass=function(a,b,c,f,d){init_GaussianShader();var g=a,h=b;c=c||3;var k=f||1,l,n,q;f=d.hasAlpha||!1;var m=d.blending||!1;d=d.flipUV||!1;this.render=function(a,b,c){l.render(a,q,c);n.render(a,b,q)};this.setSize=function(a,b){this.cleanup();g=a;h=b;q=new THREE.WebGLRenderTarget(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1});q.generateMipmaps=!1;l.material.defines.KERNEL_SCALE_H=n.material.defines.KERNEL_SCALE_H=(k/g).toFixed(4);
l.material.defines.KERNEL_SCALE_V=n.material.defines.KERNEL_SCALE_V=(k/h).toFixed(4);l.material.needsUpdate=n.material.needsUpdate=!0};this.cleanup=function(){q&&q.dispose()};this.setColor=function(a){n.material.uniforms.uColor.value.x=a.r;n.material.uniforms.uColor.value.y=a.g;n.material.uniforms.uColor.value.z=a.b};this.setAlpha=function(a){n.material.uniforms.uColor.value.w=a};l=new LmvShaderPass(GaussianShader);n=new LmvShaderPass(GaussianShader);this.setSize(a,b);l.material.blending=n.material.blending=
THREE.NoBlending;l.material.depthWrite=n.material.depthWrite=!1;l.material.depthTest=n.material.depthTest=!1;l.material.defines.HORIZONTAL=1;l.material.defines.KERNEL_RADIUS=n.material.defines.KERNEL_RADIUS=c.toFixed(1);m&&(n.material.transparent=!0,n.material.blending=THREE.NormalBlending);f&&(l.material.defines.HAS_ALPHA=n.material.defines.HAS_ALPHA="");d&&(l.material.defines.FLIP_UV="")};AutodeskNamespace("Autodesk.Viewing.Private");
(function(){var a=Autodesk.Viewing.Private;a.AnimationHandler=function(){this.animations=[]};a.AnimationHandler.prototype.init=function(a){if(!0===a.initialized)return a;for(var c=0;c<a.hierarchy.length;c++){for(var f=0;f<a.hierarchy[c].keys.length;f++)if(0>a.hierarchy[c].keys[f].time&&(a.hierarchy[c].keys[f].time=0),void 0!==a.hierarchy[c].keys[f].rot&&!(a.hierarchy[c].keys[f].rot instanceof THREE.Quaternion)){var d=a.hierarchy[c].keys[f].rot;Array.isArray(d)||(d=[d._x,d._y,d._z,d._w]);a.hierarchy[c].keys[f].rot=
(new THREE.Quaternion).fromArray(d)}for(f=1;f<a.hierarchy[c].keys.length;f++)a.hierarchy[c].keys[f].time===a.hierarchy[c].keys[f-1].time&&(a.hierarchy[c].keys.splice(f,1),f--);for(f=0;f<a.hierarchy[c].keys.length;f++)a.hierarchy[c].keys[f].index=f}a.initialized=!0;return a};a.AnimationHandler.prototype.parse=function(a){function c(a,b){b.push(a);if(a.children&&!(a instanceof THREE.Camera))for(var f=0;f<a.children.length;f++)c(a.children[f],b)}var f=[];c(a,f);return f};a.AnimationHandler.prototype.play=
function(a){-1===this.animations.indexOf(a)&&this.animations.push(a)};a.AnimationHandler.prototype.stop=function(a){a=this.animations.indexOf(a);-1!==a&&this.animations.splice(a,1)};a.AnimationHandler.prototype.update=function(a){for(var c=0;c<this.animations.length;c++)this.animations[c].update(a)};a.Animation=function(a,c,f){this.root=a;this.handler=f.animationHandler;this.data=this.handler.init(c);this.hierarchy=this.handler.parse(a);this.viewer=f.viewer;this.animator=f;this.currentTime=0;this.timeScale=
1;this.isPlaying=!1;this.isPaused=!0;this.loop=!1;this.delta=.5;this.interpolationType=0;this.setStartAndEndKeyTime()};a.Animation.prototype.setStartAndEndKeyTime=function(){if(0<this.data.hierarchy.length){var a=this.data.hierarchy[0].keys;this.startKeyTime=a[0].time;this.endKeyTime=a[a.length-1].time}else this.startKeyTime=this.endKeyTime=0};a.Animation.prototype.keyTypes=[];a.Animation.prototype.defaultKey={};a.Animation.prototype.play=function(a){this.currentTime=void 0!==a?a:0;this.isPlaying=
!0;this.isPaused=!1;this.reset();this.handler.play(this)};a.Animation.prototype.pause=function(){!0===this.isPaused?this.handler.play(this):this.handler.stop(this);this.isPaused=!this.isPaused};a.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1;this.handler.stop(this)};a.Animation.prototype.goto=function(a){this.isPlaying||this.play();this.isPaused||this.pause();this.update(a-this.currentTime)};a.Animation.prototype.reset=function(){for(var a=0,c=this.hierarchy.length;a<c;a++){var f=
this.hierarchy[a];void 0===f.animationCache&&(f.animationCache={});void 0===f.animationCache[this.data.name]&&(f.animationCache[this.data.name]={prevKey:this.defaultKey,nextKey:this.defaultKey,originalMatrix:f.matrix});for(var f=f.animationCache[this.data.name],d=0;d<this.keyTypes.length;d++){for(var g=this.keyTypes[d],h=this.data.hierarchy[a].keys[0],k=this.getNextKeyWith(g,a,1);k.time<this.currentTime&&k.index>h.index;)h=k,k=this.getNextKeyWith(g,a,k.index+1);f.prevKey[g]=h;f.nextKey[g]=k}}this.setStartAndEndKeyTime()};
a.Animation.prototype.getNextKeyWith=function(a,c,f){var d=this.data.hierarchy[c].keys;for(f=1===this.interpolationType||2===this.interpolationType?f<d.length-1?f:d.length-1:f%d.length;f<d.length;f++)if(void 0!==d[f][a])return d[f];return this.data.hierarchy[c].keys[0]};a.Animation.prototype.getPrevKeyWith=function(a,c,f){var d=this.data.hierarchy[c].keys;for(f=1===this.interpolationType||2===this.interpolationType?0<f?f:0:0<=f?f:f+d.length;0<=f;f--)if(void 0!==d[f][a])return d[f];return this.data.hierarchy[c].keys[d.length-
1]};a.Animation.prototype.isPlayingOutOfRange=function(){return!1===this.isPaused&&(this.currentTime<this.startKeyTime-this.delta||this.currentTime>this.endKeyTime+this.delta)};a.Animation.prototype.resetIfLooped=function(){!0===this.loop&&this.currentTime>this.endKeyTime&&(this.currentTime%=this.endKeyTime,this.reset())};a.MeshAnimation=function(b,c,f){a.Animation.call(this,b,c,f);this.localMatrix=new THREE.Matrix4;this.root.getAnimTransform();this.relativeTransform=c.custom&&c.custom.transform&&
"abs"===c.custom.transform?!1:!0};a.MeshAnimation.prototype=Object.create(a.Animation.prototype);a.MeshAnimation.prototype.constructor=a.MeshAnimation;a.MeshAnimation.prototype.keyTypes=["pos","rot","scl"];a.MeshAnimation.prototype.defaultKey={pos:0,rot:0,scl:0};a.MeshAnimation.prototype.update=function(){var a=[],c,f,d;return function(g){if(!1!==this.isPlaying&&(this.currentTime+=g*this.timeScale,c||(c=new THREE.Vector3,f=new THREE.Vector3,d=new THREE.Quaternion),this.resetIfLooped(),!this.isPlayingOutOfRange())){g=
0;for(var h=this.hierarchy.length;g<h;g++){for(var k=this.hierarchy[g],l=k.animationCache[this.data.name],n=0;n<this.keyTypes.length;n++){var q=this.keyTypes[n],m=l.prevKey[q],p=l.nextKey[q];if(p.time<=this.currentTime||m.time>=this.currentTime){m=this.data.hierarchy[g].keys[0];for(p=this.getNextKeyWith(q,g,1);p.time<this.currentTime&&p.index>m.index;)m=p,p=this.getNextKeyWith(q,g,p.index+1);l.prevKey[q]=m;l.nextKey[q]=p}var t=m[q],r=p[q];if(p.time!==m.time&&void 0!==t&&void 0!==r){var B=(this.currentTime-
m.time)/(p.time-m.time);0>B&&(B=0);1<B&&(B=1);"pos"===q?0===this.interpolationType?(f.x=t[0]+(r[0]-t[0])*B,f.y=t[1]+(r[1]-t[1])*B,f.z=t[2]+(r[2]-t[2])*B,k.position.copy(f)):(a[0]=this.getPrevKeyWith("pos",g,m.index-1).pos,a[1]=t,a[2]=r,a[3]=this.getNextKeyWith("pos",g,p.index+1).pos,B=.33*B+.33,q=interpolateCatmullRom(a,B),f.x=q[0],f.y=q[1],f.z=q[2],k.position.copy(f),2===this.interpolationType&&(B=interpolateCatmullRom(a,1.01*B),c.set(B[0],B[1],B[2]),c.sub(vector),c.y=0,c.normalize(),B=Math.atan2(c.x,
c.z),k.rotation.set(0,B,0))):"rot"===q?(THREE.Quaternion.slerp(t,r,d,B),k.quaternion.copy(d)):"scl"===q&&(f.x=t[0]+(r[0]-t[0])*B,f.y=t[1]+(r[1]-t[1])*B,f.z=t[2]+(r[2]-t[2])*B,k.scale.copy(f))}}this.relativeTransform&&k.updateAnimTransform()}}}}();a.CameraAnimation=function(b,c,f){a.Animation.call(this,b,c,f)};a.CameraAnimation.prototype=Object.create(a.Animation.prototype);a.CameraAnimation.prototype.constructor=a.CameraAnimation;a.CameraAnimation.prototype.keyTypes=["pos","up","target","fov","perspective"];
a.CameraAnimation.prototype.defaultKey={pos:0,up:0,target:0,fov:0,perspective:0};a.CameraAnimation.prototype.update=function(){var a=[],c,f;return function(d){if(!1!==this.isPlaying&&(this.currentTime+=d*this.timeScale,c||(c=new THREE.Vector3,f=new THREE.Vector3),this.resetIfLooped(),!this.isPlayingOutOfRange())){d=0;for(var g=this.hierarchy.length;d<g;d++){for(var h=this.hierarchy[d],k=h.animationCache[this.data.name],l=0;l<this.keyTypes.length;l++){var n=this.keyTypes[l],q=k.prevKey[n],m=k.nextKey[n];
if(m.time<=this.currentTime||q.time>=this.currentTime){q=this.data.hierarchy[d].keys[0];for(m=this.getNextKeyWith(n,d,1);m.time<this.currentTime&&m.index>q.index;)q=m,m=this.getNextKeyWith(n,d,m.index+1);k.prevKey[n]=q;k.nextKey[n]=m}var p=q[n],t=m[n];if(m.time!==q.time&&void 0!==p&&void 0!==t){var r=(this.currentTime-q.time)/(m.time-q.time);0>r&&(r=0);1<r&&(r=1);var B;if("pos"===n)B=h.position;else if("up"===n)B=h.up;else if("target"===n)B=h.target;else if("fov"===n){h.setFov(p+(t-p)*r);continue}else if("perspective"===
n){(.5<r?t:p)?h.toPerspective():h.toOrthographic();continue}0===this.interpolationType?(f.x=p[0]+(t[0]-p[0])*r,f.y=p[1]+(t[1]-p[1])*r,f.z=p[2]+(t[2]-p[2])*r,B.copy(f)):(a[0]=this.getPrevKeyWith(n,d,q.index-1)[n],a[1]=p,a[2]=t,a[3]=this.getNextKeyWith(n,d,m.index+1)[n],r=.33*r+.33,n=interpolateCatmullRom(a,r),f.x=n[0],f.y=n[1],f.z=n[2],B.copy(f),2===this.interpolationType&&(r=interpolateCatmullRom(a,1.01*r),c.set(r[0],r[1],r[2]),c.sub(B),c.y=0,c.normalize(),r=Math.atan2(c.x,c.z),h.rotation.set(0,r,
0)))}}h.matrixAutoUpdate=!0;h.matrixWorldNeedsUpdate=!0}h.lookAt(h.target);this.animator.updateFlag|=this.animator.UPDATE_CAMERA}}}();a.VisibilityAnimation=function(b,c,f,d){a.Animation.call(this,b,c,d);this.nodeId=f;this.epsilon=.1;this.root.setMaterial(this.viewer.matman().cloneMaterial(b.getMaterial()))};a.VisibilityAnimation.prototype=Object.create(a.Animation.prototype);a.VisibilityAnimation.prototype.constructor=a.VisibilityAnimation;a.VisibilityAnimation.prototype.keyTypes=["vis","opa"];a.VisibilityAnimation.prototype.defaultKey=
{viz:1,opa:1};a.VisibilityAnimation.prototype.update=function(){return function(a){if(!1!==this.isPlaying&&(this.currentTime+=a*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange())){a=0;for(var c=this.hierarchy.length;a<c;a++)for(var f=this.hierarchy[a],d=f.animationCache[this.data.name],g=0;g<this.keyTypes.length;g++){var h=this.keyTypes[g],k=d.prevKey[h],l=d.nextKey[h];if(l.time<=this.currentTime||k.time>=this.currentTime){k=this.data.hierarchy[a].keys[0];for(l=this.getNextKeyWith(h,
a,1);l.time<this.currentTime&&l.index>k.index;)k=l,l=this.getNextKeyWith(h,a,l.index+1);d.prevKey[h]=k;d.nextKey[h]=l}var n=k[h],q=l[h];if(l.time!==k.time&&void 0!==n&&void 0!==q){var m=f.getMaterial();"vis"===h?(k=(h=Math.abs(this.currentTime-l.time)<this.epsilon)?l:k,n=h?q:n,1===n&&void 0===k.opa&&(m.transparent=!1,m.opacity=1),this.viewer.visibilityManager.setVisibilityOnNode(this.nodeId,n)):"opa"===h&&(k=(this.currentTime-k.time)/(l.time-k.time),0>k&&(k=0),1<k&&(k=1),n+=(q-n)*k,m.transparent=
1!==n,m.opacity=n,0<n&&this.viewer.visibilityManager.setVisibilityOnNode(this.nodeId,1))}}}}}();a.AnnotationAnimation=function(b,c,f){function d(a,b,c){var d=g.container=document.createElement("div"),f=a.name;d.id=f;d.style.cursor="pointer";d.style.visibility=c;var m=document.createElement("div");m.id=f+"-txt";m.style.cssText="display: none;position: absolute;z-index: 1;";d.appendChild(m);c=document.createElement("img");c.src=a.custom&&a.custom.att&&1===a.custom.att?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABv1BMVEUAAAAAAAAAAAAAAAABAwEAAAAAAAAjSRkAAAAFDASJqnZhg1IqTyAjSRkpTx8hRxggRRcAAAAhRRcKFwgAAACau4R9mnFmiFUhSBgbOhMZNhIAAAAECQMgQxcAAAAAAAAAAAAHDwXB2q2jw4yfvoivyJ6fuI6mv5eSr4KAoWu2trZpiV3Nzc0wVSUhRxhNT01vb28AAAAgRBcAAAAAAAAAAAAhRxgeQBYAAAAAAAAAAAAfQRbP5MC0zqCqyJKpyJJBYje3z6WxyKOFpXF9nmkrTiG+wb5xkGVcf0xYfEg1WSpNTU0hRhgfQhYfQhZVVVVAQEAXMREcOhQcHBwSJw0AAAAAAAAWLxAVLQ8AAAAAAAAfQhYIEgYAAACbvn+DsGCGsmSUunaItGXc6dStypelxY2ZvX2Ntm2JtGnS48fB17G40aWNuWucxH6ny4mUvnPF27aPuHCEsGHV5czI3Lq52KGvzJqz1JmqyJOqzY6ew4OYwHiGs2OEsWHb29vL4LvM5bnD3q2+3KWkyoaLtWuKtmfOzs7IyMi21pyawXqPuG/g4ODX68fI4rTG4LCu0ZKszJKlx4qZwHuBnXR2iXENcZskAAAAXnRSTlMAEAIBCAsF6BUn+vPu7erjsZyBEwP99/TRk3JgRUQ1IxwO/v79/Pv6+fn09PPq08q7sqWDe2xrY01AMBj+/v7+/v37+fn59fXz8u/c1cbFxLWonZiIcm1lYVdSQT8de/EoFwAAAgVJREFUOMutklVz21AQRiNFlswYs+M6DTdN0kCDZWZmuAKDZFtgiO2YYm6TlOEHV53ptGs5j93Xc+a7e3d36P/W9prdZ/PZ17aPxphz3mR0x91G07wTG8TDo5R3HLGH3S6fGPdSo8Na/to6W2HZBEqwPCNULlu1BkFdQSyKx4qxOMoyDDJSRB/HnTcqWbSbTmVS6V3E57hvXicOBZd1gmfj6Z1kPrmTjrMMfRizumDA+k3UTcRSyWg0mkzFEgLNlU3rIIJcns0KqJjJq0I+U0SqUJlZJv8JugU3J/QnHEwu6MCMqPN1pq+H3sFxCgOC7RyT48Ev6qLUL/gmeJrJ/p0DzSnyxTtAGLMbv9dohv8zSbomSqUpOxB0AdNXsUbnGEEQmJzKq3JrLgCaJAzms5LI1enfVefEamc/YzYQYFB6/1xBUsQex3E9UZHkUvO6X48PwQjLTKEjVRVFqUqd8v6naQsMUCNcL8xTrVJZluXyl1K7OW1+7sL71x15cvVH43O7UGi3mmc8lkCE0ByMbvXazwueycbHxiXPrUdv3hLDGiF8au/d4sO7Novtnj9k0BO45uRGTp98f2JlK/RqYzN8TK8bGTjZLTXgfvDp6rMNA0ZADAOWHI6VTYwE4WAZjz/s3V5yvIxADosIPlh0BNXHSdA8LFIfDgE8WDg5hmmx9h/40fgXth2SDk3yjP4AAAAASUVORK5CYII=":
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABvFBMVEUAAAAAAAADAAAAAAAAAAACAAAAAAAAAAC5PznHVE8BAAAAAADbc27NXVeUDQaZDQaRBwAAAAAAAACHBgDuhoHVa2W9RD2QCAKYCAGPBgB0BQAAAAAAAACMBgAAAAADAAD2jonWb2n2jYjYbWfmeXPNzc3RYFqzODKfFA1RUVGKBgCVBwBvb2+WBwCBBgCFBgCWBwCLBgAAAAAAAACMBgCTBwByBQCTBwBbBACEBgAAAAAAAAAoAgBSBADgeHOoOzXmfnnofnjieHPGvr63t7e0tLTidW/ebmnba2XWZWDAT0qRHBfBSkRNTU2aFxGOBgBYTEsAAACNBgBAQEAAAABbBQAcHBxyBQBKBAAAAABfBAAAAAAAAAAsAgAkAgCJBgDZRT3MOTHQPDTVQjrlUkrjUEjRPjbOOjP/bGTvXFTqV0/fTETNOjL5Zl7eS0PzYFjxXlbiT0fUQTn0e3T7aGDWXFXbSEDTRj/PQTrOPjbb29vgamTxY1zoVE3STETTQjvSPzfOzs7IyMj5g3zzaWLXY13XYVrsXlbbU0zg4OD8lZD4gXq0eHXqd3HscWv2b2jrZmDQZWDdWVLkV1C5y9+5AAAAYHRSTlMAAgUBDggMEeDsIBj+8NHJxpxAEP754tDDtIFsYDkvI/78+/j08/DfycfHxbuvr5mTjYN0bWxkWVZTTDUjEfz8+/n59fT08vHw8PDw5NzV0Mq5uLWrm5iLfX1hV0g/ODZEwKduAAACAklEQVQ4y62SVXPbQBzEa1mWZYaY49ihBhtmKjMzw92JLLBsyxxT2mCZvnCVmU59VpO37Ms97G929nb+p05WXUvTE5GJ6aWuY+yFEdoVdAZd9MjCEYi5J0L3FZutSqVZdIYiPWaj/85j2yszAACGVyq7Lo+RIMZtxRaQOZaTwZZSLbrGLR2+aX54twVykpgVpRzgYbVGz5twYMPTV2ZkKZMupDOSzAiwfNazgQesDO9VASemU6lUWuQAgnyNXsEiiBlbEwE2W9CBQpbVAfRraIZoA5ZosII6EpB6MYrVpLxOQejowKsBL9UGSK+zCnnsF4omB7wkBkQHylDZ+rcDROD3hYcYQE0NHQhQ4f8uCQVG/XF9isJKLtI1TYBQQAgdPlqJzYcWMYBYd58/YJACD6UgpsTVA+51AhvKGgt9zQGN1xN4Dajs/vbtmBXf2mIP3/jGqiW9Q0nlGtn8tXBSnwGPWHYP5PcbLMs2JHFn+6p7WQ/ARTie3/rZm9+pZ+rfP/fawi8dhOFgqLlLX87dHOz/1D9ou/vsrcNiNgBrZzbf338yOXZvbDL2xm4ljCdn6j794cpswr/62p+wWy2m/042oQeMxudedK8mSdzGAy4/9vlm/STRtjGRTz9u3nnge2U3+O2h4o9GfXG7lcLKGWZY8ycduG3sQJCk0Tb+w3S0/Qemc4+eJchuZgAAAABJRU5ErkJggg==";
c.id=f+"-img";c.style.cssText="display: block;position: absolute;z-index: 1;";d.appendChild(c);b.api.container.appendChild(d);d.addEventListener("click",function(){m.style.display="none"===m.style.display?"block":"none"});a=new THREE.SphereGeometry(.01);d=new THREE.MeshPhongMaterial({color:32512,ambient:32512,opacity:.6,transparent:!0});a=new THREE.Mesh(a,d);a.visible=!1;void 0===b.overlayScenes.annotation&&b.createOverlayScene("annotation");b.addOverlay("annotation",a);return a}var g=this;null===
b&&(b=d(c,f.viewer,"hidden"));a.Animation.call(this,b,c,f);this.id=c.name;this.text="";this.state="hidden";this.epsilon=.1;this.viewer.api.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,function(a){g.updateText(b.position,g.text)})};a.AnnotationAnimation.prototype=Object.create(a.Animation.prototype);a.AnnotationAnimation.prototype.constructor=a.AnnotationAnimation;a.AnnotationAnimation.prototype.keyTypes=["pos","text","vis"];a.AnnotationAnimation.prototype.defaultKey={pos:0,text:"",vis:1};
a.AnnotationAnimation.prototype.stop=function(){a.Animation.prototype.stop.call(this);this.container.parentNode.removeChild(this.container);this.viewer.removeOverlay("annotation",this.root);this.root=null};a.AnnotationAnimation.prototype.updateText=function(a,c){var f;f=this.viewer.camera;var d=this.viewer.canvas,g=a.clone(),h=new THREE.Matrix4;f.updateMatrixWorld();f.matrixWorldInverse.getInverse(f.matrixWorld);h.multiplyMatrices(f.projectionMatrix,f.matrixWorldInverse);g.applyProjection(h);f={x:(g.x+
1)*d.width/2+d.offsetLeft,y:(-g.y+1)*d.height/2+d.offsetTop};if(d=document.getElementById(this.id+"-txt"))d.innerHTML=c,d.style.left=f.x+"px",d.style.top=f.y+"px",this.text=c;if(d=document.getElementById(this.id+"-img"))d.style.left=f.x+"px",d.style.top=f.y-24+"px"};a.AnnotationAnimation.prototype.update=function(){var a=[],c,f;return function(d){if(!1!==this.isPlaying&&(this.currentTime+=d*this.timeScale,c||(c=new THREE.Vector3,f=new THREE.Vector3),this.resetIfLooped(),!this.isPlayingOutOfRange()))if(this.isPaused&&
this.currentTime<this.startKeyTime){var g=document.getElementById(this.id);g&&(g.style.visibility=this.state)}else{d=0;for(var h=this.hierarchy.length;d<h;d++){for(var k=this.hierarchy[d],l=k.animationCache[this.data.name],n=0;n<this.keyTypes.length;n++){var q=this.keyTypes[n],m=l.prevKey[q],p=l.nextKey[q];if(p.time<=this.currentTime||m.time>=this.currentTime){m=this.data.hierarchy[d].keys[0];for(p=this.getNextKeyWith(q,d,1);p.time<this.currentTime&&p.index>m.index;)m=p,p=this.getNextKeyWith(q,d,
p.index+1);l.prevKey[q]=m;l.nextKey[q]=p}var t=m[q],r=p[q];if(p.time!==m.time&&void 0!==t&&void 0!==r)if(g=(this.currentTime-m.time)/(p.time-m.time),0>g&&(g=0),1<g&&(g=1),"pos"===q)if(0===this.interpolationType)f.x=t[0]+(r[0]-t[0])*g,f.y=t[1]+(r[1]-t[1])*g,f.z=t[2]+(r[2]-t[2])*g,k.position.copy(f);else{if(1===this.interpolationType||2===this.interpolationType)a[0]=this.getPrevKeyWith("pos",d,m.index-1).pos,a[1]=t,a[2]=r,a[3]=this.getNextKeyWith("pos",d,p.index+1).pos,g=.33*g+.33,p=interpolateCatmullRom(a,
g),f.x=p[0],f.y=p[1],f.z=p[2],k.position.copy(f),2===this.interpolationType&&(p=interpolateCatmullRom(a,1.01*g),c.set(p[0],p[1],p[2]),c.sub(vector),c.y=0,c.normalize(),p=Math.atan2(c.x,c.z),k.rotation.set(0,p,0))}else"text"===q?(p=Math.abs(this.currentTime-p.time)<this.epsilon?r:t,this.updateText(k.position,p)):"vis"===q&&(g=document.getElementById(this.id))&&(p=Math.abs(this.currentTime-p.time)<this.epsilon?r:t,g.style.visibility=p?"visible":"hidden")}k.matrixAutoUpdate=!0;k.matrixWorldNeedsUpdate=
!0}}}}();a.PolylineAnimation=function(b,c,f){this.viewer=f.viewer;null===b&&(b=this.createPolyline([]));a.Animation.call(this,b,c,f);this.epsilon=.1};a.PolylineAnimation.prototype=Object.create(a.Animation.prototype);a.PolylineAnimation.prototype.constructor=a.PolylineAnimation;a.PolylineAnimation.prototype.keyTypes=["points","vis"];a.PolylineAnimation.prototype.defaultKey={points:[],vis:1};a.PolylineAnimation.prototype.stop=function(){a.Animation.prototype.stop.call(this);this.viewer.removeOverlay("polyline",
this.root);this.root=null};a.PolylineAnimation.prototype.update=function(){function a(b){b.root&&(b.viewer.removeOverlay("polyline",b.root),b.root=null)}return function(c){if(!1!==this.isPlaying&&(this.currentTime+=c*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))if(this.isPaused&&this.currentTime<this.startKeyTime)a(this);else{c=0;for(var f=this.hierarchy.length;c<f;c++)for(var d=this.hierarchy[c].animationCache[this.data.name],g=0;g<this.keyTypes.length;g++){var h=this.keyTypes[g],
k=d.prevKey[h],l=d.nextKey[h];if(l.time<=this.currentTime||k.time>=this.currentTime){k=this.data.hierarchy[c].keys[0];for(l=this.getNextKeyWith(h,c,1);l.time<this.currentTime&&l.index>k.index;)k=l,l=this.getNextKeyWith(h,c,l.index+1);d.prevKey[h]=k;d.nextKey[h]=l}var n=k[h],q=l[h];if(l.time!==k.time&&void 0!==n&&void 0!==q)if(k=(this.currentTime-k.time)/(l.time-k.time),0>k&&(k=0),1<k&&(k=1),"points"===h){h=.5>k?n:q;this.viewer.removeOverlay("polyline",this.root);this.root=null;for(var l=[],m=0;m<
h.length;m++){var p=h[m].slice();if(0===m)p[0]=n[m][0]+(q[m][0]-n[m][0])*k,p[1]=n[m][1]+(q[m][1]-n[m][1])*k,p[2]=n[m][2]+(q[m][2]-n[m][2])*k;else if(m===h.length-1){var t=n.length-1,r=q.length-1;p[0]=n[t][0]+(q[r][0]-n[t][0])*k;p[1]=n[t][1]+(q[r][1]-n[t][1])*k;p[2]=n[t][2]+(q[r][2]-n[t][2])*k}p=new THREE.Vector3(p[0],p[1],p[2]);l.push(p)}this.root=this.createPolyline(l)}else"vis"===h&&(n=Math.abs(this.currentTime-l.time)<this.epsilon?q:n,(this.root.visible=n)||a(this))}}}}();a.PolylineAnimation.prototype.createPolyline=
function(a){for(var c=new THREE.Geometry,f=0;f<a.length;f++)c.vertices.push(a[f]);c.computeLineDistances();a=new THREE.LineDashedMaterial({color:0,dashSize:1,gapSize:.5,linewidth:1});c=new THREE.Line(c,a,THREE.LineStrip);void 0===this.viewer.overlayScenes.polyline&&this.viewer.createOverlayScene("polyline");this.viewer.addOverlay("polyline",c);return c};a.interpolateCatmullRom=function(a,c){function f(a,b,c,d,f,g,h){a=.5*(c-a);d=.5*(d-b);return(2*(b-c)+a+d)*h+(-3*(b-c)-2*a-d)*g+a*f+b}var d=[],g=[],
h,k,l,n,q,m;h=(a.length-1)*c;k=Math.floor(h);h-=k;d[0]=0===k?k:k-1;d[1]=k;d[2]=k>a.length-2?k:k+1;d[3]=k>a.length-3?k:k+2;k=a[d[0]];n=a[d[1]];q=a[d[2]];m=a[d[3]];d=h*h;l=h*d;g[0]=f(k[0],n[0],q[0],m[0],h,d,l);g[1]=f(k[1],n[1],q[1],m[1],h,d,l);g[2]=f(k[2],n[2],q[2],m[2],h,d,l);return g}})();AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.Private.KeyFrameAnimator=function(a,b){this.animations=[];this.viewer=a;this.keys=[];this.isPlaying=!1;this.isPaused=!0;this.updateFlag=0;this.duration=b;this.currentTime=0;this.onPlayCallback=null;this.animationHandler=new Autodesk.Viewing.Private.AnimationHandler;this.areCameraAnimationsPaused=!1;this.UPDATE_SCENE=1;this.UPDATE_CAMERA=2};
Autodesk.Viewing.Private.KeyFrameAnimator.prototype.add=function(a){if(!(!a.hierarchy||1>a.hierarchy.length||!a.hierarchy[0].keys||2>a.hierarchy[0].keys.length)){var b=null,c=this;"camera"===a.type?(b=new Autodesk.Viewing.Private.CameraAnimation(c.viewer.camera,a,c),c.animations.push(b)):"annotation"===a.type?(b=new Autodesk.Viewing.Private.AnnotationAnimation(null,a,c),c.animations.push(b)):"polyline"===a.type?(b=new Autodesk.Viewing.Private.PolylineAnimation(null,a,c),c.animations.push(b)):"mesh"!==
a.type&&"visibility"!==a.type||c.viewer.model.getData().instanceTree.enumNodeFragments(a.id,function(d){if(d=c.viewer.getFragmentProxy(c.viewer.model,d))b="mesh"===a.type?new Autodesk.Viewing.Private.MeshAnimation(d,a,c):new Autodesk.Viewing.Private.VisibilityAnimation(d,a,a.id,c),c.animations.push(b)},!0);if(b){for(var f=0,d=a.hierarchy.length;f<d;f++)for(var g=a.hierarchy[f].keys,h=0;h<g.length;h++)void 0===g[h].xk&&c.keys.push(g[h].time);(function(a){a.sort(function(a,b){return a-b});(function(a,
b,c){for(b=a.length;c=--b;)for(;c--;)a[b]!==a[c]||a.splice(c,1)})(a)})(c.keys)}this.updateFlag|=this.UPDATE_SCENE}};
Autodesk.Viewing.Private.KeyFrameAnimator.prototype.update=function(a){this.animationHandler.update(a);var b=this.updateFlag;if(this.isPlaying&&!this.isPaused){this.currentTime+=a;this.currentTime=Math.min(this.currentTime,this.duration);if(this.onPlayCallback)this.onPlayCallback(0<this.duration?this.currentTime/this.duration*100:0);this.currentTime>=this.duration&&this.pause();b|=this.UPDATE_SCENE}this.updateFlag=0;return b};
Autodesk.Viewing.Private.KeyFrameAnimator.prototype.play=function(a,b){this.onPlayCallback=b;this.currentTime>=this.duration&&this.goto(0);if(this.isPlaying)this.pause();else{for(var c=0;c<this.animations.length;c++)this.animations[c].play(a);this.isPlaying=!0;this.isPaused=!1}};Autodesk.Viewing.Private.KeyFrameAnimator.prototype.pause=function(){for(var a=0;a<this.animations.length;a++){var b=this.animations[a];b.isPaused===this.isPaused&&b.pause()}this.areCameraAnimationsPaused=this.isPaused=!this.isPaused};
Autodesk.Viewing.Private.KeyFrameAnimator.prototype.pauseCameraAnimations=function(){for(var a=0;a<this.animations.length;a++){var b=this.animations[a];b instanceof Autodesk.Viewing.Private.CameraAnimation&&b.pause()}this.areCameraAnimationsPaused=!this.areCameraAnimationsPaused};Autodesk.Viewing.Private.KeyFrameAnimator.prototype.stop=function(){for(var a=0;a<this.animations.length;a++)this.animations[a].stop();this.isPaused=this.isPlaying=!1};
Autodesk.Viewing.Private.KeyFrameAnimator.prototype.goto=function(a){if(void 0!==a){for(var b=0;b<this.animations.length;b++)this.animations[b].goto(a);this.isPaused=this.isPlaying=!0;this.currentTime=a;this.updateFlag|=this.UPDATE_SCENE}};Autodesk.Viewing.Private.KeyFrameAnimator.prototype.next=function(){for(var a=this.keys,b=-1,c=0;c<a.length;c++)if(a[c]>this.currentTime){b=a[c];break}this.goto(0>b?a[a.length-1]:b)};
Autodesk.Viewing.Private.KeyFrameAnimator.prototype.prev=function(){for(var a=this.keys,b=-1,c=a.length-1;-1<c;c--)if(a[c]<this.currentTime){b=a[c];break}this.goto(0>b?a[0]:b)};AutodeskNamespace("Autodesk.Viewing.Private");void 0===ENABLE_DEBUG&&(ENABLE_DEBUG=!0);void 0===ENABLE_TRACE&&(ENABLE_TRACE=!0);var RENDER_NORMAL=0,RENDER_HIGHLIGHTED=1,RENDER_HIDDEN=2,RENDER_FINISHED=3;
Autodesk.Viewing.Private.Viewer3DImpl=function(a,b){function c(a){var b=m,c=b==RENDER_NORMAL,d=G.settings.idbuffer&&b!=RENDER_HIDDEN;b==RENDER_HIDDEN?a.overrideMaterial=h.fadeMaterial:b==RENDER_HIGHLIGHTED&&(a.overrideMaterial=h.highlightMaterial);G.renderScenePart(a,!0,c,d);a.overrideMaterial=null}function f(){if((V.enabled||O)&&!h.is2d){var a;if(a=h.model&&!h.model.isLoadDone()?h.model.getData().bbox:h.getVisibleBounds(!0,!1)){V.needClear=!0;var b=h.camera,c=a.clone(),d=new THREE.Vector3(1,0,0),
f=c.center();a=c.size();b.worldUpTransform&&(d.applyMatrix4(b.worldUpTransform),c.applyMatrix4(b.worldUpTransform),a=c.size());a.multiply(new THREE.Vector3(1.25,1.01,1.25));a.x=a.z=Math.max(a.x,a.z);V.setTransform(f,a,b.worldup,d);O&&(c=(new THREE.Vector3).subVectors(f,b.worldup.clone().multiplyScalar(a.y/2)),O.setTransform(c,b.worldup,a))}}}function d(a,b){b.updateMatrixWorld(!0);b.traverse(function(b){var c=b.geometry;void 0!==c&&(c.boundingBox||c.computeBoundingBox(),N.copy(c.boundingBox),N.applyMatrix4(b.matrixWorld),
a.union(N))})}function g(a){if(-1==a.indexOf(";base64,")){var b=a.split(",");a=b[0].split(":")[1];b=decodeURIComponent(b[1]);return new Blob([b],{type:a})}b=a.split(";base64,");a=b[0].split(":")[1];for(var b=window.atob(b[1]),c=b.length,d=new Uint8Array(c),f=0;f<c;++f)d[f]=b.charCodeAt(f);return new Blob([d],{type:a})}var h=this,k=Autodesk.Viewing.Private,l=1E3/15,n=1E3/30,q=1E3/120,m=RENDER_NORMAL,p=-1,t=-1,r=!1,B=new THREE.Vector3(0,1,0),z="y",F,C,w,E,A,D,I,G,H=!1,K=!1,J=!1,M=!1,L,P=0,S=0,Y=0,U=
0,Z=1E3/60,da=!0,V,O,ca=function(){var a,b=0,c=0,d=0;return function(f){if(V.enabled&&!h.is2d&&A&&!da)if(f&&(V.rendered=!1),a!=A.getGeomScenes()&&(V.needClear=!0),V.needClear&&(V.clear(),V.needClear=!1,a=A.getGeomScenes(),b=a.length,c=0,d=Math.max(Math.ceil(b/10),10)),V.isValid())V.rendered||O&&O.progressive||(V.renderShadow(h.camera,G.getColorTarget()),V.rendered=!0);else{for(f=0;f<d&&c<b;){var g=a[c];g&&(g.forceVisible=!0,V.renderIntoShadow(g),g.forceVisible=!1,f++);c++}c>=b&&V.postprocess()}}}(),
W=function(){var a,b=0,c=0,d=0;return function(f){if(O&&(!O.finished||f)&&!h.is2d&&A&&!da){if(f){O.clear();O.updateCamera(h.camera);O.rendered=!1;O.finished=!1;if(O.isGroundCulled())return;a=A.getGeomScenes();b=a.length;c=0;d=Math.max(Math.ceil(b/20),1)}if(!O.isGroundCulled()){for(f=0;f<d&&c<b;){var g=a[c];g&&(g.forceVisible=!0,O.renderIntoReflection(g),g.forceVisible=!1,f++);c++}c<b?O.rendered=!1:O.finished=!0;O.rendered||O.isGroundCulled()||!(O.finished||O.progressive&&!A.isDone())||(O.postprocess(),
V.enabled&&V.isValid()&&(V.renderShadow(h.camera,O.outTarget),V.rendered=!0),O.renderReflection(h.camera,G.getColorTarget()),O.rendered=!0,A.isDone()&&(h.showGhosting&&!A.areAllVisible()?(m=RENDER_HIDDEN,A.reset(h.camera,m)):G.presentBuffer()))}}}}();this.run=function(){F=0;(function fa(a){F=window.requestAnimationFrame(fa);C&&C&&(h.camera.aspect=w/E,G.setSize(w,E),h.controls.handleResize(),O&&O.setSize(w,E),h.invalidate(!0,!0,!0),C=!1,h.api.fireEvent({type:Autodesk.Viewing.VIEWER_RESIZE_EVENT}));
D.updateMaterials();var b;if(h.keyFrameAnimator)a:{if(h.keyFrameAnimator&&(b=h.keyFrameAnimator.update(0<U?(a-U)/1E3:0))&&(h.sceneUpdated(!0),b&h.keyFrameAnimator.UPDATE_CAMERA)){b=!0;break a}b=!1}else b=!1;b=h.controls.update(a)||b||L;H=H||b;if((J=J||b)&&A){var d=A.getFragmentList(),g;for(g in h.selectionMeshes)d.getWorldMatrix(g,h.selectionMeshes[g].matrix)}J=J||G.overlayUpdate(a);g=h.model&&(h.model.isLoadDone()||1==h.model.myData.partPacksLoadDone);var k=d=h.progressiveRender?h.targetFrameTime:
1E10,p=A;M&&M&&(f(),M=!1);H||K?(g&&h.signalProgress(0,null),0<S&&(Y=.75*Y+.25*(a-S)),S=a,Y<n&&d<l?h.targetFrameTime+=1:Y>n&&d>q&&--h.targetFrameTime,h.updateCameraMatrices(),G.beginScene(h.scene,h.camera,h.lights,H),b&&h.api.fireEvent(h.cameraChangedEvent),p&&(m=p.hasHighlighted()?RENDER_HIGHLIGHTED:RENDER_NORMAL,p.reset(h.camera,m,b|H))):S=-1;ca(H);W(H);if(p&&!p.isDone())if(k=p.renderSome(c,k),p.isDone()&&m===RENDER_HIGHLIGHTED&&(m=RENDER_NORMAL,p.reset(h.camera,m),p.renderSome(c,k)),b||J||(0<U&&
(Z=.8*Z+.2*(a-U)),G.composeFinalFrame()),p.isDone()){if(m===RENDER_NORMAL&&!p.areAllVisible()&&h.showGhosting){if(!O||O.finished)m=RENDER_HIDDEN,p.reset(h.camera,m)}else m=RENDER_FINISHED,G.renderScenePart(h.sceneAfter,!0,!0,!0),G.composeFinalFrame(b&&h.skipAOWhenMoving,!0);g&&h.signalProgress(100,null)}else g&&h.signalProgress(100*p.getRenderProgress(),null);J&&(p&&p.isDone()||h.showOverlaysWhileMoving?(h.renderOverlays(),p&&!p.isDone()&&(J=!0)):G.clearAllOverlays(),G.renderScenePart(h.sceneAfter,
!0,!0,!0),G.composeFinalFrame(b&&h.skipAOWhenMoving,p&&p.isDone()),0<U&&(Z=.8*Z+.2*(a-U)));r&&!b&&h.skipAOWhenMoving&&G.composeFinalFrame();r=b;U=a;p&&p.needsRender()?(K=!0,p.resetNeedsRender()):K=!1;L=H=!1})()};this.toggleProgressive=function(a){this.progressiveRender=a;H=!0};this.toggleGhosting=function(a){this.showGhosting=a;H=!0};this.toggleOverlaysWhileMoving=function(a){this.showOverlaysWhileMoving=a};this.togglePostProcess=function(a,b){G.initPostPipeline(a,b);this.fireRenderOptionChanged();
H=!0};this.toggleCelShading=function(a){G.toggleCelShading(a);this.fireRenderOptionChanged();H=!0};this.toggleGroundShadow=function(a){V.enabled!==a&&(V.enabled=a,V.needClear=!0,f(),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))};this.setGroundShadowColor=function(a){V.enabled&&(V.setColor(a),this.invalidate(!0,!1,!1))};this.setGroundShadowAlpha=function(a){V.enabled&&(V.setAlpha(a),this.invalidate(!0,!1,!1))};this.toggleGroundReflection=function(a){a&&O||!a&&!O||(a?(O=new GroundReflection(I,
this.canvas.clientWidth,this.canvas.clientHeight),O.setClearColors(this.clearColorTop,this.clearColorBottom),O.progressive=!0,f()):(O.cleanup(),O=void 0),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))};this.setGroundReflectionColor=function(a){O&&(O.setColor(a),this.invalidate(!0,!1,!1))};this.setGroundReflectionAlpha=function(a){O&&(O.setAlpha(a),this.invalidate(!0,!1,!1))};this.setOptimizeNavigation=function(a){this.skipAOWhenMoving=a};this.renderOverlays=function(){var a=this.lightsOn;
a||this.toggleLights(!0,!0);var b;this.dir_light1&&(b=this.dir_light1.intensity,this.dir_light1.intensity=1);G.renderOverlays(this.overlayScenes,this.lights);a||this.toggleLights(!1,!0);this.dir_light1&&(this.dir_light1.intensity=b);J=!1};this.setLayerVisible=function(a,b){this.matman().setLayerVisible(a,b)};this.isLayerVisible=function(a){return this.matman().isLayerVisible(a)};this.updateCameraMatrices=function(){var a=new THREE.Matrix4,b=new THREE.Matrix4,c=new THREE.Box3;return function(){var d=
this.camera;a.compose(d.position,d.quaternion,d.scale);b.getInverse(a);d.worldup&&this.setWorldUp(d.worldup);if(this.model){var f=this.getVisibleBounds(!0,!1);c.copy(f);c.applyMatrix4(b);var g=1E-5*(c.max.z-c.min.z),h=.5*(c.max.y-c.min.y),k=-(c.max.z+g)-h,g=-(c.min.z-g)+h;d.isPerspective&&(k=Math.max(k,Math.min(1,1E-4*Math.abs(g-k))));g=Math.max(g,k);d.near=k;d.far=g;d.updateProjectionMatrix();this.model.is2d()?f=(k=this.intersectGroundViewport(new THREE.Vector3(0,0,1)))?d.position.distanceTo(k):
d.position.distanceTo(f.center()):((k=D.getCutPlanesRaw())&&k.length?(g=k[0],k=d.target.clone().sub(d.position).normalize(),h=k.dot(g),0===h?f=f.center():(f=-(d.position.clone().dot(g)+g.w)/h,f=k.multiplyScalar(f).add(d.position))):f=f.center(),f=d.position.distanceTo(f));d=G.settings.deviceHeight/(2*f*Math.tan(THREE.Math.degToRad(.5*d.fov)));D.updatePixelScale(.5*d)}}}();this.initLights=function(a){var b=k.LightPresets[p].lightMultiplier;this.lightNode=new THREE.Object3D;this.dir_light1=new THREE.DirectionalLight((new THREE.Color).setRGB(1,
1,1),b);this.dir_light1.position.set(-1,0,1);this.dir_light1.position.multiplyScalar(1E3*a);this.lightNode.add(this.dir_light1);this.amb_light=new THREE.AmbientLight((new THREE.Color).setRGB(1,1,1));this.camera.add(this.lightNode);this.toggleLights(0!==b)};this.toggleLights=function(a,b){if(this.amb_light&&this.lightNode){a&&!this.lightsOn?(this.lights=[this.dir_light1,this.amb_light],this.lightsOn=!0):!a&&this.lightsOn&&(this.lightsOn=!1,this.lights=[]);var c=k.LightPresets[p],d=c.ambientLightColor,
c=c.directLightColor;this.lightsOn?(b&&this.amb_light?this.amb_light.color.setRGB(.5*c[0],.5*c[1],.5*c[2]):d&&this.amb_light&&this.amb_light.color.setRGB(d[0],d[1],d[2]),c&&this.dir_light1&&this.dir_light1.color.setRGB(c[0],c[1],c[2])):d&&this.amb_light&&b&&this.amb_light.color.setRGB(d[0],d[1],d[2])}};this.syncCamera=function(a){this.camera.updateProjectionMatrix();a&&this.setWorldUp(this.api.navigation.getWorldUpVector());L=!0};this.setViewFromFile=function(a,b){var c;c=a.getDefaultCamera();if(!c){c=
{};var d=a.getBoundingBox(),f=d.size();c.target=d.center();a.is2d()?(c.isPerspective=!1,d=this.camera.aspect,c.orthoScale=d>f.x/f.y?f.y:f.x/d,c.up=new THREE.Vector3(0,0,1),c.position=c.target.clone(),c.position.z+=c.orthoScale,c.target.y+=1E-6*f.y):(c.isPerspective=!0,c.fov=this.camera.fov,c.up=this.camera.up.clone(),c.position=c.target.clone(),c.position.z+=1.5*Math.max(f.x,f.y,f.z))}this.setViewFromCamera(c,b)};this.adjustOrthoCamera=function(a){if(!a.isPerspective&&this.model){var b=this.model.getBoundingBox(),
c=b.size(),d=a.target.clone().sub(a.position);d.length()>1E3*c.length()?(b=a.position.distanceTo(b.center()),a.target.copy(a.position).add(d.normalize().multiplyScalar(b))):a.position.copy(a.target).add(d.normalize().multiplyScalar(-a.orthoScale))}};this.setViewFromCamera=function(a,b){this.adjustOrthoCamera(a);var c=this.model?this.model.getUpVector():null;this.model&&-1!=this.model.getData().basePath.indexOf("SaRang")&&(c=[0,0,1]);var d;d=c?(new THREE.Vector3).fromArray(c):Autodesk.Viewing.Navigation.snapToAxis(a.up.clone());
a.up=d;c=this.api.navigation;b?(d=this.camera,d.up.copy(a.up),d.position.copy(a.position),d.target.copy(a.target),a.isPerspective?d.fov=a.fov:(d.saveFov=a.fov,d.fov=Autodesk.Viewing.UnifiedCamera.ORTHO_FOV),d.isPerspective=a.isPerspective,d.orthoScale=a.orthoScale,d.dirty=!0,c.setWorldUpVector(d.up),c.setView(d.position,d.target),c.setPivotPoint(d.target),this.syncCamera(!0)):(this.camera.isPerspective=a.isPerspective,d=c.computeOrthogonalUp(a.position,a.target),c.setRequestTransitionWithUp(!0,a.position,
a.target,a.fov,d,a.up));L=!0};this.setViewFromViewBox=function(a,b,c,d){if(a.is2d()){c={};a=a.getBoundingBox();var f=b[2]-b[0],g=b[3]-b[1],h;h=b[0]+f/2;b=b[1]+g/2;var k=this.camera.aspect;c.orthoScale=k>f/g?g:f/k;c.isPerspective=!1;c.position=new THREE.Vector3(h,b,a.center().z+c.orthoScale);c.target=new THREE.Vector3(h,b,a.center().z);c.target.y+=1E-6*g;c.up=new THREE.Vector3(0,0,1);this.setViewFromCamera(c,d)}};this.setWorldUp=function(a){if(!B.equals(a)){B.copy(a);var b=Math.abs(a.x);z="x";Math.abs(a.y)>
b&&(z="y",b=Math.abs(a.y));Math.abs(a.z)>b&&(z="z");var c=new THREE.Vector3(0,1,0),b=h.camera,d=(new THREE.Vector3).crossVectors(a,c).normalize();a=Math.acos(c.dot(a));a=(new THREE.Matrix4).makeRotationAxis(d,a);b.worldUpTransform=a;this.sceneUpdated(!1)}};this.setModel=function(a){a&&(this.model=a,this.selector.setModel(this.model),this.visibilityManager.setModel(this.model),this.model.setLoader(this.loader),this.initScene())};this.initScene=function(){if(this.model){var a=this.model,b=a.getBoundingBox();
G.setUnitScale(a.getUnitScale());var c=a.is2d();c&&this.enter2DMode();this.api.navigation.setIs2D(c);this.api.setActiveNavigationTool();A=new RenderQueue(a);this.setViewFromFile(a,!0);this.controls.recordHomeView();a=.5*b.size().length();this.initLights(a);c||this.setLightPresetFromFile()||this.setLightPreset(p,!0);this.invalidate(!0)}};this.addGeometry=function(a,b,c){return A.getGeometryList().addGeometry(a,b,c)};this.addMeshInstance=function(a,b,c,d){var f=this.model.getData();a=A.getGeometryList().getGeometry(a);
if(0!==b||-1==f.basePath.indexOf("SaRang")){var g;if(a.isLines){var h=!!a.attributes.color;g=new THREE.LineBasicMaterial({vertexColors:h});h||(c=D.findMaterial(f,c),g.color=c.color);g=new THREE.Mesh(a,g,!f.animations);g.isLine=!0;f.hasLines=!0}else g=D.findMaterial(f,c),D.applyGeometryFlagsToMaterial(g,a),g=new THREE.Mesh(a,g,!f.animations),g.materialId=parseInt(c),a.is2d&&(g.is2d=!0);d&&(g.matrix&&g.matrix.copy(d),g.matrixWorld.copy(d));g.matrixAutoUpdate=!1;A.addMeshInstance(b,g)}};this.onLoadComplete=
function(){function a(){if(b.animations){c.keyFrameAnimator=new Autodesk.Viewing.Private.KeyFrameAnimator(c,b.animations.duration);for(var d in b.animations.animations)c.keyFrameAnimator.add(b.animations.animations[d]);c.keyFrameAnimator.goto(0)}c.api.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,a)}da=!1;this.signalProgress(100,"");this.sceneUpdated(!1);this.is2d&&(this.selectionMaterial2d=D.init2DSelectionMaterial(this.model),this.createOverlayScene("selection2d",this.selectionMaterial2d));
var b=this.model.getData();A.getGeometryList().printStats();b.hasLines&&D.togglePolygonOffset(!0);var c=this;this.model.isObjectTreeCreated()?a():this.api.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,a);this.api.fireEvent({type:Autodesk.Viewing.GEOMETRY_LOADED_EVENT})};this.setBVH=function(a,b){A.setBVH(a,b)};this.signalProgress=function(a,b){this.api.fireEvent({type:Autodesk.Viewing.PROGRESS_UPDATE_EVENT,percent:a,message:b})};this.resize=function(a,b){C=!0;w=a;E=b};this.enter2DMode=
function(){this.is2d=!0;D.initLayersTexture(this.model);var a=D.create2DMaterial(this.model.getData(),{},!0),a=D.findMaterial(this.model.getData(),a);G.enter2DMode(a);t=p;this.setLightPreset(k.DefaultLightPreset2d);a=this.model.getData();if(a.hidePaper){var b=a.bgColor,a=b>>16&255,c=b>>8&255,b=b&255;this.setClearColors(a,c,b,a,c,b)}this.fireRenderOptionChanged();H=!0};this.unloadCurrentModel=function(){this.is2d&&(this.is2d=void 0,this.selectionMaterial2d=null,this.removeOverlay("selection2d"),G.exit2DMode());
G.beginScene(this.scene,this.camera,this.lights,!0);G.composeFinalFrame();A&&(A.cleanup(this.glrenderer()),A=null);this.model&&(D.cleanup(this.model.getData()),this.model=null);0<=t&&(p=t)};this.createOverlayScene=function(a,b,c,d){b&&D.addMaterialNonHDR(a+"_pre",b);c&&D.addMaterialNonHDR(a+"_post",c);var f=new THREE.Scene;f.__lights=this.scene.__lights;this.overlayScenes[a]={scene:f,camera:d,materialPre:b,materialPost:c}};this.removeOverlayScene=function(a){this.overlayScenes[a]&&(delete this.overlayScenes[a],
this.invalidate(!1,!1,!0))};this.addOverlay=function(a,b){this.overlayScenes[a].scene.add(b);this.invalidate(!1,!1,!0)};this.removeOverlay=function(a,b){this.overlayScenes[a].scene.remove(b);this.invalidate(!1,!1,!0)};this.clearOverlay=function(a){if(this.overlayScenes[a]){a=this.overlayScenes[a].scene;var b,c;for(c=a.children.length-1;0<=c;--c)(b=a.children[c])&&a.remove(b);this.invalidate(!1,!1,!0)}};this.setClearColors=function(a,b,c,d,f,g){this.clearColorTop=new THREE.Vector3(a/255,b/255,c/255);
this.clearColorBottom=new THREE.Vector3(d/255,f/255,g/255);D.reflectionCube&&!D.reflectionCube.isBgColor||D.setCubeMapFromColors(this.clearColorTop,this.clearColorBottom);G.setClearColors(this.clearColorTop,this.clearColorBottom);O&&O.setClearColors(this.clearColorTop,this.clearColorBottom);H=!0;this.fireRenderOptionChanged()};var N=new THREE.Box3;this.getVisibleBounds=function(a,b){var c=null;if(A&&(c=A.getVisibleBounds(a),b)){var f=new THREE.Box3,g=h.overlayScenes,k;for(k in g)g.hasOwnProperty(k)&&
d(f,g[k].scene);d(f,h.scene);c=f.union(c)}return c};this.getFitBounds=function(a){var b;this.is2d&&(a=!0);a||null===this.selector||(b=this.selector.getSelectionBounds());if(!b||b.empty())b=this.getVisibleBounds();return b};this.getRenderProxy=function(a,b){return A?A.getFragmentList().getVizmesh(b):null};this.getFragmentProxy=function(a,b){return A?new FragmentPointer(A.getFragmentList(),b):null};this.getRenderProxyCount=function(a){return A?A.getFragmentList().getCount():0};this.getRenderProxyDbIds=
function(a,b){return A?A.getFragmentList().getDbIds(b):null};this.setFragmentVisibility=function(a,b,c){A&&(A.setVisibility(b,c),this.sceneUpdated(!0))};this.setModelVisibility=function(a,b){A&&(A.setAllVisibility(b),this.sceneUpdated(!0))};this.isWholeModelVisible=function(a){return A?A.areAllVisible():!0};this.resetIsolation=function(a){A&&(this.needGhostedPass=!1,this.invalidate(!0))};this.highlightObjectNode=function(a,b,c,d){a.is2d()&&D.highlightObject2D(b,c);var f=this,g=a.getData().instanceTree;
if(g&&!a.is2d())g.enumNodeFragments(b,function(b){f.highlightFragment(a,b,c,d)},!1);else if(g=b,a.is2d()&&(g=a.getData().fragments.dbId2fragId[b]),Array.isArray(g))for(b=0;b<g.length;b++)f.highlightFragment(a,g[b],c,d);else f.highlightFragment(a,g,c,d)};this.highlightFragment=function(a,b,c,d){var f=this.getRenderProxy(a,b);if(f){if(d=!d||f.is2d)if(a=a.is2d()?"selection2d":"selection",c){var g=new THREE.Mesh(f.geometry,f.material);g.matrix.copy(f.matrixWorld);g.matrixAutoUpdate=!1;g.matrixWorldNeedsUpdate=
!0;g.frustumCulled=!1;this.addOverlay(a,g);this.selectionMeshes[b]=g}else this.selectionMeshes[b]&&(this.removeOverlay(a,this.selectionMeshes[b]),delete this.selectionMeshes[b]);d&&c||A.setHighlighted(b,c)&&this.invalidate(!0)}};this.explode=function(a){if(a!=P&&this.model){P=a;var b=this.model.getData();if(b.instanceTree){var c=this.getVisibleBounds(!0).center(),d=b.fragments,f=a*(b.instanceTree.maxDepth-1)+1,g=0|f,h=f-g,k=A.getFragmentList(),l=new THREE.Vector3;a*=2;if(b.instanceTree&&b.instanceTree.boxes&&
0!==a){var m=b.instanceTree.boxes;(function Ja(c,d,f,n,p,q,M,z){var w=2*a;d==g&&(w*=h);var t=6*c,C=.5*(m[t]+m[t+3]),r=.5*(m[t+1]+m[t+4]),L=.5*(m[t+2]+m[t+5]);0<d&&d<=g&&(q+=(C-f)*w,M+=(r-n)*w,z+=(L-p)*w);b.instanceTree.enumNodeChildren(c,function(a){Ja(a,d+1,C,r,L,q,M,z)},!1);b.instanceTree.enumNodeFragments(c,function(a){l.x=q;l.y=M;l.z=z;k.updateAnimTransform(a,null,null,l)},!1)})(b.instanceTree.getRootId(),0,c.x,c.y,c.x,0,0,0)}else for(var f=d.boxes,n=0,d=d.length;n<d;n++)if(0==a)k.updateAnimTransform(n);
else{var p=6*n,q=.5*(f[p]+f[p+3]),M=.5*(f[p+1]+f[p+4]),p=.5*(f[p+2]+f[p+5]),q=a*(q-c.x),M=a*(M-c.y),p=a*(p-c.z);l.x=q;l.y=M;l.z=p;k.updateAnimTransform(n,null,null,l)}this.sceneUpdated(!0);this.api.fireEvent({type:Autodesk.Viewing.EXPLODE_CHANGE_EVENT})}}};this.getExplodeScale=function(){return P};this.setGhostingBrightness=function(a){this.fadeMaterial.color=a?new THREE.Color(1052688):new THREE.Color(16777215);this.fadeMaterial.needsUpdate=!0};this.setLightPreset=function(a,b){if(p!=a||b){if(0>a||
k.LightPresets.length<=a)a=k.DefaultLightPreset;p=a;var c=k.LightPresets[a];if(c&&c.path){var d="res/environments/"+c.path,f=k.getResourceUrl(d+"_mipdrop."+(c.type||"")+".dds"),d=k.getResourceUrl(d+"_irr."+(c.type||"")+".dds");D.setIrradianceMap(d,c.E_bias);D.setCubeMap(f,c.E_bias);D.setEnvExposure(-c.E_bias);this.setTonemapExposureBias(c.E_bias);this.setTonemapMethod(c.tonemap);this.setGhostingBrightness(c.darkerFade)}else D.setIrradianceMap(null),D.setCubeMap(null),D.setEnvExposure(0),this.setTonemapExposureBias(0),
this.setTonemapMethod(0),this.setGhostingBrightness(!1);f=SAOShader.uniforms.radius.value;d=SAOShader.uniforms.intensity.value;c.hasOwnProperty("saoRadius")&&(f=c.saoRadius);c.hasOwnProperty("saoIntensity")&&(d=c.saoIntensity);G.setAOOptions(f,d);(f=c.bgColorGradient)||(f=k.BackgroundPresets.Custom);this.setClearColors(f[0],f[1],f[2],f[3],f[4],f[5]);f=1;null!==c.lightMultiplier&&void 0!==c.lightMultiplier&&(f=c.lightMultiplier);this.dir_light1&&(this.toggleLights(0!==f),this.dir_light1.intensity=
f,c.lightDirection&&(this.dir_light1.position.set(-c.lightDirection[0],-c.lightDirection[1],-c.lightDirection[2]),this.dir_light1.position.multiplyScalar(1E3*this.model.getData().bbox.size().length())));this.invalidate(!0,!1,!0);this.fireRenderOptionChanged()}};this.setLightPresetFromFile=function(){var a=this.model.getMetadata("renderEnvironmentStyle","value",null);if(null===a||""===a)return!1;for(var b=this.model.getMetadata("renderEnvironmentExposureBias","value",null),c=this.model.getMetadata("renderEnvironmentExposureBase",
"value",null),d=0;d<k.LightPresets.length;d++)if(a===k.LightPresets[d].name)return null!==b&&null!==c&&(k.LightPresets[d].E_bias=b+c),this.setLightPreset(d),!0;return!1};this.setTonemapMethod=function(a){a!=G.getToneMapMethod()&&(G.setTonemapMethod(a),D.setTonemapMethod(a),this.fireRenderOptionChanged(),this.invalidate(!0))};this.setTonemapExposureBias=function(a){a!=G.getExposureBias()&&(G.setTonemapExposureBias(a),D.setTonemapExposureBias(a),this.fireRenderOptionChanged(),this.invalidate(!0))};
this.uninitialize=function(){window.cancelAnimationFrame(F);this.controls.uninitialize();this.canvas=this.controls=null;this.loader.uninitialize();this.loader=null;this.selector.uninitialize();D=G=A=this.visibilityManager=this.model=this.selector=null};this.hideLines=function(a){return A?(A.hideLines(a),this.sceneUpdated(!0),!0):!1};this.getCutPlanes=function(){return D.getCutPlanes()};this.setCutPlanes=function(a){D.setCutPlanes(a);this.sceneUpdated();this.api.fireEvent({type:Autodesk.Viewing.CUTPLANES_CHANGE_EVENT})};
this.setCutPlanesOutlineColor=function(a){D.setCutPlanesOutlineColor(a);this.invalidate(!0,!1,!1);this.api.fireEvent({type:Autodesk.Viewing.CUTPLANES_CHANGE_EVENT})};this.setCutPlanesOutlineThickness=function(a){D.setCutPlanesOutlineThickness(a);this.invalidate(!0,!1,!1);this.api.fireEvent({type:Autodesk.Viewing.CUTPLANES_CHANGE_EVENT})};this.fireRenderOptionChanged=function(){D.toggleMRTSetting();this.api.fireEvent({type:Autodesk.Viewing.RENDER_OPTION_CHANGED_EVENT})};this.viewportToRay=function(a,
b){var c=this.camera;a.z=-1;var d=new THREE.Vector3(a.x,a.y,1);a=a.unproject(c);d=d.unproject(c);d.sub(a).normalize();b||(b=new THREE.Ray);b.set(c.isPerspective?c.position:a,d);return b};this.rayIntersect=function(a,b,c){c=A.rayIntersect(a.origin,a.direction,b,c);if(!c)return null;a=c[0];b=c[1];c=c[2];var d;void 0!==a&&(d=A.getFragmentList().getDbIds(a),this.model.getData().instanceTree||(d=a));return{dbId:d,fragId:a,intersectPoint:b,face:c}};this.castRayViewport=function(){var a=new THREE.Ray;return function(b,
c,d){if(!A)return{};this.viewportToRay(b,a);return this.rayIntersect(a,c,d)}}();this.clientToViewport=function(a,b){var c=h.canvas.getBoundingClientRect();return new THREE.Vector3((a+.5)/c.width*2-1,2*-((b+.5)/c.height)+1,1)};this.viewportToClient=function(a,b){var c=h.canvas.getBoundingClientRect();return new THREE.Vector3(.5*(a+1)*c.width-.5,-.5*(b-1)*c.height-.5,0)};this.castRay=function(a,b,c){return this.castRayViewport(this.clientToViewport(a,b),c)};this.intersectGroundViewport=function(a){var b=
this.camera,c="z";this.is2d||(c=z);var d=a;d.z=-1;a=new THREE.Vector3(d.x,d.y,1);d=d.unproject(b);a=a.unproject(b);a.sub(d).normalize();if(1E-6>Math.abs(a[c]))return null;b=b.isPerspective?b.position:d;c=((this.model?this.model.getBoundingBox().min[c]:0)-b[c])/a[c];a.multiplyScalar(c);a.add(b);return a};this.intersectGround=function(a,b){return this.intersectGroundViewport(this.clientToViewport(a,b))};this.hitTestViewport=function(a,b){var c;if(h.is2d){c=G.idAtPixel(a.x,a.y);if(0>=c)return null;c=
{intersectPoint:this.intersectGroundViewport(a),dbId:c,fragId:h.model.getData().fragments.dbId2fragId[c]}}else c=this.castRayViewport(a,b);return c};this.hitTest=function(a,b,c){return h.hitTestViewport(this.clientToViewport(a,b),c)};this.snappingHitTestViewport=function(a,b){var c;if(h.is2d)c=G.idAtPixel(a.x,a.y),c={intersectPoint:this.intersectGroundViewport(a),dbId:c,fragId:h.model.getData().fragments.dbId2fragId[c]};else{c=G.idAtPixel(a.x,a.y);var d;c&&(d=[],this.model.getData().instanceTree.enumNodeFragments(c,
function(a){d.push(a)},!0));c=this.castRayViewport(a,b,d)}return c};this.snappingHitTest=function(a,b,c){return this.snappingHitTestViewport(this.clientToViewport(a,b),c)};this.rolloverObjectViewport=function(a){G.rolloverObjectViewport(a.x,a.y)&&this.invalidate(!1,!1,!0)};this.rolloverObject=function(a,b){this.rolloverObjectViewport(this.clientToViewport(a,b))};this.getScreenShot=function(a,b,c){G.presentBuffer();var d=window.URL.createObjectURL(g(h.canvas.toDataURL("image/png")));if(!a||!b)return d;
var f,k,l=0,m=0;a>b||w/E<a/b?(f=a,k=E/w*a,m=b/2-k/2):(k=b,f=w/E*b,l=a/2-f/2);var n=new Image;n.src=d;var p=document.createElement("canvas"),q=p.getContext("2d");p.width=a;p.height=b;n.onload=function(){q.drawImage(n,l,m,f,k);var a=window.URL.createObjectURL(g(p.toDataURL("image/png")));c?c(a):window.open(a)}};this.modelQueue=function(){return A};this.glrenderer=function(){return I};this.renderer=function(){return G};this.worldUp=function(){return B};this.worldUpName=function(){return z};this.setUserRenderContext=
function(a){G=a?a:new RenderContext;G.init(I,this.canvas.clientWidth,this.canvas.clientHeight);G.setClearColors(this.clearColorTop,this.clearColorBottom);this.invalidate(!0);this.sceneUpdated(!1)};this.invalidate=function(a,b,c){H=H||a;K=K||b;J=J||c};this.sceneUpdated=function(a){this.invalidate(!0,!1,!0);A&&a&&(A.visibleBoundsDirty=!0);M=!0};this.currentLightPreset=function(){return p};this.matman=function(){return D};this.fps=function(){return 1E3/Z};this.api=b;this.canvas=a;this.loader=this.svfloader=
new k.SvfLoader(this);I=function(a){var b=window.devicePixelRatio;b||(b=1);a=new FireflyWebGLRenderer({canvas:a,antialias:!1,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,stencil:!1,depth:!1,devicePixelRatio:b});a.autoClear=!1;a.sortObjects=!1;return a}(a);G=new RenderContext;G.init(I,a.clientWidth,a.clientHeight);D=new k.MaterialManager(this);init_UnifiedCamera();this.camera=new Autodesk.Viewing.UnifiedCamera(a.clientWidth,a.clientHeight);this.lights=[];this.cameraChangedEvent=this.camera.getCameraChangedEvent();
this.scene=new THREE.Scene;this.sceneAfter=new THREE.Scene;this.sceneAfter.sortObjects=!1;this.overlayScenes={};this.selectionMaterial2d=null;this.selectionMaterialBase=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:1,transparent:!1});this.selectionMaterialTop=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:.15,transparent:!0});this.selectionMaterialTop.packedNormals=!0;this.selectionMaterialBase.packedNormals=
!0;(function(a,b,c){b.depthWrite=!1;b.depthTest=!0;b.side=THREE.DoubleSide;c.depthWrite=!1;c.depthTest=!0;c.side=THREE.DoubleSide;h.createOverlayScene(a,b,c)})("selection",this.selectionMaterialBase,this.selectionMaterialTop);this.selectionMeshes={};this.fadeMaterial=new THREE.MeshPhongMaterial({color:16777215,opacity:.1,reflectivity:0,transparent:!0,depthWrite:!1});this.fadeMaterial.packedNormals=!0;D.addMaterial("__fadeMaterial__",this.fadeMaterial,!0);this.highlightMaterial=new THREE.MeshPhongMaterial({color:6724095,
specular:526344,emissive:3361911,ambient:0,opacity:1,transparent:!1});this.highlightMaterial.packedNormals=!0;D.addMaterial("__highlightMaterial__",this.highlightMaterial,!0);this.progressiveRender=!0;if(isAndroidDevice()||isIOSDevice())l*=2,q*=2,n*=2;this.targetFrameTime=n;this.controls={update:function(a){},handleResize:function(){},recordHomeView:function(){},uninitialize:function(){}};this.selector=new k.Selector(this);this.visibilityManager=new k.VisibilityManager(this);this.showOverlaysWhileMoving=
this.showGhosting=!0;this.skipAOWhenMoving=!1;this.keyFrameAnimator=null;var ea=k.LightPresets[k.DefaultLightPreset].bgColorGradient;this.setClearColors(ea[0],ea[1],ea[2],ea[3],ea[4],ea[5]);V=new GroundShadow(I);V.enabled=!0;D.addMaterialNonHDR("groundShadowDepthMaterial",V.getDepthMaterial());D.addMaterialNonHDR("normalsMaterial",G.getDepthMaterial());G.beginScene(this.scene,this.camera,this.lights,!0);G.composeFinalFrame()};Autodesk.Viewing.Private.Viewer3DImpl.prototype.constructor=Autodesk.Viewing.Private.Viewer3DImpl;
AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.Private.ViewerState=function(a){this.getState=function(b){var c=a.navigation,f=Autodesk.Viewing.Private,d={},g;g=Math.round(4294967295*Math.random());var h=Date.now();g=g.toString(16)+h.toString(16);d.guid=g;d.seedURN=a.impl.loader.svfUrn;d.overrides=this.getTransformsOverrides();g=d.objectSet;Array.isArray(g)||(d.objectSet=g=[]);a.model&&!a.model.is2d()&&(g[0]={id:this.getSelectedNodes(),isolated:a.getIsolatedNodes(),hidden:a.getHiddenNodes(),explodeScale:a.getExplodeScale(),idType:"lmv"});
a.model&&a.model.is2d()&&(g[0]={id:this.getSelectedNodes(),isolated:this.getVisibleLayers2d(),hidden:[],idType:"lmv"});(g=d.viewport)||(g=d.viewport={});h=c.getCamera().isPerspective;g.name="";g.eye=c.getPosition().toArray();g.target=c.getTarget().toArray();g.up=c.getCamera().up.toArray();g.worldUpVector=c.getWorldUpVector().toArray();g.pivotPoint=c.getPivotPoint().toArray();g.distanceToOrbit=c.getPivotPlaneDistance();g.aspectRatio=this.getAspectRatio();g.projection=h?"perspective":"orthographic";
g.isOrthographic=!h;h?g.fieldOfView=c.getVerticalFov():g.orthographicHeight=this.getOrthographicHeight();(c=d.renderOptions)||(c=d.renderOptions={});c.environment=f.LightPresets[a.impl.currentLightPreset()].name;c.ambientOcclusion={enabled:a.impl.renderer().settings.sao,radius:a.impl.renderer().getAORadius(),intensity:a.impl.renderer().getAOIntensity()};c.toneMap={method:a.impl.renderer().getToneMapMethod(),exposure:a.impl.renderer().getExposureBias(),lightMultiplier:this.getToneMapIntensity()};c.appearance=
{ghostHidden:a.impl.showGhosting,ambientShadow:a.prefs.ambientShadows,antiAliasing:a.impl.renderer().settings.antialias,progressiveDisplay:a.prefs.progressiveRendering,displayLines:a.prefs.lineRendering};if(a.model&&!a.model.is2d())for(f=d.cutplanes=[],c=a.getCutPlanes(),g=0;g<c.length;g++)f.push(c[g].toArray());for(var k in a.loadedExtensions)a.loadedExtensions[k].getState(d);b&&!0!==b&&this.applyFilter(d,b);return d};this.restoreState=function(b,c,f){if(!b)return stderr("restoreState has no viewer state to restore from."),
!1;if(!a||!a.model)return stderr("restoreState has no viewer or model to restore."),!1;c&&!0!==c&&(b=JSON.parse(JSON.stringify(b)),this.applyFilter(b,c));c=a.navigation;if(c.getTransitionActive())return stderr("Abort restoreState, animation in progress..."),!1;if(a.model&&Array.isArray(b.objectSet)&&0<b.objectSet.length){var d=b.objectSet[0],g=a.impl?a.impl.selector:null;if(a.model.getRootId()){var h=d.id;h&&g&&(h=this.toIntArray(h),g.setSelectionIds(h));h=d.isolated||[];h=this.toIntArray(h);a.isolate(h);
0===h.length&&(h=d.hidden||null)&&0<h.length&&(h=this.toIntArray(h),a.hide(h));"explodeScale"in d&&(h=parseFloat(d.explodeScale),a.explode&&(a.explode(h),a.explodeSlider&&(a.explodeSlider.value=h)))}a.model.is2d()&&(h=d.id||[],g&&(h=h.map(function(a){return{dbId:a,fragIds:0}}),g.setSelection(h)),d=d.isolated,Array.isArray(d)&&0<d.length?(a.setLayerVisible(null,!1),a.impl.setLayerVisible(d,!0)):a.setLayerVisible(null,!0))}if(d=b.viewport){var g=this.getVector3FromArray(d.eye,c.getPosition()),h=this.getVector3FromArray(d.up,
c.getCamera().up),k=this.getVector3FromArray(d.target,c.getTarget()),l="fieldOfView"in d?parseFloat(d.fieldOfView):c.getVerticalFov(),n=this.getVector3FromArray(d.worldUpVector,null);n||(n=(n=a.model?a.model.getUpVector():null)?(new THREE.Vector3).fromArray(n):new THREE.Vector3(0,1,0));c=c.getCamera().isPerspective;"isOrthographic"in d&&(c=!d.isOrthographic);var q=this.getOrthographicHeight();"orthographicHeight"in d&&(q=Number(d.orthographicHeight));this.restoreCameraState({position:g,target:k,up:h,
worldup:n,aspect:a.impl.camera.aspect,fov:l,orthoScale:q,isPerspective:c},f)}if(g=b.renderOptions){c=a.prefs.ambientShadows;d=a.prefs.antialiasing;if(k=g.ambientOcclusion)"enabled"in k&&(c=k.enabled),h="radius"in k?k.radius:null,k="intensity"in k?k.intensity:null,null!==h&&null!==k&&(a.impl.renderer().setAOOptions(h,k),a.impl.renderer().composeFinalFrame(!1));"environment"in g&&(h=this.getLightPresetIndex(g.environment),-1!==h&&a.setLightPreset(h));if(k=g.toneMap)h="lightMultiplier"in k?k.lightMultiplier:
null,k="exposure"in k?k.exposure:null,null!==h&&null!==k&&(a.impl.dir_light1&&(a.impl.dir_light1.intensity=Math.pow(2,h)),a.impl.renderer().setTonemapExposureBias(k,h),a.impl.invalidate(!0));if(g=g.appearance)"antiAliasing"in g&&(d=g.antiAliasing),"progressiveDisplay"in g&&a.setProgressiveRendering(g.progressiveDisplay),"ghostHidden"in g&&a.setGhosting(g.ghostHidden),"displayLines"in g&&a.hideLines(!g.displayLines);a.setQualityLevel(c,d)}if(Array.isArray(b.cutplanes)&&a.model&&!a.model.is2d()){c=
[];for(d=0;d<b.cutplanes.length;d++)g=b.cutplanes[d],Array.isArray(g)&&4<=g.length&&c.push(new THREE.Vector4(g[0],g[1],g[2],g[3]));a.setCutPlanes(c)}for(var m in a.loadedExtensions)a.loadedExtensions[m].restoreState(b,f);return!0};this.restoreCameraState=function(b,c){a.impl.adjustOrthoCamera(b);var f=a.navigation;c?(b.isPerspective?f.toPerspective():f.toOrthographic(),f.setCameraUpVector(b.up),f.setWorldUpVector(b.worldup),f.setView(b.position,b.target),f.setPivotPoint(b.target),f.setVerticalFov(b.fov,
!1),a.impl.syncCamera(!0)):(a.impl.camera.isPerspective=b.isPerspective,f.setRequestTransitionWithUp(!0,b.position,b.target,b.fov,b.up,b.worldup))};this.toIntArray=function(a){var c=[];if(Array.isArray(a))for(var f=0,d=a.length;f<d;++f)c.push(parseInt(a[f]));return c};this.extractSelectedNodeIds=function(a){return a&&Array.isArray(a.objectSet)&&0<a.objectSet.length?this.toIntArray(a.objectSet[0].id):[]};this.extractIsolatedNodeIds=function(a){return a&&Array.isArray(a.objectSet)&&0<a.objectSet.length?
this.toIntArray(a.objectSet[0].isolated):[]};this.getVector3FromArray=function(a,c){return a instanceof Array&&2<a.length?(a[0]=parseFloat(a[0]),a[1]=parseFloat(a[1]),a[2]=parseFloat(a[2]),(new THREE.Vector3).fromArray(a)):c};this.getSelectedNodes=function(){return a.impl&&a.impl.selector?a.impl.selector.getSelection():[]};this.getVisibleLayers2d=function(){var b=[],c=a.impl.matman(),f=c.layersMap,d;for(d in f)f.hasOwnProperty(d)&&c.isLayerVisible(d)&&b.push(d);return b};this.getAspectRatio=function(){var b=
a.navigation.getScreenViewport();return b.width/b.height};this.getOrthographicHeight=function(){var b=a.navigation.getCamera();return b.isPerspective?0:Math.abs(2*b.orthographicCamera.top)};this.getTransformsOverrides=function(){return{transformations:[]}};this.getToneMapIntensity=function(){var b=0;a.impl.dir_light1&&(b=0!=a.impl.dir_light1.intensity?Math.log(a.impl.dir_light1.intensity)/Math.log(2):-1E-20);return b};this.getLightPresetIndex=function(a){for(var c=Autodesk.Viewing.Private,f=0;f<c.LightPresets.length;f++)if(c.LightPresets[f].name===
a)return f;return-1};this.applyFilter=function(a,c){if(!0!==c)for(var f in a)if(a.hasOwnProperty(f)){var d=c[f];void 0===d?(delete a[f],stderr("[applyFilter] C - skipping key ["+f+"] from viewerState; unspecified in filter.")):"boolean"===typeof d?!1===d&&(delete a[f],stderr("[applyFilter] D - skipping key ["+f+"] from viewerState; explicit filtering.")):d instanceof Object?a[f]instanceof Object?this.applyFilter(a[f],c[f]):stderr("[applyFilter] A - Invalid filter Object for key ["+f+"]"):stderr("[applyFilter] B - Invalid filter value for key ["+
f+"]")}}};Autodesk.Viewing.Private.ViewerState.prototype.constructor=Autodesk.Viewing.Private.ViewerState;AutodeskNamespace("Autodesk.Viewing.i18n");
(function(){function a(a,b){if(!b||"function"===typeof b)return a;for(var c in b)a[c]=b[c];return a}function b(a,b,c){var d,f=0,g=a.length,h=void 0===g||"[object Array]"!==Object.prototype.toString.apply(a)||"function"===typeof a;if(c)if(h)for(d in a){if(!1===b.apply(a[d],c))break}else for(;f<g&&!1!==b.apply(a[f++],c););else if(h)for(d in a){if(!1===b.call(a[d],d,a[d]))break}else for(;f<g&&!1!==b.call(a[f],f,a[f++]););return a}function c(a){var b=function(a){if(window.XMLHttpRequest)return a(null,
new XMLHttpRequest);if(window.ActiveXObject)try{return a(null,new ActiveXObject("Msxml2.XMLHTTP"))}catch(b){return a(null,new ActiveXObject("Microsoft.XMLHTTP"))}return a(Error())},c=function(a){if("string"===typeof a)return a;var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},d=function(){for(var a=arguments[0],b=1;b<arguments.length;b++){var c=arguments[b],d;for(d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}return a},f=function(a,
g,h,k){"function"===typeof h&&(k=h,h={});h.doNotCache=h.doNotCache||!1;h.data=h.data||{};h.headers=h.headers||{};h.jsonp=h.jsonp||!1;h.async=void 0===h.async?!0:h.async;var l=d({accept:"*/*","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},f.headers,h.headers),m;m="application/json"===l["content-type"]?JSON.stringify(h.data):c(h.data);if("GET"===a){var n=[];m&&(n.push(m),m=null);h.doNotCache&&n.push("_="+(new Date).getTime());h.jsonp&&(n.push("callback="+h.jsonp),n.push("jsonp="+
h.jsonp));n=n.join("&");1<n.length&&(g=-1<g.indexOf("?")?g+("&"+n):g+("?"+n));if(h.jsonp){var n=document.getElementsByTagName("head")[0],p=document.createElement("script");p.type="text/javascript";p.src=g;n.appendChild(p);return}}b(function(b,c){if(b)return k(b);c.open(a,g,h.async);for(var d in l)l.hasOwnProperty(d)&&c.setRequestHeader(d,l[d]);c.onreadystatechange=function(){if(4===c.readyState){var a=c.responseText||"";k&&k(c.status,a)}};c.send(m)})};({authBasic:function(a,b){var c=f.headers,d;d=
a+":"+b;d=d.replace(/\r\n/g,"\n");for(var g="",h=0;h<d.length;h++){var k=d.charCodeAt(h);128>k?g+=String.fromCharCode(k):(127<k&&2048>k?g+=String.fromCharCode(k>>6|192):(g+=String.fromCharCode(k>>12|224),g+=String.fromCharCode(k>>6&63|128)),g+=String.fromCharCode(k&63|128))}d=g;var g="",l,m,n,p,q=0;do l=d.charCodeAt(q++),h=d.charCodeAt(q++),k=d.charCodeAt(q++),m=l>>2,l=(l&3)<<4|h>>4,n=(h&15)<<2|k>>6,p=k&63,isNaN(h)?n=p=64:isNaN(k)&&(p=64),g+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(m)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(n)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(p);while(q<d.length);c.Authorization="Basic "+g},connect:function(a,b,c){return f("CONNECT",a,b,c)},del:function(a,b,c){return f("DELETE",a,b,c)},get:function(a,b,c){return f("GET",a,b,c)},head:function(a,b,c){return f("HEAD",a,b,c)},headers:function(a){f.headers=a||{}},
isAllowed:function(a,b,c){this.options(a,function(a,d){c(-1!==d.text().indexOf(b))})},options:function(a,b,c){return f("OPTIONS",a,b,c)},patch:function(a,b,c){return f("PATCH",a,b,c)},post:function(a,b,c){return f("POST",a,b,c)},put:function(a,b,c){return f("PUT",a,b,c)},trace:function(a,b,c){return f("TRACE",a,b,c)}})[a.type?a.type.toLowerCase():"get"](a.url,a,function(b,c){200===b?a.success(c,b,null):a.error(c,b,null)})}function f(a,b){"function"===typeof a&&(b=a,a={});a=a||{};I.extend(w,a);delete w.fixLng;
"string"==typeof w.ns&&(w.ns={namespaces:[w.ns],defaultNs:w.ns});"string"==typeof w.fallbackNS&&(w.fallbackNS=[w.fallbackNS]);if("string"==typeof w.fallbackLng||"boolean"==typeof w.fallbackLng)w.fallbackLng=[w.fallbackLng];w.interpolationPrefixEscaped=I.regexEscape(w.interpolationPrefix);w.interpolationSuffixEscaped=I.regexEscape(w.interpolationSuffix);w.lng||(w.lng=I.detectLanguage());w.lng?w.useCookie&&I.cookie.create(w.cookieName,w.lng,w.cookieExpirationTime,w.cookieDomain):(w.lng=w.fallbackLng[0],
w.useCookie&&I.cookie.remove(w.cookieName));F=I.toLanguages(w.lng);B=F[0];I.log("currentLng set to: "+B);var c=l;a.fixLng&&(c=function(a,b){b=b||{};b.lng=b.lng||c.lng;return l(a,b)},c.lng=B);H.setCurrentLng(B);if(w.resStore)r=w.resStore,C=!0,b&&b(c);else{var d=I.toLanguages(w.lng);"string"===typeof w.preload&&(w.preload=[w.preload]);for(var f=0,g=w.preload.length;f<g;f++)for(var h=I.toLanguages(w.preload[f]),k=0,m=h.length;k<m;k++)0>d.indexOf(h[k])&&d.push(h[k]);Autodesk.Viewing.i18n.sync.load(d,
w,function(a,d){r=d;C=!0;b&&b(c)})}}function d(a,b){var c={dynamicLoad:w.dynamicLoad,resGetPath:w.resGetPath,getAsync:w.getAsync,customLoad:w.customLoad,ns:{namespaces:a,defaultNs:""}},d=I.toLanguages(w.lng);"string"===typeof w.preload&&(w.preload=[w.preload]);for(var f=0,g=w.preload.length;f<g;f++)for(var h=I.toLanguages(w.preload[f]),k=0,l=h.length;k<l;k++)0>d.indexOf(h[k])&&d.push(h[k]);for(var m=[],f=0,g=d.length;f<g;f++){h=!1;if(k=r[d[f]])for(var l=0,n=a.length;l<n;l++)k[a[l]]||(h=!0);else h=
!0;h&&m.push(d[f])}m.length?t.sync._fetch(m,c,function(c,d){var f=a.length*m.length;I.each(a,function(a,c){0>w.ns.namespaces.indexOf(c)&&w.ns.namespaces.push(c);I.each(m,function(a,g){r[g]=r[g]||{};r[g][c]=d[g][c];f--;0===f&&b&&(w.useLocalStorage&&t.sync._storeLocal(r),b())})})}):b&&b()}function g(a,b,c,d){if(!a)return a;d=d||b;if(0>a.indexOf(d.interpolationPrefix||w.interpolationPrefix))return a;var f=d.interpolationPrefix?I.regexEscape(d.interpolationPrefix):w.interpolationPrefixEscaped,h=d.interpolationSuffix?
I.regexEscape(d.interpolationSuffix):w.interpolationSuffixEscaped,k="HTML"+h;I.each(b,function(b,l){var m=c?c+w.keyseparator+b:b;"object"===typeof l&&null!==l?a=g(a,l,m,d):d.escapeInterpolation||w.escapeInterpolation?(a=a.replace(new RegExp([f,m,k].join(""),"g"),l),a=a.replace(new RegExp([f,m,h].join(""),"g"),I.escape(l))):a=a.replace(new RegExp([f,m,h].join(""),"g"),l)});return a}function h(a,b){var c=I.extend({},b);for(delete c.postProcess;-1!=a.indexOf(w.reusePrefix);){z++;if(z>w.maxRecursion)break;
var d=a.lastIndexOf(w.reusePrefix),f=a.indexOf(w.reuseSuffix,d)+w.reuseSuffix.length,d=a.substring(d,f),f=d.replace(w.reusePrefix,"").replace(w.reuseSuffix,"");if(-1!=f.indexOf(",")){var g=f.indexOf(",");if(-1!=f.indexOf("{",g)&&-1!=f.indexOf("}",g)){var h=f.indexOf("{",g),k=f.indexOf("}",h)+1;try{c=I.extend(c,JSON.parse(f.substring(h,k))),f=f.substring(0,g)}catch(l){}}}f=q(f,c);a=a.replace(d,f)}return a}function k(a,b){b=b||{};var c=void 0!==b.defaultValue?b.defaultValue:a,d=m(a,b);return void 0!==
d||d===c}function l(a,b){b=b||{};if(!C){I.log("i18next not finished initialization. you might have called t function before loading resources finished.");var c=a.indexOf(":");0>c?c=0:c++;(c=b.defaultValue||a.substr(c))&&(c=g(c,b));return c}z=0;return q.apply(null,arguments)}function n(){for(var a=[],b=1;b<arguments.length;b++)a.push(arguments[b]);return{postProcess:"sprintf",sprintf:a}}function q(a,b){b&&"object"!==typeof b?"sprintf"===w.shortcutFunction?b=n.apply(null,arguments):"defaultValue"===
w.shortcutFunction&&(b={defaultValue:b}):b=b||{};if(void 0===a||null===a)return"";"string"==typeof a&&(a=[a]);var c=a[0];if(1<a.length)for(var d=0;d<a.length&&(c=a[d],!k(c,b));d++);var d=void 0!==b.defaultValue?b.defaultValue:c,f=m(c,b),l=b.lng?I.toLanguages(b.lng):F,p=b.ns||w.ns.defaultNs,q;-1<c.indexOf(w.nsseparator)&&(q=c.split(w.nsseparator),p=q[0],c=q[1]);void 0===f&&w.sendMissing&&(b.lng?G.postMissing(l[0],p,c,d,l):G.postMissing(w.lng,p,c,d,l));l=b.postProcess||w.postProcess;void 0!==f&&l&&
K[l]&&(f=K[l](f,c,b));q=d;-1<d.indexOf(w.nsseparator)&&(q=d.split(w.nsseparator),q=q[1]);q===c&&w.parseMissingKey&&(d=w.parseMissingKey(d));void 0===f&&(d=g(d,b),d=h(d,b),l&&K[l]&&(f=K[l](void 0!==b.defaultValue?b.defaultValue:c,c,b)));return void 0!==f?f:d}function m(a,b){b=b||{};var c,d=void 0!==b.defaultValue?b.defaultValue:a,f=F;if(!r||"cimode"===f[0].toLowerCase())return d;if(b.lng&&(f=I.toLanguages(b.lng),!r[f[0]])){var k=w.getAsync;w.getAsync=!1;Autodesk.Viewing.i18n.sync.load(f,w,function(a,
b){I.extend(r,b);w.getAsync=k})}var n=b.ns||w.ns.defaultNs;-1<a.indexOf(w.nsseparator)&&(c=a.split(w.nsseparator),n=c[0],a=c[1]);if(b.context&&("string"==typeof b.context||"number"==typeof b.context)&&(c=I.extend({},b),delete c.context,c.defaultValue=w.contextNotFound,c=l(n+w.nsseparator+a+"_"+b.context,c),c!=w.contextNotFound))return g(c,{context:b.context});if(void 0!==b.count&&"string"!=typeof b.count&&1!==b.count){c=I.extend({},b);delete c.count;c.defaultValue=w.pluralNotFound;var p=n+w.nsseparator+
a+w.pluralSuffix,z=H.get(f[0],b.count);0<=z?p=p+"_"+z:1===z&&(p=n+w.nsseparator+a);c=l(p,c);if(c!=w.pluralNotFound)return g(c,{count:b.count,interpolationPrefix:b.interpolationPrefix,interpolationSuffix:b.interpolationSuffix})}var t;c=a.split(w.keyseparator);p=0;for(z=f.length;p<z&&void 0===t;p++){for(var C=f[p],A=0,D=r[C]&&r[C][n];c[A];)D=D&&D[c[A]],A++;if(void 0!==D){t=Object.prototype.toString.apply(D);if("string"===typeof D)D=g(D,b),D=h(D,b);else if("[object Array]"===t&&!w.returnObjectTrees&&
!b.returnObjectTrees)D=D.join("\n"),D=g(D,b),D=h(D,b);else if(null===D&&!0===w.fallbackOnNull)D=void 0;else if(null!==D)if(!w.returnObjectTrees&&!b.returnObjectTrees)w.objectTreeKeyHandler&&"function"==typeof w.objectTreeKeyHandler?D=w.objectTreeKeyHandler(a,D,C,n,b):(D="key '"+n+":"+a+" ("+C+")' returned an object instead of string.",I.log(D));else if("[object Number]"!==t&&"[object Function]"!==t&&"[object RegExp]"!==t){var E="[object Array]"===t?[]:{};I.each(D,function(c){E[c]=q(n+w.nsseparator+
a+w.keyseparator+c,b)});D=E}"string"===typeof D&&""===D.trim()&&!0===w.fallbackOnEmpty&&(D=void 0);t=D}}if(void 0===t&&!b.isFallbackLookup&&(!0===w.fallbackToDefaultNS||w.fallbackNS&&0<w.fallbackNS.length))if(b.isFallbackLookup=!0,w.fallbackNS.length)for(f=0,c=w.fallbackNS.length;f<c;f++){if(t=m(w.fallbackNS[f]+w.nsseparator+a,b))if(p=-1<t.indexOf(w.nsseparator)?t.split(w.nsseparator)[1]:t,z=-1<d.indexOf(w.nsseparator)?d.split(w.nsseparator)[1]:d,p!==z)break}else t=m(a,b);return t}Array.prototype.indexOf||
(Array.prototype.indexOf=function(a){if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;0<arguments.length&&(d=Number(arguments[1]),d!=d?d=0:0!=d&&Infinity!=d&&-Infinity!=d&&(d=(0<d||-1)*Math.floor(Math.abs(d))));if(d>=c)return-1;for(d=0<=d?d:Math.max(c-Math.abs(d),0);d<c;d++)if(d in b&&b[d]===a)return d;return-1});Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(a){if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===
c)return-1;var d=c;1<arguments.length&&(d=Number(arguments[1]),d!=d?d=0:0!=d&&d!=1/0&&d!=-(1/0)&&(d=(0<d||-1)*Math.floor(Math.abs(d))));for(c=0<=d?Math.min(d,c-1):c-Math.abs(d);0<=c;c--)if(c in b&&b[c]===a)return c;return-1});"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var p=this.jQuery||this.Zepto,t={},r={},B,z=0,F=[],C=!1;"undefined"!==typeof module&&module.exports?module.exports=t:(p&&(p.i18n=p.i18n||t),this.i18n=this.i18n||
t);var w={lng:void 0,load:"all",preload:[],lowerCaseLng:!1,returnObjectTrees:!1,fallbackLng:["dev"],fallbackNS:[],detectLngQS:"setLng",ns:"translation",fallbackOnNull:!0,fallbackOnEmpty:!1,fallbackToDefaultNS:!1,nsseparator:":",keyseparator:".",selectorAttr:"data-i18n",debug:!1,resGetPath:"res/locales/__lng__/__ns__.json",resPostPath:"res/locales/add/__lng__/__ns__",getAsync:!0,postAsync:!0,resStore:void 0,useLocalStorage:!1,localStorageExpirationTime:6048E5,dynamicLoad:!1,sendMissing:!1,sendMissingTo:"fallback",
sendType:"POST",interpolationPrefix:"__",interpolationSuffix:"__",reusePrefix:"$t(",reuseSuffix:")",pluralSuffix:"_plural",pluralNotFound:["plural_not_found",Math.random()].join(""),contextNotFound:["context_not_found",Math.random()].join(""),escapeInterpolation:!1,defaultValueFromContent:!0,useDataAttrOptions:!1,cookieExpirationTime:void 0,useCookie:!0,cookieName:"i18next",cookieDomain:void 0,objectTreeKeyHandler:void 0,postProcess:void 0,parseMissingKey:void 0,shortcutFunction:"sprintf"},E={"&":"&amp;",
"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},A={create:function(a,b,c,d){if(c){var f=new Date;f.setTime(f.getTime()+6E4*c);c="; expires="+f.toGMTString()}else c="";document.cookie=a+"="+b+c+";"+(d?"domain="+d+";":"")+"path=/"},read:function(a){a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(a))return d.substring(a.length,d.length)}return null},remove:function(a){this.create(a,"",-1)}},D={create:function(a,
b,c,d){},read:function(a){return null},remove:function(a){}},I={extend:p?p.extend:a,each:p?p.each:b,ajax:p?p.ajax:"undefined"!==typeof document?c:function(){},cookie:"undefined"!==typeof document?A:D,detectLanguage:function(){var a,b=[];if("undefined"!==typeof window){for(var c=window.location.search.substring(1).split("&"),d=0;d<c.length;d++){var f=c[d].indexOf("=");if(0<f){var g=c[d].substring(0,f),f=c[d].substring(f+1);b[g]=f}}b[w.detectLngQS]&&(a=b[w.detectLngQS])}!a&&"undefined"!==typeof document&&
w.useCookie&&(b=I.cookie.read(w.cookieName))&&(a=b);a||"undefined"===typeof navigator||(a=navigator.language?navigator.language:navigator.userLanguage);return a},escape:function(a){return"string"===typeof a?a.replace(/[&<>"'\/]/g,function(a){return E[a]}):a},log:function(a){w.debug&&"undefined"!==typeof console&&console.log(a)},toLanguages:function(a){var b=[];if("string"===typeof a&&-1<a.indexOf("-")){var c=a.split("-");a=w.lowerCaseLng?c[0].toLowerCase()+"-"+c[1].toLowerCase():c[0].toLowerCase()+
"-"+c[1].toUpperCase();"unspecific"!==w.load&&b.push(a);"current"!==w.load&&b.push(c[0])}else b.push(a);for(a=0;a<w.fallbackLng.length;a++)-1===b.indexOf(w.fallbackLng[a])&&w.fallbackLng[a]&&b.push(w.fallbackLng[a]);return b},regexEscape:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}};I.applyReplacement=g;var G={load:function(a,b,c){b.useLocalStorage?G._loadLocal(a,b,function(d,f){for(var g=[],h=0,k=a.length;h<k;h++)f[a[h]]||g.push(a[h]);0<g.length?G._fetch(g,b,function(a,
b){I.extend(f,b);G._storeLocal(b);c(null,f)}):c(null,f)}):G._fetch(a,b,function(a,b){c(null,b)})},_loadLocal:function(a,b,c){var d={},f=(new Date).getTime();if(window.localStorage){var g=a.length;I.each(a,function(a,h){var k=window.localStorage.getItem("res_"+h);k&&(k=JSON.parse(k),k.i18nStamp&&k.i18nStamp+b.localStorageExpirationTime>f&&(d[h]=k));g--;0===g&&c(null,d)})}},_storeLocal:function(a){if(window.localStorage)for(var b in a)a[b].i18nStamp=(new Date).getTime(),window.localStorage.setItem("res_"+
b,JSON.stringify(a[b]))},_fetch:function(a,b,c){var d=b.ns,f={};if(b.dynamicLoad){var h=function(a,b){c(null,b)};if("function"==typeof b.customLoad)b.customLoad(a,d.namespaces,b,h);else{var k=g(b.resGetPath,{lng:a.join("+"),ns:d.namespaces.join("+")}),k=Autodesk.Viewing.Private.getResourceUrl(k);I.ajax({url:k,success:function(a,b,d){I.log("loaded: "+k);a=a.json();c(null,a)},error:function(a,b,d){I.log("failed loading: "+k);c(null,void 0)},dataType:"text",async:b.getAsync})}}else{var l=d.namespaces.length*
a.length,m;I.each(d.namespaces,function(d,g){I.each(a,function(a,d){var h=function(a,b){a&&(m=m||[],m.push(a));f[d]=f[d]||{};f[d][g]=b;l--;0===l&&c(m,f)};"function"==typeof b.customLoad?b.customLoad(d,g,b,h):G._fetchOne(d,g,b,h)})})}},_fetchOne:function(a,b,c,d){var f=g(c.resGetPath,{lng:a,ns:b}),f=Autodesk.Viewing.Private.getResourceUrl(f);I.ajax({url:f,success:function(a,b,c){I.log("loaded: "+f);for(var g=!1,h=!1,k="",l=0;l<a.length;l++)if(b=a[l],c=a[l+1],h||"\\"===a[l-1]||'"'!==b||(g=!g),g)k+=
b;else{if(!h&&"//"===b+c)h="single",l++;else if("single"===h&&"\r\n"===b+c)h=!1,l++;else if("single"===h&&"\n"===b)h=!1;else if(!h&&"/*"===b+c){h="multi";l++;continue}else if("multi"===h&&"*/"===b+c){h=!1;l++;continue}h||(k+=b)}d(null,JSON.parse(k))},error:function(a,b,c){b&&200==b||a&&a.status&&200==a.status?I.log("There is a typo in: "+f):b&&404==b||a&&a.status&&404==a.status?I.log("Does not exist: "+f):I.log((b?b:a&&a.status?a.status:null)+" when loading "+f);d(c,{})},dataType:"text",async:c.getAsync})},
postMissing:function(a,b,c,d,f){var h={};h[c]=d;var k=[];if("fallback"===w.sendMissingTo&&!1!==w.fallbackLng[0])for(a=0;a<w.fallbackLng.length;a++)k.push({lng:w.fallbackLng[a],url:g(w.resPostPath,{lng:w.fallbackLng[a],ns:b})});else if("current"===w.sendMissingTo||"fallback"===w.sendMissingTo&&!1===w.fallbackLng[0])k.push({lng:a,url:g(w.resPostPath,{lng:a,ns:b})});else if("all"===w.sendMissingTo){a=0;for(var l=f.length;a<l;a++)k.push({lng:f[a],url:g(w.resPostPath,{lng:f[a],ns:b})})}f=0;for(a=k.length;f<
a;f++){var m=k[f];I.ajax({url:m.url,type:w.sendType,data:h,success:function(a,f,g){I.log("posted missing key '"+c+"' to: "+m.url);a=c.split(".");f=0;for(g=r[m.lng][b];a[f];)g=f===a.length-1?g[a[f]]=d:g[a[f]]=g[a[f]]||{},f++},error:function(a,b,d){I.log("failed posting missing key '"+c+"' to: "+m.url)},dataType:"json",async:w.postAsync})}}},H={rules:{ach:{name:"Acholi",numbers:[1,2],plurals:function(a){return Number(1<a)}},af:{name:"Afrikaans",numbers:[1,2],plurals:function(a){return Number(1!=a)}},
ak:{name:"Akan",numbers:[1,2],plurals:function(a){return Number(1<a)}},am:{name:"Amharic",numbers:[1,2],plurals:function(a){return Number(1<a)}},an:{name:"Aragonese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ar:{name:"Arabic",numbers:[0,1,2,3,11,100],plurals:function(a){return Number(0===a?0:1==a?1:2==a?2:3<=a%100&&10>=a%100?3:11<=a%100?4:5)}},arn:{name:"Mapudungun",numbers:[1,2],plurals:function(a){return Number(1<a)}},ast:{name:"Asturian",numbers:[1,2],plurals:function(a){return Number(1!=
a)}},ay:{name:"Aymar\u00e1",numbers:[1],plurals:function(a){return 0}},az:{name:"Azerbaijani",numbers:[1,2],plurals:function(a){return Number(1!=a)}},be:{name:"Belarusian",numbers:[1,2,5],plurals:function(a){return Number(1==a%10&&11!=a%100?0:2<=a%10&&4>=a%10&&(10>a%100||20<=a%100)?1:2)}},bg:{name:"Bulgarian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},bn:{name:"Bengali",numbers:[1,2],plurals:function(a){return Number(1!=a)}},bo:{name:"Tibetan",numbers:[1],plurals:function(a){return 0}},
br:{name:"Breton",numbers:[1,2],plurals:function(a){return Number(1<a)}},bs:{name:"Bosnian",numbers:[1,2,5],plurals:function(a){return Number(1==a%10&&11!=a%100?0:2<=a%10&&4>=a%10&&(10>a%100||20<=a%100)?1:2)}},ca:{name:"Catalan",numbers:[1,2],plurals:function(a){return Number(1!=a)}},cgg:{name:"Chiga",numbers:[1],plurals:function(a){return 0}},cs:{name:"Czech",numbers:[1,2,5],plurals:function(a){return Number(1==a?0:2<=a&&4>=a?1:2)}},csb:{name:"Kashubian",numbers:[1,2,5],plurals:function(a){return Number(1==
a?0:2<=a%10&&4>=a%10&&(10>a%100||20<=a%100)?1:2)}},cy:{name:"Welsh",numbers:[1,2,3,8],plurals:function(a){return Number(1==a?0:2==a?1:8!=a&&11!=a?2:3)}},da:{name:"Danish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},de:{name:"German",numbers:[1,2],plurals:function(a){return Number(1!=a)}},dz:{name:"Dzongkha",numbers:[1],plurals:function(a){return 0}},el:{name:"Greek",numbers:[1,2],plurals:function(a){return Number(1!=a)}},en:{name:"English",numbers:[1,2],plurals:function(a){return Number(1!=
a)}},eo:{name:"Esperanto",numbers:[1,2],plurals:function(a){return Number(1!=a)}},es:{name:"Spanish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},es_ar:{name:"Argentinean Spanish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},et:{name:"Estonian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},eu:{name:"Basque",numbers:[1,2],plurals:function(a){return Number(1!=a)}},fa:{name:"Persian",numbers:[1],plurals:function(a){return 0}},fi:{name:"Finnish",numbers:[1,2],plurals:function(a){return Number(1!=
a)}},fil:{name:"Filipino",numbers:[1,2],plurals:function(a){return Number(1<a)}},fo:{name:"Faroese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},fr:{name:"French",numbers:[1,2],plurals:function(a){return Number(1<a)}},fur:{name:"Friulian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},fy:{name:"Frisian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ga:{name:"Irish",numbers:[1,2,3,7,11],plurals:function(a){return Number(1==a?0:2==a?1:7>a?2:11>a?3:4)}},gd:{name:"Scottish Gaelic",
numbers:[1,2,3,20],plurals:function(a){return Number(1==a||11==a?0:2==a||12==a?1:2<a&&20>a?2:3)}},gl:{name:"Galician",numbers:[1,2],plurals:function(a){return Number(1!=a)}},gu:{name:"Gujarati",numbers:[1,2],plurals:function(a){return Number(1!=a)}},gun:{name:"Gun",numbers:[1,2],plurals:function(a){return Number(1<a)}},ha:{name:"Hausa",numbers:[1,2],plurals:function(a){return Number(1!=a)}},he:{name:"Hebrew",numbers:[1,2],plurals:function(a){return Number(1!=a)}},hi:{name:"Hindi",numbers:[1,2],plurals:function(a){return Number(1!=
a)}},hr:{name:"Croatian",numbers:[1,2,5],plurals:function(a){return Number(1==a%10&&11!=a%100?0:2<=a%10&&4>=a%10&&(10>a%100||20<=a%100)?1:2)}},hu:{name:"Hungarian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},hy:{name:"Armenian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ia:{name:"Interlingua",numbers:[1,2],plurals:function(a){return Number(1!=a)}},id:{name:"Indonesian",numbers:[1],plurals:function(a){return 0}},is:{name:"Icelandic",numbers:[1,2],plurals:function(a){return Number(1!=
a%10||11==a%100)}},it:{name:"Italian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ja:{name:"Japanese",numbers:[1],plurals:function(a){return 0}},jbo:{name:"Lojban",numbers:[1],plurals:function(a){return 0}},jv:{name:"Javanese",numbers:[0,1],plurals:function(a){return Number(0!==a)}},ka:{name:"Georgian",numbers:[1],plurals:function(a){return 0}},kk:{name:"Kazakh",numbers:[1],plurals:function(a){return 0}},km:{name:"Khmer",numbers:[1],plurals:function(a){return 0}},kn:{name:"Kannada",numbers:[1,
2],plurals:function(a){return Number(1!=a)}},ko:{name:"Korean",numbers:[1],plurals:function(a){return 0}},ku:{name:"Kurdish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},kw:{name:"Cornish",numbers:[1,2,3,4],plurals:function(a){return Number(1==a?0:2==a?1:3==a?2:3)}},ky:{name:"Kyrgyz",numbers:[1],plurals:function(a){return 0}},lb:{name:"Letzeburgesch",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ln:{name:"Lingala",numbers:[1,2],plurals:function(a){return Number(1<a)}},lo:{name:"Lao",
numbers:[1],plurals:function(a){return 0}},lt:{name:"Lithuanian",numbers:[1,2,10],plurals:function(a){return Number(1==a%10&&11!=a%100?0:2<=a%10&&(10>a%100||20<=a%100)?1:2)}},lv:{name:"Latvian",numbers:[1,2,0],plurals:function(a){return Number(1==a%10&&11!=a%100?0:0!==a?1:2)}},mai:{name:"Maithili",numbers:[1,2],plurals:function(a){return Number(1!=a)}},mfe:{name:"Mauritian Creole",numbers:[1,2],plurals:function(a){return Number(1<a)}},mg:{name:"Malagasy",numbers:[1,2],plurals:function(a){return Number(1<
a)}},mi:{name:"Maori",numbers:[1,2],plurals:function(a){return Number(1<a)}},mk:{name:"Macedonian",numbers:[1,2],plurals:function(a){return Number(1==a||1==a%10?0:1)}},ml:{name:"Malayalam",numbers:[1,2],plurals:function(a){return Number(1!=a)}},mn:{name:"Mongolian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},mnk:{name:"Mandinka",numbers:[0,1,2],plurals:function(a){return Number(1==a?1:2)}},mr:{name:"Marathi",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ms:{name:"Malay",numbers:[1],
plurals:function(a){return 0}},mt:{name:"Maltese",numbers:[1,2,11,20],plurals:function(a){return Number(1==a?0:0===a||1<a%100&&11>a%100?1:10<a%100&&20>a%100?2:3)}},nah:{name:"Nahuatl",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nap:{name:"Neapolitan",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nb:{name:"Norwegian Bokmal",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ne:{name:"Nepali",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nl:{name:"Dutch",numbers:[1,
2],plurals:function(a){return Number(1!=a)}},nn:{name:"Norwegian Nynorsk",numbers:[1,2],plurals:function(a){return Number(1!=a)}},no:{name:"Norwegian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nso:{name:"Northern Sotho",numbers:[1,2],plurals:function(a){return Number(1!=a)}},oc:{name:"Occitan",numbers:[1,2],plurals:function(a){return Number(1<a)}},or:{name:"Oriya",numbers:[2,1],plurals:function(a){return Number(1!=a)}},pa:{name:"Punjabi",numbers:[1,2],plurals:function(a){return Number(1!=
a)}},pap:{name:"Papiamento",numbers:[1,2],plurals:function(a){return Number(1!=a)}},pl:{name:"Polish",numbers:[1,2,5],plurals:function(a){return Number(1==a?0:2<=a%10&&4>=a%10&&(10>a%100||20<=a%100)?1:2)}},pms:{name:"Piemontese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ps:{name:"Pashto",numbers:[1,2],plurals:function(a){return Number(1!=a)}},pt:{name:"Portuguese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},pt_br:{name:"Brazilian Portuguese",numbers:[1,2],plurals:function(a){return Number(1!=
a)}},rm:{name:"Romansh",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ro:{name:"Romanian",numbers:[1,2,20],plurals:function(a){return Number(1==a?0:0===a||0<a%100&&20>a%100?1:2)}},ru:{name:"Russian",numbers:[1,2,5],plurals:function(a){return Number(1==a%10&&11!=a%100?0:2<=a%10&&4>=a%10&&(10>a%100||20<=a%100)?1:2)}},sah:{name:"Yakut",numbers:[1],plurals:function(a){return 0}},sco:{name:"Scots",numbers:[1,2],plurals:function(a){return Number(1!=a)}},se:{name:"Northern Sami",numbers:[1,2],
plurals:function(a){return Number(1!=a)}},si:{name:"Sinhala",numbers:[1,2],plurals:function(a){return Number(1!=a)}},sk:{name:"Slovak",numbers:[1,2,5],plurals:function(a){return Number(1==a?0:2<=a&&4>=a?1:2)}},sl:{name:"Slovenian",numbers:[5,1,2,3],plurals:function(a){return Number(1==a%100?1:2==a%100?2:3==a%100||4==a%100?3:0)}},so:{name:"Somali",numbers:[1,2],plurals:function(a){return Number(1!=a)}},son:{name:"Songhay",numbers:[1,2],plurals:function(a){return Number(1!=a)}},sq:{name:"Albanian",
numbers:[1,2],plurals:function(a){return Number(1!=a)}},sr:{name:"Serbian",numbers:[1,2,5],plurals:function(a){return Number(1==a%10&&11!=a%100?0:2<=a%10&&4>=a%10&&(10>a%100||20<=a%100)?1:2)}},su:{name:"Sundanese",numbers:[1],plurals:function(a){return 0}},sv:{name:"Swedish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},sw:{name:"Swahili",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ta:{name:"Tamil",numbers:[1,2],plurals:function(a){return Number(1!=a)}},te:{name:"Telugu",numbers:[1,
2],plurals:function(a){return Number(1!=a)}},tg:{name:"Tajik",numbers:[1,2],plurals:function(a){return Number(1<a)}},th:{name:"Thai",numbers:[1],plurals:function(a){return 0}},ti:{name:"Tigrinya",numbers:[1,2],plurals:function(a){return Number(1<a)}},tk:{name:"Turkmen",numbers:[1,2],plurals:function(a){return Number(1!=a)}},tr:{name:"Turkish",numbers:[1,2],plurals:function(a){return Number(1<a)}},tt:{name:"Tatar",numbers:[1],plurals:function(a){return 0}},ug:{name:"Uyghur",numbers:[1],plurals:function(a){return 0}},
uk:{name:"Ukrainian",numbers:[1,2,5],plurals:function(a){return Number(1==a%10&&11!=a%100?0:2<=a%10&&4>=a%10&&(10>a%100||20<=a%100)?1:2)}},ur:{name:"Urdu",numbers:[1,2],plurals:function(a){return Number(1!=a)}},uz:{name:"Uzbek",numbers:[1,2],plurals:function(a){return Number(1<a)}},vi:{name:"Vietnamese",numbers:[1],plurals:function(a){return 0}},wa:{name:"Walloon",numbers:[1,2],plurals:function(a){return Number(1<a)}},wo:{name:"Wolof",numbers:[1],plurals:function(a){return 0}},yo:{name:"Yoruba",numbers:[1,
2],plurals:function(a){return Number(1!=a)}},zh:{name:"Chinese",numbers:[1],plurals:function(a){return 0}}},addRule:function(a,b){H.rules[a]=b},setCurrentLng:function(a){if(!H.currentRule||H.currentRule.lng!==a){var b=a.split("-");H.currentRule={lng:a,rule:H.rules[b[0]]}}},get:function(a,b){var c=a.split("-");if(c=H.currentRule&&H.currentRule.lng===a?H.currentRule.rule:H.rules[c[0]]){var d=c.plurals(b),d=c.numbers[d];2===c.numbers.length&&1===c.numbers[0]&&(2===d?d=-1:1===d&&(d=1));c=d}else c=1===
b?"1":"-1";return c}},K={},p=function(a,b){K[a]=b},J=function(){function a(b){return Object.prototype.toString.call(b).slice(8,-1).toLowerCase()}var b=function(){b.cache.hasOwnProperty(arguments[0])||(b.cache[arguments[0]]=b.parse(arguments[0]));return b.format.call(null,b.cache[arguments[0]],arguments)};b.format=function(b,c){var d=1,f=b.length,g="",h=[],k,l,m,n;for(k=0;k<f;k++)if(g=a(b[k]),"string"===g)h.push(b[k]);else if("array"===g){m=b[k];if(m[2])for(g=c[d],l=0;l<m[2].length;l++){if(!g.hasOwnProperty(m[2][l]))throw J('[sprintf] property "%s" does not exist',
m[2][l]);g=g[m[2][l]]}else g=m[1]?c[m[1]]:c[d++];if(/[^s]/.test(m[8])&&"number"!=a(g))throw J("[sprintf] expecting number but found %s",a(g));switch(m[8]){case "b":g=g.toString(2);break;case "c":g=String.fromCharCode(g);break;case "d":g=parseInt(g,10);break;case "e":g=m[7]?g.toExponential(m[7]):g.toExponential();break;case "f":g=m[7]?parseFloat(g).toFixed(m[7]):parseFloat(g);break;case "o":g=g.toString(8);break;case "s":g=(g=String(g))&&m[7]?g.substring(0,m[7]):g;break;case "u":g=Math.abs(g);break;
case "x":g=g.toString(16);break;case "X":g=g.toString(16).toUpperCase()}g=/[def]/.test(m[8])&&m[3]&&0<=g?"+"+g:g;l=m[4]?"0"==m[4]?"0":m[4].charAt(1):" ";n=m[6]-String(g).length;if(m[6]){for(var p=[];0<n;p[--n]=l);l=p.join("")}else l="";h.push(m[5]?g+l:l+g)}return h.join("")};b.cache={};b.parse=function(a){for(var b=[],c=[],d=0;a;){if(null!==(b=/^[^\x25]+/.exec(a)))c.push(b[0]);else if(null!==(b=/^\x25{2}/.exec(a)))c.push("%");else if(null!==(b=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(a))){if(b[2]){var d=
d|1,f=[],g=b[2],h=[];if(null!==(h=/^([a-z_][a-z_\d]*)/i.exec(g)))for(f.push(h[1]);""!==(g=g.substring(h[0].length));)if(null!==(h=/^\.([a-z_][a-z_\d]*)/i.exec(g)))f.push(h[1]);else if(null!==(h=/^\[(\d+)\]/.exec(g)))f.push(h[1]);else throw"[sprintf] huh?";else throw"[sprintf] huh?";b[2]=f}else d|=2;if(3===d)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";c.push(b)}else throw"[sprintf] huh?";a=a.substring(b[0].length)}return c};return b}();p("sprintf",function(a,b,
c){return c.sprintf?"[object Array]"===Object.prototype.toString.apply(c.sprintf)?(b=c.sprintf,b.unshift(a),J.apply(null,b)):"object"===typeof c.sprintf?J(a,c.sprintf):a:a});Autodesk.Viewing.i18n.init=f;Autodesk.Viewing.i18n.setLng=function(a,b,c){"function"===typeof b?(c=b,b={}):b||(b={});b.lng=a;return f(b,c)};Autodesk.Viewing.i18n.preload=function(a,b){"string"===typeof a&&(a=[a]);for(var c=0,d=a.length;c<d;c++)0>w.preload.indexOf(a[c])&&w.preload.push(a[c]);return f(b)};Autodesk.Viewing.i18n.addResourceBundle=
function(a,b,c){"string"!==typeof b?(c=b,b=w.ns.defaultNs):0>w.ns.namespaces.indexOf(b)&&w.ns.namespaces.push(b);r[a]=r[a]||{};r[a][b]=r[a][b]||{};I.extend(r[a][b],c)};Autodesk.Viewing.i18n.removeResourceBundle=function(a,b){"string"!==typeof b&&(b=w.ns.defaultNs);r[a]=r[a]||{};r[a][b]={}};Autodesk.Viewing.i18n.loadNamespace=function(a,b){d([a],b)};Autodesk.Viewing.i18n.loadNamespaces=d;Autodesk.Viewing.i18n.localize=function(){Array.prototype.forEach.call(document.querySelectorAll("[data-i18n]"),
function(a){var b,c,d=a.getAttribute("data-i18n").split(/\[|\]/);1===d.length?(c=null,b=d[0]):3===d.length&&(c=d[1],b=d[2]);b=[c,b];c=b[0];b=b[1];(d=Autodesk.Viewing.i18n.translate(b))?c?a.setAttribute(c,d):a.textContent=d:c?a.setAttribute(c,b):a.textContent=b})};Autodesk.Viewing.i18n.setDefaultNamespace=function(a){w.ns.defaultNs=a};Autodesk.Viewing.i18n.t=l;Autodesk.Viewing.i18n.translate=l;Autodesk.Viewing.i18n.exists=k;Autodesk.Viewing.i18n.detectLanguage=I.detectLanguage;Autodesk.Viewing.i18n.pluralExtensions=
H;Autodesk.Viewing.i18n.sync=G;Autodesk.Viewing.i18n.functions=I;Autodesk.Viewing.i18n.lng=function(){return B};Autodesk.Viewing.i18n.addPostProcessor=p;Autodesk.Viewing.i18n.options=w})();AutodeskNamespace("Autodesk.Viewing.UI");
Autodesk.Viewing.UI.DockingPanel=function(a,b,c,f){this.kMinHeight=this.kMinWdth=100;this.visibilityCallbacks=[];this.movedSinceLastClick=!1;this.parentContainer=a;this.container=document.createElement("div");this.container.id=b;this.container.lastWidth="";this.container.dockRight=!1;this.container.dockBottom=!1;this.titleLabel=c;f=f||{};f.hasOwnProperty("localizeTitle")||(f.localizeTitle=!0);this.options=f;this.container.classList.add("dockingPanel");a.appendChild(this.container);this.listeners=
[];this.initialize();this.setVisible(!1)};Autodesk.Viewing.UI.DockingPanel.prototype.initialize=function(){this.title=this.createTitleBar(this.titleLabel||this.container.id);this.container.appendChild(this.title);this.initializeMoveHandlers(this.title);this.setTitle(this.titleLabel||this.container.id,this.options);this.closer=this.createCloseButton();this.container.appendChild(this.closer)};
Autodesk.Viewing.UI.DockingPanel.prototype.uninitialize=function(){for(var a=0;a<this.listeners.length;++a){var b=this.listeners[a];b.target.removeEventListener(b.eventId,b.callback)}this.listeners=[];this.visibilityCallbacks=[];this.parentContainer.removeChild(this.container);this.closer=this.title=this.container=this.parentContainer=null};Autodesk.Viewing.UI.DockingPanel.prototype.addVisibilityListener=function(a){this.visibilityCallbacks.push(a)};
Autodesk.Viewing.UI.DockingPanel.prototype.setVisible=function(a){if(a){var b=this.getContainerBoundingRect();if(this.container.dockRight){var c=b.width,f=300,d=this.container.lastWidth||this.container.style.width;d||(d=this.container.getBoundingClientRect().width);d&&(f=parseInt(d));this.container.style.left=c-f+"px"}this.container.dockBottom&&(c=b.height,f=300,d=this.container.lastHeight||this.container.style.height,d||(d=this.container.getBoundingClientRect().height),d&&(f=parseInt(d)),this.container.style.top=
c-f+"px");this.container.style.maxHeight=b.height+"px";this.container.style.maxWidth=b.width+"px";this.container.style.display="block"}else this.container.lastWidth=this.container.style.width,this.container.lastHeight=this.container.style.height,this.container.style.display="none";for(b=0;b<this.visibilityCallbacks.length;b++)this.visibilityCallbacks[b](a)};Autodesk.Viewing.UI.DockingPanel.prototype.isVisible=function(){return Boolean("block"===this.container.style.display)};
Autodesk.Viewing.UI.DockingPanel.prototype.visibilityChanged=function(){};
Autodesk.Viewing.UI.DockingPanel.prototype.initializeMoveHandlers=function(a){function b(a){var b=p.style.minWidth?parseInt(p.style.minWidth):t.kMinWdth,c=p.style.minHeight?parseInt(p.style.minHeight):t.kMinHeight,f=t.getContainerBoundingRect();p.style.maxWidth&&parseInt(p.style.width)>parseInt(p.style.maxWidth)&&(p.style.width=p.style.maxWidth);p.style.maxHeight&&parseInt(p.style.height)>parseInt(p.style.maxHeight)&&(p.style.height=p.style.maxHeight);parseInt(p.style.width)<b&&(p.style.width=b+"px");
parseInt(p.style.height)<c&&(p.style.height=c+"px");"touchmove"===a.type&&(a.screenX=a.touches[0].screenX,a.screenY=a.touches[0].screenY);q+=a.screenX-h;m+=a.screenY-k;d=l+q;g=n+m;b=parseInt(p.style.width);c=parseInt(p.style.height);isNaN(b)&&(b=t.container.getBoundingClientRect().width);isNaN(c)&&(c=t.container.getBoundingClientRect().height);5>d&&(d=0);5>g&&(g=0);p.dockRight=!1;p.dockBottom=!1;f.width-5<d+b&&(d=f.width-b,p.dockRight=!0);f.height-5<g+c&&(g=f.height-c,p.dockBottom=!0);p.style.left=
d+"px";p.style.top=g+"px";p.style.maxWidth=f.width-d+"px";p.style.maxHeight=f.height-g+"px";h=a.screenX;k=a.screenY;t.onMove(a,d,g)}function c(a){window.removeEventListener("mousemove",b);window.removeEventListener("mouseup",c);window.removeEventListener("touchmove",b);window.removeEventListener("touchend",c);t.onEndMove(a,d,g)}function f(a){"touchstart"===a.type&&(a.screenX=a.touches[0].screenX,a.screenY=a.touches[0].screenY);h=a.screenX;k=a.screenY;m=q=0;l=t.container.offsetLeft;n=t.container.offsetTop;
window.addEventListener("mousemove",b,!1);window.addEventListener("mouseup",c,!1);window.addEventListener("touchmove",b,!1);window.addEventListener("touchend",c,!1);a.preventDefault();t.onStartMove(a,l,n)}var d,g,h,k,l,n,q,m,p=this.container,t=this;t.addEventListener(a,"mousedown",f);t.addEventListener(a,"touchstart",f)};Autodesk.Viewing.UI.DockingPanel.prototype.initializeCloseHandler=function(a){var b=this;b.addEventListener(a,"click",function(a){b.setVisible(!1)},!1)};
Autodesk.Viewing.UI.DockingPanel.prototype.createScrollContainer=function(a){var b=document.createElement("div"),c=b.classList;c.add("dockingPanelScroll");c.add(a&&a.left?"left":"right");a&&a.heightAdjustment&&(b.style.height="calc(100% - "+a.heightAdjustment+"px)");a.marginTop&&(b.style.marginTop=a.marginTop+"px");b.id=this.container.id+"-scroll-container";this.container.appendChild(b);return this.scrollContainer=b};
Autodesk.Viewing.UI.DockingPanel.prototype.createTitleBar=function(a){var b=document.createElement("div");b.className="dockingPanelTitle";b.textContent=a;var c=this;c.addEventListener(b,"click",function(a){if(!c.movedSinceLastClick)c.onTitleClick(a);c.movedSinceLastClick=!1});c.addEventListener(b,"dblclick",function(a){c.onTitleDoubleClick(a)});return b};
Autodesk.Viewing.UI.DockingPanel.prototype.setTitle=function(a,b){b&&b.localizeTitle?(this.title.setAttribute("data-i18n",a),a=Autodesk.Viewing.i18n.translate(a)):this.title.removeAttribute("data-i18n");this.title.textContent=a};Autodesk.Viewing.UI.DockingPanel.prototype.createCloseButton=function(){var a=document.createElement("div");a.className="dockingPanelClose";a.innerHTML="&times;";this.initializeCloseHandler(a);return a};Autodesk.Viewing.UI.DockingPanel.prototype.onStartMove=function(a,b,c){};
Autodesk.Viewing.UI.DockingPanel.prototype.onEndMove=function(a,b,c){};Autodesk.Viewing.UI.DockingPanel.prototype.onMove=function(a,b,c){this.movedSinceLastClick=!0};Autodesk.Viewing.UI.DockingPanel.prototype.onTitleClick=function(a){};Autodesk.Viewing.UI.DockingPanel.prototype.onTitleDoubleClick=function(a){};Autodesk.Viewing.UI.DockingPanel.prototype.addEventListener=function(a,b,c){a.addEventListener(b,c);this.listeners.push({target:a,eventId:b,callback:c})};
Autodesk.Viewing.UI.DockingPanel.prototype.removeEventListener=function(a,b,c){for(var f=0;f<this.listeners.length;++f){var d=this.listeners[f];if(d.target===a&&d.eventId===b&&d.callback===c)return a.removeEventListener(b,c),this.listeners.splice(f,1),!0}return!1};Autodesk.Viewing.UI.DockingPanel.prototype.getContentSize=function(){return{height:this.container.clientHeight,width:this.container.clientWidth}};
Autodesk.Viewing.UI.DockingPanel.prototype.resizeToContent=function(a){if(this.isVisible()){var b=this.getContentSize().height,c=this.container.getBoundingClientRect(),f=this.getContainerBoundingRect();a=a&&a.maxHeight?a.maxHeight-c.top:f.height-c.top;a-=75;b>a&&(b=a);this.container.style.height=b.toString()+"px"}};Autodesk.Viewing.UI.DockingPanel.prototype.getContainerBoundingRect=function(){return this.parentContainer.getBoundingClientRect()};AutodeskNamespace("Autodesk.Viewing.UI");
Autodesk.Viewing.UI.ModelStructurePanel=function(a,b,c,f){Autodesk.Viewing.UI.DockingPanel.call(this,a,b,c,f);this.container.classList.add("modelStructurePanel");f=f||{};f.heightAdjustment||(f.heightAdjustment=40);f.marginTop||(f.marginTop=0);f.left=!0;this.createScrollContainer(f);this.options=f;this.tree=this.instanceTree=null;this.selectedNodes=[];this.uiCreated=!1;var d=this;this.addVisibilityListener(function(a){a&&(d.uiCreated||d.createUI(),d.resizeToContent())})};
Autodesk.Viewing.UI.ModelStructurePanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype);Autodesk.Viewing.UI.ModelStructurePanel.prototype.constructor=Autodesk.Viewing.UI.ModelStructurePanel;Autodesk.Viewing.UI.ModelStructurePanel.prototype.setModel=function(a,b){this.instanceTree=a;this.modelTitle=b;this.isVisible()?this.createUI():this.uiCreated=!1};
Autodesk.Viewing.UI.ModelStructurePanel.prototype.createUI=function(){var a=this,b=a.instanceTree;if(b){a.selectedNodes=[];var c=a.modelTitle;!c&&a.options&&a.options.defaultTitle&&(c=a.options.defaultTitle);var f={};c||(c="Browser",f.localizeTitle=!0);a.setTitle(c,f);if(a.tree){for(;a.scrollContainer.hasChildNodes();)a.scrollContainer.removeChild(a.scrollContainer.lastChild);a.title.removeEventListener("click",a.onTitleClick);a.title.removeEventListener("dblclick",a.onTitleDoubleClick)}var c=this.rootId=
b.getRootId(),d=b.getNodeName(c),g,h=0,k=0;b.enumNodeChildren(c,function(a){k||(g=b.getNodeName(a),h=a);k++});this.myDelegate=f=function(){var b=new Autodesk.Viewing.UI.TreeDelegate;b.getTreeNodeId=function(a){return"object"==typeof a?(stderr("Object used instead of dbId. Fix it."),a.dbId):a};b.getTreeNodeLabel=function(b){b=this.getTreeNodeId(b);return a.instanceTree.getNodeName(b)||"Object "+b};b.getTreeNodeClass=function(b){return a.getNodeClass(b)};b.isTreeNodeGroup=function(b){return a.isGroupNode(b)};
b.shouldCreateTreeNode=function(b){return a.shouldInclude(b)};b.onTreeNodeClick=function(b,c,d){a.onClick(c,d)};b.onTreeNodeRightClick=function(b,c,d){a.onRightClick(c,d)};b.onTreeNodeDoubleClick=function(b,c,d){a.onDoubleClick(c,d)};b.onTreeNodeIconClick=function(b,c,d){a.onIconClick(c,d)};b.forEachChild=function(b,c){var d=this.getTreeNodeId(b);a.instanceTree.enumNodeChildren(d,c)};return b}();d=1===k&&d===g;a.tree=new Autodesk.Viewing.UI.Tree(f,c,a.scrollContainer,{excludeRoot:d});a.options&&a.options.hasOwnProperty("startCollapsed")&&
!a.options.startCollapsed||(a.tree.setAllCollapsed(!0),a.tree.setCollapsed(c,!1),d&&a.tree.setCollapsed(h,!1));this.uiCreated=!0}};Autodesk.Viewing.UI.ModelStructurePanel.prototype.getNodeLabel=function(a){return this.myDelegate.getNodeLabel(a)};Autodesk.Viewing.UI.ModelStructurePanel.prototype.getNodeClass=function(a){return""};Autodesk.Viewing.UI.ModelStructurePanel.prototype.isGroupNode=function(a){a=this.myDelegate.getTreeNodeId(a);return this.instanceTree.getChildCount(a)};
Autodesk.Viewing.UI.ModelStructurePanel.prototype.shouldInclude=function(a){return!0};Autodesk.Viewing.UI.ModelStructurePanel.prototype.onClick=function(a,b){this.setSelection([a])};Autodesk.Viewing.UI.ModelStructurePanel.prototype.onDoubleClick=function(a,b){};Autodesk.Viewing.UI.ModelStructurePanel.prototype.onIconClick=function(a,b){this.setGroupCollapsed(a,!this.isGroupCollapsed(a))};
Autodesk.Viewing.UI.ModelStructurePanel.prototype.setGroupCollapsed=function(a,b){this.tree.delegate().isTreeNodeGroup(a)&&(this.tree.setCollapsed(a,b),this.resizeToContent())};Autodesk.Viewing.UI.ModelStructurePanel.prototype.isGroupCollapsed=function(a){return this.tree.delegate().isTreeNodeGroup(a)?this.tree.isCollapsed(a):!1};Autodesk.Viewing.UI.ModelStructurePanel.prototype.onRightClick=function(a,b){};
Autodesk.Viewing.UI.ModelStructurePanel.prototype.onTitleClick=function(a){this.onClick(this.instanceTree.getRootId(),a)};Autodesk.Viewing.UI.ModelStructurePanel.prototype.onTitleDoubleClick=function(a){this.onDoubleClick(this.instanceTree.getRootId(),a)};
Autodesk.Viewing.UI.ModelStructurePanel.prototype.setSelection=function(a){if(this.tree){var b,c;for(b=0;b<this.selectedNodes.length;++b)for(c=this.selectedNodes[b].parent;c;)this.tree.removeClass(c,"ancestor-selected"),c=c.parent;var f=[];for(b=0;b<a.length;++b)for(f.push(a[b]),c=a[b].parent;c;)this.tree.addClass(c,"ancestor-selected"),c=c.parent;this.selectedNodes=a;this.tree.setSelection(f)}};
Autodesk.Viewing.UI.ModelStructurePanel.prototype.getContentSize=function(){var a=this.tree;return a&&(a=a.getRootContainer())?{height:a.clientHeight+this.options.heightAdjustment+35,width:a.clientWidth}:{height:0,width:0}};Autodesk.Viewing.UI.ModelStructurePanel.prototype.addClass=function(a,b){return null!==this.tree&&this.tree.addClass(a,b)};Autodesk.Viewing.UI.ModelStructurePanel.prototype.removeClass=function(a,b){return null!==this.tree&&this.tree.removeClass(a,b)};AutodeskNamespace("Autodesk.Viewing.UI");
Autodesk.Viewing.UI.PropertyPanel=function(a,b,c,f){Autodesk.Viewing.UI.DockingPanel.call(this,a,b,c,f);this.container.classList.add("propertyPanel");this.container.dockRight=!0;this.createScrollContainer({left:!1,heightAdjustment:45,marginTop:0});this.highlightableElements={};var d=this;a=function(){function a(b){return"category"===b.type}var b=new Autodesk.Viewing.UI.TreeDelegate;b.getTreeNodeId=function(a){return a.name+(a.hasOwnProperty("value")?a.value:"")+(a.hasOwnProperty("category")?a.category:
"")};b.getTreeNodeClass=function(b){return a(b)?d.getCategoryClass(b):d.getPropertyClass(b)};b.isTreeNodeGroup=function(b){return a(b)};b.onTreeNodeClick=function(b,c,f){if(a(c))d.onCategoryClick(c,f);else d.onPropertyClick(c,f)};b.onTreeNodeRightClick=function(b,c,f){if(a(c))d.onCategoryRightClick(c,f);else d.onPropertyRightClick(c,f)};b.onTreeNodeDoubleClick=function(b,c,f){if(a(c))d.onCategoryDoubleClick(c,f);else d.onPropertyDoubleClick(c,f)};b.onTreeNodeIconClick=function(b,c,f){if(a(c))d.onCategoryIconClick(c,
f);else d.onPropertyIconClick(c,f)};b.createTreeNode=function(b,c,f){var h=null;(h=a(b)?d.displayCategory(b,c,f):d.displayProperty(b,c,f))&&(d.highlightableElements[this.getTreeNodeId(b)]=h)};return b}();this.tree=new Autodesk.Viewing.UI.Tree(a,null,this.scrollContainer,{})};Autodesk.Viewing.UI.PropertyPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype);Autodesk.Viewing.UI.PropertyPanel.prototype.constructor=Autodesk.Viewing.UI.PropertyPanel;
Autodesk.Viewing.UI.PropertyPanel.prototype.setProperties=function(a,b){this.removeAllProperties();for(var c=[],f=[],d=0;d<a.length;d++){var g=a[d];if(!g.hidden){var h=a[d].displayCategory;h&&"string"===typeof h&&""!==h?c.push(g):f.push(g)}}if(0===c.length+f.length)this.showNoProperties();else{for(d=0;d<c.length;d++)g=c[d],h=Autodesk.Viewing.Private.formatValueWithUnits(g.displayValue,g.units,g.type),this.addProperty(g.displayName,h,g.displayCategory);c=0<c.length;for(d=0;d<f.length;d++)g=f[d],h=
Autodesk.Viewing.Private.formatValueWithUnits(g.displayValue,g.units,g.type),this.addProperty(g.displayName,h,c?"Other":"",c?{localizeCategory:!0}:{})}};Autodesk.Viewing.UI.PropertyPanel.prototype.showNoProperties=function(){this.removeAllProperties();var a=this.tree.myRootContainer,b=document.createElement("div");b.className="noProperties";b.setAttribute("data-i18n","No properties to display");b.textContent=Autodesk.Viewing.i18n.translate("No properties to display");a.appendChild(b)};
Autodesk.Viewing.UI.PropertyPanel.prototype.showDefaultProperties=function(){this.showNoProperties();this.resizeToContent()};Autodesk.Viewing.UI.PropertyPanel.prototype.areDefaultPropertiesShown=function(){return!this.hasProperties()};
Autodesk.Viewing.UI.PropertyPanel.prototype.addProperty=function(a,b,c,f){if(this.tree.getElementForNode({name:a,value:b,category:c}))return!1;var d=null;a={name:a,value:b,type:"property"};c?((d=this.tree.getElementForNode({name:c}))||(d=this.tree.createElement_({name:c,type:"category"},this.tree.myRootContainer,f&&f.localizeCategory?{localize:!0}:null)),a.category=c):d=this.tree.myRootContainer;this.tree.createElement_(a,d,f&&f.localizeProperty?{localize:!0}:null);return!0};
Autodesk.Viewing.UI.PropertyPanel.prototype.hasProperties=function(){for(var a in this.highlightableElements)return!0;return!1};Autodesk.Viewing.UI.PropertyPanel.prototype.removeProperty=function(a,b,c,f){a={name:a,value:b,category:c};return(b=this.tree.getElementForNode(a))?(delete this.highlightableElements[this.tree.delegate().getTreeNodeId(a)],b.parentNode.removeChild(b),!0):!1};Autodesk.Viewing.UI.PropertyPanel.prototype.removeAllProperties=function(){this.highlightableElements={};this.tree.clear()};
Autodesk.Viewing.UI.PropertyPanel.prototype.setCategoryCollapsed=function(a,b){var c=this.tree.delegate().getTreeNodeId(a);this.tree.setCollapsed(c,b)};Autodesk.Viewing.UI.PropertyPanel.prototype.isCategoryCollapsed=function(a){a=this.tree.delegate().getTreeNodeId(a);return this.tree.isCollapsed(a)};Autodesk.Viewing.UI.PropertyPanel.prototype.getContentSize=function(){var a=this.tree.myRootContainer;return{height:a.clientHeight+55,width:a.clientWidth}};
Autodesk.Viewing.UI.PropertyPanel.prototype.highlight=function(a,b){for(var c in this.highlightableElements)for(var f=this.highlightableElements[c],d=0;d<f.length;++d){var g=f[d],h=g.innerHTML,k=h.replace(/(<highlight>|<\/highlight>)/igm,"");h!==k&&(g.innerHTML=k);a&&""!==a&&(h=k.replace(new RegExp("(\\b"+a+"\\b)","gim"),"<highlight>$1</highlight>"),g.innerHTML=h)}};
Autodesk.Viewing.UI.PropertyPanel.prototype.displayCategory=function(a,b,c){var f=document.createElement("div");a=a.name;c&&c.localize&&(f.setAttribute("data-i18n",a),a=Autodesk.Viewing.i18n.translate(a));f.textContent=a;f.title=a;f.className="categoryName";b.appendChild(f);return[f]};
Autodesk.Viewing.UI.PropertyPanel.prototype.displayProperty=function(a,b,c){var f=document.createElement("div"),d=a.name;c&&c.localize&&(f.setAttribute("data-i18n",d),d=Autodesk.Viewing.i18n.translate(d));f.textContent=d;f.title=d;f.className="propertyName";c=document.createElement("div");c.className="separator";d=document.createElement("div");d.textContent=a.value;d.title=a.value;d.className="propertyValue";b.appendChild(f);b.appendChild(c);b.appendChild(d);return[f,d]};
Autodesk.Viewing.UI.PropertyPanel.prototype.getCategoryClass=function(a){return"category"};Autodesk.Viewing.UI.PropertyPanel.prototype.getPropertyClass=function(a){return"property"};Autodesk.Viewing.UI.PropertyPanel.prototype.onCategoryClick=function(a,b){this.setCategoryCollapsed(a,!this.isCategoryCollapsed(a))};Autodesk.Viewing.UI.PropertyPanel.prototype.onPropertyClick=function(a,b){};Autodesk.Viewing.UI.PropertyPanel.prototype.onCategoryIconClick=function(a,b){this.setCategoryCollapsed(a,!this.isCategoryCollapsed(a))};
Autodesk.Viewing.UI.PropertyPanel.prototype.onPropertyIconClick=function(a,b){};Autodesk.Viewing.UI.PropertyPanel.prototype.onCategoryDoubleClick=function(a,b){};Autodesk.Viewing.UI.PropertyPanel.prototype.onPropertyDoubleClick=function(a,b){};Autodesk.Viewing.UI.PropertyPanel.prototype.onCategoryRightClick=function(a,b){};Autodesk.Viewing.UI.PropertyPanel.prototype.onPropertyRightClick=function(a,b){};AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.Private.ContextMenu=function(a){this.viewer=a;this.menus=[];this.open=!1};Autodesk.Viewing.Private.ContextMenu.prototype.constructor=Autodesk.Viewing.Private.ContextMenu;
Autodesk.Viewing.Private.ContextMenu.prototype.show=function(a,b){var c=this.viewer.container.getBoundingClientRect(),f=a.clientX-c.left,c=a.clientY-c.top;if(!this.open){var d=this;this.showMenu(b,f,c);this.open=!0;this.hideEventListener=function(a){"menuItem"!==a.target.className&&d.hide(a)};this.isTouch="press"===a.type;document.body.addEventListener(this.isTouch?"touchstart":"mousedown",this.hideEventListener,!0)}};
Autodesk.Viewing.Private.ContextMenu.prototype.showMenu=function(a,b,c){var f=document.createElement("div"),d,g=[];f.className="menu";this.viewer.container.appendChild(f);this.menus.push(f);for(var h=0;h<a.length;++h){d=a[h];var k=d.title,l=d.target;d=this.createMenuItem(f,k);"function"===typeof l?this.addCallbackToMenuItem(d,l):Array.isArray(l)?g.push({menuItem:d,target:l}):console.warn("Invalid context menu option:",k,l)}l=f.getBoundingClientRect();h=l.width;d=l.height;a=this.viewer.container.getBoundingClientRect();
var l=a.width,n=a.height;(k=isTouchDevice()&&!this.viewer.navigation.getUseLeftHandedInput())&&(b-=h);0>b&&(b=0);l<b+h&&(b=l-h,0>b&&(b=0));0>c&&(c=0);n<c+d&&(c=n-d,0>c&&(c=0));f.style.top=Math.round(c)+"px";f.style.left=Math.round(b)+"px";for(h=0;h<g.length;++h)f=g[h],d=f.menuItem,l=d.getBoundingClientRect(),b=Math.round((k?l.left:l.right)-a.left),c=Math.round(l.top-a.top),this.addSubmenuCallbackToMenuItem(d,f.target,b,c)};
Autodesk.Viewing.Private.ContextMenu.prototype.createMenuItem=function(a,b){var c=document.createElement("div");c.className="menuItem";c.setAttribute("data-i18n",b);c.textContent=Autodesk.Viewing.i18n.translate(b);a.appendChild(c);return c};Autodesk.Viewing.Private.ContextMenu.prototype.addCallbackToMenuItem=function(a,b){var c=this;a.addEventListener("click",function(a){c.hide();b();a.preventDefault();return!1},!1)};
Autodesk.Viewing.Private.ContextMenu.prototype.addSubmenuCallbackToMenuItem=function(a,b,c,f){var d=this;a.addEventListener("click",function(){d.showMenu(b,c,f)},!1)};Autodesk.Viewing.Private.ContextMenu.prototype.hide=function(){if(this.open){for(var a=0;a<this.menus.length;++a)this.menus[a]&&this.menus[a].parentNode.removeChild(this.menus[a]);this.menus=[];this.open=!1;document.body.removeEventListener(this.isTouch?"touchstart":"mousedown",this.hideEventListener);this.isTouch=!1;return!0}return!1};
AutodeskNamespace("Autodesk.Viewing.UI");Autodesk.Viewing.UI.ObjectContextMenu=function(a){this.viewer=a;this.contextMenu=new Autodesk.Viewing.Private.ContextMenu(a)};Autodesk.Viewing.UI.ObjectContextMenu.prototype.constructor=Autodesk.Viewing.UI.ObjectContextMenu;
Autodesk.Viewing.UI.ObjectContextMenu.prototype.show=function(a){var b=this.viewer.getSelectionCount(),c=this.viewer.getSelectionVisibility(),b={numSelected:b,hasSelected:0<b,hasVisible:c.hasVisible,hasHidden:c.hasHidden},c=this.buildMenu(a,b);this.viewer.runContextMenuCallbacks(c,b);c&&0<c.length&&this.contextMenu.show(a,c)};Autodesk.Viewing.UI.ObjectContextMenu.prototype.hide=function(){return this.contextMenu.hide()};Autodesk.Viewing.UI.ObjectContextMenu.prototype.buildMenu=function(a,b){return null};
AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.Private.Preferences=function(a,b){function c(a,c){if(k)return a=b+a,"undefined"!==typeof c?localStorage[a]=c:c=localStorage[a],c}function f(a,b){if("string"!==typeof a||"function"===typeof l[a])stderr("Preferences: invalid name="+a);else{var d=c(a);ok=!1;if(void 0!==d)try{d=JSON.parse(d),ok=!0}catch(f){}l[a]=ok?d:b;h[a]={}}}b||(b="Autodesk.Viewing.Preferences.");var d={},g={},h={},k=function(){var a=b+"test",c=window.localStorage;try{return c.setItem(a,"1"),c.removeItem(a),!0}catch(d){return!1}}(),
l=this;a.addEventListener("PrefChanged",function(a){var b=g[a.name];b&&(b=b.changed)&&b(a.value)});a.addEventListener("PrefReset",function(a){for(var b in g)g.hasOwnProperty(b)&&(a=g[b].reset)&&a(l[b])});this.load=function(a){d=a;for(var b in d)d.hasOwnProperty(b)&&f(b,d[b])};this.tag=function(a,b){if(a){b?Array.isArray(b)||(b=[b]):b=Object.keys(d);for(var c=0;c<b.length;++c)h[b[c]][a]=!0}};this.untag=function(a,b){if(a){b?Array.isArray(b)||(b=[b]):b=Object.keys(d);for(var c=0;c<b.length;++c)h[b[c]][a]=
!1}};this.add=function(a,b,c){if(d.hasOwnProperty(a))stderr("Preferences: "+a+" already exists");else{d[a]=b;f(a,b);if(c)for(Array.isArray(c)||(c=[c]),b=0;b<c.length;++b)this.tag(c[b],a);return!0}return!1};this.remove=function(a,c){return d.hasOwnProperty(a)?(delete d[a],delete h[a],delete this[a],c&&k&&(a=b+a,delete localStorage[a]),!0):!1};this.reset=function(b,c){b&&void 0===c&&(c=!0);for(var f in d)if(d.hasOwnProperty(f)){if(b){var g=!!h[f][b];if(c&&!g||!c&&g)continue}this.set(f,d[f],!1)&&a.fireEvent({type:"PrefReset",
name:f,value:this[f]})}};this.get=function(a){return this[a]};this.set=function(b,d,f){return this[b]!==d?(this[b]=d,c(b,d),(void 0===f||f)&&a.fireEvent({type:"PrefChanged",name:b,value:d}),(f=Autodesk.Viewing.Private.logger)&&f.log({category:"pref_changed",name:b,value:d}),!0):!1};this.addListeners=function(a,b,c){g[a]={changed:b,reset:c}};this.removeListeners=function(a){void 0!==g[a]&&delete g[a]}};AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.Private.formatValueWithUnits=function(a,b,c,f){function d(a){var b=0<=a?Math.floor(a):Math.ceil(a);return{intPart:b,fracPart:a-b}}function g(a,b,c){var f="";c&&0===a&&(f+="-");0===d(a).fracPart?f+=a:0<b?(a=a.toFixed(b),b=/^\-?([0-9]+)\.0+$/.exec(a),f=null!==b?f+b[1]:f+a):f+=a.toFixed(0);return f}function h(a,b,c){for(var f="",h=1,k=0>a,r=0;r<b;++r)h*=2;a=0<a?a+.5/h:a-.5/h;c?k=a:(b=d(a/12).intPart,f+=g(b,0,k)+"' ",k=a-12*b,0>k&&(k=-k));a=d(k).intPart;k=d((k-a)*h).intPart;if(0===k||
0!==a)f+=g(a,0);if(0!==k){for(0>a&&0>k&&(k=-k);0===k%2;)k/=2,h/=2;0!==a&&(f+="-");f+=g(k,0)+"/"+g(h,0)}return f+'"'}function k(a,b){var c="";0>a&&(c="-",a=Math.abs(a));var f=d(a),h=100*f.fracPart;return c+g(f.intPart,0)+" m "+g(h,b)+" cm"}void 0===f&&(f=3);1===c?a=Autodesk.Viewing.i18n.translate(a?"Yes":"No"):2!==c&&3!==c||!isNaN(a)?"ft"===b||"feet"===b||"foot"===b?a=h(12*a,f):"ft^2"===b||"feet^2"===b||"foot^2"===b?a=h(12*a,f)+" "+String.fromCharCode(178):"in"===b||"inch"===b?a=h(a,f):"in^2"===b||
"inch^2"===b?a=h(a,f)+" "+String.fromCharCode(178):"decimal-in"===b?a=g(a,f)+'"':"decimal-in^2"===b?a=g(a,f)+'" '+String.fromCharCode(178):"decimal-ft"===b?a=g(a,f)+"'":"decimal-ft^2"===b?a=g(a,f)+"' "+String.fromCharCode(178):"fractional-in"===b?a=h(a,f,!0):"fractional-in^2"===b?a=h(a,f,!0)+" "+String.fromCharCode(178):"m-and-cm"===b?a=k(a,f):"m-and-cm^2"===b?a=k(a,f)+" "+String.fromCharCode(178):3===c&&b?(b=b.replace("^2",String.fromCharCode(178)),b=b.replace("^3",String.fromCharCode(179)),a=g(a,
f)+" "+b):a=b?a+" "+b:3===c?g(a,f):a:a="NaN";return a};
Autodesk.Viewing.Private.convertUnits=function(a,b,c,f){if(a===b)return c;var d=1;switch(b){case "mm":d=1E3;break;case "cm":d=100;break;case "m":d=1;break;case "in":d=39.37007874;break;case "ft":d=3.280839895;break;case "decimal-in":d=39.37007874;break;case "decimal-ft":d=3.280839895;break;case "fractional-in":d=39.37007874;break;case "m-and-cm":d=1}b=1;switch(a){case "mm":b=.001;break;case "cm":b=.01;break;case "m":b=1;break;case "in":b=.0254;break;case "ft":b=.3048;break;case "decimal-in":b=.0254;
break;case "decimal-ft":b=.3048;break;case "fractional-in":b=.0254;break;case "m-and-cm":b=1}return"square"===f?c*Math.pow(d*b,2):c*d*b};AutodeskNamespace("Autodesk.Viewing.Private");
(function(){var a=Autodesk.Viewing,b=Autodesk.Viewing.Private;b.OptionSlider=function(b,f,d,g,h){function k(a){a.target!=l.stepperElement&&(l.stepperElement.value=l.sliderElement.value);l.fireChangeEvent()}var l=this;this.tbody=g;this.sliderRow=this.tbody.insertRow(h&&h.insertAtIndex?h.insertAtIndex:-1);g=this.sliderRow.insertCell(0);this.caption=document.createElement("div");this.caption.setAttribute("data-i18n",b);this.caption.textContent=a.i18n.translate(b);this.sliderElement=document.createElement("input");
this.sliderElement.type="range";this.sliderElement.id=b+"_slider";this.sliderElement.min=f;this.sliderElement.max=d;g.appendChild(this.caption);g.appendChild(this.sliderElement);g=this.sliderRow.insertCell(1);this.stepperElement=document.createElement("input");this.stepperElement.type="number";this.stepperElement.id=b+"_stepper";this.stepperElement.min=f;this.stepperElement.max=d;this.stepperElement.step=1;this.stepperElement.style.width="64px";g.appendChild(this.stepperElement);this.blockEvent=!1;
this.stepperElement.addEventListener("change",function(a){a.target!=l.sliderElement&&(l.sliderElement.value=l.stepperElement.value);l.fireChangeEvent()},!1);this.sliderElement.addEventListener("change",k,!1);this.sliderElement.addEventListener("input",k,!1)};b.OptionSlider.prototype.constructor=b.OptionSlider;a.EventDispatcher.prototype.apply(b.OptionSlider.prototype);b.OptionSlider.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.value=this.sliderElement.value;var a=new CustomEvent("change",
{detail:{target:this,value:this.sliderElement.value}});this.dispatchEvent(a)}};b.OptionSlider.prototype.setValue=function(a){this.blockEvent=!0;this.value=a;this.sliderElement.value=a;this.stepperElement.value=a;this.blockEvent=!1};b.OptionSlider.prototype.setDisabled=function(a){this.sliderElement.disabled=a;this.stepperElement.disabled=a;this.caption.disabled=a};b.OptionCheckbox=function(b,f,d,g){var h=this;this.tbody=f;this.sliderRow=this.tbody.insertRow(g&&g.insertAtIndex?g.insertAtIndex:-1);
f=this.sliderRow.insertCell(0);this.caption=document.createElement("div");this.caption.setAttribute("data-i18n",b);this.caption.textContent=a.i18n.translate(b);f.appendChild(this.caption);f=this.sliderRow.insertCell(1);this.checkElement=document.createElement("input");this.checkElement.type="checkbox";this.checkElement.id=b+"_check";this.checkElement.checked=d;f.appendChild(this.checkElement);this.blockEvent=!1;this.checked=d;this.checkElement.addEventListener("change",function(a){h.fireChangeEvent()},
!1);isTouchDevice()&&(this.sliderRowHammer=new Hammer.Manager(this.sliderRow,{recognizers:[[Hammer.Tap]],inputClass:Hammer.TouchInput}),this.sliderRowHammer.on("tap",function(a){a.preventDefault();a.target.click()}));this.checkElement.addEventListener("click",function(a){a.stopPropagation()},!1);this.sliderRow.addEventListener("click",function(a){h.checkElement.disabled||(h.checkElement.checked=!h.checkElement.checked,h.fireChangeEvent())},!1)};b.OptionCheckbox.prototype.constructor=b.OptionCheckbox;
a.EventDispatcher.prototype.apply(b.OptionCheckbox.prototype);b.OptionCheckbox.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.checked=this.checkElement.checked;var a=new CustomEvent("change",{detail:{target:this,value:this.checkElement.checked}});this.dispatchEvent(a)}};b.OptionCheckbox.prototype.setValue=function(a){this.blockEvent=!0;this.checked=a;this.checkElement.checked=a;this.blockEvent=!1};b.OptionCheckbox.prototype.setDisabled=function(a){this.checkElement.disabled=a;this.caption.disabled=
a};b.OptionCheckbox.prototype.setVisibility=function(a){this.sliderRow.style.display=a?"table-row":"none"};b.OptionDropDown=function(b,f,d,g,h){var k=this;this.tbody=f;this.sliderRow=this.tbody.insertRow(h&&h.insertAtIndex?h.insertAtIndex:-1);f=this.sliderRow.insertCell(0);this.caption=document.createElement("div");this.caption.setAttribute("data-i18n",b);this.caption.textContent=a.i18n.translate(b);f.appendChild(this.caption);f=this.sliderRow.insertCell(1);this.dropdownElement=document.createElement("select");
this.dropdownElement.id=b+"_dropdown";this.dropdownElement.className="optionDropDown";for(b=0;b<d.length;b++)h=document.createElement("option"),h.value=b,h.setAttribute("data-i18n",d[b]),h.textContent=a.i18n.translate(d[b]),this.dropdownElement.add(h);this.selectedIndex=this.dropdownElement.selectedIndex=g;f.appendChild(this.dropdownElement);f.style.paddingLeft="5px";f.style.paddingRight="5px";this.blockEvent=!1;this.dropdownElement.addEventListener("change",function(a){k.fireChangeEvent()},!1)};
b.OptionDropDown.prototype.constructor=b.OptionDropDown;a.EventDispatcher.prototype.apply(b.OptionDropDown.prototype);b.OptionDropDown.prototype.setSelectedIndex=function(a){this.blockEvent=!0;this.selectedIndex=this.dropdownElement.selectedIndex=a;this.blockEvent=!1};b.OptionDropDown.prototype.setSelectedValue=function(a){this.blockEvent=!0;this.dropdownElement.selectedValue=a;this.selectedIndex=this.dropdownElement.selectedIndex;this.blockEvent=!1};b.OptionDropDown.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.selectedIndex=
this.dropdownElement.selectedIndex;var a=new CustomEvent("change",{detail:{target:this,value:this.selectedIndex}});this.dispatchEvent(a)}};b.OptionDropDown.prototype.setDisabled=function(a){this.dropdownElement.disabled=a;this.caption.disabled=a}})();AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.Private.ProgressBar=function(a){this.bg=document.createElement("div");this.bg.className="progressbg";this.fg=document.createElement("div");this.fg.className="progressfg";this.bg.appendChild(this.fg);this.lastValue=-1;a.appendChild(this.bg);this.widthScale=this.fg.clientWidth};
Autodesk.Viewing.Private.ProgressBar.prototype.setPercent=function(a){a!=this.lastValue&&(this.lastValue=a,99<=a?this.bg.style.visibility="hidden":(this.bg.style.visibility="visible",this.fg.style.width=this.widthScale*a*.01+"px"))};AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.Private.RenderOptionsPanel=function(a){var b=this,c=Autodesk.Viewing.Private;this.viewer=a;Autodesk.Viewing.UI.DockingPanel.call(this,a.container,"RenderOptionsPanel","Rendering Options");this.table=document.createElement("table");this.table.className="tftable";this.tbody=document.createElement("tbody");this.table.appendChild(this.tbody);this.createScrollContainer({heightAdjustment:70,marginTop:20});this.scrollContainer.appendChild(this.table);this.container.style.width="320px";this.container.style.top=
"260px";this.container.style.left="220px";this.container.style.height="460px";this.container.dockRight=!0;var f=[],d;for(d in a.impl.BackgroundPresets)f.push(d);this.bgSelect=new c.OptionDropDown("Background Color",this.tbody,f,-1);this.updateBgColorIndex();this.addEventListener(this.bgSelect,"change",function(c){c=a.BackgroundPresets[b.bgSelect.value];a.prefs.set("backgroundColorPreset",JSON.stringify(c));a.impl.setClearColors(c[0],c[1],c[2],c[3],c[4],c[5])});this.celToggle=new c.OptionCheckbox("Cel Shaded",
this.tbody,!0);this.addEventListener(this.celToggle,"change",function(c){c=b.celToggle.checked;a.prefs.set("celShaded",c);a.impl.toggleCelShading(c)});this.saoToggle=new c.OptionCheckbox("AO Enabled",this.tbody,!0);this.addEventListener(this.saoToggle,"change",function(c){c=b.saoToggle.checked;a.prefs.set("ambientShadows",c);a.setQualityLevel(c,a.impl.renderer().settings.antialias)});this.saoRadius=new c.OptionSlider("AO Radius",0,100,this.tbody);this.saoRadius.setValue(10);this.saoRadius.sliderElement.step=
this.saoRadius.stepperElement.step=1;this.addEventListener(this.saoRadius,"change",function(c){a.impl.renderer().setAOOptions(parseInt(b.saoRadius.value),parseFloat(b.saoIntensity.value));a.impl.renderer().composeFinalFrame(!1)});this.saoIntensity=new c.OptionSlider("AO Intensity",0,3,this.tbody);this.saoIntensity.setValue(.75);this.saoIntensity.sliderElement.step=this.saoIntensity.stepperElement.step=.1;this.addEventListener(this.saoIntensity,"change",function(c){a.impl.renderer().setAOOptions(parseInt(b.saoRadius.value),
parseFloat(b.saoIntensity.value));a.impl.renderer().composeFinalFrame(!1)});this.groundShadowAlpha=new c.OptionSlider("Shadow Alpha",0,2,this.tbody);this.groundShadowAlpha.setValue(1);this.groundShadowAlpha.sliderElement.step=this.groundShadowAlpha.stepperElement.step=.1;this.addEventListener(this.groundShadowAlpha,"change",function(c){a.setGroundShadowAlpha(parseFloat(b.groundShadowAlpha.value))});this.groundShadowColor=new c.OptionCheckbox("Shadow Color",this.tbody);_isIE11||(this.groundShadowColor.checkElement.type=
"color");this.addEventListener(this.groundShadowColor,"change",function(c){a.setGroundShadowColor(new THREE.Color(parseInt(b.groundShadowColor.checkElement.value.substr(1,7),16)))});this.groundReflectionAlpha=new c.OptionSlider("Reflection Alpha",0,2,this.tbody);this.groundReflectionAlpha.setValue(1);this.groundReflectionAlpha.sliderElement.step=this.groundReflectionAlpha.stepperElement.step=.1;this.addEventListener(this.groundReflectionAlpha,"change",function(c){a.setGroundReflectionAlpha(parseFloat(b.groundReflectionAlpha.value))});
this.groundReflectionColor=new c.OptionCheckbox("Reflection Color",this.tbody);_isIE11||(this.groundReflectionColor.checkElement.type="color");this.addEventListener(this.groundReflectionColor,"change",function(c){a.setGroundReflectionColor(new THREE.Color(parseInt(b.groundReflectionColor.checkElement.value.substr(1,7),16)))});f=[];for(d=0;d<c.LightPresets.length;d++)f.push(c.LightPresets[d].name);this.envSelect=new c.OptionDropDown("Environment",this.tbody,f,a.impl.currentLightPreset());this.addEventListener(this.envSelect,
"change",function(c){a.setLightPreset(b.envSelect.selectedIndex)});f=a.impl.renderer().getToneMapMethod();this.toneMapMethod=new c.OptionDropDown("Tonemap Method",this.tbody,["None","Canon-RGB","Canon-Lum"],f);this.addEventListener(this.toneMapMethod,"change",function(){a.impl.setTonemapMethod(b.toneMapMethod.selectedIndex)});this.exposureBias=new c.OptionSlider("Exposure Bias",-30,30,this.tbody);this.exposureBias.setValue(a.impl.renderer().getExposureBias());this.exposureBias.sliderElement.step=
this.exposureBias.stepperElement.step=.1;this.addEventListener(this.exposureBias,"change",function(c){a.impl.setTonemapExposureBias(b.exposureBias.value,b.whiteScale.value)});this.exposureBias.setDisabled(0==f);this.whiteScale=new c.OptionSlider("Light Intensity",-5,20,this.tbody);f=0;a.impl.dir_light1&&(f=0!=a.impl.dir_light1.intensity?Math.log(a.impl.dir_light1.intensity)/Math.log(2):-1E-20);this.whiteScale.setValue(f);this.whiteScale.sliderElement.step=this.whiteScale.stepperElement.step=.1;this.addEventListener(this.whiteScale,
"change",function(c){a.impl.dir_light1.intensity=Math.pow(2,b.whiteScale.value);a.impl.setTonemapExposureBias(b.exposureBias.value,b.whiteScale.value)});this.fovAngle=new c.OptionSlider("FOV-degrees",6.88,100,this.tbody);this.fovAngle.setValue(a.getFOV());this.addEventListener(this.fovAngle,"change",function(c){a.setFOV(parseFloat(b.fovAngle.value))});this.addEventListener(this.viewer,Autodesk.Viewing.CAMERA_CHANGE_EVENT,function(c){c=parseFloat(b.fovAngle.value);var d=a.getFOV();c!=d&&b.fovAngle.setValue(d)});
this.addEventListener(this.viewer,Autodesk.Viewing.RENDER_OPTION_CHANGED_EVENT,function(a){b.syncUI()});this.addVisibilityListener(function(){b.resizeToContent()})};Autodesk.Viewing.Private.RenderOptionsPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype);Autodesk.Viewing.Private.RenderOptionsPanel.prototype.constructor=Autodesk.Viewing.Private.RenderOptionsPanel;
Autodesk.Viewing.Private.RenderOptionsPanel.prototype.getContentSize=function(){return{height:this.table.clientHeight+75,width:this.table.clientWidth}};
Autodesk.Viewing.Private.RenderOptionsPanel.prototype.updateBgColorIndex=function(){var a=this.viewer.impl,b=a.clearColorTop,a=a.clearColorBottom,b=[255*b.x|0,255*b.y|0,255*b.z|0,255*a.x|0,255*a.y|0,255*a.z|0],c,f;for(f in Autodesk.Viewing.Private.BackgroundPresets){var a=Autodesk.Viewing.Private.BackgroundPresets[f],d;for(d=0;6>d&&a[d]==b[d];d++);if(6==d){c=f;break}}if(!c)for(c="Custom",f=Autodesk.Viewing.Private.BackgroundPresets[c],a=0;6>a;a++)f[a]=b[a];this.bgSelect.setSelectedValue(c)};
Autodesk.Viewing.Private.RenderOptionsPanel.prototype.syncUI=function(){var a=this.viewer.impl,b=0;a.dir_light1&&(b=0!=a.dir_light1.intensity?Math.log(a.dir_light1.intensity)/Math.log(2):-1E-20);this.whiteScale.setValue(b);this.exposureBias.setValue(a.renderer().getExposureBias());this.updateBgColorIndex();b=a.renderer().getToneMapMethod();this.toneMapMethod.setSelectedIndex(b);this.envSelect.setSelectedIndex(a.currentLightPreset());this.exposureBias.setDisabled(0==b);this.saoToggle.setValue(a.renderer().settings.sao);
this.saoRadius.setDisabled(!a.renderer().settings.sao);this.saoIntensity.setDisabled(!a.renderer().settings.sao);this.saoRadius.setValue(a.renderer().getAORadius());this.saoIntensity.setValue(a.renderer().getAOIntensity());this.groundShadowAlpha.setDisabled(!this.viewer.prefs.get("groundShadow"));this.groundShadowColor.setDisabled(!this.viewer.prefs.get("groundShadow"));this.groundReflectionAlpha.setDisabled(!this.viewer.prefs.get("groundReflection"));this.groundReflectionColor.setDisabled(!this.viewer.prefs.get("groundReflection"));
this.fovAngle.setValue(this.viewer.getFOV());this.celToggle.setValue(a.renderer().settings.toonShaded)};Autodesk.Viewing.Private.RenderOptionsPanel.prototype.uninitialize=function(){Autodesk.Viewing.UI.DockingPanel.prototype.uninitialize.call(this);this.viewer=this.fovAngle=this.whiteScale=this.exposureBias=this.toneMapMethod=this.envSelect=this.groundShadowAlpha=this.saoIntensity=this.saoRadius=this.saoToggle=this.bgSelect=this.tbody=this.table=null};AutodeskNamespace("Autodesk.Viewing.UI");
Autodesk.Viewing.UI.LayersPanel=function(a,b,c){this.viewer=a;this.layersRoot=this.tree=null;this.visibilityImages={};this.isMac=-1!==navigator.userAgent.search("Mac OS");b="Layer Manager";var f=a.config.viewableName;f&&"W2D"!==f&&(b=Autodesk.Viewing.i18n.translate(b)+": "+f);this.filterImageId=c+"-layerFilterImageId";Autodesk.Viewing.UI.DockingPanel.call(this,a.container,c,b,{localizeTitle:!1});this.container.classList.add("layersPanel");this.filterContainer=document.createElement("div");this.filterContainer.className=
"filterBox";this.filterContainer.id=this.container.id+"-search-container";this.container.appendChild(this.filterContainer);this.createScrollContainer({heightAdjustment:105,marginTop:5});var d=this;a.model?d.build():d.addEventListener(a,Autodesk.Viewing.GEOMETRY_LOADED_EVENT,function(){d.build()});this.addVisibilityListener(function(){d.resizeToContent()})};Autodesk.Viewing.UI.LayersPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype);
Autodesk.Viewing.UI.LayersPanel.prototype.constructor=Autodesk.Viewing.UI.LayersPanel;Autodesk.Viewing.UI.LayersPanel.prototype.uninitialize=function(){Autodesk.Viewing.UI.DockingPanel.prototype.uninitialize.call(this);this.filterContainer=this.scrollContainer=this.visibilityImages=this.layersRoot=this.tree=this.viewer=null};
Autodesk.Viewing.UI.LayersPanel.prototype.build=function(){function a(){if(d.value){var a=function(c){var d=[];if(-1!==c.name.toLowerCase().indexOf(b))d.push(c);else if(!c.isLayer){c=c.children;for(var f=0;f<c.length;++f)d=d.concat(a(c[f]))}return d},b=d.value.toLowerCase();k&&0<k.childCount&&h.setLayerVisible(a(k),!0,!0)}else h.setLayerVisible(null,!0);g=null}var b=this,c=document.createElement("div");c.className="filterSearch";b.filterContainer.appendChild(c);var f=document.createElement("div");
f.className="filterImage";f.id=b.filterImageId;f.title=Autodesk.Viewing.i18n.translate("Show/hide all layers");c.appendChild(f);b.visibilityImages[b.filterImageId]=f;b.addEventListener(f,"click",function(a){b.onImageClick(null,a);a.stopPropagation()});var d=this.filterField=document.createElement("input");d.className="filterInput";d.placeholder=Autodesk.Viewing.i18n.translate("Enter filter term");d.setAttribute("data-i18n","[placeholder]Enter filter term");d.type="search";d.incremental="incremental";
c.appendChild(d);var g=null,h=b.viewer;d.addEventListener("keyup",function(b){g&&clearTimeout(g);g=setTimeout(a,500)});d.addEventListener("click",function(a){""===d.value?h.setLayerVisible(null,!0):setTimeout(function(){""===d.value&&(h.setLayerVisible(null,!0),a.preventDefault())},1)});var c=function(){var a=new Autodesk.Viewing.UI.TreeDelegate;a.getTreeNodeId=function(a){return a.id};a.getTreeNodeLabel=function(a){return b.getNodeLabel(a)};a.getTreeNodeClass=function(a){return b.getNodeClass(a)};
a.isTreeNodeGroup=function(a){return b.isGroupNode(a)};a.shouldCreateTreeNode=function(a){return b.shouldInclude(a)};a.onTreeNodeClick=function(a,c,d){b.onClick(c,d)};a.onTreeNodeRightClick=function(a,c,d){b.onRightClick(c,d)};a.onTreeNodeDoubleClick=function(a,c,d){b.onDoubleClick(c,d)};a.onTreeNodeIconClick=function(a,c,d){b.onIconClick(c,d)};a.createTreeNode=function(a,c){b.createNode(a,c)};return a}(),k=b.layersRoot=b.viewer.model.getLayersRoot();k&&(b.tree=new Autodesk.Viewing.UI.Tree(c,k,b.scrollContainer,
{excludeRoot:!0}),b.resizeToContent(),b.update(),b.addEventListener(b.viewer,Autodesk.Viewing.LAYER_VISIBILITY_CHANGED_EVENT,function(){b.update()}))};
Autodesk.Viewing.UI.LayersPanel.prototype.update=function(){function a(a,b){var c;c=1===b?"layerVisible":0===b?"layerHidden":"layerMixed";a.classList.remove("layerVisible","layerHidden","layerMixed");a.classList.add(c)}function b(a,b){0===b?d.tree.addClass(a.id,"dim"):d.tree.removeClass(a.id,"dim")}function c(a){var b;if(0<a.length)for(var c=0;c<a.length;++c){var d=a[c];void 0===b?b=d:0===d&&1===b?b=-1:1===d&&0===b&&(b=-1);if(-1===b)break}else b=0;return b}function f(g){var k=d.visibilityImages[g.id];
if(!g.isLayer){for(var l=g.children,n=[],q=0;q<l.length;++q)n=n.concat(f(l[q]));l=c(n);a(k,l);b(g,l);return n}n=d.viewer.isLayerVisible(g)?1:0;a(k,n);b(g,n);return[n]}var d=this,g=this.layersRoot&&0<this.layersRoot.childCount?f(d.layersRoot):[];a(d.visibilityImages[d.filterImageId],c(g))};Autodesk.Viewing.UI.LayersPanel.prototype.setLayerVisible=function(a,b){this.viewer.setLayerVisible(a,"layerVisible"!==this.visibilityImages[a?a.id:this.filterImageId].className,b);this.filterField.value=""};
Autodesk.Viewing.UI.LayersPanel.prototype.getNodeLabel=function(a){return a.isLayer||0===a.childCount?a.name:a.name+" ("+a.childCount+")"};Autodesk.Viewing.UI.LayersPanel.prototype.getNodeClass=function(a){return""};Autodesk.Viewing.UI.LayersPanel.prototype.isGroupNode=function(a){return!a.isLayer};Autodesk.Viewing.UI.LayersPanel.prototype.shouldInclude=function(a){return!0};Autodesk.Viewing.UI.LayersPanel.prototype.onIconClick=function(a,b){this.setGroupCollapsed(a,!this.isGroupCollapsed(a))};
Autodesk.Viewing.UI.LayersPanel.prototype.setGroupCollapsed=function(a,b){var c=this.tree.delegate();c.isTreeNodeGroup(a)&&(c=c.getTreeNodeId(a),this.tree.setCollapsed(c,b),this.resizeToContent())};Autodesk.Viewing.UI.LayersPanel.prototype.isGroupCollapsed=function(a){var b=this.tree.delegate();return b.isTreeNodeGroup(a)?(a=b.getTreeNodeId(a),this.tree.isCollapsed(a)):!1};Autodesk.Viewing.UI.LayersPanel.prototype.onClick=function(a,b){};
Autodesk.Viewing.UI.LayersPanel.prototype.onDoubleClick=function(a,b){};Autodesk.Viewing.UI.LayersPanel.prototype.onRightClick=function(a,b){};Autodesk.Viewing.UI.LayersPanel.prototype.onImageClick=function(a,b){};Autodesk.Viewing.UI.LayersPanel.prototype.getContentSize=function(){var a=this.filterContainer,b=a.clientHeight+80,a=a.clientWidth,c=this.tree;return c&&(c=c.getRootContainer())?{height:c.clientHeight+b,width:Math.max(c.clientWidth,a)}:{height:b,width:a}};
Autodesk.Viewing.UI.LayersPanel.prototype.createNode=function(a,b){var c=document.createElement("div");b.children&&0<b.children.length?b.insertBefore(c,b.children[0]):b.appendChild(c);c.title=Autodesk.Viewing.i18n.translate("Show/hide this layer");this.visibilityImages[a.id]=c;var f=document.createElement("label");f.textContent=this.getNodeLabel(a);b.appendChild(f);var d=this;this.addEventListener(c,"click",function(b){d.onImageClick(a,b);b.stopPropagation()})};AutodeskNamespace("Autodesk.Viewing.UI");
Autodesk.Viewing.UI.SettingsPanel=function(a,b,c,f){Autodesk.Viewing.UI.DockingPanel.call(this,a,b,c,f);this.panelTabs=[];this.tabIdToIndex={};this.controls={};this.controlIdCount=0;var d=this;this.container.style.maxWidth="800px";this.container.style.minWidth="340px";this.container.style.top="100px";this.container.style.left=a.offsetWidth/2-170+"px";this.container.style.position="absolute";this.tabContainer=document.createElement("div");this.tabContainer.className="settings-tabs";this.container.appendChild(this.tabContainer);
this.tabs=document.createElement("ul");this.tabContainer.appendChild(this.tabs);this.heightAdjustment=f&&f.heightAdjustment?f.heightAdjustment:110;this.createScrollContainer({left:!1,heightAdjustment:this.heightAdjustment,marginTop:0});this.mouseOver=!1;this.addEventListener(this.container,"mouseover",function(a){a=a.toElement||a.relatedTarget;if(d.mouseOver)return!0;for(var b=0;a&&a.parentNode&&a.parentNode!=window;){if(a.parentNode==this||a==this){a.preventDefault&&a.preventDefault();d.mouseOver=
!0;for(b=0;b<d.panelTabs.length;b++)d.panelTabs[b].classList.remove("selectedmouseout");return!0}a=a.parentNode}});this.addEventListener(this.container,"mouseout",function(a){a=a.toElement||a.relatedTarget;if(d.mouseOver){for(;a&&a.parentNode&&a.parentNode!=window;){if(a.parentNode==this||a==this)return a.preventDefault&&a.preventDefault(),!1;a=a.parentNode}d.mouseOver=!1;for(a=0;a<d.panelTabs.length;a++)d.panelTabs[a].classList.contains("tabselected")&&d.panelTabs[a].classList.add("selectedmouseout")}})};
Autodesk.Viewing.UI.SettingsPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype);Autodesk.Viewing.UI.SettingsPanel.prototype.constructor=Autodesk.Viewing.UI.SettingsPanel;Autodesk.Viewing.UI.SettingsPanel.prototype.setVisible=function(a){a&&(this.container.style.display="block");Autodesk.Viewing.UI.DockingPanel.prototype.setVisible.call(this,a)};
Autodesk.Viewing.UI.SettingsPanel.prototype.addTab=function(a,b,c){var f=this;if(void 0!==this.tabIdToIndex[a])return!1;var d=c&&void 0!==c.className?c.className:null,g=c&&void 0!==c.width?c.width:200;c=c&&void 0!==c.index?c.index:this.panelTabs.length;var h=document.createElement("li");h.id=a;var k=document.createElement("a"),l=document.createElement("span");l.setAttribute("data-i18n",b);l.textContent=Autodesk.Viewing.i18n.translate(b);k.appendChild(l);h.appendChild(k);this.tabs.appendChild(h);b=
document.createElement("table");b.id=a+"-table";b.className="settings-table tftable "+d;d=document.createElement("tbody");b.appendChild(d);this.scrollContainer.appendChild(b);this.addEventListener(h,"touchstart",touchStartToClick);this.addEventListener(h,"click",function(b){f.selectTab(a)});this.panelTabs.push(h);this.tabIdToIndex[a]=c;d=this.container.style.minWidth?parseInt(this.container.style.minWidth):0;g>d&&(this.container.style.minWidth=g+"px");return!0};
Autodesk.Viewing.UI.SettingsPanel.prototype.removeTab=function(a){a=this.tabIdToIndex[a];if(!a)return!1;this.panelTabs.splice(a,1);this.tabs.removeChild(tabDom);this.tabIdToIndex={};a=this.panelTabs.length;for(var b=0;b<a;b++)this.tabIdToIndex[this.panelTabs[b].id]=b;return!0};Autodesk.Viewing.UI.SettingsPanel.prototype.hasTab=function(a){return void 0!==this.panelTabs[this.tabIdToIndex[a]]};
Autodesk.Viewing.UI.SettingsPanel.prototype.selectTab=function(a){if(this.isTabSelected(a))return!1;for(var b=this.panelTabs.length,c=0;c<b;c++){var f=this.panelTabs[c],d=document.getElementById(f.id+"-table");a===f.id?(f.classList.add("tabselected"),d.style.display="table",this.mouseOver||f.classList.add("selectedmouseout")):(f.classList.remove("tabselected"),d.style.display="none",this.mouseOver||this.panelTabs[c].classList.remove("selectedmouseout"))}this.resizeToContent();return!0};
Autodesk.Viewing.UI.SettingsPanel.prototype.isTabSelected=function(a){return(a=this.panelTabs[this.tabIdToIndex[a]])&&a.classList.contains("tabselected")};
Autodesk.Viewing.UI.SettingsPanel.prototype.addCheckbox=function(a,b,c,f,d){if(void 0===this.tabIdToIndex[a])return null;var g=document.getElementById(a+"-table");b=new Autodesk.Viewing.Private.OptionCheckbox(b,g.tBodies[0],c,d);b.changeListener=function(a){f(a.detail.target.checked)};this.addEventListener(b,"change",b.changeListener);return this.addControl(a,b)};
Autodesk.Viewing.UI.SettingsPanel.prototype.addSlider=function(a,b,c,f,d,g,h){if(void 0===this.tabIdToIndex[a])return null;var k=document.getElementById(a+"-table");b=new Autodesk.Viewing.Private.OptionSlider(b,c,f,k.tBodies[0],h);b.setValue(d);b.sliderElement.step=b.stepperElement.step=1;this.addEventListener(b,"change",function(a){g(a)});return this.addControl(a,b)};
Autodesk.Viewing.UI.SettingsPanel.prototype.addDropDownMenu=function(a,b,c,f,d,g){if(void 0===this.tabIdToIndex[a])return null;var h=document.getElementById(a+"-table");b=new Autodesk.Viewing.Private.OptionDropDown(b,h.tBodies[0],c,f,g);this.addEventListener(b,"change",function(a){d(a)});return this.addControl(a,b)};
Autodesk.Viewing.UI.SettingsPanel.prototype.addControl=function(a,b,c){if(void 0===this.tabIdToIndex[a])return null;if(!b.hasOwnProperty("sliderRow")){var f=c&&c.insertAtIndex?c.insertAtIndex:-1;c=c&&c.caption?c.caption:null;a=document.getElementById(a+"-table");f>a.length&&(f=-1);var f=a.tBodies[0].insertRow(f),d=f.insertCell(0);if(c){var g=document.createElement("div");g.setAttribute("data-i18n",c);g.textContent=Autodesk.Viewing.i18n.translate(c);d.appendChild(g);d=f.insertCell(1)}else d.colSpan=
2;d.appendChild(b);b.sliderRow=f;b.tbody=a.tBodies[0]}c="adsk_settings_control_id_"+this.controlIdCount.toString();this.controlIdCount+=1;this.controls[c]=b;this.resizeToContent();return c};Autodesk.Viewing.UI.SettingsPanel.prototype.removeCheckbox=function(a){return this.removeControl(a)};Autodesk.Viewing.UI.SettingsPanel.prototype.removeSlider=function(a){return this.removeControl(a)};Autodesk.Viewing.UI.SettingsPanel.prototype.removeCheckbox=function(a){return this.removeControl(a)};
Autodesk.Viewing.UI.SettingsPanel.prototype.removeControl=function(a){var b=this.controls[a];if(void 0===b)return!1;b.tbody.deleteRow(b.sliderRow.rowIndex);delete this.controls[a];this.resizeToContent();return!0};Autodesk.Viewing.UI.SettingsPanel.prototype.getControl=function(a){return void 0!==this.controls[a]?this.controls[a]:null};
Autodesk.Viewing.UI.SettingsPanel.prototype.getContentSize=function(){for(var a=this.heightAdjustment,b=this.panelTabs.length>this.panelTabs[0]?0:null,c=0;c<this.panelTabs.length;c++){var f=this.panelTabs[c];if(this.isTabSelected(f.id)){b=f;break}}b&&(b=document.getElementById(f.id+"-table"),a+=b.clientHeight);return{height:a,width:this.container.clientWidth}};AutodeskNamespace("Autodesk.Viewing.Private");Autodesk.Viewing.Private.AlertBox=function(){};Autodesk.Viewing.Private.AlertBox.instances=[];
Autodesk.Viewing.Private.AlertBox.displayError=function(a,b,c,f,d){var g=document.createElement("div");g.className="alertBox error";a.appendChild(g);f||(f="img-item-not-found");var h=document.createElement("div");h.className="alertBoxImage "+f;g.appendChild(h);f=document.createElement("div");f.className="alertBoxMsg";g.appendChild(f);c||(c=Autodesk.Viewing.i18n.translate("Error Occurred",{defaultValue:"Error Occurred"}));h=document.createElement("div");h.className="alertBoxTitle";h.textContent=c;
f.appendChild(h);c=document.createElement("div");c.className="alertBoxText";c.textContent=b;f.appendChild(c);if(d){b=document.createElement("div");b.className="alertBoxContent";f.appendChild(b);f=document.createElement("ul");f.className="alertBoxContent";for(c=0;c<d.length;c++){var k=d[c];if(k){h=document.createElement("li");f.appendChild(h);k=this.extractList(k);if(k.list.length){var l=this.generateListElement(list);f.appendChild(l)}h.innerHTML=k.msg}}b.appendChild(f)}d=document.createElement("div");
d.className="alertBoxOK";d.textContent=Autodesk.Viewing.i18n.translate("OK",{defaultValue:"OK"});var n={alertBox:g,container:a};d.addEventListener("click",function(b){g.style.visibility="hidden";a.removeChild(g);Autodesk.Viewing.Private.AlertBox.instances.splice(Autodesk.Viewing.Private.AlertBox.instances.indexOf(n),1)});g.appendChild(d);g.style.visibility="visible";Autodesk.Viewing.Private.AlertBox.instances.push(n)};
Autodesk.Viewing.Private.AlertBox.displayErrors=function(a,b,c){var f=document.createElement("div");f.className="alertBox errors";a.appendChild(f);b||(b="img-item-not-found");var d=document.createElement("div");d.className="alertBoxImage "+b;f.appendChild(d);b=document.createElement("div");b.className="alertBoxMsg errors";f.appendChild(b);for(d=0;d<c.length;d++){var g=c[d].header;g||(g=Autodesk.Viewing.i18n.translate("Error",{defaultValue:"Error"}));var h=document.createElement("div");h.className=
"alertBoxTitle errors";h.textContent=g;b.appendChild(h);var k=document.createElement("div");k.className="alertBoxText errors";h=c[d].msg;g=this.extractList(h);if(g.list.length){var l=document.createElement("div"),h=this.generateListElement(g.list);l.appendChild(h);k.textContent=g.msg;k.appendChild(l)}else k.textContent=h;b.appendChild(k);if(c[d].hints){k=document.createElement("ul");k.className="alertBoxContent";for(var l=c[d].hints,n=0;n<l.length;n++)if(g=l[n]){var q=document.createElement("li");
k.appendChild(q);g=this.extractList(g);g.list.length&&(h=this.generateListElement(g.list),k.appendChild(h));q.innerHTML=g.msg}b.appendChild(k)}}c=document.createElement("div");c.className="alertBoxOK";c.textContent=Autodesk.Viewing.i18n.translate("OK",{defaultValue:"OK"});var m={alertBox:f,container:a};c.addEventListener("click",function(b){f.style.visibility="hidden";a.removeChild(f);Autodesk.Viewing.Private.AlertBox.instances.splice(Autodesk.Viewing.Private.AlertBox.instances.indexOf(m),1)});f.appendChild(c);
f.style.visibility="visible";Autodesk.Viewing.Private.AlertBox.instances.push(m)};Autodesk.Viewing.Private.AlertBox.extractList=function(a){var b={msg:a,list:[]};a&&-1!=a.indexOf("<ul>")&&(a=a.split("<ul>"),b.msg=a[0],a=a[1].split("</ul>"),b.list=a[0].split(", "),1===b.list.length&&(b.list=a[0].split(",")));return b};Autodesk.Viewing.Private.AlertBox.generateListElement=function(a){for(var b=document.createElement("ul"),c=0;c<a.length;c++){var f=document.createElement("li");f.textContent=a[c];b.appendChild(f)}return b};
Autodesk.Viewing.Private.AlertBox.dismiss=function(){if(0<Autodesk.Viewing.Private.AlertBox.instances.length){var a=Autodesk.Viewing.Private.AlertBox.instances.pop();a.alertBox.style.visibility="hidden";a.container.removeChild(a.alertBox);return!0}return!1};AutodeskNamespace("Autodesk.Viewing.Private");Autodesk.Viewing.Private.HudMessage=function(){};Autodesk.Viewing.Private.HudMessage.instances=[];
Autodesk.Viewing.Private.HudMessage.displayMessage=function(a,b,c,f,d){if(!(0<Autodesk.Viewing.Private.HudMessage.instances.length)){var g=b.msgTitleKey,h=b.msgTitleDefaultValue?b.msgTitleDefaultValue:g,k=b.messageKey,l=b.messageDefaultValue?b.messageDefaultValue:k;b=b.buttonText;var n=document.createElement("div");n.className="hud";a.appendChild(n);var q=document.createElement("div");q.className="hudTitle";q.textContent=Autodesk.Viewing.i18n.translate(g,{defaultValue:h});q.setAttribute("data-i18n",
g);n.appendChild(q);c&&(g=document.createElement("div"),g.className="hudClose",g.innerHTML="&times;",g.addEventListener("click",function(b){a.removeChild(n);c&&c(b)}),n.appendChild(g));g=document.createElement("div");g.className="hudMessage";g.textContent=Autodesk.Viewing.i18n.translate(k,{defaultValue:l});g.setAttribute("data-i18n",k);n.appendChild(g);f&&(k=document.createElement("div"),k.className="hudButton",k.textContent=Autodesk.Viewing.i18n.translate(b,{defaultValue:b}),k.setAttribute("data-i18n",
b),k.addEventListener("click",f),n.appendChild(k));d&&(f=document.createElement("div"),k=document.createElement("input"),k.className="hudCheckbox",k.type="checkbox",f.appendChild(k),l=document.createElement("label"),l.setAttribute("for","Do not show this message again"),l.setAttribute("data-i18n","Do not show this message again"),l.textContent=Autodesk.Viewing.i18n.translate("Do not show this message again",{defaultValue:"Do not show this message again"}),f.appendChild(l),k.addEventListener("change",
d),n.appendChild(f));Autodesk.Viewing.Private.HudMessage.instances.push({hudMessage:n,container:a})}};Autodesk.Viewing.Private.HudMessage.dismiss=function(){if(0<Autodesk.Viewing.Private.HudMessage.instances.length){var a=Autodesk.Viewing.Private.HudMessage.instances.pop();a.hudMessage.style.visibility="hidden";a.container.removeChild(a.hudMessage);return!0}return!1};"use strict";AutodeskNamespace("Autodesk.Viewing.UI");Autodesk.Viewing.UI.TreeDelegate=function(){};
Autodesk.Viewing.UI.TreeDelegate.prototype.constructor=Autodesk.Viewing.UI.TreeDelegate;Autodesk.Viewing.UI.TreeDelegate.prototype.isTreeNodeGroup=function(a){throw"isTreeNodeGroup is not implemented.";};Autodesk.Viewing.UI.TreeDelegate.prototype.getTreeNodeId=function(a){throw"getTreeNodeId is not implemented.";};Autodesk.Viewing.UI.TreeDelegate.prototype.getTreeNodeLabel=function(a){return a.name};Autodesk.Viewing.UI.TreeDelegate.prototype.shouldCreateTreeNode=function(a){return!0};
Autodesk.Viewing.UI.TreeDelegate.prototype.forEachChild=function(a,b){for(var c=a.children?a.children.length:0,f=0;f<c;++f)b(a.children[f])};Autodesk.Viewing.UI.TreeDelegate.prototype.createTreeNode=function(a,b,c){var f=document.createElement("label");b.appendChild(f);a=this.getTreeNodeLabel(a);c&&c.localize&&(f.setAttribute("data-i18n",a),a=Autodesk.Viewing.i18n.translate(a));f.textContent=a};Autodesk.Viewing.UI.TreeDelegate.prototype.onTreeNodeClick=function(a,b,c){};
Autodesk.Viewing.UI.TreeDelegate.prototype.onTreeNodeIconClick=function(a,b,c){a.delegate().isTreeNodeGroup(b)&&a.setCollapsed(b,!a.isCollapsed(b))};Autodesk.Viewing.UI.TreeDelegate.prototype.onTreeNodeDoubleClick=function(a,b,c){};Autodesk.Viewing.UI.TreeDelegate.prototype.onTreeNodeRightClick=function(a,b,c){};Autodesk.Viewing.UI.TreeDelegate.prototype.getTreeNodeClass=function(a){return""};
Autodesk.Viewing.UI.Tree=function(a,b,c,f){this.myDelegate=a;this.mySelectedNodes=[];this.myOptions=f||{};this.myGroupNodes=[];this.nodeToElement=[];a=this.myRootContainer=this.createHtmlElement_(c,"div","treeview");b=this.rootElem=this.createElement_(b,a,null,0);f&&f.excludeRoot&&b.classList.add("exclude")};Autodesk.Viewing.UI.Tree.prototype.constructor=Autodesk.Viewing.UI.Tree;Autodesk.Viewing.UI.Tree.prototype.show=function(a){this.myRootContainer.style.display=a?"block":"none"};
Autodesk.Viewing.UI.Tree.prototype.getRootContainer=function(){return this.myRootContainer};Autodesk.Viewing.UI.Tree.prototype.getElementForNode=function(a){"number"!==typeof a&&"string"!==typeof a&&(a=this.myDelegate.getTreeNodeId(a));return this.nodeToElement[a]};Autodesk.Viewing.UI.Tree.prototype.delegate=function(){return this.myDelegate};Autodesk.Viewing.UI.Tree.prototype.isCollapsed=function(a){return this.hasClass(a,"collapsed")};
Autodesk.Viewing.UI.Tree.prototype.setCollapsed=function(a,b,c){b?(this.addClass(a,"collapsed",c),this.removeClass(a,"expanded",c)):(this.addClass(a,"expanded",c),this.removeClass(a,"collapsed",c))};
Autodesk.Viewing.UI.Tree.prototype.setAllCollapsed=function(a){var b;a?(a=function(a){return a.classList.contains("expanded")},b=function(a){a.classList.add("collapsed");a.classList.remove("expanded")}):(a=function(a){return a.classList.contains("collapsed")},b=function(a){a.classList.add("expanded");a.classList.remove("collapsed")});for(var c=0;c<this.myGroupNodes.length;++c){var f=this.myGroupNodes[c];a(f)&&b(f)}};
Autodesk.Viewing.UI.Tree.prototype.addToSelection=function(a){for(var b=a.length,c=0;c<b;++c){var f=a[c],d;d=f;-1===this.mySelectedNodes.indexOf(d)?(this.mySelectedNodes.push(d),d=!0):d=!1;d&&this.addClass(f,"selected")}};Autodesk.Viewing.UI.Tree.prototype.removeFromSelection=function(a){for(var b=a.length-1;0<=b;--b){var c=a[b],f;f=this.mySelectedNodes.indexOf(c);-1!==f?(this.mySelectedNodes.splice(f,1),f=!0):f=!1;f&&this.removeClass(c,"selected")}};
Autodesk.Viewing.UI.Tree.prototype.setSelection=function(a){this.removeFromSelection(this.mySelectedNodes);this.addToSelection(a);return this.mySelectedNodes};Autodesk.Viewing.UI.Tree.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedNodes)};Autodesk.Viewing.UI.Tree.prototype.isSelected=function(a){return this.hasClass(a,"selected")};
Autodesk.Viewing.UI.Tree.prototype.scrollTo=function(a){if(a=this.getElementForNode(a)){var b=a.offsetTop;for(a=a.parentNode;a&&a!=this.myRootContainer;)b+=a.offsetTop,a=a.parentNode;this.myRootContainer.parentNode.scrollTop=b}};Autodesk.Viewing.UI.Tree.prototype.addClass=function(a,b,c){if(a=this.getElementForNode(a)){if(c)for(a=a.parentNode,c=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;a&&a!==c;)a.classList.add(b),a=a.parentNode;else a.classList.add(b);return!0}return!1};
Autodesk.Viewing.UI.Tree.prototype.removeClass=function(a,b,c){if(a=this.getElementForNode(a)){if(c)for(a=a.parentNode,c=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;a&&a!==c;)a.classList.remove(b),a=a.parentNode;else a.classList.remove(b);return!0}return!1};Autodesk.Viewing.UI.Tree.prototype.hasClass=function(a,b){return this.getElementForNode(a).classList.contains(b)};
Autodesk.Viewing.UI.Tree.prototype.clear=function(){for(var a=this.myRootContainer;a.hasChildNodes();)a.removeChild(a.lastChild);this.nodeToElement={}};
Autodesk.Viewing.UI.Tree.prototype.createElement_=function(a,b,c,f){function d(b,d,f){b=g.createHtmlElement_(b,d,f);d=g.createHtmlElement_(b,"header");g.createHtmlElement_(d,"icon").addEventListener("click",function(b){g.myDelegate.onTreeNodeIconClick(g,a,b);b.stopPropagation();b.preventDefault()},!1);g.myDelegate.createTreeNode(a,d,c);return b}if(!a||!this.myDelegate.shouldCreateTreeNode(a))return null;var g=this,h;g.myDelegate.isTreeNodeGroup(a)?(h=d(b,"group","expanded"),g.nodeToElement[this.myDelegate.getTreeNodeId(a)]=
h,b=g.myOptions.excludeRoot?1:0,f==b&&(h.style.left="0px"),g.myGroupNodes.push(h),g.myDelegate.forEachChild(a,function(a){g.createElement_(a,h,c,f+1)})):(h=d(b,"leaf","expanded"),g.nodeToElement[this.myDelegate.getTreeNodeId(a)]=h,b=g.myOptions.excludeRoot?1:0,f==b&&(h.style.marginLeft="0px"));isTouchDevice()&&(h.hammer=new Hammer.Manager(h,{recognizers:[[Hammer.Tap,{event:"doubletap",taps:2,interval:400,threshold:6,posThreshold:30}],[Hammer.Tap]],inputClass:Hammer.TouchInput}),h.hammer.on("doubletap",
function(b){g.myDelegate.onTreeNodeDoubleClick(g,a,b);b.srcEvent.stopPropagation();b.preventDefault()}),h.hammer.on("tap",function(b){g.myDelegate.onTreeNodeClick(g,a,b);b.srcEvent.stopPropagation();b.preventDefault()}));h.addEventListener("click",function(b){g.myDelegate.onTreeNodeClick(g,a,b);b.stopPropagation();b.preventDefault()},!1);h.addEventListener("dblclick",function(b){g.myDelegate.onTreeNodeDoubleClick(g,a,b);b.stopPropagation();b.preventDefault()},!1);h.addEventListener("contextmenu",
function(b){g.myDelegate.onTreeNodeRightClick(g,a,b);b.stopPropagation();b.preventDefault()},!1);(b=g.myDelegate.getTreeNodeClass(a))&&h.classList.add(b);return h};Autodesk.Viewing.UI.Tree.prototype.createHtmlElement_=function(a,b,c){b=document.createElement(b);a.appendChild(b);c&&(b.className=c);return b};
Autodesk.Viewing.UI.Tree.prototype.iterate=function(a,b){if(a&&this.myDelegate.shouldCreateTreeNode(a)){var c=this.getElementForNode(a);if(c){b(a,c);var f=this;this.myDelegate.forEachChild(a,function(a){f.iterate(a,b)})}}};AutodeskNamespace("Autodesk.Viewing.Private");Autodesk.Viewing.Private.TreeDelegate=Autodesk.Viewing.UI.TreeDelegate;Autodesk.Viewing.Private.TreeDelegate.prototype=Autodesk.Viewing.UI.TreeDelegate.prototype;Autodesk.Viewing.Private.Tree=Autodesk.Viewing.UI.Tree;
Autodesk.Viewing.Private.Tree.prototype=Autodesk.Viewing.UI.Tree.prototype;"use strict";AutodeskNamespace("Autodesk.Viewing.Private");Autodesk.Viewing.Private.BrowserDelegate=function(){};Autodesk.Viewing.Private.BrowserDelegate.prototype.constructor=Autodesk.Viewing.Private.BrowserDelegate;Autodesk.Viewing.Private.BrowserDelegate.prototype.getNodeId=function(a){throw"getId is not implemented.";};Autodesk.Viewing.Private.BrowserDelegate.prototype.getNodeLabel=function(a){return a.name};
Autodesk.Viewing.Private.BrowserDelegate.prototype.getNodeClass=function(a){return""};Autodesk.Viewing.Private.BrowserDelegate.prototype.hasThumbnail=function(a){return!1};Autodesk.Viewing.Private.BrowserDelegate.prototype.getThumbnail=function(a){return null};Autodesk.Viewing.Private.BrowserDelegate.prototype.onNodeClick=function(a,b,c){};Autodesk.Viewing.Private.BrowserDelegate.prototype.onNodeHover=function(a,b,c){};Autodesk.Viewing.Private.BrowserDelegate.prototype.selectItem=function(a){};
Autodesk.Viewing.Private.BrowserDelegate.prototype.deselectItem=function(a){};Autodesk.Viewing.Private.BrowserDelegate.prototype.hasContent=function(a){return!1};Autodesk.Viewing.Private.BrowserDelegate.prototype.addContent=function(a,b){};
Autodesk.Viewing.Private.Browser=function(a,b,c){this.myDelegate=a;this.mySelectedIds=[];this.myRootContainerId=c+"-browserview";this.idToElement={};this.myRootContainer=document.createElement("div");this.myRootContainer.id=this.myRootContainerId;this.myRootContainer.classList.add("browserview");document.getElementById(c).appendChild(this.myRootContainer);this.createElements(b,this.myRootContainer)};Autodesk.Viewing.Private.Browser.prototype.constructor=Autodesk.Viewing.Private.Browser;
Autodesk.Viewing.Private.Browser.prototype.show=function(a){a?(this.myRootContainer.classList.remove("browserHidden"),this.myRootContainer.classList.add("browserVisible"),this.myRootContainer.style.display="block"):(this.myRootContainer.classList.remove("browserVisible"),this.myRootContainer.classList.add("browserHidden"),this.myRootContainer.style.display="none")};Autodesk.Viewing.Private.Browser.prototype.getRootContainer=function(){return this.myRootContainer};
Autodesk.Viewing.Private.Browser.prototype.delegate=function(){return this.myDelegate};Autodesk.Viewing.Private.Browser.prototype.addToSelection=function(a){for(var b=0,c=a.length;b<c;++b){var f=a[b],d;d=f;-1==this.mySelectedIds.indexOf(d)?(this.mySelectedIds.push(d),d=!0):d=!1;d&&(d=this.idToElement[f],void 0===d?this.myDelegate.selectItem(f):d.classList.add("selected"))}};
Autodesk.Viewing.Private.Browser.prototype.removeFromSelection=function(a){for(var b=a.length-1;0<=b;--b){var c=a[b],f;f=this.mySelectedIds.indexOf(c);-1!=f?(this.mySelectedIds.splice(f,1),f=!0):f=!1;f&&(f=this.idToElement[c],void 0===f?this.myDelegate.deselectItem(c):f.classList.remove("selected"))}};Autodesk.Viewing.Private.Browser.prototype.setSelection=function(a){this.removeFromSelection(this.mySelectedIds);this.addToSelection(a);return this.mySelectedIds};
Autodesk.Viewing.Private.Browser.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedIds)};Autodesk.Viewing.Private.Browser.prototype.createElements=function(a,b){if(a)for(var c=0;c<a.length;c++)this.createElement(a[c],b)};
Autodesk.Viewing.Private.Browser.prototype.createElement=function(a,b){var c=this,f=c.myDelegate.getNodeId(a),d=document.createElement("item");b.appendChild(d);this.idToElement[f]=d;d.onmouseover=function(){c.myDelegate.onNodeHover(c,a)};d.onclick=function(b){c.myRootContainer.querySelector(".flipped").removeClass("flipped");c.myDelegate.onNodeClick(c,a,b)};f=document.createElement("div");f.classList.add("card");d.appendChild(f);var g=document.createElement("div");g.classList.add("browserElement");
f.appendChild(g);var h=c.myDelegate.getNodeLabel(a),k=document.createElement("label");k.innerHTML=h;g.appendChild(k);k.onclick=function(b){c.myDelegate.onNodeClick(c,a,b)};if(h=c.myDelegate.getThumbnail(a))k=document.createElement("img"),k.classList.add("thumb"),k.src=h,g.appendChild(k),k.onclick=function(b){c.myDelegate.onNodeClick(c,a,b)};c.myDelegate.hasContent(a)&&c.myDelegate.addContent(a,f);d.classList.add(c.myDelegate.getNodeClass(a))};AutodeskNamespace("Autodesk.Viewing.Private");
(function(){var a=Autodesk.Viewing.Private;a.WEBGL_HELP_LINK=null;a.ErrorInfoData={1:{img:"img-reload","globalized-msg":"Viewer-UnknownFailure","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message> <hint>Try loading the item again. </hint><hint>Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},2:{img:"img-unsupported","globalized-msg":"Viewer-BadData","default-msg":"<title> Sorry </title><message>The item you are trying to view was not processed completely. </message><hint>Try loading the item again.</hint><hint>Please upload the file again to see if that fixes the issue.</hint>"},
3:{img:"img-reload","globalized-msg":"Viewer-NetworkError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},4:{img:"img-unloack","globalized-msg":"Viewer-AccessDenied","default-msg":"<title> No access </title><message>Sorry. You don\u2019t have the required privileges to access this item.</message><hint> Please contact the author</hint>"},
5:{img:"img-item-not-found","globalized-msg":"Viewer-FileNotFound","default-msg":'<title> Sorry </title><message>We can\u2019t display the item you are looking for. It may not have been processed yet. It may have been moved, deleted, or you may be using a corrupt file or unsupported file format.</message><hint> Try loading the item again.</hint><hint> Please upload the file again to see if that fixes the issue.</hint><hint> <a href="http://help.autodesk.com/view/ADSK360/ENU/?guid=GUID-488804D0-B0B0-4413-8741-4F5EE0FACC4A" target="_blank">See a list of supported formats.</a></hint>'},
6:{img:"img-reload","globalized-msg":"Viewer-ServerError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},7:{img:"img-reload","globalized-msg":"Viewer-UnhandledResponseCode","default-msg":"<title> Network problem </title><message>Sorry. We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},
8:{img:"img-unsupported","globalized-msg":"Viewer-WebGlNotSupported","default-msg":'<title>Sorry</title><message>We can\'t show this item because this browser doesn\'t support WebGL.</message><hint>Try Google Chrome, Mozilla Firefox, or another browser that supports WebGL 3D graphics.</hint><hint>For more information, see the <a href="WEBGL_HELP" target="_blank">A360 browser reqirements.</a></hint>'},9:{img:"img-item-not-found","globalized-msg":"Viewer-NoViewable","default-msg":"<title> No viewable content </title><message>There\u2019s nothing to display for this item. It may not have been processed or it may not have content we can display.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},
10:{img:"img-unsupported","globalized-msg":"Viewer-WebGlDisabled","default-msg":'<title>Sorry</title><message>We can\'t show this item because WebGL is disabled on this device.</message><hint> For more information see the <a href="WEBGL_HELP" target="_blank">A360 Help.</a></hint>'},11:{img:"img-unsupported","globalized-msg":"Viewer-RTCError","default-msg":"<title> Sorry </title><message>We couldn\u2019t connect to the Collaboration server.</message><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"}};
a.currentError=null;a.currentErrors=null;a.ErrorHandler=function(){};a.ErrorHandler.prototype.constructor=a.ErrorHandler;a.ErrorHandler.getErrorCode=function(a){return 403===a||401===a?Autodesk.Viewing.ErrorCodes.NETWORK_ACCESS_DENIED:404===a?Autodesk.Viewing.ErrorCodes.NETWORK_FILE_NOT_FOUND:500<=a?Autodesk.Viewing.ErrorCodes.NETWORK_SERVER_ERROR:Autodesk.Viewing.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE};a.ErrorHandler.reportError=function(b,c,f,d){a.ErrorHandler.currentError=null;a.ErrorHandler.currentErrors=
null;if(c){a.logger&&a.logger.log({category:"error",code:c,message:f},!0);a.ErrorHandler.currentError=[b,c,f,d];var g=a.ErrorInfoData[c];if(g){var h={defaultValue:""};h.defaultValue=g["default-msg"];var k=g.img;f=this.parseErrorString(g["globalized-msg"],h);if(c===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_DISABLED||c===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED)for(c=a.WEBGL_HELP_LINK||"http://www.autodesk.com/a360-browsers",d=0;d<f.hints.length;d++)-1!==f.hints[d].indexOf('href="WEBGL_HELP"')&&
(f.hints[d]=f.hints[d].replace('href="WEBGL_HELP"','href="'+c+'"'))}else k="img-unsupported",h={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"},this.parseArguments(f,h),f=this.parseErrorString(c,h),f.header||(f.header="warning"===d?Autodesk.Viewing.i18n.translate("header-warning"):"");a.AlertBox.displayError(b,f.msg,f.header,k,f.hints)}};a.ErrorHandler.reportErrors=function(b,c){a.ErrorHandler.currentError=null;a.ErrorHandler.currentErrors=null;if(c){a.ErrorHandler.currentErrors=
[b,c];for(var f={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"},d=[],g=0;g<c.length;g++)if(c[g].code){this.parseArguments(c[g].message,f);var h=this.parseErrorString(c[g].code,f);h.header||(h.header="warning"===c[0].type?Autodesk.Viewing.i18n.translate("header-warning",{defaultValue:"Warning"}):"");d.push(h);a.logger&&a.logger.log({category:"error",code:c[g].code,message:c[g].message},!0)}d.length&&a.AlertBox.displayErrors(b,"img-unsupported",d)}};a.ErrorHandler.parseArguments=function(a,
c){if(a)if("string"===typeof a)c.defaultValue=a;else{c.defaultValue=a[0];for(var f=1;f<a.length;f++)c[(f-1).toString()]=a[f]}};a.ErrorHandler.parseErrorString=function(a,c){var f={msg:null,msgList:null,header:null,hints:null};if(!a)return f;var d=Autodesk.Viewing.i18n.translate(a,c);if(!d)return f;-1!=d.indexOf("<title>")&&(d=d.split("<title>")[1].split("</title>"),f.header=d[0],d=d[1]);d&&-1!=d.indexOf("<message>")?(d=d.split("<message>")[1].split("</message>"),f.msg=d[0],d=d[1]):f.msg=d;if(d&&-1!=
d.indexOf("<hint>")){f.hints=[];for(var d=d.split("<hint>"),g=0;g<d.length;g++){var h=d[g].split("</hint")[0];f.hints.push(h)}}return f};a.ErrorHandler.localize=function(){if(0<a.AlertBox.instances.length)if(a.AlertBox.dismiss(),a.ErrorHandler.currentError){var b=a.ErrorHandler.currentError.shift(),c=a.ErrorHandler.currentError;a.ErrorHandler.reportError(b,c[0],c[1],c[2])}else b=a.ErrorHandler.currentErrors.shift(),a.ErrorHandler.reportErrors(b,a.ErrorHandler.currentErrors[0])}})();"use strict";
Autodesk.Viewing.Extension=function(a,b){this.viewer=a;this.options=b};Autodesk.Viewing.Extension.prototype.load=function(){return!0};Autodesk.Viewing.Extension.prototype.unload=function(){return!0};Autodesk.Viewing.Extension.prototype.getState=function(a){};Autodesk.Viewing.Extension.prototype.restoreState=function(a,b){return!0};"use strict";AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.ExtensionManager=function(){var a={};return{registerExtension:function(b,c){return a.hasOwnProperty(b)?!1:(a[b]=c,!0)},getExtension:function(b){return a.hasOwnProperty(b)?a[b]:null},unregisterExtension:function(b){return a.hasOwnProperty(b)?(delete a[b],!0):!1}}};Autodesk.Viewing.theExtensionManager=new Autodesk.Viewing.ExtensionManager;Autodesk.Viewing.ExtensionMixin=function(){};
Autodesk.Viewing.ExtensionMixin.prototype={loadExtension:function(a,b){this.loadedExtensions||(this.loadedExtensions={});var c=!1;if(this.getExtension(a))stderr("Extension already loaded: "+a);else{var f=Autodesk.Viewing.theExtensionManager.getExtension(a);if(f){if(f=new f(this,b),c=f.load())this.loadedExtensions[a]=f,stderr("Extension loaded: "+a)}else stderr("Extension not found: "+a)}return c},getExtension:function(a){return this.loadedExtensions&&a in this.loadedExtensions?this.loadedExtensions[a]:
null},unloadExtension:function(a){var b=!1,c=this.getExtension(a);c?(b=c.unload(),stderr("Extension unloaded: "+a),delete this.loadedExtensions[a]):stderr("Extension not found: "+a);return b},apply:function(a){var b=Autodesk.Viewing.ExtensionMixin.prototype;a.loadExtension=b.loadExtension;a.getExtension=b.getExtension;a.unloadExtension=b.unloadExtension}};AutodeskNamespace("Autodesk.Viewing");Autodesk.Viewing.FileLoader=function(a){this.viewer=a};
Autodesk.Viewing.FileLoader.prototype.constructor=Autodesk.Viewing.FileLoader;Autodesk.Viewing.FileLoader.prototype.loadFile=function(a,b,c,f,d){return!1};Autodesk.Viewing.FileLoader.prototype.getObjectTree=function(a,b){};Autodesk.Viewing.FileLoader.prototype.getProperties=function(a,b,c){};"use strict";AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.FileLoaderManager=function(){var a={};return{registerFileLoader:function(b,c,f){return!a.hasOwnProperty(b)&&f instanceof Autodesk.Viewing.FileLoader?(a[b]={loader:f,extensions:c},!0):!1},getFileLoader:function(b){return a.hasOwnProperty(b)?a[b].loader:null},getFileLoaderForExtension:function(b){for(var c in a)if(a.hasOwnProperty(c))for(var f=a[c],d=0;d<f.extensions.length;d++)if(f.extensions[d]===b)return f.loader;return null},unregisterFileLoader:function(b){return a.hasOwnProperty(b)?
(delete a[b],!0):!1}}};Autodesk.Viewing.theFileLoaderManager=new Autodesk.Viewing.FileLoaderManager;
function init_UnifiedCamera(){"undefined"===typeof Autodesk.Viewing.UnifiedCamera&&(AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.UnifiedCamera=function(a,b){THREE.Camera.call(this);this.fov=45;this.near=.1;this.far=1E5;this.aspect=a/b;this.left=-a/2;this.right=a/2;this.top=b/2;this.bottom=-b/2;this.target=new THREE.Vector3(0,0,-1);this.worldup=new THREE.Vector3(0,1,0);this.orthographicCamera=new THREE.OrthographicCamera(this.left,this.right,this.top,this.bottom,this.near,this.far);this.perspectiveCamera=
new THREE.PerspectiveCamera(this.fov,this.aspect,this.near,this.far);this.zoom=1;this.toPerspective()},Autodesk.Viewing.UnifiedCamera.ORTHO_FOV=360*Math.atan(.5)/Math.PI,Autodesk.Viewing.UnifiedCamera.prototype=Object.create(THREE.Camera.prototype),Autodesk.Viewing.UnifiedCamera.prototype.clone=function(){var a=new Autodesk.Viewing.UnifiedCamera(2*this.right,2*this.top);THREE.Camera.prototype.clone.call(this,a);a.position.copy(this.position);a.up.copy(this.up);this.target&&(a.target=this.target.clone());
this.worldup&&(a.worldup=this.worldup.clone());a.left=this.left;a.right=this.right;a.top=this.top;a.bottom=this.bottom;a.near=this.near;a.far=this.far;a.fov=this.fov;a.aspect=this.aspect;a.zoom=this.zoom;a.isPerspective=this.isPerspective;this.updateProjectionMatrix();return a},Autodesk.Viewing.UnifiedCamera.prototype.__computeFovPosition=function(a){if(1E-4>=Math.abs(this.fov-a))return this.position.clone();var b=this.target.clone().sub(this.position),c=THREE.Math.degToRad(this.fov);a=THREE.Math.degToRad(a);
c=b.length()*Math.tan(.5*c)/Math.tan(.5*a);b=b.normalize().multiplyScalar(-c);return this.target.clone().add(b)},Autodesk.Viewing.UnifiedCamera.prototype.toPerspective=function(){!this.isPerspective&&this.saveFov&&(this.position.copy(this.__computeFovPosition(this.saveFov)),this.fov=this.saveFov);this.perspectiveCamera.aspect=this.aspect;this.perspectiveCamera.near=this.near;this.perspectiveCamera.far=this.far;this.perspectiveCamera.fov=this.fov/this.zoom;this.perspectiveCamera.updateProjectionMatrix();
this.projectionMatrix=this.perspectiveCamera.projectionMatrix;this.isPerspective=!0},Autodesk.Viewing.UnifiedCamera.prototype.toOrthographic=function(){if(this.isPerspective){this.saveFov=this.fov;var a=Autodesk.Viewing.UnifiedCamera.ORTHO_FOV;this.position.copy(this.__computeFovPosition(a));this.fov=a}this.orthoScale=this.target.clone().sub(this.position).length();var a=.5*this.orthoScale,b=a*this.aspect;this.left=this.orthographicCamera.left=-b;this.right=this.orthographicCamera.right=b;this.top=
this.orthographicCamera.top=a;this.bottom=this.orthographicCamera.bottom=-a;this.orthographicCamera.near=this.near;this.orthographicCamera.far=this.far;this.orthographicCamera.updateProjectionMatrix();this.projectionMatrix=this.orthographicCamera.projectionMatrix;this.isPerspective=!1},Autodesk.Viewing.UnifiedCamera.prototype.updateProjectionMatrix=function(){this.isPerspective?this.toPerspective():this.toOrthographic()},Autodesk.Viewing.UnifiedCamera.prototype.setSize=function(a,b){this.aspect=a/
b;this.left=-a/2;this.right=a/2;this.top=b/2;this.bottom=-b/2},Autodesk.Viewing.UnifiedCamera.prototype.setFov=function(a){this.fov=a;this.updateProjectionMatrix()},Autodesk.Viewing.UnifiedCamera.prototype.setLens=function(a,b){void 0===b&&(b=24);var c=2*THREE.Math.radToDeg(Math.atan(b/(2*a)));this.setFov(c);return c},Autodesk.Viewing.UnifiedCamera.prototype.getCameraChangedEvent=function(){return{type:Autodesk.Viewing.CAMERA_CHANGE_EVENT,camera:this}})}AutodeskNamespace("Autodesk.Viewing");
(function(){var a=Autodesk.Viewing,b=Autodesk.Viewing.Private;a.ESCAPE_EVENT="escape";a.PROGRESS_UPDATE_EVENT="progress";a.FULLSCREEN_MODE_EVENT="fullScreenMode";a.NAVIGATION_MODE_CHANGED_EVENT="navmode";a.VIEWER_STATE_RESTORED_EVENT="viewerStateRestored";a.VIEWER_RESIZE_EVENT="viewerResize";a.VIEWER_UNINITIALIZED="viewerUninitialized";a.MODEL_ROOT_LOADED_EVENT="svfLoaded";a.GEOMETRY_LOADED_EVENT="geometryLoaded";a.OBJECT_TREE_CREATED_EVENT="propertyDbLoaded";a.OBJECT_TREE_UNAVAILABLE_EVENT="propertyDbUnavailable";
a.SELECTION_CHANGED_EVENT="selection";a.ISOLATE_EVENT="isolate";a.HIDE_EVENT="hide";a.SHOW_EVENT="show";a.HIGHLIGHT_EVENT="highlight";a.CAMERA_CHANGE_EVENT="cameraChanged";a.EXPLODE_CHANGE_EVENT="explodeChanged";a.CUTPLANES_CHANGE_EVENT="cutplanesChanged";a.TOOL_CHANGE_EVENT="toolChanged";a.RENDER_OPTION_CHANGED_EVENT="renderOptionChanged";a.LAYER_VISIBILITY_CHANGED_EVENT="layerVisibility";a.RESET_EVENT="reset";a.NAVIGATION_MODE={ORBIT:0,PAN:1,DOLLY:2,ROLL:3,FOV:4,TOUCH_PAN_DOLLY:5,TOUCH_ROLL:6,OTHER:7};
a.Viewer3D=function(a,f){this.clientContainer=a;this.container=document.createElement("div");this.container.className="adsk-viewing-viewer";this.container.style.height="100%";this.container.style.width="100%";this.container.style.overflow="hidden";this.container.classList.add(isTouchDevice()?"touch":"notouch");this.clientContainer.appendChild(this.container);this.config=f;this.contextMenu=null;this.contextMenuCallbacks={};this.started=this.__firefoxLMBfix=!1;if("CANVAS"===this.container.nodeName)throw"Viewer must be initialized on a div [temporary]";
this.canvasWrap=document.createElement("div");this.canvasWrap.classList.add("canvas-wrap");this.canvas=document.createElement("canvas");this.canvas.tabIndex=0;this.canvasWrap.appendChild(this.canvas);this.container.appendChild(this.canvasWrap);this.canvas.viewer=this;this.running=!1;this._defaultNavigationTool=this._pushedTool="";this.stats={category:"misc_stats",explode_count:0,get_props_count:0,isolate_count:0};var d=this;window.addEventListener("beforeunload",function(){d.__logStats(!0)});this.prefs=
new b.Preferences(this,"Autodesk.Viewing.Private.GuiViewer3D.SavedSettings.")};a.Viewer3D.prototype.constructor=a.Viewer3D;a.EventDispatcher.prototype.apply(a.Viewer3D.prototype);a.ScreenModeMixin.prototype.apply(a.Viewer3D.prototype);a.ExtensionMixin.prototype.apply(a.Viewer3D.prototype);a.Viewer3D.ScreenMode=a.ScreenMode;a.Viewer3D.kDefaultCanvasConfig={click:{onObject:["selectOnly"],offObject:["deselectAll"]},clickAlt:{onObject:["setCOI"],offObject:["setCOI"]},clickCtrl:{onObject:["selectToggle"],
offObject:["deselectAll"]},clickShift:{onObject:["selectToggle"],offObject:["deselectAll"]}};a.Viewer3D.prototype.start=function(){if(this.started)return 0;var a=this.initialize();if(0===a&&(this.started=!0,this.config&&this.config.hasOwnProperty("extensions")))for(var b=this.config.extensions,d=0;d<b.length;++d)this.loadExtension(b[d],this.config);return a};a.Viewer3D.prototype.registerUniversalHotkeys=function(){var b=this,f,d,g,h=a.theHotkeyManager.KEYCODES;a.theHotkeyManager.pushHotkeys("Autodesk.FitToView",
[{keycodes:[h.f],onPress:function(){b.navigation.setRequestFitToView(!0);return!0}}]);f=function(){b.navigation.setRequestHomeView(!0);return!0};a.theHotkeyManager.pushHotkeys("Autodesk.Home",[{keycodes:[h.h],onPress:f},{keycodes:[h.HOME],onPress:f}]);a.theHotkeyManager.pushHotkeys("Autodesk.Escape",[{keycodes:[h.ESCAPE],onRelease:function(){if(b.objectContextMenu&&b.objectContextMenu.hide())return!0;b.fireEvent({type:a.ESCAPE_EVENT});return!0}}]);f=function(){g=b.getActiveNavigationTool();return b.setActiveNavigationTool("pan")};
d=function(){return b.setActiveNavigationTool(g)};a.theHotkeyManager.pushHotkeys("Autodesk.Pan",[{keycodes:[h.SHIFT],onPress:f,onRelease:d},{keycodes:[h.SPACE],onPress:f,onRelease:d}],{tryUntilSuccess:!0})};a.Viewer3D.prototype.createControls=function(){var b=this.impl;this.navigation=new a.Navigation(b.camera);this.__initAutoCam(b);this.utilities=new a.ViewingUtilities(b,this.autocam,this.navigation);this.clickHandler=new a.DefaultHandler(b,this.navigation,this.utilities);this.toolController=new a.ToolController(b,
this,this.autocam,this.utilities,this.clickHandler);this.toolController.registerTool(new a.GestureHandler(this));this.toolController.registerTool(a.theHotkeyManager);this.toolController.activateTool(a.theHotkeyManager.getName());this.registerUniversalHotkeys();this.toolController.registerTool(new a.OrbitDollyPanTool(b,this));this.toolController.activateTool("gestures");return this.toolController};a.Viewer3D.prototype.initialize=function(){var c=detectWebGL();if(0>=c)return-1===c?a.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED:
a.ErrorCodes.BROWSER_WEBGL_DISABLED;var f=this;this.onResizeCallback=function(a){f.resize()};window.addEventListener("resize",this.onResizeCallback,!1);this.setScreenModeDelegate(this.config?this.config.screenModeDelegate:void 0);this.initContextMenu();this.localize();c=this.getDimensions();this.canvas.width=c.width;this.canvas.height=c.height;isIOSDevice()&&window.devicePixelRatio&&(this.canvas.width/=window.devicePixelRatio,this.canvas.height/=window.devicePixelRatio);this.impl=new b.Viewer3DImpl(this.canvas,
this);this.impl.controls=this.createControls();this.setDefaultNavigationTool("orbit");this.defaultLoader=this.impl.loader;this.model=null;this.impl.controls&&this.impl.controls.setAutocam(this.autocam);c=this.config&&this.config.canvasConfig?this.config.canvasConfig:a.Viewer3D.kDefaultCanvasConfig;this.setCanvasClickBehavior(c);this.loader=document.createElement("div");this.loader.id="loader";this.loader.className="spinner";this.container.appendChild(this.loader);if(!c.disableSpinner)for(c=1;3>=c;c++){var d=
document.createElement("div");d.className="bounce"+c;this.loader.appendChild(d)}this.initSettings();this.viewerState=new b.ViewerState(this);this.config&&this.config.hasOwnProperty("startOnInitialize")&&!this.config.startOnInitialize||this.run();window.NOP_VIEWER=this;return 0};a.Viewer3D.prototype.setUp=function(b){if((this.config=b)&&this.config.hasOwnProperty("extensions")){b=this.config.extensions;for(var f=0;f<b.length;++f)this.loadExtension(b[f],this.config)}this.setCanvasClickBehavior(this.config&&
this.config.canvasConfig?this.config.canvasConfig:a.Viewer3D.kDefaultCanvasConfig)};a.Viewer3D.prototype.tearDown=function(){this.clearSelection();if(this.loadedExtensions)for(var a in this.loadedExtensions)try{this.unloadExtension(a)}catch(f){stderr("Failed to unload extension: "+a);console.log("  error: "+f.message);console.error("  stack:\n"+f.stack);var d=b.logger;d&&d.log({category:"error_unload_extension",extensionId:a})}this.__logStats();this.loader.style.display="block";this.model=null};a.Viewer3D.prototype.run=
function(){this.running||(this.resize(),this.running=!0,this.impl.run())};a.Viewer3D.prototype.localize=function(){a.i18n.localize()};a.Viewer3D.prototype.__logStats=function(a){var f=b.logger;f&&(this.stats.explode_count||this.stats.get_props_count||this.stats.isolate_count)&&(f.log(this.stats,a),this.stats.explode_count=0,this.stats.get_props_count=0,this.stats.isolate_count=0)};a.Viewer3D.prototype.__initAutoCam=function(a){var b=this,d=a.camera;d.pivot||(d.pivot=new THREE.Vector3(0,0,0));d.target||
(d.target=new THREE.Vector3(0,0,0));d.worldup||(d.worldup=d.up.clone());b.autocamCamera=d.clone();b.autocamCamera.target=d.target.clone();b.autocamCamera.pivot=d.pivot.clone();b.autocamCamera.worldup=d.worldup.clone();b.autocam=new Autocam(b.autocamCamera,b.navigation,b.canvas,function(a){b.autocamCamera.isPerspective!==d.isPerspective&&(b.autocamCamera.isPerspective?b.navigation.toPerspective():b.navigation.toOrthographic());b.navigation.setVerticalFov(b.autocamCamera.fov,!1);b.navigation.setView(b.autocamCamera.position,
b.autocamCamera.target);b.navigation.setPivotPoint(b.autocamCamera.pivot);b.navigation.setCameraUpVector(b.autocamCamera.up);a&&b.navigation.setWorldUpVector(b.autocamCamera.worldup);b.impl.syncCamera(a)},function(a){b.utilities?b.utilities.pivotActive(a,!1):b.impl.controls.pivotActive(a,!1)});b.addEventListener("cameraChanged",function(a){b.autocam.sync(a.camera)});b.autocam.sync(d)};a.Viewer3D.prototype.load=function(a,b,d,g){var h=this;return this.loadModel(a,null,b,function(){h.modelstructure&&
h.model.getObjectTree(function(a){h.modelstructure.setModel(a,h.config.defaultModelStructureTitle?h.config.defaultModelStructureTitle:"")},function(a){});d&&d()},g)};a.Viewer3D.prototype.uninitialize=function(c){window.removeEventListener("resize",this.onResizeCallback,!1);this.canvas.parentNode.removeChild(this.canvas);this.viewerState=this.canvas=this.canvas.viewer=null;this.__logStats();(c=b.logger)&&c.log({category:"viewer_destroy"},!0);this.toolController&&(this.toolController.uninitialize(),
this.utilities=this.clickHandler=this.toolController=null);this.navigation&&(this.navigation.uninitialize(),this.navigation=null);this.impl&&(this.impl.uninitialize(),this.impl=null);this.prefs=this.model=this.loader=null;a.theHotkeyManager.popHotkeys("Autodesk.FitToView");a.theHotkeyManager.popHotkeys("Autodesk.Home");a.theHotkeyManager.popHotkeys("Autodesk.Escape");a.theHotkeyManager.popHotkeys("Autodesk.Pan");a.theHotkeyManager.popHotkeys("Autodesk.Orbit");this.onDefaultContextMenu&&this.container.removeEventListener("contextmenu",
this.onDefaultContextMenu,!1);this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container);this.container=null;this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null);this.config=this.clientContainer=null;this.listeners={};this.contextMenuCallbacks=this.contextMenu=null;this.fireEvent(a.VIEWER_UNINITIALIZED)};a.Viewer3D.prototype.finish=function(){this.tearDown();this.uninitialize()};a.Viewer3D.prototype.loadModel=function(b,
f,d,g,h,k){function l(){if(n.model.is2d())a.theHotkeyManager.popHotkeys("Autodesk.Orbit");else{var b;a.theHotkeyManager.pushHotkeys("Autodesk.Orbit",[{keycodes:[a.theHotkeyManager.KEYCODES.ALT],onPress:function(){b=n.getActiveNavigationTool();return n.setActiveNavigationTool("orbit")},onRelease:function(){return n.setActiveNavigationTool(b)}}],{tryUntilSuccess:!0})}}var n=this;this.addEventListener(a.GEOMETRY_LOADED_EVENT,function(b){this.impl.needsRender=!0;n.removeEventListener(a.GEOMETRY_LOADED_EVENT)});
var q=b.toLowerCase().match(/\.([a-z0-9]+$)/),q=q?q[1]:null;this.impl.loader=k&&k.fileLoader?k.fileLoader:a.theFileLoaderManager.getFileLoaderForExtension(q)||this.defaultLoader;this.impl.unloadCurrentModel();return this.impl.loader.loadFile(b,f,d,function(b){n.model=new a.Model(b);n.impl.setModel(n.model);n.loader.style.display="None";n.model.is2d()&&n.activateLayerState("Initial");l();g&&g()},function(a,b){n.loader.style.display="None";h&&h(a,b)})};a.Viewer3D.prototype.getDimensions=function(){if(this.container){var b=
{};this.getScreenMode()===a.ScreenMode.kFullScreen?(b.width=screen.width,b.height=screen.height):b=this.container.getBoundingClientRect();return{width:b.width,height:b.height}}return null};a.Viewer3D.prototype.resize=function(){return this.impl.resize(this.container.clientWidth,this.container.clientHeight)};a.Viewer3D.prototype.getCamera=function(){return this.impl.camera};a.Viewer3D.prototype.getState=function(a){return this.viewerState.getState(a)};a.Viewer3D.prototype.restoreState=function(b,f,
d){(b=this.viewerState.restoreState(b,f,d))&&this.fireEvent({type:a.VIEWER_STATE_RESTORED_EVENT,value:b});return b};a.Viewer3D.prototype.setViewFromArray=function(a,b){this.setActiveNavigationTool("orbit");var d=this.model?this.model.getData().globalOffset:{x:0,y:0,z:0},d={position:new THREE.Vector3(a[0]-d.x,a[1]-d.y,a[2]-d.z),target:new THREE.Vector3(a[3]-d.x,a[4]-d.y,a[5]-d.z),up:new THREE.Vector3(a[6],a[7],a[8]),aspect:a[9],fov:THREE.Math.radToDeg(a[10]),orthoScale:a[11],isPerspective:!a[12]};
this.impl.setViewFromCamera(d)};a.Viewer3D.prototype.setViewFromViewBox=function(a,b){var d=this.model;if(d&&!d.is2d())console.warn("av.Viewer3D.setViewFromViewBox is not applicable to 3D");else{if(b&&b.length){var d=d.getData().metadata.views,g;for(g=0;g<d.length&&d[g].name!=b;g++);g<d.length&&(d=d[g].layer_state)&&this.activateLayerState(d)}this.impl.setViewFromViewBox(this.model,a,b,!1)}};a.Viewer3D.prototype.activateLayerState=function(b){if(b&&b.length){var f=this.model.getData().metadata,d=
f.layer_states;if(d){var g;for(g=0;g<d.length&&d[g].name!=b;g++);if(g<d.length){d=d[g].visible_layers;b={};if(d&&0<d.length)for(g=0;g<d.length;g++)b[d[g]]=1;d=[];g=[];for(var h in f.layers)1===b[f.layers[h].name]?d.push(h):g.push(h);this.impl.setLayerVisible(d,!0);this.impl.setLayerVisible(g,!1);this.fireEvent({type:a.LAYER_VISIBILITY_CHANGED_EVENT})}}}};a.Viewer3D.prototype.getLayerStates=function(){function a(b,c){var d=Object.getOwnPropertyNames(b),f=Object.getOwnPropertyNames(c);if(d.length!==
f.length)return!1;for(f=0;f<d.length;++f){var g=d[f];if(b[g]!==c[g])return!1}return!0}var b=this.model,d=(b=b?b.getData().metadata:null)?b.layers:null,b=b?b.layer_states:null;if(!d||!b)return null;var g,h={},k={},l;for(l in d)if(d.hasOwnProperty(l)){var n=parseInt(l);g=d[l];g="string"===typeof g?g:g.name;h[g]=!0;this.impl.isLayerVisible(n)&&(k[g]=!0)}l=[];for(d=0;d<b.length;++d){var q=b[d],m=q.visible_layers,p={};if(!q.hidden){if(m&&0<m.length)for(n=0;n<m.length;++n)g=m[n],h.hasOwnProperty(g)&&(p[g]=
!0);l.push({name:q.name,description:q.description,active:a(k,p)})}}return 0<l.length?l:null};a.Viewer3D.prototype.setViewFromFile=function(){this.setActiveNavigationTool();this.impl.setViewFromFile(this.model)};a.Viewer3D.prototype.getProperties=function(b,f,d){this.stats.get_props_count++;this.model?this.model.getProperties(b,f,d):d&&d(a.ErrorCodes.BAD_DATA,"Properties failed to load since model does not exist.")};a.Viewer3D.prototype.getObjectTree=function(b,f){this.model?this.model.getObjectTree(b,
f):f&&f(a.ErrorCodes.BAD_DATA,"ObjectTree failed to load since model does not exist.")};a.Viewer3D.prototype.setCanvasClickBehavior=function(a){this.impl.controls.hasOwnProperty("setClickBehavior")&&this.impl.controls.setClickBehavior(a);this.clickHandler&&this.clickHandler.setClickBehavior(a)};a.Viewer3D.prototype.search=function(b,f,d,g){this.searchText=b;this.model?this.model.search(b,f,d,g):d&&d(a.ErrorCodes.BAD_DATA,"Search failed since model does not exist.")};a.Viewer3D.prototype.getHiddenNodes=
function(){return this.impl.visibilityManager.getHiddenNodes()};a.Viewer3D.prototype.getIsolatedNodes=function(){return this.model&&this.model.is2d()?(console.warn("av.Viewer3D.getIsolatedNodes is not yet implemented for 2D"),[]):this.impl.visibilityManager.getIsolatedNodes()};a.Viewer3D.prototype.isolate=function(a){if(this.model&&this.model.is2d())console.warn("av.Viewer3D.isolate is not yet implemented for 2D");else{var b=this;this.model.getObjectTree(function(){b.stats.isolate_count++;b.impl.visibilityManager.isolate(a)})}};
a.Viewer3D.prototype.isolateById=function(a){console.warn("isolateById() is deprecated. Use isolate() instead.");return this.isolate(a)};a.Viewer3D.prototype.setBackgroundColor=function(a,b,d,g,h,k){this.impl.setClearColors(a,b,d,g,h,k)};a.Viewer3D.prototype.toggleSelect=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.toggleSelect is not yet implemented for 2D"):this.impl.selector.toggleSelection(a)};a.Viewer3D.prototype.select=function(a){"number"===typeof a&&(a=[a]);this.impl.selector.setSelectionIds(a)};
a.Viewer3D.prototype.clearSelection=function(){this.impl.selector.clearSelection()};a.Viewer3D.prototype.getSelectionVisibility=function(){return this.impl.selector.getSelectionVisibility()};a.Viewer3D.prototype.getSelectionCount=function(){return this.impl.selector.getSelectionLength()};a.Viewer3D.prototype.setSelectionMode=function(a){this.impl.selector.setSelectionMode(a)};a.Viewer3D.prototype.getSelection=function(){return this.impl.selector.getSelection()};a.Viewer3D.prototype.hide=function(a){if(this.model&&
this.model.is2d())console.warn("av.Viewer3D.hide is not yet implemented for 2D");else{var f=b.logger;f&&f.log({category:"hide"});Array.isArray(a)?this.impl.visibilityManager.hideMultiple(a):this.impl.visibilityManager.hide(a)}};a.Viewer3D.prototype.hideById=function(a){this.hide(a)};a.Viewer3D.prototype.show=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.show is not yet implemented for 2D"):Array.isArray(a)?this.impl.visibilityManager.showMultiple(a):this.impl.visibilityManager.show(a)};
a.Viewer3D.prototype.showAll=function(){this.impl.visibilityManager.isolateNone();this.model.is2d()&&this.setLayerVisible(null,!0)};a.Viewer3D.prototype.toggleVisibility=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.toggleVisibility is not yet implemented for 2D"):this.impl.visibilityManager.toggleVisibility(a)};a.Viewer3D.prototype.areAllVisible=function(){return this.impl.isWholeModelVisible(this.model)};a.Viewer3D.prototype.explode=function(a){this.model&&this.model.is2d()?
console.warn("av.Viewer3D.explode is not applicable to 2D"):(this.stats.explode_count++,this.impl.explode(a))};a.Viewer3D.prototype.getExplodeScale=function(){return this.model&&this.model.is2d()?(console.warn("av.Viewer3D.getExplodeScale is not applicable to 2D"),0):this.impl.getExplodeScale()};a.Viewer3D.prototype.setQualityLevel=function(a,b){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setQualityLevel is not applicable to 2D"):(this.prefs.set("ambientShadows",a),this.prefs.set("antialiasing",
b),this.impl.togglePostProcess(a,b))};a.Viewer3D.prototype.setGhosting=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setGhosting is not applicable to 2D"):(this.prefs.set("ghosting",a),this.impl.toggleGhosting(a))};a.Viewer3D.prototype.setGroundShadow=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setGroundShadow is not applicable to 2D"):(this.prefs.set("groundShadow",a),this.impl.toggleGroundShadow(a))};a.Viewer3D.prototype.setGroundReflection=function(a){this.model&&
this.model.is2d()?console.warn("av.Viewer3D.setGroundReflection is not applicable to 2D"):(this.prefs.set("groundReflection",a),this.impl.toggleGroundReflection(a))};a.Viewer3D.prototype.setProgressiveRendering=function(a){this.prefs.set("progressiveRendering",a);this.impl.toggleProgressive(a)};a.Viewer3D.prototype.setOptimizeNavigation=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setOptimizeNaviation is not applicable to 2D"):(this.prefs.set("optimizeNavigation",a),this.impl.setOptimizeNavigation(a))};
a.Viewer3D.prototype.setActiveNavigationTool=function(c){if(c===this._pushedTool||!c&&!this._pushedTool)return!0;if(this._pushedTool){if(!this.impl.controls.deactivateTool(this._pushedTool))return!1;this._pushedTool=null;var f=b.logger;f&&f.log({category:"tool_changed",name:c})}return c&&c!==this.getDefaultNavigationToolName()||null!==this._pushedTool?this.impl.controls.activateTool(c)?(this._pushedTool=c,this.fireEvent({type:a.NAVIGATION_MODE_CHANGED_EVENT,id:this._pushedTool}),!0):!1:(this.fireEvent({type:a.NAVIGATION_MODE_CHANGED_EVENT,
id:this.getDefaultNavigationToolName()}),!0)};a.Viewer3D.prototype.getActiveNavigationTool=function(){return this._pushedTool?this._pushedTool:this._defaultNavigationTool};a.Viewer3D.prototype.setDefaultNavigationTool=function(a){this._defaultNavigationTool&&this.impl.controls.deactivateTool(this._defaultNavigationTool);this._pushedTool&&this.impl.controls.deactivateTool(this._pushedTool);this.impl.controls.activateTool(a);this._defaultNavigationTool=a;this._pushedTool&&this.impl.controls.activateTool(this._pushedTool)};
a.Viewer3D.prototype.getDefaultNavigationToolName=function(){return this._defaultNavigationTool};a.Viewer3D.prototype.getFOV=function(){return this.navigation.getVerticalFov()};a.Viewer3D.prototype.setFOV=function(a){this.navigation.setVerticalFov(a,!0)};a.Viewer3D.prototype.getFocalLength=function(){return this.navigation.getFocalLength()};a.Viewer3D.prototype.setFocalLength=function(a){this.navigation.setFocalLength(a,!0)};a.Viewer3D.prototype.hideLines=function(b){this.prefs.set("lineRendering",
!b);if(!this.impl.hideLines(b)){var f=function(){d.impl.hideLines(b);d.removeEventListener(a.GEOMETRY_LOADED_EVENT,f)},d=this;this.addEventListener(a.GEOMETRY_LOADED_EVENT,f)}};a.Viewer3D.prototype.applyCamera=function(a,b){this.impl.setViewFromCamera(a,!0);b&&this.fitToView()};a.Viewer3D.prototype.fitToView=function(b){var f=this,d=!0,g=function(){var k=null;if(Array.isArray(b)&&0<b.length){for(var n=new THREE.Box3,q=new THREE.Box3,m=f.model.getData().instanceTree,p=f.impl.modelQueue().getFragmentList(),
t=0;t<b.length;t++)m.enumNodeFragments(b[t],function(a){p.getWorldBounds(a,q);n.union(q)},!0);n.empty()||(k=n)}if(!k||k.empty())k=f.impl.getFitBounds();f.navigation.fitBounds(!1,k);f.removeEventListener(a.OBJECT_TREE_CREATED_EVENT,h);f.removeEventListener(a.GEOMETRY_LOADED_EVENT,g);return d},h=function(){f.model&&f.model.isLoadDone()?g():(d=!1,f.addEventListener(a.GEOMETRY_LOADED_EVENT,g))},k=this.model.getData().propertydb,k=k&&0<k.attrs.length;!this.model.is2d()&&k&&null!==b&&void 0!==b?this.model&&
this.model.isObjectTreeCreated()?h():(d=!1,this.addEventListener(a.OBJECT_TREE_CREATED_EVENT,h)):this.navigation.fitBounds(!1,this.impl.getFitBounds(!0))};a.Viewer3D.prototype.setClickConfig=function(a,b,d){var g=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();return a in g&&(a=g[a],b in a)?(a[b]=d,!0):!1};a.Viewer3D.prototype.getClickConfig=function(a,b){var d=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();
return a in d&&(d=d[a],b in d)?d[b]:null};a.Viewer3D.prototype.setClickToSetCOI=function(a,b){!1!==b&&this.prefs.set("clickToSetCOI",a);var d=this.getClickConfig("click","onObject");a?-1===d.indexOf("setCOI")&&this.setClickConfig("click","onObject",["setCOI"]):0<=d.indexOf("setCOI")&&this.setClickConfig("click","onObject",["selectOnly"])};a.Viewer3D.prototype.initSettings=function(){var a=isIOSDevice()||isAndroidDevice();this.prefs.load({ambientShadows:!0,antialiasing:!a,groundShadow:!0,groundReflection:!1,
progressiveRendering:!0,environmentMap:!1,openPropertiesOnSelect:!1,ghosting:!0,viewCube:!a,lineRendering:!0,lightPreset:b.DefaultLightPreset,backgroundColorPreset:null,reverseMouseZoomDir:!1,reverseHorizontalLookDirection:!1,reverseVerticalLookDirection:!1,alwaysUsePivot:!1,zoomTowardsPivot:!1,orbitPastWorldPoles:!0,leftHandedMouseSetup:!1,clickToSetCOI:a,optimizeNavigation:!1,fusionOrbit:!0,fusionOrbitConstrained:!0,useFirstPersonNav:!1});this.prefs.tag("3d");this.prefs.tag("2d");this.prefs.untag("2d",
"viewCube alwaysUsePivot zoomTowardsPivot reverseHorizontalLookDirection reverseVerticalLookDirection orbitPastWorldPoles clickToSetCOI ghosting optimizeNavigation ambientShadows antialiasing groundShadow groundReflection lineRendering lightPreset".split(" "));this.setQualityLevel(this.prefs.ambientShadows,this.prefs.antialiasing);this.setGroundShadow(this.prefs.groundShadow);this.setGroundReflection(this.prefs.groundReflection);this.setGhosting(this.prefs.ghosting);this.setProgressiveRendering(this.prefs.progressiveRendering);
this.setClickToSetCOI(this.prefs.clickToSetCOI);this.setOptimizeNavigation(this.prefs.optimizeNavigation);this.hideLines(!this.prefs.lineRendering);this.navigation.setUsePivotAlways(this.prefs.alwaysUsePivot);this.navigation.setReverseZoomDirection(this.prefs.reverseMouseZoomDir);this.navigation.setReverseHorizontalLookDirection(this.prefs.reverseHorizontalLookDirection);this.navigation.setReverseVerticalLookDirection(this.prefs.reverseVerticalLookDirection);this.navigation.setZoomTowardsPivot(this.prefs.zoomTowardsPivot);
this.navigation.setOrbitPastWorldPoles(this.prefs.orbitPastWorldPoles);this.navigation.setUseLeftHandedInput(this.prefs.leftHandedMouseSetup);if(a=this.prefs.backgroundColorPreset)try{var f=JSON.parse(a);this.impl.setClearColors(f[0],f[1],f[2],f[3],f[4],f[5])}catch(d){this.prefs.set("backgroundColorPreset",null)}this.impl.setLightPreset(this.prefs.lightPreset)};a.Viewer3D.prototype.setLightPreset=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setLightPreset is not applicable to 2D"):
(this.prefs.set("lightPreset",a),this.impl.setLightPreset(a))};a.Viewer3D.prototype.setUsePivotAlways=function(a){this.prefs.set("alwaysUsePivot",a);this.navigation.setUsePivotAlways(a)};a.Viewer3D.prototype.setReverseZoomDirection=function(a){this.prefs.set("reverseMouseZoomDir",a);this.navigation.setReverseZoomDirection(a)};a.Viewer3D.prototype.setReverseHorizontalLookDirection=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setReverseHorizontalLookDirection is not applicable to 2D"):
(this.prefs.set("reverseHorizontalLookDirection",a),this.navigation.setReverseHorizontalLookDirection(a))};a.Viewer3D.prototype.setReverseVerticalLookDirection=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setReverseVerticalLookDirection is not applicable to 2D"):(this.prefs.set("reverseVerticalLookDirection",a),this.navigation.setReverseVerticalLookDirection(a))};a.Viewer3D.prototype.setZoomTowardsPivot=function(a){this.prefs.set("zoomTowardsPivot",a);this.navigation.setZoomTowardsPivot(a)};
a.Viewer3D.prototype.setOrbitPastWorldPoles=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setOrbitPastWorldPoles is not applicable to 2D"):(this.prefs.set("orbitPastWorldPoles",a),this.navigation.setOrbitPastWorldPoles(a))};a.Viewer3D.prototype.setUseLeftHandedInput=function(a){this.prefs.set("leftHandedMouseSetup",a);this.navigation.setUseLeftHandedInput(a)};a.Viewer3D.prototype.preContextMenuShow=function(a){var b=this.impl.castRay(a.clientX,a.clientY),d;b?(b=b.dbId,this.impl.selector.isSelectedOrParentIsSelected(b)||
(a.ctrlKey||a.metaKey||a.shiftKey?(d=this.impl.selector.getSelection(),d.push(b)):d=[b])):d=[];d&&this.impl.selector.setSelection(d);return!0};a.Viewer3D.prototype.setLayerVisible=function(b,f,d){function g(a,b){var c=[];if(a.isLayer)c.push(a.index);else for(var d=a.children,f=0;f<d.length;++f)c=c.concat(g(d[f]));return c}if(this.model&&!this.model.is2d())console.warn("av.Viewer3D.setLayerVisible is not yet implemented for 3D");else{var h=this.model.getLayersRoot();if(h&&0!==h.childCount){null===
b&&(b=[h]);Array.isArray(b)||(b=[b]);d&&(this.impl.setLayerVisible(g(h),!1),f=!0);d=[];for(h=0;h<b.length;++h)d=d.concat(g(b[h]));this.impl.setLayerVisible(d,f);this.fireEvent({type:a.LAYER_VISIBILITY_CHANGED_EVENT})}}};a.Viewer3D.prototype.isLayerVisible=function(a){return this.model&&!this.model.is2d()?(console.warn("av.Viewer3D.isLayerVisible is not yet implemented for 3D"),!1):!!(a&&a.isLayer&&this.impl.isLayerVisible(a.index))};a.Viewer3D.prototype.anyLayerHidden=function(){function a(d){if(d.isLayer)return!b.impl.isLayerVisible(d.index);
d=d.children;for(var h=0;h<d.length;++h)if(a(d[h]))return!0;return!1}if(this.model&&!this.model.is2d())return console.warn("av.Viewer3D.anyLayerHidden is not yet implemented for 3D"),0;var b=this,d=b.model.getLayersRoot();return!(!d||!a(d))};a.Viewer3D.prototype.setGroundShadowColor=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setGroundShadowColor is not applicable to 2D"):this.impl.setGroundShadowColor(a)};a.Viewer3D.prototype.setGroundShadowAlpha=function(a){this.model&&this.model.is2d()?
console.warn("av.Viewer3D.setGroundShadowAlpha is not applicable to 2D"):this.impl.setGroundShadowAlpha(a)};a.Viewer3D.prototype.setGroundReflectionColor=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setGroundReflectionColor is not applicable to 2D"):this.impl.setGroundReflectionColor(a)};a.Viewer3D.prototype.setGroundReflectionAlpha=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setGroundReflectionAlpha is not applicable to 2D"):this.impl.setGroundReflectionAlpha(a)};
a.Viewer3D.prototype.getCutPlanes=function(){return this.model&&this.model.is2d()?(console.warn("av.Viewer3D.getCutPlanes is not applicable to 2D"),[]):this.impl.getCutPlanes()};a.Viewer3D.prototype.setCutPlanes=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.getCutPlanes is not applicable to 2D"):this.impl.setCutPlanes(a)};a.Viewer3D.prototype.setCutPlanesOutlineColor=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setCutPlanesOutlineColor is not applicable to 2D"):
this.impl.setCutPlanesOutlineColor(a)};a.Viewer3D.prototype.setCutPlanesOutlineThickness=function(a){this.model&&this.model.is2d()?console.warn("av.Viewer3D.setCutPlanesOutlineThickness is not applicable to 2D"):this.impl.setCutPlanesOutlineThickness(a)};a.Viewer3D.prototype.getScreenShot=function(a,b,d){return this.impl.getScreenShot(a,b,d)};a.Viewer3D.prototype.setContextMenu=function(a){this.contextMenu&&this.contextMenu.hide();this.contextMenu=a};a.Viewer3D.prototype.triggerContextMenu=function(a){if(this.config&&
this.config.onTriggerContextMenuCallback)this.config.onTriggerContextMenuCallback(a);return this.contextMenu&&this.preContextMenuShow(a)?(this.contextMenu.show(a),!0):!1};a.Viewer3D.prototype.initContextMenu=function(){function a(c){var d=c.button;"buttons"in c&&(!b.__firefoxLMBfix||c.buttons&1?2===d&&c.buttons&1&&(d=0,b.__firefoxLMBfix=!0):(b.__firefoxLMBfix=!1,d=0));c=b.navigation&&b.navigation.getUseLeftHandedInput()?0:2;return d===c?!0:!1}if(!this.config||(this.config.hasOwnProperty("disableBrowserContextMenu")?
this.config.disableBrowserContextMenu:1))this.onDefaultContextMenu=function(a){a.preventDefault()},this.container.addEventListener("contextmenu",this.onDefaultContextMenu,!1);var b=this,d=this.canvas||this.container;d.addEventListener("mousedown",function(d){a(d)&&(b.startX=d.clientX,b.startY=d.clientY)});d.addEventListener("mouseup",function(d){a(d)&&d.clientX===b.startX&&d.clientY===b.startY&&b.triggerContextMenu(d);return!0},!1)};a.Viewer3D.prototype.preContextMenuShow=function(a){return!0};a.Viewer3D.prototype.registerContextMenuCallback=
function(a,b){this.contextMenuCallbacks[a]=b};a.Viewer3D.prototype.unregisterContextMenuCallback=function(a){return a in this.contextMenuCallbacks?(delete this.contextMenuCallbacks[a],!0):!1};a.Viewer3D.prototype.runContextMenuCallbacks=function(a,b){for(var d in this.contextMenuCallbacks)if(this.contextMenuCallbacks.hasOwnProperty(d))this.contextMenuCallbacks[d](a,b)}})();AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.ErrorCodes={UNKNOWN_FAILURE:1,BAD_DATA:2,NETWORK_FAILURE:3,NETWORK_ACCESS_DENIED:4,NETWORK_FILE_NOT_FOUND:5,NETWORK_SERVER_ERROR:6,NETWORK_UNHANDLED_RESPONSE_CODE:7,BROWSER_WEBGL_NOT_SUPPORTED:8,BAD_DATA_NO_VIEWABLE_CONTENT:9,BROWSER_WEBGL_DISABLED:10,RTC_ERROR:11};AutodeskNamespace("Autodesk.Viewing");Autodesk.Viewing.HTTP_REQUEST_HEADERS={};Autodesk.Viewing.ACM_SESSION_ID;
Autodesk.Viewing.Document=function(a,b){function c(a){if(a){var b=a.children?a.children.length:0;if("geometry"===a.type&&b){for(var f=0,l=0;l<b;l++){var n=a.children[l];n&&"view"===n.type&&(d.myViewGeometry[n.guid]=a,f++)}d.myNumViews[a.guid]=f}else if("application/autodesk-db"==a.mime&&a.urn)d.myPropertyDb=a.urn.substr(0,a.urn.lastIndexOf("/")+1);else if(0<b)for(l=0;l<b;l++)c(a.children[l])}}function f(a,b,c){if(a){var d=a.guid;if(d){c.apply(this,[d,b]);b=a.children?a.children.length:0;for(var n=
0;n<b;n++)f(a.children[n],d,c)}}}this.myPath=b;this.myData=a;this.myViewGeometry={};this.myNumViews={};this.myPropertyDb=null;var d=this;c(a);this.parents={};f(this.myData,null,function(a,b){d.parents[a]=b})};Autodesk.Viewing.Document.prototype.constructor=Autodesk.Viewing.Document;
Autodesk.Viewing.Document.load=function(a,b,c,f){function d(a){var b={},c;for(c in a)-1!=c.indexOf("x-ads-acm")&&(b[c]=a[c]);return b}function g(a){for(var b in a)if("oauth2AccessToken"===b)return a[b];return null}function h(a,b){a.application="autodesk";var d=new XMLHttpRequest;d.open("POST",ACM_SESSION_URL,!0);d.setRequestHeader("Content-Type","application/json");d.setRequestHeader("Authorization","Bearer "+b);d.onload=function(){200===d.status&&(Autodesk.Viewing.ACM_SESSION_ID=JSON.parse(d.responseText).acmsession);
n()};d.onerror=c;d.ontimeout=c;d.send(JSON.stringify(a));delete a.application}function k(a){if(-1===a.indexOf("urn:")){if(0===a.indexOf("http"))return a;0!==a.indexOf("/")&&(a="/"+a);return window.location.protocol+"//"+window.location.host+a}return a}function l(a){var b=[],c=null;if(!a||!a.children)return b;if(a=1===a.children.length?a.children[0]:null)c=a.messages;a=c?c.length:0;for(var d=0;d<a;d++)b.push(c[d]);return b}function n(){var d=k(a);try{Autodesk.Viewing.Private.ViewingService.get(VIEWING_URL,
"bubbles",d,function(a){if(/<[^>]*script/.test(a))c&&c(Autodesk.Viewing.ErrorCodes.BAD_DATA,"Malicious document content detected. Abort loading.");else{a="string"===typeof a?JSON.parse(a):a;a=new Autodesk.Viewing.Document(a,d);var f=Autodesk.Viewing.Document.getSubItemsWithProperties(a.getRootItem(),{type:"folder",role:"viewable"},!0)[0];0<Autodesk.Viewing.Document.getSubItemsWithProperties(f,{type:"geometry"},!0).length?(f=l(a.getRootItem()),b&&b(a,f)):c&&(f=l(a.getRootItem()),c(Autodesk.Viewing.ErrorCodes.BAD_DATA_NO_VIEWABLE_CONTENT,
"No viewable content.",f))}},function(a,b,d){d=l(d);c&&(b="Error: "+a+" ("+b+")",a=Autodesk.Viewing.Private.ErrorHandler.getErrorCode(a),c(a,b,d))},{headers:Autodesk.Viewing.HTTP_REQUEST_HEADERS,withCredentials:!!auth})}catch(f){c&&c(Autodesk.Viewing.ErrorCodes.UNKNOWN_FAILURE,"An exception occurred while loading the document: "+f.toString(),null)}}"function"!==typeof b&&(console.log("Autodesk.Viewing.Document.load called with deprecated (auth) parameter"),"function"===typeof c&&(b=c),"function"===
typeof f&&(c=f));if(f){var q=d(f);f=g(f);Autodesk.Viewing.HTTP_REQUEST_HEADERS=q;h(q,f)}else n()};
Autodesk.Viewing.Document.prototype.getFullPath=function(a){if(!a)return a;var b=a;Autodesk.Viewing.Private.offline?b=decodeURIComponent(Autodesk.Viewing.Private.offlineResourcePrefix)+b.substr(b.indexOf("/")):0===a.indexOf("urn")?b=VIEWING_URL+"/items/"+a:0===a.indexOf("$file$")&&-1!==this.myPath.indexOf("/output/bubble.json")&&(b=this.myPath.replace("/output/bubble.json","")+a.replace("$file$",""));return b};
Autodesk.Viewing.Document.prototype.getThumbnailPath=function(a,b,c){b=b?b:200;c=c?c:200;a=VIEWING_URL+"/thumbnails/"+this.myData.urn+"?guid="+encodeURIComponent(a.guid)+"&width="+b+"&height="+c;Autodesk.Viewing.ACM_SESSION_ID&&(a+="&acmsession="+Autodesk.Viewing.ACM_SESSION_ID);return a};
Autodesk.Viewing.Document.prototype.getViewablePath=function(a){if("geometry"===a.type){var b=[];"3d"===a.role?b=Autodesk.Viewing.Document.getSubItemsWithProperties(a,{mime:"application/autodesk-svf"},!1):"2d"===a.role&&(b=Autodesk.Viewing.Document.getSubItemsWithProperties(a,{mime:"application/autodesk-f2d"},!1),0==b.length&&(b=Autodesk.Viewing.Document.getSubItemsWithProperties(a,{role:"tileRoot"},!0)));if(0<b.length)return this.getFullPath(b[0].urn)}else if("view"===a.type&&(a=this.getViewGeometry(a)))return this.getViewablePath(a);
return""};Autodesk.Viewing.Document.prototype.getPropertyDbPath=function(){return this.myPropertyDb};Autodesk.Viewing.Document.prototype.getRootItem=function(){return this.myData};Autodesk.Viewing.Document.prototype.getPath=function(){return this.myPath};Autodesk.Viewing.Document.prototype.getItemById=function(a){function b(c){if(!c)return null;for(var f in c){var d=c[f];if("guid"===f&&d===a)return c;if(null!==d&&"object"===typeof d&&(d=b(d)))return d}return null}return b(this.myData)};
Autodesk.Viewing.Document.getSubItemsWithProperties=function(a,b,c){var f=[];if(!a)return[];for(var d=a.children?a.children.length:0,g=0;g<d;g++){var h=a.children[g],k;a:{k=b;var l=void 0;for(l in k)if(!(l in h)||k[l]!==h[l]){k=!1;break a}k=!0}k&&f.push(h);c&&f.push.apply(f,Autodesk.Viewing.Document.getSubItemsWithProperties(h,b,c))}return f};Autodesk.Viewing.Document.prototype.getViewGeometry=function(a){return this.myViewGeometry[a.guid]};
Autodesk.Viewing.Document.prototype.getNumViews=function(a){return this.myNumViews[a.guid]||0};Autodesk.Viewing.Document.prototype.getParentId=function(a){return this.parents[a]};Autodesk.Viewing.Document.prototype.getMessages=function(a,b){var c=[];if(!a)return c;var f=null;b&&(f=this.getRootItem().guid);for(var d=a,g=this.parents[d];d&&(!b||g!==f);){if((d=this.getItemById(d))&&d.messages)for(var h=0;h<d.messages.length;h++)c.push(d.messages[h]);d=g;g=this.parents[d]}return c};AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.ModelUnits={METER:"m",CENTIMETER:"cm",MILLIMETER:"mm",FOOT:"ft",INCH:"in"};Autodesk.Viewing.Model=function(a){this.myData=a;this.myLoader=this.propWorker=this.sharedPath=null};Autodesk.Viewing.EventDispatcher.prototype.apply(Autodesk.Viewing.Model.prototype);Autodesk.Viewing.Model.prototype.constructor=Autodesk.Viewing.Model;Autodesk.Viewing.Model.prototype.setData=function(a){this.myData=a};Autodesk.Viewing.Model.prototype.getData=function(){return this.myData};
Autodesk.Viewing.Model.prototype.setLoader=function(a){this.myLoader=a};Autodesk.Viewing.Model.prototype.getRoot=function(){return this.is2d()?(console.warn("Autodesk.Viewing.Model.getRoot is not yet implemented for 2D"),null):this.myData&&this.myData.instanceTree?this.myData.instanceTree.root:null};
Autodesk.Viewing.Model.prototype.getRootId=function(){return this.is2d()?(console.warn("Autodesk.Viewing.Model.getRootId is not yet implemented for 2D"),0):this.myData&&this.myData.instanceTree?this.myData.instanceTree.getRootId():0};Autodesk.Viewing.Model.prototype.getBoundingBox=function(){return this.myData?this.myData.bbox:null};
Autodesk.Viewing.Model.prototype.getUnitScale=function(){switch(this.is2d()?this.getMetadata("page_dimensions","model_units",null):this.getMetadata("distance unit","value",null)){case "meter":case "m":return 1;case "foot":case "ft":return.3048;case "inch":case "in":return.0254;case "centimeter":case "cm":return.01;case "millimeter":case "mm":return.001;default:return 1}};
Autodesk.Viewing.Model.prototype.getUnitString=function(){switch(this.is2d()?this.getMetadata("page_dimensions","model_units",null):this.getMetadata("distance unit","value",null)){case "meter":case "m":return Autodesk.Viewing.ModelUnits.METER;case "foot":case "ft":return Autodesk.Viewing.ModelUnits.FOOT;case "inch":case "in":return Autodesk.Viewing.ModelUnits.INCH;case "centimeter":case "cm":return Autodesk.Viewing.ModelUnits.CENTIMETER;case "millimeter":case "mm":return Autodesk.Viewing.ModelUnits.MILLIMETER;
default:return null}};Autodesk.Viewing.Model.prototype.getMetadata=function(a,b,c){if(this.myData){var f=this.myData.metadata;if(f&&(a=f[a],void 0!==a))if(b){if(b=a[b],void 0!==b)return b}else return a}return c};
Autodesk.Viewing.Model.prototype.getDefaultCamera=function(){var a=this.myData;if(!a)return null;var b=null,c=a.cameras?a.cameras.length:0;if(0<c){var f=this.getMetadata("default camera","index",null);if(null!==f&&a.cameras[f])b=a.cameras[f];else{for(f=0;f<c;f++){var d=a.cameras[f];if(d.isPerspective){b=d;break}}b||(b=a.cameras[0])}}return b};Autodesk.Viewing.Model.prototype.getUpVector=function(){return this.getMetadata("world up vector","XYZ",null)};
Autodesk.Viewing.Model.prototype.geomPolyCount=function(){return this.myData?this.myData.geomPolyCount:null};Autodesk.Viewing.Model.prototype.instancePolyCount=function(){return this.myData?this.myData.instancePolyCount:null};Autodesk.Viewing.Model.prototype.getLayersRoot=function(){return this.is2d()?this.myData?this.myData.layersRoot:null:(console.warn("Autodesk.Viewing.Model.getLayersRoot is not yet implemented for 3D"),null)};
Autodesk.Viewing.Model.prototype.is2d=function(){return!(!this.myData||!this.myData.is2d)};Autodesk.Viewing.Model.prototype.isLoadDone=function(){return!(!this.myData||!this.myData.loadDone)};Autodesk.Viewing.Model.prototype.isObjectTreeCreated=function(){return!!this.myData.instanceTree};Autodesk.Viewing.Model.prototype.getProperties=function(a,b,c){this.myData&&this.myLoader&&this.myLoader.getProperties(a,b,c)};
Autodesk.Viewing.Model.prototype.getExternalIdMapping=function(a,b){this.myData&&this.myLoader&&this.myLoader.getExternalIdMapping(a,b)};Autodesk.Viewing.Model.prototype.getObjectTree=function(a,b){this.myData&&this.myLoader&&this.myLoader.getObjectTree(a,b)};Autodesk.Viewing.Model.prototype.search=function(a,b,c,f){var d=this;this.isLoadDone()?this.myLoader.searchProperties(a,f,b,c):this.getObjectTree(function(){d.myLoader.searchProperties(a,f,b,c)})};
Autodesk.Viewing.Model.prototype.pageToModel=function(a){var b=this.myData.metadata.page_dimensions,c=a.x/b.page_width*b.logical_width+b.logical_offset_x,f=a.y/b.page_height*b.logical_height+b.logical_offset_y;if(b.source_to_logical_xform){if(!b.inverse_xform){for(var d=new THREE.Matrix4,g=0;16>g;g++)d.elements[g]=b.source_to_logical_xform[g];b.inverse_xform=d.getInverse(d)}b=b.inverse_xform.elements;a.x=b[0]*c+b[4]*f+0*b[8]+b[12];a.y=b[1]*c+b[5]*f+0*b[9]+b[13]}else a.x=c,a.y=f};AutodeskNamespace("Autodesk.Viewing");
Autodesk.Viewing.Navigation=function(a){this.__options={dollyToPivot:!1,orbitPastPoles:!0,reverseDolly:!1,reverseHorizontalLook:!1,reverseVerticalLook:!1,useLeftHandedInput:!1,usePivotAlways:!1,lockNavigation:!1};this.__transitionActive=this.__homeViewRequested=this.__fitToViewRequested=this.__pivotIsSetFlag=!1;this.__destinationView=null;this.__isTouchDevice=this.__is2D=!1;this.__kEpsilon=1E-6;var b=null,c={left:0,top:0,width:1,height:1};this.uninitialize=function(){this.setCamera(null)};this.setCamera=
function(a){a!==b&&(b=a)&&(a.hasOwnProperty("target")||(a.target=new THREE.Vector3(0,0,0)),a.hasOwnProperty("pivot")||(a.pivot=new THREE.Vector3(0,0,0)),a.worldup=a.up.clone(),a.dirty=!0)};this.getCamera=function(){return b};this.setScreenViewport=function(a){c=a};this.getScreenViewport=function(){return c};this.__setUp=function(a){return a&&b&&0!==a.clone().normalize().sub(b.worldup).lengthSq()?(b.worldup.copy(a).normalize(),b.dirty=!0):!1};this.__getUp=function(){return b?b.worldup:new THREE.Vector3(0,
1,0)};this.setView=function(a,c){b&&a&&c&&!this.__options.lockNavigation&&(b.position.copy(a),b.target.copy(c),b.dirty=!0)};this.orientCameraUp=function(){b&&!this.__options.lockNavigation&&(b.up.copy(this.getAlignedUpVector()),b.dirty=!0)};this.getPivotPoint=function(){return b?b.pivot.clone():new THREE.Vector3(0,0,0)};this.setPivotPoint=function(a){b&&a&&!this.__options.lockNavigation&&(b.pivot.copy(a),b.dirty=!0)};this.getPosition=function(){return b?b.position.clone():new THREE.Vector3(0,0,1)};
this.setPosition=function(a){b&&a&&!this.__options.lockNavigation&&(b.position.copy(a),b.dirty=!0)};this.setTarget=function(a){b&&a&&!this.__options.lockNavigation&&(b.target.copy(a),b.dirty=!0)};this.getTarget=function(){return b?b.target.clone():new THREE.Vector3(0,0,0)};this.getEyeVector=function(){return b?b.target.clone().sub(b.position):new THREE.Vector3(0,0,-1)};this.getFovMin=function(){return 6.88};this.getFovMax=function(){return 100};this.isPointVisible=function(a){return(new THREE.Frustum).setFromMatrix(b.projectionMatrix.clone().multiply(b.matrixWorldInverse)).containsPoint(a)};
this.setVerticalFov=function(a,c){if(!b||b.isPerspective)if(6.88>a?a=6.88:100<a&&(a=100),b&&!this.__options.lockNavigation&&!(1E-6>=Math.abs(b.fov-a))){if(c){var g=this.__pivotIsSetFlag&&this.isPointVisible(this.getPivotPoint()),h=this.getPosition(),k=this.getEyeVector(),l=THREE.Math.degToRad(b.fov),n=THREE.Math.degToRad(a),q=g?this.getPivotPlaneDistance():k.length(),l=q*Math.tan(.5*l)/Math.tan(.5*n),k=k.normalize().multiplyScalar(q-l);this.setPosition(h.add(k));g&&this.setTarget(this.getTarget().add(k))}b.setFov(a);
b.dirty=!0}};this.computeFit=function(a,b,c,h){if(!h||h.empty())return{position:a,target:b};var k=h.center();h=h.size();h=.5*Math.sqrt(h.x*h.x+h.y*h.y+h.z*h.z);0===h&&(h=1);if(!this.getIs2D()){var l=Math.max(1,.9+c/100*.5);h*=l}a=a.clone().sub(b).normalize();c=h/Math.tan(THREE.Math.degToRad(.5*c));a.multiplyScalar(c);return{position:k.clone().add(a),target:k}};this.computeOrthogonalUp=function(a,b){var c=this.__getUp(),h=b.clone().sub(a);if(0===h.lengthSq())return h.copy(c);var k=h.clone().cross(c);
0===k.lengthSq()&&(c.z>c.y?h.y-=1E-4:h.z-=1E-4,k.crossVectors(h,c));return k.cross(h).normalize()};this.fitBounds=function(a,c,g){var h=this.getTarget(),k=this.getPosition();if(this.__options.lockNavigation||!c||c.empty())return{position:k,target:h};var l=this.getVerticalFov();c=this.computeFit(k,h,l,c);g=g?this.computeOrthogonalUp(k,h):b.up;a?(b.up.copy(g),this.setView(c.position,c.target)):this.setRequestTransitionWithUp(!0,c.position,c.target,l,g);this.setPivotPoint(c.target);this.setPivotSetFlag(!0);
return c};this.updateCamera=function(){b&&(b.updateProjectionMatrix(),this.orient(b,b.target,b.position,b.up),b.dirty=!1)};this.setCamera(a)};Autodesk.Viewing.Navigation.prototype.constructor=Autodesk.Viewing.Navigation;Autodesk.Viewing.Navigation.prototype.setIs2D=function(a){this.__is2D=!!a};Autodesk.Viewing.Navigation.prototype.getIs2D=function(){return this.__is2D};Autodesk.Viewing.Navigation.prototype.setIsTouchDevice=function(a){this.__isTouchDevice=!!a};
Autodesk.Viewing.Navigation.prototype.getIsTouchDevice=function(){return this.__isTouchDevice};
Autodesk.Viewing.Navigation.prototype.orient=function(){var a,b,c,f;return function(d,g,h,k){a||(a=new THREE.Matrix4,b=new THREE.Vector3,c=new THREE.Vector3,f=new THREE.Vector3);var l=a.elements;f.subVectors(h,g).normalize();0===f.lengthSq()&&(f.z=1);b.crossVectors(k,f).normalize();0===b.lengthSq()&&(k.z>k.y?f.y-=1E-4:f.z+=1E-4,b.crossVectors(k,f).normalize());c.crossVectors(f,b);l[0]=b.x;l[4]=c.x;l[8]=f.x;l[1]=b.y;l[5]=c.y;l[9]=f.y;l[2]=b.z;l[6]=c.z;l[10]=f.z;d.setRotationFromMatrix(a)}}();
Autodesk.Viewing.Navigation.prototype.fov2fl=function(a){a=THREE.Math.degToRad(a);0>=a&&(a=1E-4);return Math.round(12/Math.tan(.5*a))};Autodesk.Viewing.Navigation.prototype.fl2fov=function(a){0>=a&&(a=1E-4);a=2*Math.atan(12/a);return THREE.Math.radToDeg(a)};Autodesk.Viewing.Navigation.prototype.setCameraUpVector=function(a){if(!this.__options.lockNavigation){var b=this.getCamera();b.up.copy(a);b.dirty=!0}};
Autodesk.Viewing.Navigation.prototype.getCameraUpVector=function(){var a=this.getCameraRightVector(!1),b=this.getEyeVector();return a.cross(b).normalize()};Autodesk.Viewing.Navigation.prototype.getAlignedUpVector=function(){var a=this.getCameraRightVector(!0),b=this.getEyeVector();return a.cross(b).normalize()};
Autodesk.Viewing.Navigation.prototype.getCameraRightVector=function(a){var b=new THREE.Vector3;a=a?this.getWorldUpVector():this.getCamera().up;var c=this.getEyeVector();b.crossVectors(c,a);0===b.lengthSq()&&(a.z>a.y?c.y-=1E-4:c.z+=1E-4,b.crossVectors(c,a));return b.normalize()};Autodesk.Viewing.Navigation.prototype.setWorldUpVector=function(a,b){this.__options.lockNavigation||(this.__setUp(a),b&&this.orientCameraUp())};Autodesk.Viewing.Navigation.prototype.getWorldUpVector=function(){return this.__getUp().clone()};
Autodesk.Viewing.Navigation.prototype.getWorldRightVector=function(){var a=new THREE.Vector3;a.copy(this.__getUp());Math.abs(a.z)<=Math.abs(a.y)?a.set(a.y,-a.x,0):0<=a.z?a.set(a.z,0,-a.x):a.set(-a.z,0,a.x);return a.normalize()};Autodesk.Viewing.Navigation.prototype.getVerticalFov=function(){return this.getCamera().fov};Autodesk.Viewing.Navigation.prototype.getHorizontalFov=function(){var a=this.getScreenViewport();return this.getCamera().fov*(a.width/a.height)};
Autodesk.Viewing.Navigation.prototype.getFocalLength=function(){return this.fov2fl(this.getVerticalFov())};Autodesk.Viewing.Navigation.prototype.setFocalLength=function(a,b){this.setVerticalFov(this.fl2fov(a),b)};Autodesk.Viewing.Navigation.prototype.setReverseZoomDirection=function(a){this.__options.reverseDolly=!!a};
Autodesk.Viewing.Navigation.prototype.setReverseHorizontalLookDirection=function(a){this.getIs2D()?console.warn("Autodesk.Viewing.Navigation.setReverseHorizontalLookDirection is not applicable to 2D"):this.__options.reverseHorizontalLookDirection=!!a};Autodesk.Viewing.Navigation.prototype.setReverseVerticalLookDirection=function(a){this.getIs2D()?console.warn("Autodesk.Viewing.Navigation.setReverseVerticalLookDirection is not applicable to 2D"):this.__options.reverseVerticalLookDirection=!!a};
Autodesk.Viewing.Navigation.prototype.getReverseZoomDirection=function(){return this.__options.reverseDolly};Autodesk.Viewing.Navigation.prototype.getReverseHorizontalLookDirection=function(){return this.getIs2D()?(console.warn("Autodesk.Viewing.Navigation.getReverseHorizontalLookDirection is not applicable to 2D"),!1):this.__options.reverseHorizontalLookDirection};
Autodesk.Viewing.Navigation.prototype.getReverseVerticalLookDirection=function(){return this.getIs2D()?(console.warn("Autodesk.Viewing.Navigation.getReverseVerticalLookDirection is not applicable to 2D"),!1):this.__options.reverseVerticalLookDirection};Autodesk.Viewing.Navigation.prototype.setZoomTowardsPivot=function(a){this.__options.dollyToPivot=!!a};Autodesk.Viewing.Navigation.prototype.getZoomTowardsPivot=function(){return this.__options.dollyToPivot};
Autodesk.Viewing.Navigation.prototype.setOrbitPastWorldPoles=function(a){this.getIs2D()?console.warn("Autodesk.Viewing.Navigation.setOrbitPastWorldPoles is not applicable to 2D"):this.__options.orbitPastPoles=!!a};Autodesk.Viewing.Navigation.prototype.getOrbitPastWorldPoles=function(){return this.getIs2D()?(console.warn("Autodesk.Viewing.Navigation.orbitPastWorldPoles is not applicable to 2D"),!1):this.__options.orbitPastPoles};
Autodesk.Viewing.Navigation.prototype.setUsePivotAlways=function(a){this.__options.usePivotAlways=!!a};Autodesk.Viewing.Navigation.prototype.getUsePivotAlways=function(){return this.__options.usePivotAlways};Autodesk.Viewing.Navigation.prototype.setUseLeftHandedInput=function(a){this.__options.useLeftHandedInput=!!a};Autodesk.Viewing.Navigation.prototype.getUseLeftHandedInput=function(){return this.__options.useLeftHandedInput};
Autodesk.Viewing.Navigation.prototype.setIsLocked=function(a){this.__options.lockNavigation=!!a};Autodesk.Viewing.Navigation.prototype.getIsLocked=function(){return this.__options.lockNavigation};Autodesk.Viewing.Navigation.prototype.setPivotSetFlag=function(a){this.__options.lockNavigation||(this.__pivotIsSetFlag=!!a)};Autodesk.Viewing.Navigation.prototype.getPivotSetFlag=function(){return this.__pivotIsSetFlag};
Autodesk.Viewing.Navigation.prototype.setRequestFitToView=function(a){this.__options.lockNavigation||(this.__fitToViewRequested=!!a)};Autodesk.Viewing.Navigation.prototype.getRequestFitToView=function(){return this.__fitToViewRequested};Autodesk.Viewing.Navigation.prototype.setRequestHomeView=function(a){this.__options.lockNavigation||(this.__homeViewRequested=!!a)};Autodesk.Viewing.Navigation.prototype.getRequestHomeView=function(){return this.__homeViewRequested};
Autodesk.Viewing.Navigation.prototype.setRequestTransition=function(a,b,c,f,d){this.__destinationView=a?{position:b.clone(),coi:c.clone(),fov:f,up:this.getCamera().up.clone(),worldUp:this.getWorldUpVector(),reorient:d}:null};Autodesk.Viewing.Navigation.prototype.setRequestTransitionWithUp=function(a,b,c,f,d,g){this.__destinationView=a?{position:b.clone(),coi:c.clone(),fov:f,up:d.clone(),worldUp:g?g:this.getWorldUpVector(),reorient:!1}:null};
Autodesk.Viewing.Navigation.prototype.getRequestTransition=function(){return this.__destinationView};Autodesk.Viewing.Navigation.prototype.setTransitionActive=function(a){this.__transitionActive=!!a};Autodesk.Viewing.Navigation.prototype.getTransitionActive=function(){return this.__transitionActive};
Autodesk.Viewing.Navigation.prototype.getWorldSize=function(a){var b=this.getScreenViewport(),b=b.width/b.height;a=2*a*Math.tan(THREE.Math.degToRad(.5*this.getCamera().fov));return new THREE.Vector2(a*b,a)};
Autodesk.Viewing.Navigation.prototype.getWorldPoint=function(a,b){a=2*a-1;b=2*(1-b)-1;var c=this.getCamera(),f;c.isPerspective&&(f=new THREE.Vector3(a,b,1),f=f.unproject(c));var d=this.getEyeVector(),g=this.getPosition();if(!c.isPerspective||isNaN(f.x)){var h=this.getWorldSize(d.length());f=this.getCameraRightVector(!1).multiplyScalar(.5*a*h.x);h=this.getCameraUpVector().multiplyScalar(.5*b*h.y);f=d.clone().add(f).add(h).normalize()}else f=f.sub(g).normalize();h=this.getPivotPoint();this.__pivotIsSetFlag&&
(this.getIs2D()||c.isPerspective&&this.isPointVisible(h))?(c=f.dot(d),d=0!==c?Math.abs(h.sub(g).dot(d))/c:h.sub(g).length()):d=c.isPerspective?.5*(c.near+c.far):c.orthoScale;return f.multiplyScalar(d).add(g)};Autodesk.Viewing.Navigation.prototype.getPivotPlaneDistance=function(){var a=this.getPivotPoint(),b=this.getEyeVector(),c=this.getPosition();return a.sub(c).dot(b.normalize())};
Autodesk.Viewing.Navigation.prototype.panRelative=function(a,b,c){c=this.getWorldSize(c);a*=c.x;b*=c.y;a=this.getCameraRightVector(!1).multiplyScalar(a);b=this.getCameraUpVector().multiplyScalar(b);b=a.add(b);this.setView(this.getPosition().add(b),this.getTarget().add(b))};
Autodesk.Viewing.Navigation.prototype.dollyFromPoint=function(a,b){if(!(Math.abs(a)<=this.__kEpsilon)){var c=this.getPosition(),c=b.clone().sub(c),f=c.length(),d=f+a,g=10*this.__kEpsilon;d<g&&(d=g);f=d/f;Math.abs(f-1)>this.__kEpsilon&&(c.multiplyScalar(f),c.set(-c.x,-c.y,-c.z),c=c.add(b),d=this.getEyeVector(),this.getCamera().isPerspective||d.multiplyScalar(f),this.setView(c,d.add(c)))}};
Autodesk.Viewing.Navigation.prototype.toPerspective=function(){if(this.getIs2D())console.warn("Autodesk.Viewing.Navigation.toPerspective is not applicable to 2D");else{var a=this.getCamera();this.__options.lockNavigation||a.isPerspective||(a.toPerspective(),a.dirty=!0)}};Autodesk.Viewing.Navigation.prototype.toOrthographic=function(){var a=this.getCamera();!this.__options.lockNavigation&&a.isPerspective&&(a.toOrthographic(),a.dirty=!0)};
Autodesk.Viewing.Navigation.snapToAxis=function(a){var b=new THREE.Vector3(Math.abs(a.x),Math.abs(a.y),Math.abs(a.z));b.x>b.y&&b.x>b.z?a.set(0<a.x?1:-1,0,0):b.y>b.x&&b.y>b.z?a.set(0,0<a.y?1:-1,0):a.set(0,0,0<a.z?1:-1);return a};"use strict";AutodeskNamespace("Autodesk.Viewing");Autodesk.Viewing.ViewingApplication=function(a,b){this.appContainerId=a;this.container=document.getElementById(a);this.options=b;this.myRegisteredViewers={};this.selectedItem=this.urn=this.myCurrentViewer=this.myDocument=null};
Autodesk.Viewing.ViewingApplication.prototype.k3D="3D";Autodesk.Viewing.ViewingApplication.prototype.k2D="2D";Autodesk.Viewing.ViewingApplication.prototype.registerViewer=function(a,b,c){c=c||{};this.options&&this.options.hasOwnProperty("disableBrowserContextMenu")&&!c.hasOwnProperty("disableBrowserContextMenu")&&(c.disableBrowserContextMenu=this.options.disableBrowserContextMenu);this.myRegisteredViewers[a]={};this.myRegisteredViewers[a].class=b;this.myRegisteredViewers[a].config=c};
Autodesk.Viewing.ViewingApplication.prototype.getViewerClass=function(a){return this.myRegisteredViewers.hasOwnProperty(a)?this.myRegisteredViewers[a].class:null};Autodesk.Viewing.ViewingApplication.prototype.getViewerContainer=function(){return document.getElementById(this.appContainerId)};
Autodesk.Viewing.ViewingApplication.prototype.getViewer=function(a,b,c){if(a in this.myRegisteredViewers){var f={},d=this.myRegisteredViewers[a].config,g;for(g in d)d.hasOwnProperty(g)&&(f[g]=d[g]);for(g in b)if(b.hasOwnProperty(g)){var d=b[g],h=Array.isArray(d),k=f[g],l=Array.isArray(k);h&&l?(d?h||(d=[d]):d=[],k?l||(k=[k]):k=[],f[g]=k.concat(d)):f[g]=d}a=this.myRegisteredViewers[a].class;if(this.myCurrentViewer&&this.myCurrentViewer.__proto__.constructor===a)return this.myCurrentViewer.tearDown(),
this.myCurrentViewer.setUp(f),this.myCurrentViewer;this.setCurrentViewer(null);for(b=this.getViewerContainer();b.hasChildNodes();)b.removeChild(b.lastChild);f=new a(b,f);a=f.start();if(0===a)return this.setCurrentViewer(f),f;c&&c(a,"Viewer failed to initialize.")}return null};Autodesk.Viewing.ViewingApplication.prototype.setCurrentViewer=function(a){this.myCurrentViewer&&this.myCurrentViewer.finish();this.myCurrentViewer=a};Autodesk.Viewing.ViewingApplication.prototype.getCurrentViewer=function(){return this.myCurrentViewer};
Autodesk.Viewing.ViewingApplication.prototype.loadDocument=function(a,b,c,f){var d=this;Autodesk.Viewing.Private.logger&&Autodesk.Viewing.Private.logger.log({category:"load_document",urn:0==a.indexOf("urn:")?a.substring(4):a});Autodesk.Viewing.Document.load(a,function(a,c){d.myDocument=a;d.onDocumentLoaded(a,c);b&&b(a,c)},function(a,b,f){d.onDocumentFailedToLoad(b,a,f);c&&c(a,b,f)},f)};Autodesk.Viewing.ViewingApplication.prototype.onDocumentLoaded=function(a,b){console.log(a,b)};
Autodesk.Viewing.ViewingApplication.prototype.onDocumentFailedToLoad=function(a,b,c){console.log(a,b,c)};
Autodesk.Viewing.ViewingApplication.prototype.selectItem=function(a,b,c){var f=this.myDocument.getViewablePath(a);if(f){var d,g,h,k;if("geometry"===a.type&&"3d"===a.role)d=this.k3D,h=a.name,k=a;else if("view"===a.type&&"3d"===a.role){if(g=a,d=this.k3D,k=this.myDocument.getViewGeometry(a))h=k.name}else"geometry"===a.type&&"2d"===a.role?(d=0<Autodesk.Viewing.Document.getSubItemsWithProperties(a,{mime:"application/autodesk-f2d"},!1).length?this.k3D:this.k2D,h=a.name,k=a):"view"===a.type&&"2d"===a.role&&
(g=a,d=this.k3D,k=this.myDocument.getViewGeometry(a))&&(h=k.name);var l=Autodesk.Viewing.Private.logger;if(l){var n=f.indexOf("urn:");l.log({category:"load_viewable",role:a.role,type:a.type,urn:-1!==n?f.substring(n+4):f})}var q=this.myDocument.getMessages(a.guid,!0);if(d){var m=this,p=this.myCurrentViewer&&this.urn===f,l=null,l=g&&g.camera?function(){m.myCurrentViewer.setViewFromArray(g.camera,g.name);b&&b(m.myCurrentViewer,a,q)}:g&&g.viewbox?function(){m.myCurrentViewer.setViewFromViewBox(g.viewbox,
g.name);b&&b(m.myCurrentViewer,a,q)}:p?function(){m.myCurrentViewer.setViewFromFile();b&&b(m.myCurrentViewer,a,q)}:function(){b&&b(m.myCurrentViewer,a,q)},n=function(a,b){c&&c(a,b,q)},t=!1;p?(l&&l(),t=!0):(this.urn=null,h={defaultModelStructureTitle:h,viewableName:h},a.hasOwnProperty("extensions")&&(h.extensions=Array.isArray(a.extensions)?a.extensions:[a.extensions]),(d=this.getViewer(d,h,c))&&d.load(this.myDocument.getFullPath(f),this.myDocument.getPropertyDbPath(),l,n)&&(this.urn=f,t=!0));if(t)return this.selectedItem=
a,this.onItemSelected(a,k),!0}}return!1};Autodesk.Viewing.ViewingApplication.prototype.onItemSelected=function(a,b){stderr("Selected URL: http://"+location.host+location.pathname+"?document=urn:"+this.myDocument.getRootItem().guid+"&item="+encodeURIComponent(a.guid));if(this.itemSelectedObservers)for(var c=this.getCurrentViewer(),f=0;f<this.itemSelectedObservers.length;++f){var d=this.itemSelectedObservers[f];d.onItemSelected&&d.onItemSelected(c,a,b)}};
Autodesk.Viewing.ViewingApplication.prototype.addItemSelectedObserver=function(a){this.itemSelectedObservers||(this.itemSelectedObservers=[]);this.itemSelectedObservers.push(a)};Autodesk.Viewing.ViewingApplication.prototype.selectItemById=function(a,b,c){return(a=this.myDocument.getItemById(a))?this.selectItem(a,b,c):!1};Autodesk.Viewing.ViewingApplication.prototype.getSelectedItem=function(){return this.selectedItem};AutodeskNamespace("Autodesk.Viewing.Private");
Autodesk.Viewing.Private.ViewCubeUi=function(a){this.viewer=a;this.homeViewContainer=this.infoButton=this.viewcube=this.cube=null};
Autodesk.Viewing.Private.ViewCubeUi.prototype={constructor:Autodesk.Viewing.UI.ViewCube,create:function(){var a=this.viewer.config;(a&&void 0!==a.wantInfoButton?a.wantInfoButton:1)&&this.initInfoButton();this.initHomeButton()},initInfoButton:function(){if(!(0<document.getElementsByClassName("infoButton").length)){this.infoButton=document.createElement("div");this.infoButton.className="infoButton";this.infoButton.style.cursor="pointer";this.viewer.container.appendChild(this.infoButton);var a=this;
this.infoButton.addEventListener("click",function(b){b=a.viewer.getPropertyPanel(!0);var c=!b.areDefaultPropertiesShown()||!b.isVisible();c&&b.showDefaultProperties();c!==b.isVisible()&&b.setVisible(c)})}},initHomeButton:function(){if(!(0<document.getElementsByClassName("homeViewWrapper").length)){var a=document.createElement("div");a.className="homeViewWrapper";a.style.cursor="pointer";this.viewer.container.appendChild(a);this.homeViewContainer=a;var b=this;a.addEventListener("click",function(a){b.viewer.navigation.setRequestHomeView(!0)});
this._initHomeMenu(a)}},_initHomeMenu:function(a){function b(a){h.style.display="none";document.removeEventListener("click",b)}var c=this.viewer,f=c.autocam,d=document.createElement("div");d.className="homeViewMenuHandle";var g=document.createElement("img");g.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsSAAALEgHS3X78AAAAIGNIUk0AAH7FAACLdgAA9UcAAIsOAABxUAAA6BUAADlYAAAfBMec4XAAAAEBSURBVHja7JcxCsIwFIb/V3oFx04v4iB4A3ev4Ak9iOABOhQcageHDh7iuVSwpW1eYmIFEwiFQvN9SZP/ERIRLNkyLNySQBLIhy+I6AhgE5F5FZHTpACAbV3X61h0Zs5nVwBAJiL0rd+eNuHvnQIArTEmplhrE7gAWEUUePSO/Vg1jJgFvQyYWoFoWTDMgLlNWDFzIyIUqjNzA6DSCpwBlMaYW4iZd+OU3bh2ARG5h5J4h3fj6nIghIQNbg2iTyQ0cFUS+kho4eoodpFwgTvVAo2EK9y5GM1J+MC9quGYhC98shaoPiQqAOwB7Hzhrxn1umMrABy6pxeT0t3w7wWeAwD5qe4YizvzugAAAABJRU5ErkJggg==";
g.width=g.height=18;d.appendChild(g);d.addEventListener("mouseover",function(a){g.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsSAAALEgHS3X78AAAAIGNIUk0AAH7FAACLdgAA9UcAAIsOAABxUAAA6BUAADlYAAAfBMec4XAAAAEVSURBVHja7JcxDoJAEEX/rvY2HMEb6AEsaTDxBngKIzfgDBR6AxJtiI0egN7Ght6GWBIYGzVKQHaQDYU7yYSwxb5HMvs3CCJCnyXRcxkBIzAsLwyWpx0ARyNzn29m81oBAE60mmqj237smBkwAl9PAfIssv3Y1kbMs+j9VZQvIyHEGMBI40enRHSpFdCcBR8ZUJcD2rKgnAH1Q5gmnu3HXcOBNPGUBIrQDbqUeMKL0A2UBIjo2pXEO5yIrso50IVEE7wxiH6RUIErJWEbCVW4chRzJDhw1l2gIsGFPzdmNQBLLrZr6R7pcL69WrpHkovtGoDF2o8rUCXRFt5aoCzRFl4pwCwLwOTxBGOeXi3Mv+HfC9wHAAIQ03ZDDGqmAAAAAElFTkSuQmCC"});
d.addEventListener("mouseleave",function(a){g.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsSAAALEgHS3X78AAAAIGNIUk0AAH7FAACLdgAA9UcAAIsOAABxUAAA6BUAADlYAAAfBMec4XAAAAEBSURBVHja7JcxCsIwFIb/V3oFx04v4iB4A3ev4Ak9iOABOhQcageHDh7iuVSwpW1eYmIFEwiFQvN9SZP/ERIRLNkyLNySQBLIhy+I6AhgE5F5FZHTpACAbV3X61h0Zs5nVwBAJiL0rd+eNuHvnQIArTEmplhrE7gAWEUUePSO/Vg1jJgFvQyYWoFoWTDMgLlNWDFzIyIUqjNzA6DSCpwBlMaYW4iZd+OU3bh2ARG5h5J4h3fj6nIghIQNbg2iTyQ0cFUS+kho4eoodpFwgTvVAo2EK9y5GM1J+MC9quGYhC98shaoPiQqAOwB7Hzhrxn1umMrABy6pxeT0t3w7wWeAwD5qe4YizvzugAAAABJRU5ErkJggg=="});
a.appendChild(d);var h=document.createElement("div");h.className="homeViewMenu";c.container.appendChild(h);var k=document.createElement("div");k.className="homeViewMenuItem";k.textContent=Autodesk.Viewing.i18n.translate("Set current view as Home");h.appendChild(k);k.addEventListener("click",function(a){f.setCurrentViewAsHome(!1);b(a)});k=document.createElement("div");k.className="homeViewMenuItem";k.textContent=Autodesk.Viewing.i18n.translate("Focus and set as Home");h.appendChild(k);k.addEventListener("click",
function(a){f.setCurrentViewAsHome(!0);b(a)});k=document.createElement("div");k.className="homeViewMenuItem";k.textContent=Autodesk.Viewing.i18n.translate("Reset Home");h.appendChild(k);k.addEventListener("click",function(a){f.resetHome();b(a)});a.addEventListener("mouseover",function(a){if(c.model&&c.model.is2d()||c.prefs&&!c.prefs.viewCube)d.style.display="block"});a.addEventListener("mouseleave",function(a){d.style.display="none"});d.addEventListener("click",function(a){if(c.model&&c.model.is2d()||
c.prefs&&!c.prefs.viewCube)h.style.display="block",document.addEventListener("click",b);a.stopPropagation()});a.addEventListener("contextmenu",function(a){if(c.model&&c.model.is2d()||c.prefs&&!c.prefs.viewCube)h.style.display="block",document.addEventListener("click",b)})},displayViewCube:function(a,b){!1!==b&&this.viewer.prefs.set("viewCube",a);if(a&&!this.cube)this.viewcube=document.createElement("div"),this.viewcube.className="viewcube",this.viewer.container.appendChild(this.viewcube),this.cube=
new Autocam.ViewCube("cube",this.viewer.autocam,this.viewcube,LOCALIZATION_REL_PATH);else if(!this.cube){this._positionHomeButton();return}this.viewcube.style.display=a?"block":"none";this._positionHomeButton();a&&this.viewer.autocam.refresh()},_positionHomeButton:function(){if(this.homeViewContainer){var a=this.cube&&this.viewcube&&"block"===this.viewcube.style.display,b=this.viewer.container.getBoundingClientRect(),c=this.homeViewContainer.getBoundingClientRect();a?(a=this.viewcube.getBoundingClientRect(),
b=b.left+b.width-a.left-c.width):this.infoButton?(a=this.infoButton.getBoundingClientRect(),b=b.left+b.width-a.left+a.width-c.width):b=10;this.homeViewContainer.style.right=b+"px"}},uninitialize:function(){this.viewer=null}};"use strict";AutodeskNamespace("Autodesk.Viewing.Private");AutodeskNamespace("Autodesk.Viewing.Extensions");function stringToDOM(a){var b=document.createElement("div");b.innerHTML=a;return b.firstChild}
(function(){var a=Autodesk.Viewing,b=Autodesk.Viewing.Private,c=Autodesk.Viewing.UI,f=Autodesk.Viewing.Extensions;a.TOOLBAR_CREATED_EVENT="toolbarCreated";a.TOOLBAR={NAVTOOLSID:"navTools",MODELTOOLSID:"modelTools",SETTINGSTOOLSID:"settingsTools"};b.GuiViewer3D=function(b,c){c||(c={});this.customizeConfig(c);a.Viewer3D.call(this,b,c);this.toolbar=null;this.dockingPanels=[];this.layersPanel=this.modelstructure=null};b.GuiViewer3D.prototype=Object.create(a.Viewer3D.prototype);b.GuiViewer3D.prototype.constructor=
b.GuiViewer3D;b.GuiViewer3D.prototype.customizeConfig=function(a){a.startOnInitialize=!1;a.hasOwnProperty("docStructureConfig")||(a.docStructureConfig=b.GuiViewer3D.kDefaultDocStructureConfig)};b.GuiViewer3D.prototype.resize=function(){a.Viewer3D.prototype.resize.call(this);this.resizePanels();this.centerToolBar&&this.centerToolBar()};b.GuiViewer3D.kDefaultDocStructureConfig={click:{onObject:["isolate"]},clickCtrl:{onObject:["toggleVisibility"]}};b.GuiViewer3D.prototype.initialize=function(){var c=
a.Viewer3D.prototype.initialize.call(this);if(0<c)return c;var g=this;this.toolController&&(c=new a.HotGestureTool(this),this.toolController.registerTool(c),this.toolController.activateTool(c.getName()));this.getToolbar(!0);this.addEventListener(a.FULLSCREEN_MODE_EVENT,function(a){g.resizePanels({viewer:g});g.updateFullscreenButton(a.mode)});this.contextMenu||this.setContextMenu(new f.ViewerObjectContextMenu(this));this.progressbar=new b.ProgressBar(this.container);this.addEventListener(a.PROGRESS_UPDATE_EVENT,
function(a){void 0!==a.percent&&g.progressbar.setPercent(a.percent)},!1);this.selectionActive=!1;this.addEventListener(a.SELECTION_CHANGED_EVENT,function(a){g.selectionActive=0<a.dbIdArray.length;g.prefs.openPropertiesOnSelect&&g.getPropertyPanel(!0).setVisible(g.selectionActive)});this.addEventListener(a.ISOLATE_EVENT,function(a){(g.prefs.openPropertiesOnSelect||a.nodeIdArray[0]===g.model.getRootId())&&g.propertygrid&&g.propertygrid.setVisible(0<a.nodeIdArray.length||g.selectionActive)});this.addEventListener(a.VIEWER_STATE_RESTORED_EVENT,
function(a){g.renderoptions&&g.renderoptions.syncUI();(a=g.getSettingsPanel(!0))&&a.syncUI()});this.initEscapeHandlers();this.localize();this.run();return 0};b.GuiViewer3D.prototype.uninitialize=function(){this.viewerSettingsPanel&&(this.viewerSettingsPanel.uninitialize(),this.viewerSettingsPanel=null);this.modelstructure&&(this.modelstructure.uninitialize(),this.modelstructure=null);this.layersPanel&&(this.layersPanel.uninitialize(),this.layersPanel=null);this.propertygrid&&(this.propertygrid.uninitialize(),
this.propertygrid=null);this.renderoptions&&(this.renderoptions.uninitialize(),this.renderoptions=null);a.theHotkeyManager.popHotkeys("Autodesk.ROLL");a.theHotkeyManager.popHotkeys("Autodesk.FOV");this.toolbar=this.debugMenu=this.navTools=this.modelTools=this.progressbar=null;a.Viewer3D.prototype.uninitialize.call(this)};b.GuiViewer3D.prototype.setUp=function(b){b||(b={});this.customizeConfig(b);this.getToolbar(!0);a.Viewer3D.prototype.setUp.call(this,b)};b.GuiViewer3D.prototype.tearDown=function(){a.Viewer3D.prototype.tearDown.call(this);
this.toolbar&&(this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null);this.modelstructure&&this.setModelStructurePanel(null);this.propertygrid&&this.setPropertyPanel(null);this.viewerSettingsPanel&&this.setSettingsPanel(null);this.layersPanel&&this.setLayersPanel(null);this.renderoptions&&(this.removePanel(this.renderoptions),this.renderoptions.uninitialize(),this.renderoptions=null)};b.GuiViewer3D.prototype.loadModel=function(b,c,f,k,l){var n=this,q=function(){n.displayViewCube(n.prefs.viewCube);
n.removeEventListener(a.GEOMETRY_LOADED_EVENT,q)};-1!=b.indexOf(".f2d")?(this.createUI("2d"),n.prefs.useFirstPersonNav?this.unloadExtension("Autodesk.FirstPerson"):this.unloadExtension("Autodesk.Beeline"),this.setDefaultNavigationTool("pan"),this.setClickToSetCOI(!1,!1),this.displayViewCube(!1,!1)):(this.createUI("3d"),-1===this.getDefaultNavigationToolName().indexOf("orbit")&&this.setDefaultNavigationTool("orbit"),n.prefs.useFirstPersonNav?this.loadExtension("Autodesk.FirstPerson",null):this.loadExtension("Autodesk.Beeline",
null),this.loadExtension("Autodesk.Viewing.Oculus",null),this.prefs.fusionOrbit&&this.loadExtension("Autodesk.Viewing.FusionOrbit",null),this.loadExtension("Autodesk.Section",null),this.addEventListener(a.GEOMETRY_LOADED_EVENT,q));return a.Viewer3D.prototype.loadModel.call(this,b,c,f,k,l)};b.GuiViewer3D.prototype.createUI=function(d){var f=this;this.initHotkeys(d);this.loadExtension("Autodesk.DefaultTools.NavTools",{mode:d});this.initModelTools(d);ENABLE_DEBUG&&this.initDebugTools();this.fireEvent({type:a.TOOLBAR_CREATED_EVENT});
this.viewCubeUi||(this.viewCubeUi=new b.ViewCubeUi(this));this.viewCubeUi.create();this.centerToolBar=function(){f.toolbar.container.style.left="calc(50% - "+f.toolbar.getDimensions().width/2+"px)"};this.toolbar.addEventListener(c.ToolBar.Event.SIZE_CHANGED,this.centerToolBar);this.resize()};b.GuiViewer3D.prototype.addOptionToggle=function(b,c,f,k,l){var n=l?this.prefs[l]:null;f="boolean"===typeof n?n:f;n=document.createElement("li");n.className="toolbar-submenu-listitem";var q=document.createElement("input");
q.className="toolbar-submenu-checkbox";q.type="checkbox";q.id=c;n.appendChild(q);var m=document.createElement("label");m.setAttribute("for",c);m.setAttribute("data-i18n",c);m.textContent=a.i18n.translate(c);n.appendChild(m);b.appendChild(n);q.checked=f;q.addEventListener("touchstart",touchStartToClick);m.addEventListener("touchstart",touchStartToClick);n.addEventListener("touchstart",touchStartToClick);q.addEventListener("click",function(a){k(q.checked);a.stopPropagation()});m.addEventListener("click",
function(a){a.stopPropagation()});n.addEventListener("click",function(a){k(!q.checked);a.stopPropagation()});l&&this.prefs.addListeners(l,function(a){q.checked=a},function(a){q.checked=a;k(a)});return q};b.GuiViewer3D.prototype.addOptionList=function(b,c,f,k,l,n){var q=this.prefs[n];k="number"===typeof q?q:k;var m=document.createElement("select");m.className="optionDropDown";m.id="selectMenu_"+c;for(q=0;q<f.length;q++){var p=document.createElement("option");p.value=q;p.setAttribute("data-i18n",f[q]);
p.textContent=Autodesk.Viewing.i18n.translate(f[q]);m.add(p)}f=document.createElement("li");f.className="toolbar-submenu-select";q=document.createElement("div");q.className="toolbar-submenu-selectlabel";q.setAttribute("for",c);q.setAttribute("data-i18n",c);q.textContent=a.i18n.translate(c);f.appendChild(q);f.appendChild(m);b.appendChild(f);m.selectedIndex=k;m.onchange=function(a){l(a.target.selectedIndex);a.stopPropagation()};m.addEventListener("touchstart",function(a){a.stopPropagation()});m.addEventListener("click",
function(a){a.stopPropagation()});n&&this.prefs.addListeners(n,function(a){m.selectedIndex=a},function(a){m.selectedIndex=a;l(a)});return m};b.GuiViewer3D.prototype.showViewer3dOptions=function(a){var b=this.getSettingsPanel(!0);a&&b.isVisible()&&b.setVisible(!1);b.setVisible(a)};b.GuiViewer3D.prototype.showRenderingOptions=function(a){this.renderoptions.setVisible(a)};b.GuiViewer3D.prototype.showLayerManager=function(a){this.layersPanel.setVisible(a)};b.GuiViewer3D.prototype.initHotkeys=function(b){var c=
this,f=a.theHotkeyManager.KEYCODES;if("3d"===b){var k;a.theHotkeyManager.pushHotkeys("Autodesk.FOV",[{keycodes:[f.CONTROL,f.SHIFT],onPress:function(){if(c.toolController.getIsLocked())return!1;k=c.getActiveNavigationTool();c.setActiveNavigationTool("fov");return!0},onRelease:function(){if(c.toolController.getIsLocked())return!1;c.setActiveNavigationTool(k);return!0}}],{tryUntilSuccess:!0})}var l;a.theHotkeyManager.pushHotkeys("Autodesk.ROLL",[{keycodes:[f.ALT,f.SHIFT],onPress:function(){if(c.toolController.getIsLocked())return!1;
l=c.getActiveNavigationTool();c.setActiveNavigationTool("worldup");return!0},onRelease:function(){if(c.toolController.getIsLocked())return!1;c.setActiveNavigationTool(l);return!0}}],{tryUntilSuccess:!0})};b.GuiViewer3D.prototype.setModelStructurePanel=function(b){var f=this;if(b instanceof a.UI.ModelStructurePanel||null===b){this.modelstructure&&(this.modelstructure.setVisible(!1),this.removePanel(this.modelstructure),this.modelstructure.uninitialize());if(this.modelstructure=b)this.addPanel(this.modelstructure),
b.addVisibilityListener(function(a){if(a)f.onPanelVisible(b,f);f.settingsTools.structurebutton.setState(a?c.Button.State.ACTIVE:c.Button.State.INACTIVE)}),f.model&&f.model.getObjectTree(function(a){f.modelstructure.setModel(a)});return!0}return!1};b.GuiViewer3D.prototype.setLayersPanel=function(b){var f=this;if(this.model&&!this.model.is2d())return console.warn("av.Viewer3D.setLayersPanel is not yet implemented for 3D"),!1;if(b instanceof a.UI.LayersPanel||!b){this.layersPanel&&(this.layersPanel.setVisible(!1),
this.removePanel(this.layersPanel),this.layersPanel.uninitialize());if(this.layersPanel=b)this.addPanel(b),b.addVisibilityListener(function(a){if(a)f.onPanelVisible(b,f);f.settingsTools.layerButton.setState(a?c.Button.State.ACTIVE:c.Button.State.INACTIVE)});return!0}return!1};b.GuiViewer3D.prototype.setPropertyPanel=function(b){var f=this;if(b instanceof a.UI.PropertyPanel||!b){this.propertygrid&&(this.propertygrid.setVisible(!1),this.removePanel(this.propertygrid),this.propertygrid.uninitialize());
if(this.propertygrid=b)this.addPanel(b),b.addVisibilityListener(function(a){if(a)f.onPanelVisible(b,f);f.settingsTools.propertiesbutton.setState(a?c.Button.State.ACTIVE:c.Button.State.INACTIVE)});return!0}return!1};b.GuiViewer3D.prototype.getPropertyPanel=function(a){!this.propertygrid&&a&&this.setPropertyPanel(new f.ViewerPropertyPanel(this));return this.propertygrid};b.GuiViewer3D.prototype.setSettingsPanel=function(b){return b instanceof a.UI.SettingsPanel||!b?(this.viewerSettingsPanel&&(this.viewerSettingsPanel.setVisible(!1),
this.removePanel(this.viewerSettingsPanel),this.viewerSettingsPanel.uninitialize()),(this.viewerSettingsPanel=b)&&this.addPanel(b),!0):!1};b.GuiViewer3D.prototype.getSettingsPanel=function(a){!this.viewerSettingsPanel&&a&&this.setSettingsPanel(new f.ViewerSettingsPanel(this,this.model.is2d()?"2d":"3d"));return this.viewerSettingsPanel};b.GuiViewer3D.prototype.initModelTools=function(d){var g=this;if("3d"===d){g.modelstructure||g.setModelStructurePanel(new f.ViewerModelStructurePanel(g,"Browser",{docStructureConfig:g.config.docStructureConfig}));
var h=new c.Button("toolbar-modelStructureTool");h.setToolTip("Model browser");h.setIcon("adsk-icon-structure");h.onClick=function(a){g.showModelStructurePanel(!g.modelstructure.isVisible())};this.settingsTools.addControl(h);this.settingsTools.structurebutton=h;this.initExplodeSlider()}else h=new f.ViewerLayersPanel(this),this.setLayersPanel(h),h=new c.Button("toolbar-layersTool"),h.setToolTip("Layer Manager"),h.setIcon("adsk-icon-layers"),h.onClick=function(a){g.layersPanel||g.setLayersPanel(new f.ViewerLayersPanel(g));
g.showLayerManager(!g.layersPanel.isVisible())},this.settingsTools.addControl(h),this.settingsTools.layerButton=h;g.addEventListener(a.RESET_EVENT,function(){g.model&&!g.model.is2d()&&(g.explode(0),g.explodeSlider.value=0);g.showAll()});h=new c.Button("toolbar-propertiesTool");h.setToolTip("Properties");h.setIcon("adsk-icon-properties");h.onClick=function(a){a=g.getPropertyPanel(!0);a.setVisible(!a.isVisible())};h.setVisible(!g.prefs.openPropertiesOnSelect);this.settingsTools.addControl(h);this.settingsTools.propertiesbutton=
h;h=new f.ViewerSettingsPanel(this,d);this.setSettingsPanel(h);this.viewerOptionButton=h=new c.Button("toolbar-settingsTool");h.setIcon("adsk-icon-settings");h.setToolTip("Settings");this.settingsTools.addControl(h);this.createViewerOptionsMenu(d);ENABLE_DEBUG&&"3d"===d&&(this.renderoptions=new b.RenderOptionsPanel(this),this.addPanel(this.renderoptions),d=new c.Button("toolbar-renderOptionsTool"),d.setToolTip("Rendering options"),d.setIcon("adsk-icon-settings-render"),d.onClick=function(a){g.showRenderingOptions(!g.renderoptions.isVisible())},
this.settingsTools.addControl(d),this.renderoptionsbutton=d);this.canChangeScreenMode()&&(d=new c.Button("toolbar-fullscreenTool",{collapsible:!1}),d.setToolTip("Full screen"),d.setIcon("adsk-icon-fullscreen"),d.onClick=function(a){g.nextScreenMode()},this.settingsTools.addControl(d),this.settingsTools.fullscreenbutton=d,this.updateFullscreenButton(this.getScreenMode()))};b.GuiViewer3D.prototype.setPropertiesOnSelect=function(a){this.settingsTools.propertiesbutton.setVisible(!a)};b.GuiViewer3D.prototype.addDivider=
function(a){var b=document.createElement("li");b.className="toolbar-submenu-horizontal-divider";a.appendChild(b);return b};b.GuiViewer3D.prototype.createViewerOptionsMenu=function(c){function g(a){var b=h.getSettingsPanel(!0);b.isVisible()&&b.isTabSelected(a)?h.showViewer3dOptions(!1):(h.showViewer3dOptions(!0),b.selectTab(a))}var h=this,k=document.createElement("div");k.id="toolbar-settingsToolSubmenu";k.classList.add("toolbar-submenu");k.classList.add("toolbar-settings-sub-menu");k.classList.add("adsk-hidden");
k.mode=c;this.container.appendChild(k);if("3d"===c){c=[];for(var l=0;l<b.LightPresets.length;l++)c.push(b.LightPresets[l].name);this.viewerOptionButton.envList=this.addOptionList(k,"Background and lighting",c,4,function(a){h.blockEvent||(k.classList.toggle("adsk-hidden"),h.setLightPreset(a))},"lightPreset");this.selectLightPreset=function(a){h.blockEvent=!0;h.viewerOptionButton.envList&&(h.viewerOptionButton.envList.selectedIndex=h.impl.currentLightPreset());h.blockEvent=!1};h.addEventListener(a.RENDER_OPTION_CHANGED_EVENT,
this.selectLightPreset);this.viewerOptionButton.displayLines=this.addOptionToggle(k,"Display Lines",!0,function(a){h.hideLines(!a)},"lineRendering");this.addDivider(k)}c=document.createElement("li");c.className="toolbar-submenu-listitem";l=document.createElement("label");l.setAttribute("data-i18n","Performance and appearance settings");l.textContent=a.i18n.translate("Performance and appearance settings");c.appendChild(l);this.show3dOptionsPerformanceTab=function(){g(f.ViewerSettingTab.Performance)};
this.viewerOptionButton.performanceOption=c;this.viewerOptionButton.performanceOption.addEventListener("touchstart",touchStartToClick);this.viewerOptionButton.performanceOption.addEventListener("click",this.show3dOptionsPerformanceTab);k.appendChild(this.viewerOptionButton.performanceOption);this.addDivider(k);c=document.createElement("li");c.className="toolbar-submenu-listitem";l=document.createElement("label");l.setAttribute("data-i18n","Navigation and selection settings");l.textContent=a.i18n.translate("Navigation and selection settings");
c.appendChild(l);this.show3dOptionsNavigationTab=function(){g(f.ViewerSettingTab.Navigation)};this.viewerOptionButton.navigationOption=c;this.viewerOptionButton.navigationOption.addEventListener("touchstart",touchStartToClick);this.viewerOptionButton.navigationOption.addEventListener("click",this.show3dOptionsNavigationTab);k.appendChild(c);k.style.width=k.getBoundingClientRect().width+"px";this.container.removeChild(k);this.viewerOptionButton.onClick=function(a){k.classList.toggle("adsk-hidden")};
this.viewerOptionButton.container.appendChild(k);this.viewerOptionButton.subMenu=k};b.GuiViewer3D.prototype.removeViewerOptionsMenu=function(a){this.viewerOptionButton.container.removeChild(this.viewerOptionButton.subMenu);"3d"===a&&(this.removeEventListener(Autodesk.Viewing.RENDER_OPTION_CHANGED_EVENT,this.selectLightPreset),this.viewerOptionButton.envList=null);this.viewerOptionButton.navigationOption.removeEventListener("touchstart",touchStartToClick);this.viewerOptionButton.navigationOption.removeEventListener("click",
this.show3dOptionsNavigationTab);this.viewerOptionButton.navigationOption=null;this.viewerOptionButton.performanceOption.removeEventListener("touchstart",touchStartToClick);this.viewerOptionButton.performanceOption.removeEventListener("click",this.show3dOptionsPerformanceTab);this.viewerOptionButton.performanceOption=null};b.GuiViewer3D.prototype.initDebugTools=function(){var a=new c.ControlGroup("debugTools");this.debugMenu=a;var b=new c.Button("toolbar-debugTool");b.setIcon("adsk-icon-bug");a.addControl(b);
this.debugMenu.debugSubMenuButton=b;this.createDebugSubmenu(this.debugMenu.debugSubMenuButton);this.toolbar.addControl(a)};b.GuiViewer3D.prototype.createDebugSubmenu=function(a){function c(){f.localize()}var f=this,k=document.createElement("div");k.id="toolbar-debugToolSubmenu";k.classList.add("toolbar-submenu");k.classList.add("toolbar-settings-sub-menu");k.classList.add("adsk-hidden");this.debugMenu.subMenu=k;this.debugMenu.subMenu.style.minWidth="180px";this.container.appendChild(k);this.initModelStats();
this.addDivider(k);this.addDivider(k);var l="en ru ja ko zh-Hant sp".split(" ");this.addOptionList(k,"Language","English Russian Japanese Korean Chinese Spanish(unsupported)".split(" "),f.selectedLanguage?f.selectedLanguage:0,function(a){var d=l[a];f.selectedLanguage=a;b.setLanguage(d,c)},null).parentNode.style.paddingBottom="15px";this.addDivider(this.debugMenu.subMenu);this.addOptionList(k,"Error","UNKNOWN FAILURE; BAD DATA;NETWORK ERROR;NETWORK ACCESS DENIED;NETWORK FILE NOT FOUND; NETWORK SERVER ERROR;NETWORK UNHANDLED RESPONSE CODE;BROWSER WEBGL NOT SUPPORTED;BAD DATA NO VIEWABLE CONTENT".split(";"),
0,function(a){b.ErrorHandler.reportError(f.container,a+1,"")},null).parentNode.style.paddingBottom="15px";var n=k.getBoundingClientRect();this.debugMenu.subMenu.style.width=n.width+"px";this.container.removeChild(k);a.container.appendChild(k);var n=n.left+n.width,q=this.container.getBoundingClientRect().right;n>q&&(this.debugMenu.subMenu.style.left=-(n-q+10)+"px");a.onMouseOver=function(a){k.classList.remove("adsk-hidden")};a.onMouseOut=function(a){k.classList.add("adsk-hidden")};isTouchDevice()&&
(a.onClick=function(a){k.classList.toggle("adsk-hidden")})};b.GuiViewer3D.prototype.initModelStats=function(){function b(a){var c=f.impl,d="";f.model&&(d+="Geom&nbsp;polys:&nbsp;"+c.modelQueue().getGeometryList().geomPolyCount+"<br>",d+="Instance&nbsp;polys:&nbsp;"+c.modelQueue().getGeometryList().instancePolyCount+"<br>",d+="Fragments:&nbsp;"+c.modelQueue().getFragmentList().getCount()+"<br>",d+="Geoms:&nbsp;"+c.modelQueue().getGeometryList().geoms.length+"<br>");f.modelStats.innerHTML=d+("# "+(a||
""))}function c(){f.modelStats=document.createElement("div");f.modelStats.className="statspanel";f.container.appendChild(f.modelStats);f.addEventListener(a.PROGRESS_UPDATE_EVENT,function(a){a.message&&b(a.message)})}var f=this;this.addOptionToggle(this.debugMenu.subMenu,"Model statistics",!1,function(a){a&&!f.modelStats&&(c(),b(""));f.modelStats.style.visibility=a?"visible":"hidden"})};b.GuiViewer3D.prototype.initEscapeHandlers=function(){var c=this;this.addEventListener(a.ESCAPE_EVENT,function(a){if(!c.contextMenu||
!c.contextMenu.hide())if(c.renderoptions&&c.renderoptions.isVisible())c.renderoptions.setVisible(!1);else if(c.getActiveNavigationTool()!==c.getDefaultNavigationToolName())c.toolController&&c.toolController.setIsLocked(!1),c.setActiveNavigationTool(),b.HudMessage.dismiss();else if(c.selectionActive)c.clearSelection();else if(!c.areAllVisible())c.showAll();else if(!b.AlertBox.dismiss()){for(a=0;a<c.dockingPanels.length;++a){var f=c.dockingPanels[a];if("none"!==f.container.style.display&&""!==f.container.style.display){f.container===
c.modelstructure?c.showModelStructurePanel(!1):f.setVisible(!1);return}}c.escapeScreenMode()}})};b.GuiViewer3D.prototype.displayViewCube=function(a,b){this.viewCubeUi.displayViewCube(a,b)};b.GuiViewer3D.prototype.getToolbar=function(b){!this.toolbar&&b&&(b=a.UI,this.toolbar=new b.ToolBar("guiviewer3d-toolbar"),this.navTools=new b.RadioButtonGroup(a.TOOLBAR.NAVTOOLSID),this.modelTools=new b.ControlGroup(a.TOOLBAR.MODELTOOLSID),this.settingsTools=new b.ControlGroup(a.TOOLBAR.SETTINGSTOOLSID),this.toolbar.addControl(this.navTools),
this.toolbar.addControl(this.modelTools),this.toolbar.addControl(this.settingsTools),this.container.appendChild(this.toolbar.container));return this.toolbar};b.GuiViewer3D.prototype.showModelStructurePanel=function(a){this.modelstructure.setVisible(a)};b.GuiViewer3D.prototype.onPanelVisible=function(a){this.dockingPanels.splice(this.dockingPanels.indexOf(a),1);this.dockingPanels.splice(0,0,a)};b.GuiViewer3D.prototype.updateFullscreenButton=function(b){var c="adsk-icon-fullscreen";switch(b){case a.ScreenMode.kNormal:this.isScreenModeSupported(a.ScreenMode.kFullBrowser)||
(c="adsk-icon-fullscreen");break;case a.ScreenMode.kFullBrowser:c=this.isScreenModeSupported(a.ScreenMode.kFullScreen)?"adsk-icon-fullscreen":"adsk-icon-fullscreen-exit";break;case a.ScreenMode.kFullScreen:c="adsk-icon-fullscreen-exit"}this.settingsTools.fullscreenbutton.setIcon(c)};b.GuiViewer3D.prototype.localize=function(){a.i18n.localize();if(this.viewerOptionButton&&this.viewerOptionButton.subMenu){var c=this.viewerOptionButton.subMenu.mode;this.removeViewerOptionsMenu(c);this.createViewerOptionsMenu(c)}this.debugMenu&&
this.debugMenu.debugSubMenuButton&&(this.debugMenu.debugSubMenuButton.removeChild(this.debugMenu.subMenu),this.createDebugSubmenu(this.debugMenu.debugSubMenuButton));b.ErrorHandler.localize()};b.GuiViewer3D.prototype.addPanel=function(a){return-1===this.dockingPanels.indexOf(a)?(this.dockingPanels.push(a),!0):!1};b.GuiViewer3D.prototype.removePanel=function(a){a=this.dockingPanels.indexOf(a);return-1<a?(this.dockingPanels.splice(a,1),!0):!1};b.GuiViewer3D.prototype.resizePanels=function(a){a=a||{};
var b=this.toolbar.getDimensions().height,c=this.getDimensions(),f=c.height;a.dimensions&&a.dimensions.height?f=a.dimensions.height:a.dimensions={height:c.height,width:c.width};a.dimensions.height=f-b;(c=a?a.viewer:null)||(c=this);b=a?a.dockingPanels:null;b||(b=c.dockingPanels);var l=c.container.getBoundingClientRect(),c=l.top,f=l.bottom,n=l.left,q=l.right,m;a&&a.dimensions?(m=a.dimensions.width,f=l=a.dimensions.height):(m=l.width,l=l.height);for(a=0;a<b.length;++a){var p=b[a].container,t=p.getBoundingClientRect(),
r=t.top,r=t.bottom,B=t.left,B=t.right,z=t.width,t=t.height;if(z&&t){m<z&&(z=Math.round(m),p.style.width=z+"px");l<t&&(t=Math.round(l),p.style.height=t+"px");if(q<B||p.dockRight)B=Math.round(q-z-n),p.style.left=B+"px";if(f<r||p.dockBottom)r=Math.round(f-t-c),0>r&&(r=0),p.style.top=r+"px";p.style.maxWidth=Math.round(m)+"px";p.style.maxHeight=Math.round(l)+"px"}}};b.GuiViewer3D.prototype.initExplodeSlider=function(){var a=this,b=new c.Button("toolbar-explodeTool");b.setIcon("adsk-icon-explode");b.setToolTip("Explode");
a.modelTools.addControl(b,{index:0});var f=stringToDOM('<div class="explode-submenu" style="display:none"><input class="explode-slider" type="range" min="0" max="1" step="0.01" value="0"></input></div>'),k;k=document.querySelector("#toolbar-explodeTool").parentNode;f.classList.add("ios");k.appendChild(f);var l=f.querySelector(".explode-slider");a.explodeSlider=l;l.oninput=function(b){a.explode(l.value)};l.onchange=function(b){a.explode(l.value)};f.onclick=function(a){a.stopPropagation()};var n=b.container.querySelector(".adsk-control-tooltip");
b.onClick=function(a){a=b.getState();a===c.Button.State.INACTIVE?(b.setState(c.Button.State.ACTIVE),n.style.display="none",f.style.display=""):a===c.Button.State.ACTIVE&&(b.setState(c.Button.State.INACTIVE),n.style.display="",l.parentNode.style.display="none")}};b.GuiViewer3D.prototype.initInspectTools=function(){var a=new c.Button("toolbar-inspectTools");a.setToolTip("Inspect");a.setIcon("measure");a.setVisible(!1);this.modelTools.addControl(a);var b=new c.RadioButtonGroup("toolbar-inspectSubMenu");
b.addClass("toolbar-vertical-group");b.setVisible(!1);this.modelTools.addControl(b);a.container.insertBefore(b.container,a.container.firstChild);a.onMouseOver=function(){b.setVisible(!0)};a.onMouseOut=function(){b.setVisible(!1)};isTouchDevice()&&(a.onClick=function(a){b.setVisible(!b.isVisible())})}})();AutodeskNamespace("Autodesk.Viewing.UI");
(function(){var a=Autodesk.Viewing,b=Autodesk.Viewing.UI;b.Control=function(a,b){this._id=a;this._isCollapsible=!b||b.collapsible;this._toolTipElement=null;this._listeners={};this.container=document.createElement("div");this.container.id=a;this.addClass("adsk-control")};b.Control.Event={VISIBILITY_CHANGED:"Control.VisibilityChanged",COLLAPSED_CHANGED:"Control.CollapsedChanged"};a.EventDispatcher.prototype.apply(b.Control.prototype);b.Control.prototype.constructor=b.Control;b.Control.prototype.container=
null;b.Control.prototype.getId=function(){return this._id};b.Control.prototype.setVisible=function(a){if(!this.container.classList.contains("adsk-hidden")===a)return!1;a?this.container.classList.remove("adsk-hidden"):this.container.classList.add("adsk-hidden");this.fireEvent({type:b.Control.Event.VISIBILITY_CHANGED,target:this,controlId:this._id,isVisible:a});return!0};b.Control.prototype.isVisible=function(){return!this.container.classList.contains("adsk-hidden")};b.Control.prototype.setToolTip=
function(a){if(this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")===a)return!1;this._toolTipElement||(this._toolTipElement=document.createElement("div"),this._toolTipElement.id=this._id+"-tooltip",this._toolTipElement.classList.add("adsk-control-tooltip"),this.container.appendChild(this._toolTipElement));this._toolTipElement.setAttribute("data-i18n",a);this._toolTipElement.setAttribute("tooltipText",a);this._toolTipElement.textContent=Autodesk.Viewing.i18n.translate(a,{defaultValue:a});
return!0};b.Control.prototype.getToolTip=function(){return this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")};b.Control.prototype.setCollapsed=function(a){if(!this._isCollapsible||this.isCollapsed()===a)return!1;a?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed");this.fireEvent({type:b.Control.Event.COLLAPSED_CHANGED,isCollapsed:a});return!0};b.Control.prototype.isCollapsed=function(){return!!this.container.classList.contains("collapsed")};
b.Control.prototype.isCollapsible=function(){return this._isCollapsible};b.Control.prototype.addClass=function(a){this.container.classList.add(a)};b.Control.prototype.removeClass=function(a){this.container.classList.remove(a)};b.Control.prototype.getPosition=function(){var a=this.container.getBoundingClientRect();return{top:a.top,left:a.left}};b.Control.prototype.getDimensions=function(){var a=this.container.getBoundingClientRect();return{width:a.width,height:a.height}}})();AutodeskNamespace("Autodesk.Viewing.UI");
(function(){var a=Autodesk.Viewing.UI;a.ControlGroup=function(b,c){a.Control.call(this,b,c);var f=this;this._controls=[];this.addClass("adsk-control-group");this.handleChildSizeChanged=function(b){f.fireEvent({type:a.ControlGroup.Event.SIZE_CHANGED,childEvent:b})}};a.ControlGroup.Event={VISIBILITY_CHANGED:a.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:a.Control.Event.COLLAPSED_CHANGED,SIZE_CHANGED:"ControlGroup.SizeChanged",CONTROL_ADDED:"ControlGroup.ControlAdded",CONTROL_REMOVED:"ControlGroup.ControlRemoved"};
a.ControlGroup.prototype=Object.create(a.Control.prototype);a.ControlGroup.prototype.constructor=a.ControlGroup;a.ControlGroup.prototype.addControl=function(b,c){var f=c&&void 0!==c.index?c.index:this._controls.length;if(null!==this.getControl(b.getId()))return!1;var d={type:a.ControlGroup.Event.CONTROL_ADDED,control:b,index:f};f<this._controls.length?(this.container.insertBefore(b.container,this._controls[f].container),this._controls.splice(f,0,b)):(this.container.appendChild(b.container),this._controls.push(b));
b.addEventListener(a.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged);b.addEventListener(a.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged);b instanceof a.ControlGroup&&b.addEventListener(a.ControlGroup.Event.SIZE_CHANGED,this.handleChildSizeChanged);this.fireEvent(d);this.fireEvent(a.ControlGroup.Event.SIZE_CHANGED);return!0};a.ControlGroup.prototype.indexOf=function(a){for(var c=0;c<this._controls.length;c++){var f=this._controls[c];if(f===a||"string"===typeof a&&a===f.getId())return c}return-1};
a.ControlGroup.prototype.removeControl=function(b){b="string"===typeof b?this.getControl(b):b;if(!b)return!1;var c=this._controls.indexOf(b);this._controls.splice(c,1);this.container.removeChild(b.container);c={type:a.ControlGroup.Event.CONTROL_REMOVED,control:b,index:c};b.removeEventListener(a.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged);b.removeEventListener(a.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged);b instanceof a.ControlGroup&&b.removeEventListener(a.ControlGroup.Event.SIZE_CHANGED,
this.handleChildSizeChanged);this.fireEvent(c);this.fireEvent(a.ControlGroup.Event.SIZE_CHANGED);return!0};a.ControlGroup.prototype.getControl=function(a){for(var c=0;c<this._controls.length;c++)if(a===this._controls[c].getId())return this._controls[c];return null};a.ControlGroup.prototype.getNumberOfControls=function(){return this._controls.length};a.ControlGroup.prototype.setCollapsed=function(b){if(!this._isCollapsible)return!1;var c=!1;this._controls.forEach(function(a){a.isCollapsible()&&a.setCollapsed(b)&&
(c=!0)});c&&(b?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this.fireEvent({type:a.ControlGroup.Event.COLLAPSED_CHANGED,isCollapsed:b}));return c}})();AutodeskNamespace("Autodesk.Viewing.UI");
(function(){var a=Autodesk.Viewing.UI;a.ToolBar=function(b,c){a.ControlGroup.call(this,b,c);this.removeClass("adsk-control-group");this.addClass("adsk-toolbar")};a.ToolBar.Event={VISIBILITY_CHANGED:a.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:a.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:a.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:a.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:a.ControlGroup.Event.SIZE_CHANGED};a.ToolBar.prototype=Object.create(a.ControlGroup.prototype);a.ToolBar.prototype.constructor=
a.ToolBar})();AutodeskNamespace("Autodesk.Viewing.UI");
(function(){var a=Autodesk.Viewing.UI;a.Button=function(b,c){a.Control.call(this,b,c);var f=this;this._state=a.Button.State.INACTIVE;this.icon=document.createElement("div");this.icon.classList.add("adsk-button-icon");this.container.appendChild(this.icon);this.container.addEventListener("click",function(b){f.fireEvent(a.Button.Event.CLICK);if(f.onClick)f.onClick(b);b.stopPropagation()});isTouchDevice()?this.container.addEventListener("touchstart",touchStartToClick):(this.container.addEventListener("mouseover",
function(a){f.onMouseOver(a)}),this.container.addEventListener("mouseout",function(a){f.onMouseOut(a)}));this.addClass("adsk-button");this.addClass(a.Button.StateToClassMap[this._state])};a.Button.Event={VISIBILITY_CHANGED:a.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:a.Control.Event.COLLAPSED_CHANGED,STATE_CHANGED:"Button.StateChanged",CLICK:"click"};a.Button.State={ACTIVE:0,INACTIVE:1,DISABLED:2};a.Button.StateToClassMap=function(){var b=a.Button.State,c={};c[b.ACTIVE]="active";c[b.INACTIVE]=
"inactive";c[b.DISABLED]="disabled";return c}();a.Button.prototype=Object.create(a.Control.prototype);a.Button.prototype.constructor=a.Button;a.Button.prototype.setState=function(b){if(b===this._state)return!1;this.removeClass(a.Button.StateToClassMap[this._state]);this.addClass(a.Button.StateToClassMap[b]);this._state=b;this.fireEvent({type:a.Button.Event.STATE_CHANGED,state:b});return!0};a.Button.prototype.setIcon=function(a){this.iconClass&&this.icon.classList.remove(this.iconClass);this.iconClass=
a;this.icon.classList.add(a)};a.Button.prototype.getState=function(){return this._state};a.Button.prototype.onClick=function(a){};a.Button.prototype.onMouseOver=function(a){};a.Button.prototype.onMouseOut=function(a){}})();AutodeskNamespace("Auodesk.Viewing.UI");
(function(){var a=Autodesk.Viewing.UI;a.ComboButton=function(b,c){a.Button.call(this,b,c);this.arrowButton=new a.Button(b+"arrow");this.arrowButton.addClass("adsk-button-arrow");this.arrowButton.removeClass("adsk-button");this.subMenu=new a.RadioButtonGroup(b+"SubMenu");this.subMenu.addClass("toolbar-vertical-group");this.subMenu.setVisible(!1);this.container.insertBefore(this.subMenu.container,this.container.firstChild);this.container.insertBefore(this.arrowButton.container,this.container.firstChild);
var f=this;this.arrowButton.onClick=function(a){f.subMenu.setVisible(!f.subMenu.isVisible())};this.toggleFlyoutVisible=function(){f.subMenu.setVisible(!f.subMenu.isVisible())};this.onClick=function(a){f.subMenu.setVisible(!f.subMenu.isVisible())};this.subMenuActiveButtonChangedHandler=function(b){b.isActiveButton?(f.setIcon(b.target.getActiveButton().iconClass),f.setToolTip(b.target.getActiveButton().getToolTip()),f.setState(a.Button.State.ACTIVE),f.onClick=b.button.onClick):f.setState(a.Button.State.INACTIVE)};
this.subMenu.addEventListener(a.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,this.subMenuActiveButtonChangedHandler);var d=stringToDOM('<div style="position:fixed; top:0; left:0; width:100vw; height:100vh;"></div>');this.subMenu.container.insertBefore(d,this.subMenu.container.firstChild);d.addEventListener("click",function(a){f.subMenu.setVisible(!1);a.stopPropagation()})};a.ComboButton.prototype=Object.create(a.Button.prototype);a.ComboButton.prototype.constructor=a.ComboButton;a.ComboButton.prototype.addControl=
function(b){this.subMenu.addControl(b);b.addEventListener(a.Button.Event.CLICK,this.toggleFlyoutVisible)};a.ComboButton.prototype.removeControl=function(b){b.removeEventListener(a.Button.Event.CLICK,this.toggleFlyoutVisible)};a.ComboButton.prototype.setState=function(b){if(b===a.Button.State.INACTIVE){var c=this.subMenu.getActiveButton();c&&c.setState(a.Button.State.INACTIVE)}a.Button.prototype.setState.call(this,b)}})();AutodeskNamespace("Autodesk.Viewing.UI");
(function(){var a=Autodesk.Viewing.UI;a.RadioButtonGroup=function(b,c){a.ControlGroup.call(this,b,c);var f=this;this._activeButton=null;this._handleButtonStateChange=function(b){var c=a.Button.State;b.state!==c.ACTIVE?b.target===f._activeButton&&(f._activeButton=null,f.fireEvent({type:a.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,button:b.target,isActiveButton:!1})):(f._activeButton=b.target,f.fireEvent({type:a.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,button:b.target,isActiveButton:!0}),f._controls.forEach(function(a){a!==
b.target&&a.getState()!==c.DISABLED&&a.setState(c.INACTIVE)}))}};a.RadioButtonGroup.Event={ACTIVE_BUTTON_CHANGED:"RadioButtonGroup.ActiveButtonChanged",VISIBILITY_CHANGED:a.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:a.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:a.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:a.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:a.ControlGroup.Event.SIZE_CHANGED};a.RadioButtonGroup.prototype=Object.create(a.ControlGroup.prototype);a.RadioButtonGroup.prototype.constructor=
a.RadioButtonGroup;a.RadioButtonGroup.prototype.addControl=function(b,c){return b instanceof a.Button?a.ControlGroup.prototype.addControl.call(this,b,c)?(b.addEventListener(a.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0):!1:!1};a.RadioButtonGroup.prototype.removeControl=function(b){b="string"==typeof b?this.getControl(b):b;return null!==b&&a.ControlGroup.prototype.removeControl.call(this,b)?(b.removeEventListener(a.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0):!1};
a.RadioButtonGroup.prototype.getActiveButton=function(){return this._activeButton}})();AutodeskNamespace("Autodesk.Viewing.Extensions");
Autodesk.Viewing.Extensions.ViewerPanelMixin=function(){this.getContainerBoundingRect=function(){var a=this.parentContainer.getBoundingClientRect(),b={height:0,width:0,left:0,bottom:0,right:0,top:0},c=document.getElementsByClassName("toolbar-menu");c&&0<c.length&&(b=c[0].getBoundingClientRect());return{height:a.height-b.height,width:a.width,left:a.left,bottom:a.bottom-b.height,right:a.right,top:a.top}}};AutodeskNamespace("Autodesk.Viewing.Extensions");AutodeskNamespace("Autodesk.Viewing.UI");
(function(){var a=Autodesk.Viewing,b=Autodesk.Viewing.UI,c=Autodesk.Viewing.Extensions;c.ViewerModelStructurePanel=function(a,c,g){this.viewer=a;g=g||{};g.heightAdjustment=75;b.ModelStructurePanel.call(this,a.container,a.container.id+"ViewerModelStructurePanel",c,g);this.clickConfig=g&&g.docStructureConfig?g.docStructureConfig:null;this.isMac=-1!==navigator.userAgent.search("Mac OS");this.initSearchBox();this.prevSearchResults=[];this.prevSearchString=""};c.ViewerModelStructurePanel.prototype=Object.create(b.ModelStructurePanel.prototype);
c.ViewerModelStructurePanel.prototype.constructor=c.ViewerModelStructurePanel;c.ViewerPanelMixin.call(c.ViewerModelStructurePanel.prototype);c.ViewerModelStructurePanel.prototype.initialize=function(){b.ModelStructurePanel.prototype.initialize.call(this);var c=this;c.addEventListener(c.viewer,a.SELECTION_CHANGED_EVENT,function(a){c.setSelection(a.nodeArray.slice())});c.addEventListener(c.viewer,a.ISOLATE_EVENT,function(a){c.setIsolation(a.nodeIdArray.slice())});c.addEventListener(c.viewer,a.HIDE_EVENT,
function(a){c.setHidden(a.nodeIdArray.slice(),!0)});c.addEventListener(c.viewer,a.SHOW_EVENT,function(a){c.setHidden(a.nodeIdArray.slice(),!1)})};c.ViewerModelStructurePanel.prototype.uninitialize=function(){this.viewer=null;b.ModelStructurePanel.prototype.uninitialize.call(this)};c.ViewerModelStructurePanel.prototype.handleAction=function(a,b){for(var c in a)switch(a[c]){case "selectOnly":this.viewer.select(b);break;case "deselectAll":this.viewer.select([]);break;case "selectToggle":this.viewer.toggleSelect(b);
break;case "isolate":this.viewer.isolate(b);break;case "showAll":this.viewer.isolate(null);break;case "focus":this.viewer.fitToView();break;case "hide":this.viewer.hide(b);break;case "show":this.viewer.show(b);break;case "toggleVisibility":this.viewer.toggleVisibility(b)}};c.ViewerModelStructurePanel.prototype.ctrlDown=function(a){return this.isMac&&a.metaKey||!this.isMac&&a.ctrlKey};c.ViewerModelStructurePanel.prototype.onClick=function(a,b){if(!this.isMac||!b.ctrlKey){var c="click";this.ctrlDown(b)&&
(c+="Ctrl");b.shiftKey&&(c+="Shift");b.altKey&&(c+="Alt");this.clickConfig&&this.clickConfig[c]?this.handleAction(this.clickConfig[c].onObject,a):this.viewer.select(a)}};c.ViewerModelStructurePanel.prototype.onDoubleClick=function(a,b){this.handleAction(["focus"],a)};c.ViewerModelStructurePanel.prototype.onRightClick=function(a,b){if(this.isMac&&b.ctrlKey&&0===b.button)return this.clickConfig&&this.clickConfig.clickCtrl?this.handleAction(this.clickConfig.clickCtrl.onObject,a):this.viewer.select(a),
null;var c=[],h=!0;if(b.shiftKey||this.isMac&&b.metaKey||b.ctrlKey&&(this.isMac||2===b.button))for(var k=this.viewer.impl.selector.getSelection(),l=0;l<k.length;++l)k[l]!==a?c.push(k[l]):h=!1;h&&c.push(a);this.viewer.select(c);return this.viewer.contextMenu.show(b)};c.ViewerModelStructurePanel.prototype.setHidden=function(a,b){this.uiCreated||this.createUI();for(var c=0;c<a.length;++c)this.tree.iterate(a[c],function(a,c){c.classList.toggle("dim",b);c.classList.toggle("visible",!b)})};c.ViewerModelStructurePanel.prototype.setIsolation=
function(a){this.rootId&&(this.tree&&this.tree.iterate(this.rootId,function(a,b){b.classList.remove("dim");b.classList.remove("visible")}),0<a.length&&(1!==a.length||a[0]!==this.rootId)&&(this.setHidden([this.rootId],!0),this.setHidden(a,!1)))};c.ViewerModelStructurePanel.prototype.initSearchBox=function(){function b(){if(!h.isSearching){for(var a=0;a<h.prevSearchResults.length;a++)h.tree.setCollapsed(h.prevSearchResults[a],!0,!0);0===c.value.length?(h.isSearching=!1,h.prevSearchString="",g.isolate()):
h.prevSearchString!=c.value&&(h.isSearching=!0,g.search(c.value,function(a){g.isolate(a);if(a.length){for(var b=0;b<a.length;b++)h.tree.setCollapsed(a[b],!1,!0);h.resizeToContent();h.tree.scrollTo(a[0])}h.prevSearchResults=a;h.isSearching=!1},null,["name"]))}}var c=document.createElement("input");c.className="toolbar-search-box";c.type="search";c.results=5;c.placeholder=a.i18n.translate("Filter by name");c.incremental="incremental";c.autosave=this.container.id+"search_autosave";c.setAttribute("data-i18n",
"[placeholder]Filter by name");this.scrollContainer.parentNode.insertBefore(c,this.scrollContainer);var g=this.viewer,h=this,k;c.addEventListener("input",function(a){clearTimeout(k);k=setTimeout(b,500)});c.addEventListener("change",function(a){clearTimeout(k);b()})}})();AutodeskNamespace("Autodesk.Viewing.Extensions");
Autodesk.Viewing.Extensions.ViewerPropertyPanel=function(a){this.viewer=a;this.currentNodeIds=[];this.isSelection=!1;this.isDirty=!0;this.propertyNodeId=null;Autodesk.Viewing.UI.PropertyPanel.call(this,a.container,"ViewerPropertyPanel","Object Properties Loading...")};Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype=Object.create(Autodesk.Viewing.UI.PropertyPanel.prototype);Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.constructor=Autodesk.Viewing.Extensions.ViewerPropertyPanel;
Autodesk.Viewing.Extensions.ViewerPanelMixin.call(Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype);
Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.initialize=function(){Autodesk.Viewing.UI.PropertyPanel.prototype.initialize.call(this);var a=this;a.addEventListener(a.viewer,Autodesk.Viewing.SELECTION_CHANGED_EVENT,function(b){a.currentNodeIds=b.dbIdArray;a.isSelection=0<b.dbIdArray.length;a.isDirty=!0;a.requestProperties()});a.addEventListener(a.viewer,Autodesk.Viewing.ISOLATE_EVENT,function(b){0==b.nodeIdArray.length&&a.isSelection||(a.currentNodeIds=b.nodeIdArray,a.isDirty=!0,a.requestProperties())});
a.addEventListener(a.viewer,Autodesk.Viewing.HIDE_EVENT,function(b){a.isDirty=!0;a.requestProperties()});a.addEventListener(a.viewer,Autodesk.Viewing.SHOW_EVENT,function(b){a.isDirty=!0;a.requestProperties()});this.currentNodeIds=a.viewer.getSelection();0===this.currentNodeIds.length?this.currentNodeIds=a.viewer.getIsolatedNodes():this.isSelection=!0};
Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.setTitle=function(a,b){a||(a="Object Properties",b=b||{},b.localizeTitle=!0);Autodesk.Viewing.UI.PropertyPanel.prototype.setTitle.call(this,a,b)};Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.setVisible=function(a){Autodesk.Viewing.UI.DockingPanel.prototype.setVisible.call(this,a);this.requestProperties()};
Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.visibilityChanged=function(){Autodesk.Viewing.UI.DockingPanel.prototype.visibilityChanged.call(this);this.isVisible()&&this.requestProperties()};Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.requestProperties=function(){this.isVisible()&&this.isDirty&&(0<this.currentNodeIds.length?this.setNodeProperties(this.currentNodeIds[this.currentNodeIds.length-1]):this.showDefaultProperties(),this.isDirty=!1)};
Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.setNodeProperties=function(a){var b=this;this.propertyNodeId=a;b.viewer.getProperties(a,function(a){b.setTitle(a.name);b.setProperties(a.properties);b.highlight(b.viewer.searchText);b.resizeToContent();if(b.isVisible()){var f=b.viewer.toolController;a=f.lastClickX;var f=f.lastClickY,d=b.container.getBoundingClientRect(),g=d.left,h=d.top,k=d.width,d=d.height,l=b.viewer.canvas.getBoundingClientRect(),n=l.left,q=l.top,m=l.width,l=l.height;g<=
a&&a<g+k&&h<=f&&f<h+d&&(a<g+k/2&&a+k<n+m?(b.container.style.left=Math.round(a-n)+"px",b.container.dockRight=!1):n<=a-k?(b.container.style.left=Math.round(a-n-k)+"px",b.container.dockRight=!1):a+k<n+m?(b.container.style.left=Math.round(a-n)+"px",b.container.dockRight=!1):f+d<q+l?(b.container.style.top=Math.round(f-q)+"px",b.container.dockBottom=!1):q<=f-d&&(b.container.style.top=Math.round(f-q-d)+"px",b.container.dockBottom=!1))}})};
Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.showDefaultProperties=function(){var a=this.viewer.model.getRootId();a?this.setNodeProperties(a):(this.propertyNodeId=null,this.setTitle("Model Properties",{localizeTitle:!0}),Autodesk.Viewing.UI.PropertyPanel.prototype.showDefaultProperties.call(this))};Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.areDefaultPropertiesShown=function(){var a=this.viewer.model.getRootId();return this.propertyNodeId===a};
Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.uninitialize=function(){Autodesk.Viewing.UI.PropertyPanel.prototype.uninitialize.call(this);this.viewer=null};Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.onCategoryClick=function(a,b){Autodesk.Viewing.UI.PropertyPanel.prototype.onCategoryClick.call(this,a,b);this.viewer.getDimensions();this.resizeToContent()};
Autodesk.Viewing.Extensions.ViewerPropertyPanel.prototype.onCategoryIconClick=function(a,b){Autodesk.Viewing.UI.PropertyPanel.prototype.onCategoryIconClick.call(this,a,b);this.viewer.getDimensions();this.resizeToContent()};AutodeskNamespace("Autodesk.Viewing.Extensions");Autodesk.Viewing.Extensions.ViewerLayersPanel=function(a){var b=a.container;Autodesk.Viewing.UI.LayersPanel.call(this,a,b,b.id+"ViewerLayersPanel")};Autodesk.Viewing.Extensions.ViewerLayersPanel.prototype=Object.create(Autodesk.Viewing.UI.LayersPanel.prototype);
Autodesk.Viewing.Extensions.ViewerLayersPanel.prototype.constructor=Autodesk.Viewing.Extensions.ViewerLayersPanel;Autodesk.Viewing.Extensions.ViewerPanelMixin.call(Autodesk.Viewing.Extensions.ViewerLayersPanel.prototype);Autodesk.Viewing.Extensions.ViewerLayersPanel.prototype.onClick=function(a,b){this.isMac&&b.ctrlKey||this.setLayerVisible(a,!(b.shiftKey||b.metaKey||b.ctrlKey))};
Autodesk.Viewing.Extensions.ViewerLayersPanel.prototype.onRightClick=function(a,b){this.setLayerVisible(a,!(b.shiftKey||b.metaKey||b.ctrlKey))};Autodesk.Viewing.Extensions.ViewerLayersPanel.prototype.onImageClick=function(a,b){this.isMac&&b.ctrlKey||this.setLayerVisible(a)};Autodesk.Viewing.Extensions.ViewerLayersPanel.prototype.onTitleClick=function(a){this.viewer.setLayerVisible(null,!0)};Autodesk.Viewing.Extensions.ViewerLayersPanel.prototype.onTitleDoubleClick=function(a){this.viewer.fitToView()};
AutodeskNamespace("Autodesk.Viewing.Extensions");Autodesk.Viewing.Extensions.ViewerSettingTab={Navigation:"navigationtab",Performance:"performancetab"};
Autodesk.Viewing.Extensions.ViewerSettingsPanel=function(a,b){this.viewer=a;this.is3dMode="3d"===b;Autodesk.Viewing.UI.SettingsPanel.call(this,a.container,"ViewerSettingsPanel","Settings",{width:340,heightAdjustment:155});this.addTab("navigationtab","Navigation and selection",{className:"navigation"});this.addTab("performancetab","Performance and appearance",{className:"performance"});this.restoreDiv=document.createElement("div");this.restoreDiv.className="viewer-restore-defaults";this.restoreDiv.setAttribute("data-i18n",
"Restore settings defaults");this.restoreDiv.textContent=Autodesk.Viewing.i18n.translate("Restore settings defaults");this.addEventListener(this.restoreDiv,"touchstart",touchStartToClick);this.addEventListener(this.restoreDiv,"click",function(){var b=a.model.is2d()?"2d":"3d";a.prefs.reset(b)},!1);this.container.appendChild(this.restoreDiv);this.createNavigationPanel();this.createPerformancePanel()};Autodesk.Viewing.Extensions.ViewerSettingsPanel.prototype=Object.create(Autodesk.Viewing.UI.SettingsPanel.prototype);
Autodesk.Viewing.Extensions.ViewerSettingsPanel.prototype.constructor=Autodesk.Viewing.Extensions.ViewerSettingsPanel;Autodesk.Viewing.Extensions.ViewerPanelMixin.call(Autodesk.Viewing.Extensions.ViewerSettingsPanel.prototype);Autodesk.Viewing.Extensions.ViewerSettingsPanel.prototype.uninitialize=function(){this.viewer=null;Autodesk.Viewing.UI.SettingsPanel.prototype.uninitialize.call(this)};
Autodesk.Viewing.Extensions.ViewerSettingsPanel.prototype.addCheckbox=function(a,b,c,f,d){var g=this.viewer,h=g.prefs[d];a=Autodesk.Viewing.UI.SettingsPanel.prototype.addCheckbox.call(this,a,b,"boolean"===typeof h?h:c,function(a){g.prefs.set(d,a);f(a)});var k=this.getControl(a);k.saveKey=d;g.prefs.addListeners(d,function(a){k.setValue(a)},function(a){k.setValue(a);f(a)});return k};
Autodesk.Viewing.Extensions.ViewerSettingsPanel.prototype.removeCheckbox=function(a){this.viewer.prefs.removeListeners(a.saveKey);this.removeEventListener(a,"change",a.changeListener);return Autodesk.Viewing.UI.SettingsPanel.prototype.removeCheckbox.call(this,a)};
Autodesk.Viewing.Extensions.ViewerSettingsPanel.prototype.createNavigationPanel=function(){var a=this.viewer,b=Autodesk.Viewing.Extensions.ViewerSettingTab.Navigation;this.is3dMode&&(this.addCheckbox(b,"Show ViewCube",!0,function(b){a.displayViewCube(b)},"viewCube"),this.addCheckbox(b,"ViewCube acts on pivot",!1,function(b){a.setUsePivotAlways(b)},"alwaysUsePivot"),this.addCheckbox(b,"Zoom towards pivot",!1,function(b){a.setZoomTowardsPivot(b)},"zoomTowardsPivot"),this.addCheckbox(b,"Set pivot with left mouse button",
!1,function(b){a.setClickToSetCOI(b)},"clickToSetCOI"),this.addCheckbox(b,"Fusion style orbit",!1,function(b){b?a.loadExtension("Autodesk.Viewing.FusionOrbit",null):a.unloadExtension("Autodesk.Viewing.FusionOrbit",null)},"fusionOrbit"));this.addCheckbox(b,"Reverse mouse zoom direction",!1,function(b){a.setReverseZoomDirection(b)},"reverseMouseZoomDir");this.is3dMode&&this.addCheckbox(b,"Orbit past world poles",!0,function(b){a.setOrbitPastWorldPoles(b)},"orbitPastWorldPoles");this.addCheckbox(b,"Open properties on select",
!0,function(b){a.setPropertiesOnSelect(b)},"openPropertiesOnSelect");this.addCheckbox(b,"Left handed mouse setup",!1,function(b){a.setUseLeftHandedInput(b)},"leftHandedMouseSetup")};
Autodesk.Viewing.Extensions.ViewerSettingsPanel.prototype.createPerformancePanel=function(){var a=this.viewer,b=Autodesk.Viewing.Extensions.ViewerSettingTab.Performance;this.is3dMode&&(this.ghosthiddenChkBoxId=this.addCheckbox(b,"Ghost hidden objects",!0,function(b){a.setGhosting(b)},"ghosting"),this.optimizeNavigationhkBoxId=this.addCheckbox(b,"Smooth navigation",isMobileDevice(),function(b){a.setOptimizeNavigation(b)},"optimizeNavigation"),this.antialiasingChkBoxId=this.addCheckbox(b,"Anti-aliasing",
!0,function(b){a.setQualityLevel(a.prefs.ambientShadows,b)},"antialiasing"),this.ambientshadowsChkBoxId=this.addCheckbox(b,"Ambient shadows",!0,function(b){a.setQualityLevel(b,a.prefs.antialiasing)},"ambientShadows"),this.groundShadowChkBoxId=this.addCheckbox(b,"Ground shadow",!0,function(b){a.setGroundShadow(b)},"groundShadow"),this.groundReflectionChkBoxId=this.addCheckbox(b,"Ground reflection",!0,function(b){a.setGroundReflection(b)},"groundReflection"));this.progressiveRenderChkBoxId=this.addCheckbox(b,
"Progressive model display",!0,function(b){a.setProgressiveRendering(b)},"progressiveRendering")};
Autodesk.Viewing.Extensions.ViewerSettingsPanel.prototype.syncUI=function(){var a=this.viewer,b=this.getControl(this.antialiasingChkBoxId);b&&b.setValue(a.prefs.antialiasing);(b=this.getControl(this.ambientshadowsChkBoxId))&&b.setValue(a.prefs.ambientShadows);(b=this.getControl(this.groundShadowChkBoxId))&&b.setValue(a.prefs.groundShadow);(b=this.getControl(this.groundReflectionChkBoxId))&&b.setValue(a.prefs.groundReflection);(b=this.getControl(this.progressiveRenderChkBoxId))&&b.setValue(a.prefs.progressiveRendering);
(b=this.getControl(this.ghosthiddenChkBoxId))&&b.setValue(a.prefs.ghosting)};AutodeskNamespace("Autodesk.Viewing.Extensions");Autodesk.Viewing.Extensions.ViewerObjectContextMenu=function(a){Autodesk.Viewing.UI.ObjectContextMenu.call(this,a)};Autodesk.Viewing.Extensions.ViewerObjectContextMenu.prototype=Object.create(Autodesk.Viewing.UI.ObjectContextMenu.prototype);Autodesk.Viewing.Extensions.ViewerObjectContextMenu.prototype.constructor=Autodesk.Viewing.Extensions.ViewerObjectContextMenu;
Autodesk.Viewing.Extensions.ViewerObjectContextMenu.prototype.buildMenu=function(a,b){var c=this,f=[],d=this.viewer.model.is2d();!d&&b.hasSelected&&(f.push({title:"Isolate",target:function(){var a=c.viewer.getSelection();c.viewer.clearSelection();c.viewer.isolate(a)}}),b.hasVisible&&f.push({title:"Hide Selected",target:function(){var a=c.viewer.getSelection();c.viewer.clearSelection();c.viewer.hide(a)}}),b.hasHidden&&f.push({title:"Show Selected",target:function(){var a=c.viewer.getSelection();c.viewer.clearSelection();
c.viewer.show(a)}}));d?f.push({title:"Show All Layers",target:function(){c.viewer.setLayerVisible(null,!0)}}):f.push({title:"Show All Objects",target:function(){c.viewer.showAll()}});!d&&b.hasSelected&&f.push({title:"Focus",target:function(){var a=c.viewer.getSelection();c.viewer.fitToView(a)}});b.hasSelected&&f.push({title:"Clear Selection",target:function(){c.viewer.clearSelection()}});return f};"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.CAM360");
Autodesk.Viewing.Extensions.CAM360.CAM360Extension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)};Autodesk.Viewing.Extensions.CAM360.CAM360Extension.prototype=Object.create(Autodesk.Viewing.Extension.prototype);Autodesk.Viewing.Extensions.CAM360.CAM360Extension.prototype.constructor=Autodesk.Viewing.Extensions.CAM360.CAM360Extension;
Autodesk.Viewing.Extensions.CAM360.CAM360Extension.prototype.load=function(){function a(){b.impl.setLightPreset(0,!0);b.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,a)}var b=this.viewer,c=new Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel(this.viewer,"CAM Model Structure Loading",this.options);b.setModelStructurePanel(c);b.hideLines(!1);b.setGhosting(!1);b.setQualityLevel(!1,!0);b.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,a);return!0};
Autodesk.Viewing.Extensions.CAM360.CAM360Extension.prototype.unload=function(){this.viewer.setModelStructurePanel(null)};Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.CAM360",Autodesk.Viewing.Extensions.CAM360.CAM360Extension);"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.CAM360");Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel=function(a,b,c){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.call(this,a,b,c);this.viewer=a};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype=Object.create(Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype);Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.constructor=Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel;
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.sortCamNodes=function(a,b){function c(a,b){d.viewer.getProperties(a,function(c){a:{c=c.properties;for(var f=0;f<c.length;++f){var g=c[f];if("9429B915-D020-4CEB-971B-6ADD0A5D4BFA"===g.displayName){c=g.displayValue;break a}}c=null}c?("CAM_Setup"==c?d.camSetupNodes.push(a):"CAM_Operation"==c?d.camOperationNodes.push(a):"CAM_Tool"===c?d.camToolNodes.push(a):"CAM_Stock"===c?d.camStockNodes.push(a):"CAM_Folder"==c&&d.camFolderNodes.push(a),
d.camNodes.push(a)):d.camModelNodes.push(a);b()},function(a,c,d){b()})}function f(){0<g.length?c(g.shift(),f):b()}this.camNodes=[];this.camModelNodes=[];this.camSetupNodes=[];this.camStockNodes=[];this.camOperationNodes=[];this.camToolNodes=[];this.camFolderNodes=[];var d=this,g=[];a.enumNodeChildren(a.getRootId(),function(a){g.push(a)},!0);g.shift();f()};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.setModel=function(a,b){var c=this;c.sortCamNodes(a,function(){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.setModel.call(c,a,b);c.SetCAMNodeVisible(!1);c.setVisible(!0);c.ExpandSetupNodes();c.resizeToContent()})};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.initialize=function(){function a(c){b.SetCAMNodeVisible(!1);b.removeEventListener(b.viewer,Autodesk.Viewing.GEOMETRY_LOADED_EVENT,a)}Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.initialize.call(this);var b=this;this.viewer.model&&this.viewer.model.isLoadDone()||b.addEventListener(b.viewer,Autodesk.Viewing.GEOMETRY_LOADED_EVENT,a);b.addEventListener(b.viewer,Autodesk.Viewing.SHOW_EVENT,function(a){if(a=a.nodeIdArray)for(var f=
0;f<a.length;f++)b.setCamNodeVisibility(a[f])});b.addEventListener(b.viewer,Autodesk.Viewing.SELECTION_CHANGED_EVENT,function(a){if(a=a.nodeArray)for(var f=0;f<a.length;f++)b.HideHightlightCAMNode(a[f])});b.addEventListener(b.viewer,Autodesk.Viewing.ISOLATE_EVENT,function(a){if(a=a.nodeIdArray)if(0==a.length)b.SetModelVisible(),b.SetCAMNodeVisible(!0);else for(var f=0;f<a.length;f++)b.setCamNodeVisibility(a[f])})};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.IsCAMNode=function(a){return-1!==this.camNodes.indexOf(a)};Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.IsCAMSetupNode=function(a){return-1!==this.camSetupNodes.indexOf(a)};Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.IsCAMStockNode=function(a){return-1!==this.camStockNodes.indexOf(a)};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.IsCAMToolNode=function(a){return-1!==this.camToolNodes.indexOf(a)};Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.IsCAMOperationNode=function(a){return-1!==this.camOperationNodes.indexOf(a)};Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.IsCAMFolderNode=function(a){return-1!==this.camFolderNodes.indexOf(a)};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.shouldInclude=function(a){return!this.IsCAMStockNode(a)};Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.isGroupNode=function(a){return this.IsCAMOperationNode(a)?!1:Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.isGroupNode.call(this,a)};Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.setNodeVisibility=function(a,b){b?this.viewer.show(a):this.viewer.hide(a)};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.SetModelVisible=function(){if(this.camModelNodes)for(var a=0;a<this.camModelNodes.length;a++)this.setNodeVisibility(this.camModelNodes[a],!0)};Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.SetCAMNodeVisible=function(a){if(this.camNodes){for(var b=0;b<this.camNodes.length;b++)this.setNodeVisibility(this.camNodes[b],a);this.SetToolNodeVisible(!1)}};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.SetToolNodeVisible=function(a){if(this.camToolNodes)for(var b=0;b<this.camToolNodes.length;b++)this.setNodeVisibility(this.camToolNodes[b],a)};Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.HideHightlightNode=function(a){var b=this.viewer.impl,c=this;c.instanceTree.enumNodeFragments(a,function(a){b.highlightFragment(c.model,a,!1,!0)},!0)};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.HideHightlightCAMNode=function(a){var b=this.IsCAMSetupNode(a),c=this.IsCAMOperationNode(a),f=this.IsCAMFolderNode(a),d=this;d.instanceTree.enumNodeChildren(a,function(a){b?d.IsCAMStockNode(a)||d.HideHightlightNode(a):c?d.IsCAMToolNode(a)&&d.HideHightlightNode(a):f&&d.HideHightlightNode(a)},!1)};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.setCamNodeVisibility=function(a){var b=this.IsCAMSetupNode(a),c=this.IsCAMOperationNode(a),f=this.IsCAMFolderNode(a),d=this;b?this.instanceTree.enumNodeChildren(a,function(a){var b=d.IsCAMStockNode(a);d.setNodeVisibility(a,b)}):c?this.instanceTree.enumNodeChildren(a,function(a){d.IsCAMToolNode(a)&&d.setNodeVisibility(a,!1)}):f&&this.instanceTree.enumNodeChildren(a,function(a){d.setNodeVisibility(a,!1)})};
Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.onClick=function(a,b){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.onClick.call(this,a,b);this.SetModelVisible();this.setCamNodeVisibility(a);this.viewer.fitToView()};Autodesk.Viewing.Extensions.CAM360.CAMModelStructurePanel.prototype.ExpandSetupNodes=function(){if(this.camSetupNodes)for(var a=0;a<this.camSetupNodes.length;a++)this.tree.setCollapsed(this.camSetupNodes[a],!1)};"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360");
Autodesk.Viewing.Extensions.Fusion360.AnimationExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b);this.viewer=a;this.animTools=null;this.animToolsId="animationTools";this.playButton=null;this.prevExplodeValue=0;this.prevAnimationTime=-1};Autodesk.Viewing.Extensions.Fusion360.AnimationExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype);Autodesk.Viewing.Extensions.Fusion360.AnimationExtension.prototype.constructor=Autodesk.Viewing.Extensions.Fusion360.AnimationExtension;
Autodesk.Viewing.Extensions.Fusion360.AnimationExtension.prototype.load=function(){function a(a,b){b?(a.setIcon("toolbar-animationPlayIcon"),a.setToolTip("Play")):(a.setIcon("toolbar-animationPauseIcon"),a.setToolTip("Pause"))}function b(){l.toolbar.removeClass("toolbar-animationMenuplacer");k.animTools.setVisible(!1)}function c(a,b){l.model.is2d()||0===l.getExplodeScale()||(k.prevExplodeValue=l.explodeslider.value,b&&(l.explodeslider.value=a),l.explode(a))}function f(a){var b=a.value;a.style.background=
"-webkit-linear-gradient(left,#ffffff "+b+"%, #393939 "+b+"%)";a.style.background="-moz-linear-gradient(left,#ffffff "+b+"%, #393939 "+b+"%)";a.style.background="-ms-linear-gradient(left,#ffffff "+b+"%, #393939 "+b+"%)";a.style.background="-o-linear-gradient(left,#ffffff "+b+"%, #393939 "+b+"%)";a.style.background="linear-gradient(to right,#ffffff "+b+"%, #393939 "+b+"%)"}function d(a){var b="";0>a&&(b="-",a=-a);var c=~~(a/3600),d=~~(a%3600/60);a%=60;0<c&&(b+=c+":"+(10>d?"0":""));return b=b+(d+":"+
(10>a?"0":""))+a.toFixed(2)}function g(m){l.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,g);k.toolbar=new q.ToolBar("animation-toolbar");k.toolbar.addClass("toolbar-animationSubtoolbar");l.container.appendChild(k.toolbar.container);k.animTools=new q.ControlGroup(k.animToolsId);k.animTools.setVisible(!1);k.toolbar.addControl(k.animTools);k.playButton=new q.Button("toolbar-animationPlay");k.playButton.setToolTip("Play");k.playButton.onClick=function(b){c(0);var g=l.impl.keyFrameAnimator;
void 0!==g&&g&&(0<k.prevAnimationTime&&(g.goto(k.prevAnimationTime),k.prevAnimationTime=-1),g.play(0,function(b){t.value=b;n.value=d(g.currentTime);B.value=d(g.currentTime-g.duration);100<=b&&a(k.playButton,!0);f(t)}),a(k.playButton,g.isPaused),l.toolbar.addClass("toolbar-animationMenuplacer"),k.animTools.setVisible(!0),k.animTools.isPositionAdjusted||(h(),k.animTools.isPositionAdjusted=!0))};k.playButton.setIcon("toolbar-animationPlayIcon");l.modelTools.addControl(k.playButton);k.onExplodeChange=
function(){var c=l.impl.keyFrameAnimator;void 0!==c&&c&&(0!==c.currentTime&&(k.prevAnimationTime=c.currentTime,c.goto(0)),a(k.playButton,!0));b()};l.addEventListener(Autodesk.Viewing.EXPLODE_CHANGE_EVENT,k.onExplodeChange);l.modelTools.resetModelButton&&(l.modelTools.resetModelButton.onClick=function(b){l.showAll();b=l.impl.keyFrameAnimator;void 0!==b&&b&&(b.goto(0),t.value=0,n.value=d(0),B.value=d(-b.duration),a(k.playButton,!0));c(0,!0);f(t)});k.animTools.backwardButton=new q.Button("toolbar-animationBackward");
k.animTools.backwardButton.setToolTip("Previous keyframe");k.animTools.backwardButton.onClick=function(b){b=l.impl.keyFrameAnimator;void 0!==b&&b&&(b.prev(),t.value=0<b.duration?b.currentTime/b.duration*100:0,n.value=d(b.currentTime),B.value=d(b.currentTime-b.duration),a(k.playButton,b.isPaused),f(t))};k.animTools.backwardButton.addClass("toolbar-animationButton");k.animTools.backwardButton.setIcon("toolbar-animationBackwardIcon");k.animTools.addControl(k.animTools.backwardButton);k.animTools.forwardButton=
new q.Button("toolbar-animationForward");k.animTools.forwardButton.setToolTip("Next keyframe");k.animTools.forwardButton.onClick=function(b){b=l.impl.keyFrameAnimator;void 0!==b&&b&&(b.next(),t.value=0<b.duration?b.currentTime/b.duration*100:0,n.value=d(b.currentTime),B.value=d(b.currentTime-b.duration),a(k.playButton,b.isPaused),f(t))};k.animTools.forwardButton.addClass("toolbar-animationButton");k.animTools.forwardButton.setIcon("toolbar-animationForwardIcon");k.animTools.addControl(k.animTools.forwardButton);
k.animTools.timeText=new q.Control("toolbar-animationTimeLapse");var n=document.createElement("input");n.type="text";n.value="0";n.className="animationTimeLapse";n.disabled=!0;k.animTools.timeText.container.appendChild(n);k.animTools.timeText.addClass("toolbar-animationButton");k.animTools.addControl(k.animTools.timeText);k.animTools.timeline=new q.Control("toolbar-animationTimeline");var t=k.animTools.input=document.createElement("input");t.type="range";t.value="0";t.className="animationTimeline";
k.animTools.timeline.container.appendChild(t);t.addEventListener("input",function(b){b=l.impl.keyFrameAnimator;if(void 0!==b&&b){var c=t.value*b.duration/100;n.value=d(c);B.value=d(c-b.duration);b.goto(c);a(k.playButton,b.isPaused);f(t)}});var r=document.createElement("div");r.className="adsk-control-tooltip";r.textContent=Autodesk.Viewing.i18n.translate("Click-drag to scrub");k.animTools.timeline.container.appendChild(r);t.addEventListener("mouseover",function(a){a.target===t&&(r.style.visibility=
"visible")});t.addEventListener("mouseout",function(a){a.target===t&&(r.style.visibility="hidden")});k.animTools.timeline.addClass("toolbar-animationButton");k.animTools.timeline.addClass("toolbar-animationTimeline");k.animTools.addControl(k.animTools.timeline);k.animTools.timeLeftText=new q.Control("toolbar-animationRemainingTime");var B=document.createElement("input");B.type="text";B.value="0";B.className="animationTimeLapse";B.disabled=!0;k.animTools.timeLeftText.container.appendChild(B);k.animTools.timeLeftText.addClass("toolbar-animationButton");
k.animTools.addControl(k.animTools.timeLeftText);k.animTools.closeButton=new q.Button("toolbar-animationClose");k.animTools.closeButton.setToolTip("Close animation timeline");k.animTools.closeButton.onClick=function(a){b()};k.animTools.closeButton.setIcon("toolbar-animationCloseIcon");k.animTools.closeButton.addClass("toolbar-animationButton");k.animTools.addControl(k.animTools.closeButton);k.onEscape=function(c){c=l.impl.keyFrameAnimator;void 0!==c&&c&&(c.isPaused?b():c.pause(),a(k.playButton,c.isPaused))};
l.addEventListener(Autodesk.Viewing.ESCAPE_EVENT,k.onEscape);k.onCameraChange=function(){if(l.toolController.cameraUpdated){var a=l.impl.keyFrameAnimator;void 0!==a&&a&&(!a.isPlaying||a.isPaused||a.areCameraAnimationsPaused||a.pauseCameraAnimations())}};l.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,k.onCameraChange);k.onResize=function(){l.container.clientWidth<(isTouchDevice()?560:600)?k.toolbar.setCollapsed(!0):(k.toolbar.setCollapsed(!1),h())};l.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,
k.onResize)}function h(){var a=l.toolbar.getDimensions().width,b=l.container.getBoundingClientRect().width;a>b&&(a=l.modelTools.getDimensions().width);b=a-(2*k.animTools.backwardButton.getDimensions().width+3*k.animTools.timeText.getDimensions().width+k.animTools.closeButton.getDimensions().width)+12;k.animTools.input.style.width=b+"px";k.toolbar.container.style.left="calc(50% - "+a/2+"px)"}var k=this,l=this.viewer,n=l.impl,q=Autodesk.Viewing.UI;this.viewer.toolbar&&this.viewer.toolbar.modelTools&&
0<this.viewer.toolbar.modelTools.getNumberOfControls()?g():this.viewer.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,g);n.toggleGhosting(!1);return!0};
Autodesk.Viewing.Extensions.Fusion360.AnimationExtension.prototype.unload=function(){var a=this.viewer,b=a.impl.keyFrameAnimator;b&&b.stop();a.impl.keyFrameAnimator=null;this.animTools&&(this.animTools.removeControl(this.animTools.timeText.getId()),this.animTools.removeControl(this.animTools.timeline.getId()),this.animTools.removeControl(this.animTools.timeLeftText.getId()),this.animTools.removeControl(this.animTools.forwardButton.getId()),this.animTools.removeControl(this.animTools.backwardButton.getId()),
this.animTools.removeControl(this.animTools.closeButton.getId()));this.toolbar&&(this.toolbar.removeControl(this.animTools),this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null);(b=a.getToolbar(!1))&&b.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID).removeControl(this.playButton.getId());a.removeEventListener(Autodesk.Viewing.EXPLODE_CHANGE_EVENT,this.onExplodeChange);a.removeEventListener(Autodesk.Viewing.ESCAPE_EVENT,this.onEscape);a.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,
this.onCameraChange);a.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResize);return!0};Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Fusion360.Animation",Autodesk.Viewing.Extensions.Fusion360.AnimationExtension);
function init_WarpShader(){"undefined"===typeof window.WarpShader&&(WarpShader={uniforms:{tDiffuse:{type:"t",value:null},scale:{type:"v2",value:new THREE.Vector2(1,1)},scaleIn:{type:"v2",value:new THREE.Vector2(1,1)},lensCenter:{type:"v2",value:new THREE.Vector2(0,0)},hmdWarpParam:{type:"v4",value:new THREE.Vector4(1,.22,.24,0)},chromAbParam:{type:"v4",value:new THREE.Vector4(.996,-.004,1.014,0)}},defines:{},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = uv;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",
fragmentShader:"uniform sampler2D tDiffuse;\nuniform vec2 scale;\nuniform vec2 scaleIn;\nuniform vec2 lensCenter;\nuniform vec4 hmdWarpParam;\nuniform vec4 chromAbParam;\nvarying vec2 vUv;\nvec4 sampleColor() {\nvec2 uv = (vUv*2.0)-1.0;\nvec2 theta = (uv-lensCenter)*scaleIn;\nfloat rSq = theta.x*theta.x + theta.y*theta.y;\nvec2 rvector = theta*(hmdWarpParam.x + hmdWarpParam.y*rSq + hmdWarpParam.z*rSq*rSq + hmdWarpParam.w*rSq*rSq*rSq);\n  vec2 rBlue = rvector * (chromAbParam.z + chromAbParam.w * rSq);\n  vec2 tcBlue = (lensCenter + scale * rBlue);\n  tcBlue = (tcBlue+1.0)/2.0;\n  if (any(bvec2(clamp(tcBlue, vec2(0.0,0.0), vec2(1.0,1.0))-tcBlue)))\n    return vec4(0.0, 0.0, 0.0, 1.0);\n  vec2 tcGreen = lensCenter + scale * rvector;\n  tcGreen = (tcGreen+1.0)/2.0;\n  vec2 rRed = rvector * (chromAbParam.x + chromAbParam.y * rSq);\n  vec2 tcRed = lensCenter + scale * rRed;\n  tcRed = (tcRed+1.0)/2.0;\n  return vec4(texture2D(tDiffuse, tcRed).r, texture2D(tDiffuse, tcGreen).g, texture2D(tDiffuse, tcBlue).b, 1);\n}\nvoid main() {\nvec4 texel = sampleColor();\ngl_FragColor = texel;\n}"})}
AutodeskNamespace("Autodesk.Viewing.Extensions.Oculus");
Autodesk.Viewing.Extensions.Oculus.StereoRenderContext=function(a){var b,c,f,d,g,h,k,l,n,q,m=a?a.useWarp:!0,p=a&&a.HMD?a.HMD:{hResolution:1920,vResolution:1080,hScreenSize:.12576,vScreenSize:.07074,interpupillaryDistance:.0635,lensSeparationDistance:.0635,eyeToScreenDistance:.041,distortionK:[1,.22,.24,0],chromaAbParameter:[.996,-.004,1.014,0]},t,r,B=1,z=0,F=100,C=1;this.init=function(a,b,c){init_WarpShader();g=a;h=b;k=c;l=g.getPixelRatio();C=p.hResolution/(2*p.vResolution);a=-1-4*(p.hScreenSize/
4-p.lensSeparationDistance/2)/p.hScreenSize;B=p.distortionK[0]+p.distortionK[1]*Math.pow(a,2)+p.distortionK[2]*Math.pow(a,4)+p.distortionK[3]*Math.pow(a,6);F=THREE.Math.radToDeg(2*Math.atan2(p.vScreenSize*B,2*p.eyeToScreenDistance));z=4*(p.hScreenSize/4-p.interpupillaryDistance/2)/p.hScreenSize;a=4*(p.hScreenSize/4-p.lensSeparationDistance/2)/p.hScreenSize;t=new THREE.Vector2(a,0);r=new THREE.Vector2(-a,0);f=new RenderContext;d=new RenderContext;f.settings.sao=d.settings.sao=!1;f.settings.antialias=
d.settings.antialias=!1;f.settings.customPresentPass=d.settings.customPresentPass=m;f.init(g,h/2*B/l,k*B/l);d.init(g,k/2*B/l,k*B/l);this.settings=f.settings;if(m){n=new LmvShaderPass(WarpShader);q=new LmvShaderPass(WarpShader);a=[n,q];for(b=0;2>b;b++)a[b].material.blending=THREE.NoBlending,a[b].material.depthWrite=!1,a[b].material.depthTest=!1,a[b].uniforms.hmdWarpParam.value.set(p.distortionK[0],p.distortionK[1],p.distortionK[2],p.distortionK[3]),a[b].uniforms.chromAbParam.value.set(p.chromaAbParameter[0],
p.chromaAbParameter[1],p.chromaAbParameter[2],p.chromaAbParameter[3]),a[b].uniforms.scaleIn.value.set(1,1/C),a[b].uniforms.scale.value.set(1/B,1*C/B);a[0].uniforms.lensCenter.value.copy(t);a[1].uniforms.lensCenter.value.copy(r)}};this.update=function(a){var b=f.update(a);a=d.update(a);return b||a};this.beginScene=function(a,g,h,k){b=g.clone();c=g.clone();b.aspect=c.aspect=C;b.fov=c.fov=F;var l=1/f.getUnitScale();g=g.target.clone().sub(g.position).cross(g.up).normalize();g.multiplyScalar(.5*p.interpupillaryDistance*
l);b.position.sub(g);c.position.add(g);b.target.sub(g);c.target.add(g);b.toPerspective();c.toPerspective();b.projectionMatrix.elements[12]+=z;c.projectionMatrix.elements[12]-=z;f.beginScene(a,b,h,k);d.beginScene(a,c,h,k)};this.renderScenePart=function(a,b,c,g){f.renderScenePart(a,b,c,g);d.renderScenePart(a,b,c,g)};this.sceneDirty=function(a,b){f.sceneDirty(a,b);d.sceneDirty(a,b)};this.endScene=function(){f.endScene();d.endScene()};this.clearAllOverlays=function(){f.clearAllOverlays();d.clearAllOverlays()};
this.renderOverlays=function(a){f.renderOverlays(a);d.renderOverlays(a)};this.composeFinalFrame=function(a,b){f.composeFinalFrame(a,b,!0);d.composeFinalFrame(a,b,!0);g.setViewport(0,0,h/2,k);f.presentBuffer(n);g.setViewport(h/2,0,h/2,k);d.presentBuffer(q);g.setViewport(0,0,h,k)};this.cleanup=function(){f.cleanup();d.cleanup()};this.setSize=function(a,b,c){h=a;k=b;f.setSize(h/2*B/l,k*B/l,c);d.setSize(h/2*B/l,k*B/l,c);g.setSize(a,b)};this.getMaxAnisotropy=function(){return f.getMaxAnisotropy()};this.hasMRT=
function(){return f.hasMRT()};this.initPostPipeline=function(a,b,c){c=b=a=!1;f.initPostPipeline(a,b,c);d.initPostPipeline(a,b,c)};this.setClearColors=function(a,b){f.setClearColors(a,b);d.setClearColors(a,b)};this.setAOOptions=function(a,b){f.setAOOptions(a,b);d.setAOOptions(a,b)};this.getAORadius=function(){return f.getAORadius()};this.getAOIntensity=function(){return f.getAOIntensity()};this.setTonemapExposureBias=function(a){f.setTonemapExposureBias(a);d.setTonemapExposureBias(a)};this.getExposureBias=
function(){return f.getExposureBias()};this.setTonemapMethod=function(a){f.setTonemapMethod(a);d.setTonemapMethod(a)};this.getToneMapMethod=function(){return f.getToneMapMethod()};this.toggleTwoSided=function(a){f.toggleTwoSided(a);d.toggleTwoSided(a)};this.enter2DMode=function(a){f.enter2DMode(a);d.enter2DMode(a)};this.idAtPixel=function(a,b){console.warn("idAtPixel not implemented in stereo context.");return 0};this.overlayUpdate=function(a){f.overlayUpdate(a);d.overlayUpdate(a)};this.rolloverObjectViewport=
function(a,b){console.warn("rolloverObjectViewport not implemented in stereo context")};this.screenCapture=function(){console.warn("Screen capture not implemented by stereo render context");return null};this.setUnitScale=function(a){f.setUnitScale(a);d.setUnitScale(a)};this.getUnitScale=function(){return f.getUnitScale()}};AutodeskNamespace("Autodesk.Viewing.Extensions.Oculus");
(function(){function a(a){function b(){z.copy(d.matrixWorld);z.elements[12]=0;z.elements[13]=0;z.elements[14]=0;C&&B.set(C[1],C[2],C[3])}function c(){var a=new WebSocket("ws://localhost:8888/ws");a.onopen=function(){console.log("### Oculus Connected ####")};a.onmessage=function(a){a=a.data;try{C=JSON.parse(a)}catch(b){console.log(a)}};a.onclose=function(){console.log("### Oculus Connection Closed ####")};P=a}var d,f=new THREE.Vector3(0,0,0),g=new THREE.Quaternion,t=new THREE.Quaternion,r=new THREE.Matrix4,
B=new THREE.Vector3(0,0,0),z=new THREE.Matrix4,F=new THREE.Matrix4,C,w=0,E=1,A=10,D=-1,I=0,G=0,H=0,K=0,J=0,M=0,L=0,P;h?C=[0,0,0,0,0,0,0,0]:c();this.getNames=function(){return["headtracker"]};this.getName=function(){return"headtracker"};this.activate=function(c){d=a.navigation.getCamera();b();a.model&&(E=1/a.model.getUnitScale(),A=1E-4*a.model.getBoundingBox().size().length())};this.deactivate=function(a){d=null};this.update=function(b){0>D&&(D=b);var c=b-D;d.isPerspective||a.navigation.toPerspective();
if(h){var l=h.getState();C[0]=w+1;l.orientation&&(C[4]=l.orientation.x,C[5]=l.orientation.y,C[6]=l.orientation.z,C[7]=l.orientation.w);l.position&&(C[1]=l.position.x,C[2]=l.position.y,C[3]=l.position.z)}if(C){l=C[0];if(l>w){d.position.sub(f);f.set(C[1],C[2],C[3]);f.sub(B);f.multiplyScalar(E);f.applyMatrix4(z);d.position.add(f);I+=(M-L)*c*.001;t.setFromAxisAngle(d.worldup,I);g.set(C[4],C[5],C[6],C[7]);t.multiply(g);F.makeRotationFromQuaternion(t);r.multiplyMatrices(z,F);var n=r.elements,da=new THREE.Vector3(-n[8],
-n[9],-n[10]),V=d.target.clone().sub(d.position).length();d.up.set(n[4],n[5],n[6]);var n=new THREE.Vector3(n[0],n[1],n[2]),O=da.clone().multiplyScalar((G-K)*c*A);d.position.add(O);c=n.multiplyScalar((J-H)*c*A);d.position.add(c);d.target.set(d.position.x,d.position.y,d.position.z);d.target.add(da.multiplyScalar(V))}w=l}P&&1===P.readyState&&P.send("get\n");D=b;return!0};this.handleSingleClick=function(a,b){return!1};this.handleDoubleClick=function(a,b){return!1};this.handleSingleTap=function(a){return!1};
this.handleDoubleTap=function(a,b){return!1};this.handleKeyDown=function(a,b){var c=!1;switch(b){case 38:case 87:G=1;c=!0;break;case 40:case 83:K=1;c=!0;break;case 37:case 65:H=1;c=!0;break;case 39:case 68:J=1;c=!0;break;case 81:M=1;c=!0;break;case 69:L=1,c=!0}return c};this.handleKeyUp=function(a,c){var d=!1;switch(c){case 38:case 87:G=0;d=!0;break;case 40:case 83:K=0;d=!0;break;case 37:case 65:H=0;d=!0;break;case 39:case 68:J=0;d=!0;break;case 81:M=0;d=!0;break;case 69:L=0;d=!0;break;case 32:b(),
d=!0}return d};this.handleWheelInput=function(a){return!1};this.handleButtonDown=function(a,b){return!1};this.handleButtonUp=function(a,b){return!1};this.handleMouseMove=function(a){return!1};this.handleGesture=function(a,b){return!1};this.handleTouchChange=function(a,b){return!1};this.handleBlur=function(a){return!1};this.handleResize=function(){}}var b=Autodesk.Viewing,c=b.Extensions,f=b.UI,d=c.Oculus,g=null,h=null;d.Oculus=function(a,c){b.Extension.call(this,a,c);this.viewer=a;this.context=null;
this.initialized=!1};d.Oculus.prototype=Object.create(b.Extension.prototype);d.Oculus.prototype.constructor=c.Oculus;d.Oculus.prototype.toggleOculus=function(b){var c=this.viewer;b?this.context||(this.context=new d.StereoRenderContext({useWarp:!g}),c.impl.setUserRenderContext(this.context),c.resize(c.canvas.clientWidth,c.canvas.clientHeight),c.displayViewCube(!1,!1),c.navigation.isPerspective||c.navigation.toPerspective(),g?launchFullscreen(c.impl.canvas,{vrDisplay:g}):launchFullscreen(c.impl.canvas),
this.headTracker||(this.headTracker=new a(c),c.toolController.registerTool(this.headTracker)),c.toolController.activateTool("headtracker")):this.context&&(this.context=null,c.impl.setUserRenderContext(null),c.displayViewCube(c.prefs.get("viewCube"),!1),c.toolController.deactivateTool("headtracker"),exitFullscreen())};d.Oculus.prototype.createUI=function(){var a=this,b=this.viewer;this.oculusButton=new f.Button("toolbar-oculusTool");this.oculusButton.setToolTip("Oculus VR Mode");this.oculusButton.setIcon("oculusIcon");
this.oculusButton.onClick=function(b){a.toggleOculus(!a.context)};b.modelTools.addControl(this.oculusButton)};d.Oculus.prototype.load=function(){function a(c){d.removeEventListener(b.TOOLBAR_CREATED_EVENT,a);f.createUI()}function c(l){for(var p=0;p<l.length;++p)if(l[p]instanceof HMDVRDevice){g=l[p];break}if(g){for(p=0;p<l.length;++p)if(l[p]instanceof PositionSensorVRDevice&&l[p].hardwareUnitId==g.hardwareUnitId){h=l[p];break}g&&h?d.modelTools&&0<d.modelTools.getNumberOfControls()?f.createUI():d.addEventListener(b.TOOLBAR_CREATED_EVENT,
a):stderr("Didn't find a HMD and sensor!");f.initialized=!0}}var d=this.viewer,f=this;navigator.getVRDevices?navigator.getVRDevices().then(c):navigator.mozGetVRDevices?navigator.mozGetVRDevices(c):this.initialized=!0;return!0};d.Oculus.prototype.unload=function(){this.toggleOculus(!1);return!0};b.theExtensionManager.registerExtension("Autodesk.Viewing.Oculus",d.Oculus)})();AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration");
(function(){var a=Autodesk.Viewing,b=a.Private,c=a.Extensions.Collaboration;c.InteractionInterceptor=function(a){this.getNames=function(){return["intercept"]};this.getName=function(){return"intercept"};this.activate=function(a){};this.deactivate=function(a){};this.update=function(a){return!1};this.handleSingleClick=function(a,b){return!1};this.handleDoubleClick=function(a,b){return!1};this.handleSingleTap=function(a){return!1};this.handleDoubleTap=function(a,b){return!1};this.handleKeyDown=function(a,
b){return!1};this.handleKeyUp=function(a,b){return!1};this.handleWheelInput=function(b){a.takeControl();return!1};this.handleButtonDown=function(b,c){a.takeControl();return!1};this.handleButtonUp=function(a,b){return!1};this.handleMouseMove=function(b){a.updatePointer(b);return!1};this.handleGesture=function(b){a.takeControl();return!1};this.handleBlur=function(a){return!1};this.handleResize=function(){}};c.ViewTransceiver=function(c){function d(a){t=!0;a=JSON.parse(a.data.msg);A.restoreState(a);
p.impl.invalidate(!0,!1,!0);t=!1}function g(a){for(var b=0;b<a.length;b++)a[b]=Math.round(1E3*a[b])/1E3}function h(a){var b=a.data.msg;!0===b[1]||B||(b[0]!=z&&(z=b[0],a.data.lastInControl=b[0],m.dispatchEvent({type:"controlChange",channelId:m.channelId,data:a.data})),r=!1,p.navigation.setView((new THREE.Vector3).set(b[2],b[3],b[4]),(new THREE.Vector3).set(b[5],b[6],b[7])),p.navigation.setCameraUpVector((new THREE.Vector3).set(b[8],b[9],b[10])))}function k(a){if(r||B)a=a.camera,a=[a.position.x,a.position.y,
a.position.z,a.target.x,a.target.y,a.target.z,a.up.x,a.up.y,a.up.z],g(a),a.unshift(B),a.unshift(c.getLocalId()),F.sendMessage("camera",a,m.channelId),z!=a[0]&&(z=a[0],m.dispatchEvent({type:"controlChange",channelId:m.channelId,data:{lastInControl:z}}))}function l(a,b,c){a&&!w&&(w=document.createElement("div"),w.classList.add("collabPointer"));a&&!E?(p.container.appendChild(w),E=!0):!a&&E&&(p.container.removeChild(w),E=!1);a&&(w.style.left=b-6+"px",w.style.top=c-6+"px")}function n(a){r||B||(a=a.data.msg,
C.origin.set(a[1],a[2],a[3]),C.direction.set(a[4],a[5],a[6]),a=C.at(p.getCamera().near),a.project(p.getCamera()),a=p.impl.viewportToClient(a.x,a.y),l(!0,a.x,a.y))}function q(a){t||(a=A.getState(D),c.sendMessage("state",JSON.stringify(a),m.channelId))}var m=this,p=this.viewer=null,t=!1,r=!1,B=!1,z,F=this.client=c,C=new THREE.Ray,w=null,E=!1;this.channelId=null;var A,D={seedURN:!1,objectSet:!0,viewport:!1,cutplanes:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}};
this.takeControl=function(){r=!0;l(!1)};this.updatePointer=function(a){r&&(a=p.impl.clientToViewport(a.canvasX,a.canvasY),p.impl.viewportToRay(a,C),a=[C.origin.x,C.origin.y,C.origin.z,C.direction.x,C.direction.y,C.direction.z],g(a),a.unshift(c.getLocalId()),F.sendMessage("pointer",a,m.channelId))};this.connectCamera=function(a){B=!a};this.attach=function(c){p&&this.detach();this.viewer=p=c;A=new b.ViewerState(p);F.addEventListener("cameraChange",h);F.addEventListener("pointerMove",n);F.addEventListener("viewerState",
d);p.hasEventListener(a.CAMERA_CHANGE_EVENT,k)||p.addEventListener(a.CAMERA_CHANGE_EVENT,k);p.hasEventListener(a.SELECTION_CHANGED_EVENT,q)||(p.addEventListener(a.SELECTION_CHANGED_EVENT,q),p.addEventListener(a.ISOLATE_EVENT,q),p.addEventListener(a.HIDE_EVENT,q),p.addEventListener(a.SHOW_EVENT,q),p.addEventListener(a.HIGHLIGHT_EVENT,q),p.addEventListener(a.EXPLODE_CHANGE_EVENT,q),p.addEventListener(a.LAYER_VISIBILITY_CHANGED_EVENT,q),p.addEventListener(a.CUTPLANES_CHANGE_EVENT,q))};this.detach=function(){F&&
(F.removeEventListener("cameraChange",h),F.removeEventListener("viewerState",d));p&&(p.removeEventListener(a.CAMERA_CHANGE_EVENT,k),p.removeEventListener(a.SELECTION_CHANGED_EVENT,q),p.removeEventListener(a.ISOLATE_EVENT,q),p.removeEventListener(a.HIDE_EVENT,q),p.removeEventListener(a.SHOW_EVENT,q),p.removeEventListener(a.HIGHLIGHT_EVENT,q),p.removeEventListener(a.EXPLODE_CHANGE_EVENT,q),p.removeEventListener(a.LAYER_VISIBILITY_CHANGED_EVENT,q),p.removeEventListener(a.CUTPLANES_CHANGE_EVENT,q),A=
this.viewer=p=null)}};c.ViewTransceiver.prototype.constructor=c.ViewTransceiver;Autodesk.Viewing.EventDispatcher.prototype.apply(c.ViewTransceiver.prototype)})();AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration");var avec=Autodesk.Viewing.Extensions.Collaboration;avec.Panel=null;Autodesk.Viewing.startLiveReviewSession=function(){avec.Panel&&avec.Panel.startSession()};Autodesk.Viewing.endLiveReviewSession=function(){avec.Panel&&avec.Panel.endSession()};
(function(){function a(a,d,f,g){this.viewer=a;this.client=d;this.p2p=f;this.viewtx=g;c.UI.DockingPanel.call(this,a.container,"CollabPanel","Live Review");this.container.classList.add("collabPanel");this.container.style.height="auto";this.container.dockRight=!0;this.content=document.createElement("div");this.container.appendChild(this.content);this.content.classList.add("collabPanelContent");this.tableContainer=document.createElement("div");this.tableContainer.classList.add("userListTable","dockingPanelScroll");
this.table=document.createElement("table");this.table.classList.add("tftable");this.tbody=document.createElement("tbody");this.table.appendChild(this.tbody);this.tableContainer.appendChild(this.table);this.content.appendChild(this.tableContainer);this.inviteDiv=document.createElement("div");this.inviteDiv.className="collabBoxOK";this.inviteDiv.style.float="left";this.inviteDiv.style.width="232px";this.inviteDiv.setAttribute("data-i18n","Invite");this.inviteDiv.textContent=Autodesk.Viewing.i18n.translate("Invite");
this.content.appendChild(this.inviteDiv);this.inviteDiv.addEventListener("click",function(c){(new b).start(a.container,function(){document.location.href="mailto:?subject=Please Join My Live Review"},"Invite Others","Email Invite",!0)});this.chatHistory=document.createElement("div");this.chatHistory.classList.add("chatHistory");this.chatHistory.classList.add("textEntry");this.chatHistory.classList.add("dockingPanelScroll");this.content.appendChild(this.chatHistory);this.chatPanel=document.createElement("div");
this.chatPanel.classList.add("chatPanel");this.textInput=document.createElement("input");this.textInput.type="text";this.textInput.classList.add("textEntry");this.textInput.placeholder="Type a message...";this.chatPanel.appendChild(this.textInput);this.content.appendChild(this.chatPanel);this.isCameraConnected=!0;var h=this;this.addEventListener(d,"userListChange",function(a){a.channelId&&a.channelId!==h.viewtx.channelId||(a=h.client.getChannelInfo(h.viewtx.channelId))&&h.updateUsers(a.users)});this.addEventListener(this.viewtx,
"controlChange",function(a){a.channelId===h.viewtx.channelId&&h.updateUserInControl(a.data.lastInControl)});this.addEventListener(d,"chatReceived",function(a){a.channelId===h.viewtx.channelId&&h.updateChatHistory(a)});this.textInput.onkeyup=function(a){h.handleChatInput(a)};this.addEventListener(this.p2p,"remoteStreamAdded",function(a){h.videoPanel||h.createVideoPanel();h.remoteVideo.src=window.URL.createObjectURL(a.data)});this.addEventListener(this.p2p,"localStreamAdded",function(a){h.videoPanel||
h.createVideoPanel();h.localVideo.src=window.URL.createObjectURL(a.data)});this.addEventListener(this.p2p,"remoteHangup",function(a){h.removeVideoPanel()})}function b(){}var c=Autodesk.Viewing,f=c.Extensions,d=c.Private,g=c.UI,h=f.Collaboration;a.prototype=Object.create(c.UI.DockingPanel.prototype);a.prototype.constructor=a;a.prototype.startSession=function(){var a=this;this.isVisible()||(new b).start(this.viewer.container,function(){a.setVisible(!0,!0)},"Start a Live Review","Start Review")};a.prototype.endSession=
function(){this.isVisible()&&(this.setVisible(!1,!0),this.reset())};a.prototype.updateUsers=function(a){for(var b=document.createElement("tbody"),c=0;c<a.length;c++){var d=b.insertRow(-1);d.id=a[c].id;var f=d.insertCell(0);f.style.width="14px";f.style.cursor="default";var g=document.createElement("div");g.classList.add("statusBase");g.classList.add("statusNormal");g.innerHTML="&#9679";f.appendChild(g);d.insertCell(1).textContent=a[c].name}this.table.replaceChild(b,this.tbody);this.tbody=b;this.fixComponentPlacement()};
a.prototype.updateUserInControl=function(a){for(var b=0;b<this.tbody.rows.length;b++){var c=this.tbody.rows[b],d=c.cells[0].childNodes[0];c.id==a?(d.classList.remove("statusNormal"),d.classList.add("statusInControl"),d.innerHTML="&#9784",c.cells[1].style.color="#4CBA36"):(d.classList.remove("statusInControl"),d.classList.add("statusNormal"),d.innerHTML="&#9679",c.cells[1].style.color="#ffffff")}};a.prototype.updateChatHistory=function(a){var b=this.client.getUserById(a.data.from,a.channelId);if("/"!=
a.data.msg.charAt(0)){if(this.chatHistory.lastUser!=b.name){var c=document.createElement("p"),d=document.createElement("div");d.classList.add("heading");d.style.float="left";d.style.fontStyle="normal";d.style.color="#857E7E";d.textContent=b.name;c.appendChild(d);d=document.createElement("div");d.classList.add("heading");d.style.textAlign="right";d.style.fontStyle="normal";d.style.color="#857E7E";d.textContent=(new Date).toLocaleTimeString();c.appendChild(d);this.chatHistory.appendChild(c);this.chatHistory.lastUser=
b.name}else b=document.createElement("br"),this.chatHistory.appendChild(b);b=document.createElement("span");b.classList.add("messageText");b.textContent=a.data.msg;this.chatHistory.appendChild(b);this.chatHistory.scrollTop=this.chatHistory.scrollHeight}};a.prototype.handleChatInput=function(a){13==a.which&&0!=this.textInput.value.length&&(this.client.sendChatMessage(this.textInput.value,this.viewtx.channelId),this.textInput.value="",this.textInput.placeholder="")};a.prototype.fixComponentPlacement=
function(a){a=this.tableContainer.offsetHeight+this.chatPanel.offsetHeight;this.videoPanel&&(a+=this.videoPanel.offsetHeight);this.chatHistory.style.height="calc(100% - "+a+"px)"};a.prototype.createVideoPanel=function(a){this.videoPanel=document.createElement("div");this.videoPanel.classList.add("videoPanel");this.localVideo=document.createElement("video");this.localVideo.autoplay=!0;this.localVideo.muted=!0;this.localVideo.classList.add("videoInset");this.videoPanel.appendChild(this.localVideo);
this.remoteVideo=document.createElement("video");this.remoteVideo.autoplay=!0;this.remoteVideo.classList.add("videoMain");this.videoPanel.appendChild(this.remoteVideo);var b=this;a=document.createElement("div");a.classList.add("dockingPanelClose");a.innerHTML="&times";a.title="End video call";a.onclick=function(a){b.p2p.hangup();b.removeVideoPanel()};this.videoPanel.appendChild(a);this.content.insertBefore(this.videoPanel,this.chatHistory);this.fixComponentPlacement()};a.prototype.removeCollabPrompt=
function(){var a=document.getElementById("collabBox");a&&(a.style.visibility="hidden",this.viewer.container.removeChild(a))};a.prototype.removeVideoPanel=function(){this.videoPanel&&this.content.removeChild(this.videoPanel);this.videoPanel=null};a.prototype.reset=function(a){this.tbody&&(a=document.createElement("tbody"),this.table.replaceChild(a,this.tbody),this.tbody=a);this.chatHistory.textContent="";this.textInput.value="";this.removeVideoPanel();this.removeCollabPrompt()};b.prototype.start=function(a,
b,c,f,g){if(a){var h=document.createElement("div");h.id="collabBox";h.className="collabBox";a.appendChild(h);var t=document.createElement("div");t.className="collabBoxTitle";t.textContent=Autodesk.Viewing.i18n.translate(c,{defaultValue:c});h.appendChild(t);c=document.createElement("span");c.className="collabBoxText";t="Enter your name:";g&&(t="Review URL");c.textContent=Autodesk.Viewing.i18n.translate(t,{defaultValue:t});h.appendChild(c);c=document.createElement("span");c.className="collabBoxInputContainer";
h.appendChild(c);var r=document.createElement("input");r.type="text";r.className="collabBoxInputText";g&&(t=window.location.toString(),t=-1==t.indexOf("?")?t+"?invited=true":t+"&invited=true",Autodesk.Viewing.Private.docItemId&&(t+="&itemid="+Autodesk.Viewing.Private.docItemId),r.value=t+"&doNotRedirect=true");c.appendChild(r);r.onkeyup=function(c){13==c.keyCode&&(h.style.visibility="hidden",a.removeChild(h),d.setUserName(r.value),b())};c=document.createElement("div");c.className="collabBoxClose";
c.innerHTML="&times;";c.addEventListener("click",function(b){h.style.visibility="hidden";a.removeChild(h)});h.appendChild(c);g?(c=document.createElement("span"),c.className="collabBoxText",c.style.marginTop="0px",t="Copy and send this URL to invite others",c.textContent=Autodesk.Viewing.i18n.translate(t,{defaultValue:t})):(c=document.createElement("div"),c.className="collabBoxOK",c.textContent=Autodesk.Viewing.i18n.translate(f,{defaultValue:f}),c.addEventListener("click",function(c){h.style.visibility=
"hidden";a.removeChild(h);""!==r.value.trim()&&d.setUserName(r.value);b()}));h.appendChild(c);h.style.visibility="visible";r.focus();g&&r.select()}};f.Collaboration.Collaboration=function(a,b){c.Extension.call(this,a,b);b&&b.rtc&&b.rtc.disableRTCToolbarButton&&(this.disableRTCToolbarButton=!0);this.viewer=a};f.Collaboration.Collaboration.prototype=Object.create(c.Extension.prototype);f.Collaboration.Collaboration.prototype.constructor=f.Collaboration.Collaboration;f.Collaboration.Collaboration.prototype.initNetwork=
function(a){if(!this.p2p||a)this.viewtx=new h.ViewTransceiver(this.client),this.interceptor=new h.InteractionInterceptor(this.viewtx),this.viewer.toolController.registerTool(this.interceptor),this.p2p=new d.P2PClient(this.client)};f.Collaboration.Collaboration.prototype.createUI=function(){var c=this,h=this.viewer;this.initNetwork(!1);this.panel=new a(this.viewer,this.client,this.p2p,this.viewtx);f.Collaboration.Collaboration.Panel=this.panel;this.collabButton=new g.Button("toolbar-collaborateTool");
this.collabButton.setToolTip("Live review");this.collabButton.setIcon("adsk-icon-live-review");this.collabButton.onClick=function(a){c.panel.isVisible()?(c.panel.setVisible(!1,!0),c.panel.reset()):(new b).start(h.container,function(){c.panel.setVisible(!0,!0)},"Start a Live Review","Start Review")};this.disableRTCToolbarButton&&this.collabButton.setVisible(!1,!0);this.panel.addVisibilityListener(function(a){a?(h.model&&(a=h.model.getData(),c.viewtx.channelId=a.basePath,c.viewtx.attach(h),c.client.connect(c.viewtx.channelId),
c.client.join(c.viewtx.channelId)),h.toolController.activateTool(c.interceptor.getName()),c.collabButton.setState(g.Button.State.ACTIVE),d.logger&&d.logger.log({category:"viewer_rtc_start"})):(d.logger&&c.client.isConnected()&&d.logger.log({category:"viewer_rtc_stop"}),c.p2p.hangup(),c.viewtx.detach(h),c.viewtx.channelId=null,c.client.disconnect(),c.panel.reset(),h.toolController.deactivateTool(c.interceptor.getName()),c.collabButton.setState(g.Button.State.INACTIVE))});h.modelTools.addControl(this.collabButton);
Autodesk.Viewing.Private.getParameterByName("invited")&&(new b).start(h.container,function(){c.panel.setVisible(!0,!0)},"Join a Live Review","Join Review")};f.Collaboration.Collaboration.prototype.close=function(){this.panel.setVisible(!1,!0);this.panel.reset()};f.Collaboration.Collaboration.prototype.load=function(){var a=this.viewer,b=this;d.loadDependency("io","socket.io-1.3.5.js",function(){function c(d){a.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,c);b.createUI()}b.client=d.MessageClient.GetInstance(b.options?
b.options.messageServerURL:void 0);b.client.addEventListener("socketError",function(c){d.ErrorHandler.reportError(a.container,Autodesk.Viewing.ErrorCodes.RTC_ERROR,c.data);b.close()});b.presenceChannelId=window.location.host;b.client.isConnected();a.modelTools?b.createUI():a.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,c)});return!0};f.Collaboration.Collaboration.prototype.unload=function(){var a=this.viewer;this.p2p.hangup();this.viewtx.detach(a);this.client.disconnect();a.toolController.deactivateTool(this.interceptor.getName());
this.panel&&(this.panel.reset(),this.panel.setVisible(!1),this.panel.uninitialize(),this.panel=null);a.modelTools.removeControl(this.collabButton.getId());this.collabButton=null;return!0};c.theExtensionManager.registerExtension("Autodesk.Viewing.Collaboration",f.Collaboration.Collaboration)})();"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.Beeline");Autodesk.Viewing.Extensions.Beeline.BeelineExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)};
Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype);Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.constructor=Autodesk.Viewing.Extensions.Beeline.BeelineExtension;
Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.load=function(){var a=this,b=this.viewer,c=b.getToolbar(!0),f=Autodesk.Viewing.UI;this.tool=new Autodesk.Viewing.Extensions.Beeline.BeelineTool(b.impl,b);b.toolController.registerTool(this.tool);this.createUI(c);var d;this.HOTKEYS_ID="Autodesk.Beeline.Hotkeys";c=[];c.push({keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.CONTROL,Autodesk.Viewing.theHotkeyManager.KEYCODES.ALT],onPress:function(){d=b.getActiveNavigationTool();b.setActiveNavigationTool(a.tool.getName());
return!0},onRelease:function(){b.setActiveNavigationTool(d?d:b.defaultNavigationToolName);return!0}});Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.HOTKEYS_ID,c);this.onToolChanged=function(b){-1!==b.toolName.indexOf("beeline")&&a.beelineButton.setState(b.active?f.Button.State.ACTIVE:f.Button.State.INACTIVE)};b.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged);return!0};
Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.createUI=function(a){var b=Autodesk.Viewing.UI;a=a.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);var c=this.viewer,f=new b.Button("toolbar-beelineTool");f.setToolTip("Walk to");f.setIcon("adsk-icon-walk");f.onClick=function(a){a=f.getState();a===b.Button.State.INACTIVE?c.setActiveNavigationTool("beeline"):a===b.Button.State.ACTIVE&&c.setActiveNavigationTool()};this.beelineButton=f;var d=a.getControl("toolbar-cameraSubmenuTool");d?a.addControl(this.beelineButton,
{index:a.indexOf(d.getId())}):a.addControl(this.beelineButton);var g=this,h=function(){c.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,h);var a=Autodesk.Viewing.Extensions.ViewerSettingTab.Navigation,b=c.getSettingsPanel(!0);g.viewerOption_LookHorId=b.addCheckbox(a,"Reverse horizontal look direction",!1,function(a){c.setReverseHorizontalLookDirection(a)},"reverseHorizontalLookDirection");g.viewerOption_LookVertId=b.addCheckbox(a,"Reverse vertical look direction",!1,function(a){c.setReverseVerticalLookDirection(a)},
"reverseVerticalLookDirection")};this.viewer.getSettingsPanel(!1)?h():this.viewer.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,h)};
Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.unload=function(){var a=this.viewer;a.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged);this.onToolChanged=void 0;Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID);var b=a.getToolbar(!1);b&&b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.beelineButton.getId());this.beelineButton=null;this.viewer.getSettingsPanel(!1).removeCheckbox(this.viewerOption_LookHorId);this.viewer.getSettingsPanel(!1).removeCheckbox(this.viewerOption_LookVertId);
a.getActiveNavigationTool()==this.tool.getName()&&a.setActiveNavigationTool();a.toolController.deregisterTool(this.tool);this.tool=null;return!0};Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Beeline",Autodesk.Viewing.Extensions.Beeline.BeelineExtension);AutodeskNamespace("Autodesk.Viewing.Extensions.Beeline");
Autodesk.Viewing.Extensions.Beeline.BeelineTool=function(a,b){function c(){h.revertToStartState()}function f(a){var b={};b.target=a.target.clone();b.worldup=a.worldup.clone();b.position=a.position.clone();b.up=a.up.clone();for(var c="isPerspective fov zoom aspect left right top bottom".split(" "),d=0;d<c.length;d++)b[c[d]]=a[c[d]];return b}function d(b){var c=new THREE.Vector3(b.x,b.y,1),d=a.hitTestViewport(c.clone(),!1);if(!d||!d.intersectPoint)return[];b=new THREE.Raycaster;var c=c.clone(),f=a.camera,
g=new THREE.Vector3(c.x,c.y,1);c.z=-1;c=c.unproject(f);g=g.unproject(f);g.sub(c).normalize();b.set(n.isPerspective?f.position:c,g);c=[];d=d.fragId instanceof Array?d.fragId:[d.fragId];for(f=0;f<d.length;f++)g=a.getRenderProxy(this.model,d[f]),VBIntersector.meshRayCast(g,b,c);c.sort(function(a,b){return a.distance-b.distance});return c}function g(){n.isPerspective||(n.toPerspective(),q.activatePivot(!1));28<n.getFocalLength()&&n.setFocalLength(28,!0)}var h=this,k=b.container,l=b.autocam,n=b.navigation,
q=b.utilities,m=["beeline"],p=0,t=!1,r=0,B=null,z=null,F=new THREE.Vector3,C=new THREE.Vector3,w=new THREE.Vector3,E=new THREE.Vector3,A=!1,D=new THREE.Vector3,I=new THREE.Vector3,G=null,H=null;this.getNames=function(){return m};this.getName=function(){return m[0]};this.activate=function(a){r=0;b.addEventListener(Autodesk.Viewing.FULLSCREEN_MODE_EVENT,c);l.userLookSpeed=.8;this.showHUDMessage(!0)};this.deactivate=function(){b.removeEventListener(Autodesk.Viewing.FULLSCREEN_MODE_EVENT,c);this.revertToStartState();
this.showHUDMessage(!1)};this.getCursor=function(){return t?"url(data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAQAAADYBBcfAAAACXBIWXMAABYlAAAWJQFJUiTwAAADGGlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjaY2BgnuDo4uTKJMDAUFBUUuQe5BgZERmlwH6egY2BmYGBgYGBITG5uMAxIMCHgYGBIS8/L5UBFTAyMHy7xsDIwMDAcFnX0cXJlYE0wJpcUFTCwMBwgIGBwSgltTiZgYHhCwMDQ3p5SUEJAwNjDAMDg0hSdkEJAwNjAQMDg0h2SJAzAwNjCwMDE09JakUJAwMDg3N+QWVRZnpGiYKhpaWlgmNKflKqQnBlcUlqbrGCZ15yflFBflFiSWoKAwMD1A4GBgYGXpf8EgX3xMw8BSMDVQYqg4jIKAUICxE+CDEESC4tKoMHJQODAIMCgwGDA0MAQyJDPcMChqMMbxjFGV0YSxlXMN5jEmMKYprAdIFZmDmSeSHzGxZLlg6WW6x6rK2s99gs2aaxfWMPZ9/NocTRxfGFM5HzApcj1xZuTe4FPFI8U3mFeCfxCfNN45fhXyygI7BD0FXwilCq0A/hXhEVkb2i4aJfxCaJG4lfkaiQlJM8JpUvLS19QqZMVl32llyfvIv8H4WtioVKekpvldeqFKiaqP5UO6jepRGqqaT5QeuA9iSdVF0rPUG9V/pHDBYY1hrFGNuayJsym740u2C+02KJ5QSrOutcmzjbQDtXe2sHY0cdJzVnJRcFV3k3BXdlD3VPXS8Tbxsfd99gvwT//ID6wIlBS4N3hVwMfRnOFCEXaRUVEV0RMzN2T9yDBLZE3aSw5IaUNak30zkyLDIzs+ZmX8xlz7PPryjYVPiuWLskq3RV2ZsK/cqSql01jLVedVPrHzbqNdU0n22VaytsP9op3VXUfbpXta+x/+5Em0mzJ/+dGj/t8AyNmf2zvs9JmHt6vvmCpYtEFrcu+bYsc/m9lSGrTq9xWbtvveWGbZtMNm/ZarJt+w6rnft3u+45uy9s/4ODOYd+Hmk/Jn58xUnrU+fOJJ/9dX7SRe1LR68kXv13fc5Nm1t379TfU75/4mHeY7En+59lvhB5efB1/lv5dxc+NH0y/fzq64Lv4T8Ffp360/rP8f9/AA0ADzT6lvFdAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAEtSURBVHja7JQxTkJBFEXPQ/xQEDG0ljRYSU1iLN2AtSWlC7Gw04QtGF2ApQVLIDY2hlgIDagJwWCOhf74JXxRYumbaib3ZO7c9zIhq1WBfzAfjJViDWPdYBq/w0pKITjhd7eGJwQkDu2I8rOFHYcmkqgDz4wfoeGZA01BHXtsbSla89ixZsH3an2LtpRUOQde28xFm17PgyPvVK1bl5yYEOtuq3rnyMQCXNJgiiTchuHCnhrGbYBMaXAJULGqlJz54O43bcFdH5xZUqpWJJWW7duza/tDmTWJbbv27Fs2PS2m1iZRNeGcI/aAEevOgCKnbAI7DNjjhUmk1ouf7xgHbLgF3MSzT7wCaxxSiW3hnsf4OngLotj3ILO74CoWTWzOIGcTXab4/6z+CnwbAGjXSZC++vLvAAAAAElFTkSuQmCC), auto":
1>=r?"url(data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAQdJREFUeNq0k0GOgzAMRZ+jHI4VO4410qzam0aCjbsoaS1PUgfoWIqAEPnZ3z8AN0DNWoFfVeUbC0BtrOtaISNhC3tvGkC2P7ZtY1kWgHul90JEtCYTkVqo7O844LPyeZ51RJ5atQ3biZeolFJ0miYd1d4nd5A/gB+g7E++AFB7VqzWIkKkfdW/d27P8RpE4p8jRy7Z9ZBOpSEgRRb0MAv0lmxZNEXJj0IACTvwrfeksJBW9a0Z6NEh+vl4UI6qHzHBJ4nyFQv6YoaG3Ls80X7vTIqS1W+vdWvArfuSG/pplPzTBRy6ybaLkSSHAFcThoCe/c6C81n7jUY6a78rHQigftBnQY8BAEubfpuApyq2AAAAAElFTkSuQmCC), auto":
null};this.update=function(){var a=n.getCamera(),c=t=!1;if(1===r){var d=D.clone().sub(I);if(0!==d.x||0!==d.y){t=!0;I.x+=.7*d.x;I.y+=.7*d.y;var c=n.getWorldUpVector().dot(n.getCameraUpVector()),g=b.prefs.reverseHorizontalLookDirection?-1:1,h=b.prefs.reverseVerticalLookDirection?-1:1;d.x*=0>c?-g:g;d.y*=h;l.sync(n.getCamera());l.look(d);c=!0;G=f(a)}}return c};this.revertToStartState=function(){q.pivotActive(!1);p=0;A=!0};this.attemptFlight=function(a,b){var c=d(a);0<c.length&&(F=c[0].point,C=c[c.length-
1].point,h.fly(1E3,b))};this.fly=function(a,b){q.setPivotPoint(0===b?F:C,!0,!0);g();w=n.getPosition();z=a;switch(b){case 0:E=w.clone().lerp(F,.8);break;case 1:var c=2*l.camera.near,d=C.clone().sub(w).length(),c=c/d;q.setPivotPoint(w.clone().lerp(C,1+10*c),!0,!0);E=w.clone().lerp(C,1+c);break;default:return}p=1;A=!1;B=null;requestAnimationFrame(h.step)};this.step=function(a){var b=n.getCamera();if(!A){if(null===B)G=f(b),B=a;else{var c;a:if(c=G,b.target.equals(c.target)&&b.position.equals(c.position)&&
b.worldup.equals(c.worldup)&&b.up.equals(c.up)){for(var d="isPerspective fov zoom aspect left right top bottom".split(" "),g=0;g<d.length;g++)if(b[d[g]]!==c[d[g]]){c=!1;break a}c=!0}else c=!1;if(!c){h.revertToStartState();return}}a-=B;c=a<z?a/z:1;c=w.clone().lerp(E,c);d=n.getEyeVector();d.multiplyScalar(n.getPivotPoint().sub(n.getPosition()).length()/d.length());n.setView(c,d.add(c));G=f(b);q.activatePivot(!1);a<z?requestAnimationFrame(h.step):h.revertToStartState()}};this.handleGesture=function(a){switch(a.type){case "dragstart":return H=
"drag",this.handleButtonDown(a,0);case "dragmove":return"drag"===H?this.handleMouseMove(a):!1;case "dragend":if("drag"===H)return this.handleButtonUp(a,0),H=null,!0}return!1};this.handleButtonDown=function(a,b){r+=1<<b;return 0===b?(I.x=D.x=a.canvasX,I.y=D.y=a.canvasY,!0):!1};this.handleButtonUp=function(a,b){r-=1<<b;return 0===b?!0:!1};this.handleSingleClick=function(a,b){if(0===b){var c={x:a.normalizedX,y:a.normalizedY};switch(p){case 0:h.attemptFlight(c,0);break;case 1:h.revertToStartState()}}else return this.revertToStartState(),
!1;return!0};this.handleSingleTap=function(a){return this.handleSingleClick(a,0)};this.handleDoubleTap=function(a){return a.pointers&&1===a.pointers.length?(h.attemptFlight({x:a.normalizedX,y:a.normalizedY},1),!0):!1};this.handleDoubleClick=function(a,b){return 0===b?(h.attemptFlight({x:a.normalizedX,y:a.normalizedY},1),!0):!1};this.handleMouseMove=function(a){D.x=a.canvasX;D.y=a.canvasY;return 1===r?(g(),!0):!1};this.handleBlur=function(a){this.revertToStartState();return!1};this.showOrthoWarningMessage=
function(){Autodesk.Viewing.Private.HudMessage.displayMessage(k,{msgTitleKey:"Orthographic View Set",messageKey:"The view is set to Orthographic Beeline",messageDefaultValue:"The view is set to Orthographic. Using this tool will switch to Perspective."})};this.showFocalWarningMessage=function(){Autodesk.Viewing.Private.HudMessage.displayMessage(k,{msgTitleKey:"Long Focal Length View Set",messageKey:"The view is set to a long focal length",messageDefaultValue:"This view has a long focal length. Using this tool will set a short focal length."})};
this.watchCamera=function(a){if(b.toolController.getActiveToolName()===m[0]||b.toolController.getActiveToolName()===m[1]){a=(a=n.getCamera())&&!a.isPerspective;var c=28<n.getFocalLength();a?h.showOrthoWarningMessage():c?h.showFocalWarningMessage():Autodesk.Viewing.Private.HudMessage.dismiss()}};this.showHUDMessage=function(a){var c=n.getCamera(),c=c&&!c.isPerspective,d=28<n.getFocalLength();a&&c?h.showOrthoWarningMessage():a&&d?h.showFocalWarningMessage():Autodesk.Viewing.Private.HudMessage.dismiss();
a?b.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,h.watchCamera):b.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,h.watchCamera)}};"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.DefaultTools");
(function(){function a(a,b,c){return function(){var k=b.getState();k===f.Button.State.INACTIVE?(a.setActiveNavigationTool(c),b.setState(f.Button.State.ACTIVE)):k===f.Button.State.ACTIVE&&(a.setActiveNavigationTool(),b.setState(f.Button.State.INACTIVE))}}var b=Autodesk.Viewing,c=Autodesk.Viewing.Extensions.DefaultTools,f=Autodesk.Viewing.UI;c.NavToolsExtension=function(a,c){b.Extension.call(this,a,c)};c.NavToolsExtension.prototype=Object.create(b.Extension.prototype);c.NavToolsExtension.prototype.constructor=
c.NavToolsExtension;c.NavToolsExtension.prototype.load=function(){var a=this.viewer,c=new b.FovTool(a),f=new b.WorldUpTool(a.impl,a);a.toolController.registerTool(c);a.toolController.registerTool(f);this.createUI();this.initCameraStateMachine();this.initFocalLengthOverlay();return!0};c.NavToolsExtension.prototype.createUI=function(){var c=this.viewer,g=c.getToolbar(!0).getControl(b.TOOLBAR.NAVTOOLSID);g.returnToDefault=function(){};if("3d"===this.options.mode){var h=new f.ComboButton("toolbar-orbitTools");
h.setToolTip("Orbit");h.setIcon("adsk-icon-orbit-constrained");this.createOrbitSubmenu(h);g.addControl(h);g.orbittoolsbutton=h;h.setState(f.Button.State.ACTIVE);g.returnToDefault=function(){h.setState(f.Button.State.ACTIVE)}}var k=new f.Button("toolbar-panTool");k.setToolTip("Pan");k.setIcon("adsk-icon-pan");k.onClick=a(c,k,"pan");g.addControl(k);g.panbutton=k;k=new f.Button("toolbar-zoomTool");k.setToolTip("Zoom");k.setIcon("adsk-icon-zoom");k.onClick=a(c,k,"dolly");g.addControl(k);g.dollybutton=
k;c=new f.ComboButton("toolbar-cameraSubmenuTool");c.setToolTip("Camera interactions");c.setIcon("adsk-icon-camera");this.createCameraSubmenu(c);g.addControl(c);g.camerabutton=c};c.NavToolsExtension.prototype.createOrbitSubmenu=function(c){var g=this.viewer,h=g.getToolbar(!0).getControl(b.TOOLBAR.NAVTOOLSID),k=new f.Button("toolbar-freeOrbitTool");k.setToolTip("Free orbit");k.setIcon("adsk-icon-orbit-free");k.onClick=a(g,k,"freeorbit");c.addControl(k);h.freeorbitbutton=k;k=new f.Button("toolbar-orbitTool");
k.setToolTip("Orbit");k.setIcon("adsk-icon-orbit-constrained");k.onClick=a(g,k,"orbit");c.addControl(k);h.orbitbutton=k;c.onClick=k.onClick};c.NavToolsExtension.prototype.createCameraSubmenu=function(c){var g=this,h=this.viewer,k=h.getToolbar(!0).getControl(b.TOOLBAR.NAVTOOLSID);if(isTouchDevice()){var l=new f.Button("toolbar-homeTool");l.setToolTip("Home");l.setIcon("adsk-icon-home");l.onClick=function(){h.navigation.setRequestHomeView(!0)};c.addControl(l);k.homebutton=l}l=new f.Button("toolbar-fitToViewTool");
l.setToolTip("Fit to view");l.setIcon("adsk-icon-fit-to-view");l.onClick=function(a){h.fitToView("3d"===g.options.mode?h.getSelection():void 0)};c.addControl(l);k.fovbutton=l;"3d"===this.options.mode&&(l=new f.Button("toolbar-focalLengthTool"),l.setToolTip("Focal length"),l.setIcon("adsk-icon-focal-length"),l.onClick=a(h,l,"fov"),c.addControl(l),k.fovbutton=l);l=new f.Button("toolbar-rollTool");l.setToolTip("Roll");l.setIcon("adsk-icon-roll");l.onClick=a(h,l,"worldup");c.addControl(l);k.rollbutton=
l};c.NavToolsExtension.prototype.initCameraStateMachine=function(a){var c=this,f=this.viewer,k=f.getToolbar(!0).getControl(b.TOOLBAR.NAVTOOLSID);this.toolChangedHandler=function(a){"fov"===a.toolName&&c.showFocalLengthOverlay(a.active)};f.addEventListener(b.TOOL_CHANGE_EVENT,this.toolChangedHandler);this.navChangedHandler=function(a){f.getDefaultNavigationToolName()===a.id&&k.returnToDefault()};f.addEventListener(b.NAVIGATION_MODE_CHANGED_EVENT,this.navChangedHandler)};c.NavToolsExtension.prototype.initFocalLengthOverlay=
function(){var a=this.focallength=document.createElement("div");a.className="focallength";var b=document.createElement("table"),c=document.createElement("tbody");b.appendChild(c);a.appendChild(b);this.viewer.container.appendChild(a);b=c.insertRow(-1);c=b.insertCell(0);c.setAttribute("data-i18n","Focal Length");c.textContent=Autodesk.Viewing.i18n.translate("Focal Length");c=b.insertCell(1);c.textContent="";c.style.width="4em";c.style.textAlign="right";this.fovCell=c;a.style.visibility="hidden"};c.NavToolsExtension.prototype.showFocalLengthOverlay=
function(a){function c(a){a?b.Private.HudMessage.displayMessage(q.container,{msgTitleKey:"Orthographic View Set",messageKey:"The view is set to Orthographic",messageDefaultValue:"The view is set to Orthographic. Changing the focal length will switch to Perspective."}):b.Private.HudMessage.dismiss()}function f(a){a&&k();n.focallength&&(n.focallength.style.visibility=a?"visible":"hidden")}function k(){var a=q.getFocalLength();m!==a&&(m=a,n.fovCell.textContent=a.toString()+" mm")}function l(a){k();"fov"===
q.toolController.getActiveToolName()&&(a=(a=q.navigation.getCamera())&&!a.isPerspective,f(!a),c(a))}var n=this,q=this.viewer,m=0,p=q.navigation.getCamera(),p=p&&!p.isPerspective;f(a&&!p);c(a&&p);a?q.addEventListener(b.CAMERA_CHANGE_EVENT,l):q.removeEventListener(b.CAMERA_CHANGE_EVENT,l)};c.NavToolsExtension.prototype.unload=function(){this.destroyUI();return!0};c.NavToolsExtension.prototype.destroyUI=function(){var a=this.viewer,c=a.getToolbar(!1);if(!c)return!0;c=c.getControl(b.TOOLBAR.NAVTOOLSID);
if(!c)return!0;"3d"===this.options.mode&&(c.orbittoolsbutton.subMenu.removeEventListener(f.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,c.orbittoolsbutton.subMenuActiveButtonChangedHandler(c)),c.removeControl(c.orbittoolsbutton.getId()),c.orbittoolsbutton=null);c.removeControl(c.panbutton.getId());c.panbutton=null;c.removeControl(c.dollybutton.getId());c.dollybutton=null;c.camerabutton.subMenu.removeEventListener(f.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,c.camerabutton.subMenuActiveButtonChangedHandler(c));
c.removeControl(c.camerabutton.getId());c.camerabutton=null;a.removeEventListener(b.TOOL_CHANGE_EVENT,this.toolChangedHandler);this.toolChangedHandler=null;a.removeEventListener(b.NAVIGATION_MODE_CHANGED_EVENT,this.navChangedHandler);this.navChangedHandler=null;return!0};b.theExtensionManager.registerExtension("Autodesk.DefaultTools.NavTools",c.NavToolsExtension)})();"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.Measure");
Autodesk.Viewing.Extensions.Measure.MeasureExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)};Autodesk.Viewing.Extensions.Measure.MeasureExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype);Autodesk.Viewing.Extensions.Measure.MeasureExtension.prototype.constructor=Autodesk.Viewing.Extensions.Measure.MeasureExtension;
Autodesk.Viewing.Extensions.Measure.MeasureExtension.prototype.load=function(){function a(){b.createUI()}var b=this,c=this.viewer;this.escapeHotkeyId="Autodesk.Measure.Hotkeys.Escape";if(!c.toolController)return!1;this.tool=new Autodesk.Viewing.Extensions.Measure.MeasureTool(c,{onCloseCallback:function(a){b.enableMeasureTool(!1)}});c.toolController.registerTool(this.tool);this.viewer.toolbar?0<this.viewer.toolbar.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID).getNumberOfControls()?this.createUI():
this.viewer.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a):this.viewer.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a);return!0};Autodesk.Viewing.Extensions.Measure.MeasureExtension.prototype.unload=function(){var a=this.viewer;this.destroyUI();a.toolController.deregisterTool(this.tool);this.tool=null;return!0};
Autodesk.Viewing.Extensions.Measure.MeasureExtension.prototype.enableMeasureTool=function(a){if(this.tool){var b=this.viewer.toolController,c=this.tool.isActive();if(a&&!c)return b.activateTool("measure"),this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0;if(!a&&c)return b.deactivateTool("measure"),this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0}return!1};
Autodesk.Viewing.Extensions.Measure.MeasureExtension.prototype.createUI=function(){var a=Autodesk.Viewing.UI,b=this,c=this.viewer;this.measureToolButton=null;c=c.getToolbar(!0).getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);this.measureToolButton=new a.Button("toolbar-measureTool");this.measureToolButton.setToolTip("Measure");this.measureToolButton.setIcon("adsk-icon-measure");this.measureToolButton.onClick=function(a){b.enableMeasureTool(!b.tool.isActive())};this.onMeasureButtonStateChange=function(c){c.state===
a.Button.State.ACTIVE?b.enableMeasureTool(!0):c.state===a.Button.State.INACTIVE&&b.enableMeasureTool(!1)};this.measureToolButton.addEventListener(a.Button.Event.STATE_CHANGED,this.onMeasureButtonStateChange);c.addControl(this.measureToolButton,{index:0});Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.escapeHotkeyId,[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){return b.enableMeasureTool(!1)}}])};
Autodesk.Viewing.Extensions.Measure.MeasureExtension.prototype.destroyUI=function(){var a=this.viewer;if(!a.model.is2d()){this.measureToolButton&&this.measureToolButton.removeEventListener(Autodesk.Viewing.UI.Button.Event.STATE_CHANGED,this.onMeasureButtonStateChange);if(a=a.getToolbar(!1))if(a=a.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID)){if(this.measureToolButton){var b=a.getControl("toolbar-inspectSubMenu");b?b.removeControl(this.measureToolButton.getId()):a.removeControl(this.measureToolButton.getId())}this.measureToolButton=
null}Autodesk.Viewing.theHotkeyManager.popHotkeys(this.escapeHotkeyId)}};Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Measure",Autodesk.Viewing.Extensions.Measure.MeasureExtension);AutodeskNamespace("Autodesk.Viewing.Extensions.Measure");
Autodesk.Viewing.Extensions.Measure.MeasureTool=function(a,b){function c(){A.updateLabelPositions()}function f(){g.clearMeasurement()}function d(a){var b=this,c=!1,d=null,f=null,k=null,m=null,l=null,p=null,C={first:{},second:{}},w={first:{},second:{}},A={first:{},second:{}},D={xyz:{axis:!1,color:"00CC00"},x:{axis:!0,color:"FF0000"},y:{axis:!0,color:"00FF00"},z:{axis:!0,color:"0000FF"}},G={},L=[];this.showFirstVertex=function(a){var b=this.setScale(a);this.showEndPoint("first",a,b)};this.showSecondVertex=
function(a){var b=this.setScale(a);this.showEndPoint("second",a,b)};this.showEndPoint=function(a,b,c){d||(d=new THREE.MeshPhongMaterial({color:3355647,ambient:3355647,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1}),h.impl.createOverlayScene("MeasureTool-endPoint"));a=C[a];var f=a.mesh;f||(a.geometry=new THREE.SphereGeometry(1),f=a.mesh=new THREE.Mesh(a.geometry,d),h.impl.addOverlay("MeasureTool-endPoint",f));f.scale.x=c;f.scale.y=c;f.scale.z=c;f.position.set(b.x,b.y,b.z);f.visible=!0;h.impl.invalidate(!1,
!1,!0)};this.setScale=function(a){var b=h.navigation,c=b.getCamera(),d=b.getEyeVector(),f=b.getPosition();a=a.clone();c=c.isPerspective?a.sub(f).dot(d.normalize()):b.getEyeVector().length();d=b.getVerticalFov();c=2*c*Math.tan(THREE.Math.degToRad(.5*d));b=b.getScreenViewport();return 5*c/(b.height*(window.devicePixelRatio||1))};this.updateScale=function(){var a=h.impl.overlayScenes["MeasureTool-endPoint"];if(a)for(var a=a.scene,b=0;b<a.children.length;b++){var c=a.children[b];if(c){var d=this.setScale(c.position);
c.scale.x=d;c.scale.y=d;c.scale.z=d}}if(a=h.impl.overlayScenes["MeasureTool-extensionLine"])for(a=a.scene,b=0;b<a.children.length;b++)if(c=a.children[b])d=this.setScale(c.geometry.vertices[0]),c.material.dashSize=4*d,c.material.gapSize=2*d};this.showFirstEdge=function(a,b){this.showEdge("first",a,b)};this.showSecondEdge=function(a,b){this.showEdge("second",a,b)};this.showEdge=function(a,b,c){f||(f=new THREE.LineBasicMaterial({color:3355647,opacity:.5,linewidth:5,depthTest:!1,depthWrite:!1}),h.impl.createOverlayScene("MeasureTool-edge"));
a=w[a];a.line&&h.impl.removeOverlay("MeasureTool-edge",a.line);a.line=new THREE.Line(b,f,THREE.LinePieces);h.impl.addOverlay("MeasureTool-edge",a.line);if(t||E){var d=a.label;d||(d=a.label=document.createElement("div"),d.className="measure-label",h.container.appendChild(d));d.textContent="Length = "+this.getEdgeLength(b);d.classList.toggle("visible",!0);a.intersectPoint=c.clone();this.updateLabelPositions()}};this.showFirstFace=function(a,b){this.showFace("first",a,b)};this.showSecondFace=function(a,
b){this.showFace("second",a,b)};this.showFace=function(a,b,c){k||(k=new THREE.MeshPhongMaterial({color:3355647,ambient:3355647,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),h.impl.createOverlayScene("MeasureTool-face"));a=A[a];a.mesh&&h.impl.removeOverlay("MeasureTool-face",a.mesh);a.mesh=new THREE.Mesh(b,k);h.impl.addOverlay("MeasureTool-face",a.mesh);if(t||E){var d=a.label;d||(d=a.label=document.createElement("div"),d.className="measure-label",h.container.appendChild(d));
d.textContent="Area = "+this.getFaceArea(b);d.classList.toggle("visible",!0);a.intersectPoint=c.clone();this.updateLabelPositions()}};this.drawExtensionFace=function(a){p||(p=new THREE.MeshPhongMaterial({color:10066329,ambient:10066329,opacity:.25,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),h.impl.createOverlayScene("MeasureTool-extensionFace"));a=new THREE.Mesh(a,p);h.impl.addOverlay("MeasureTool-extensionFace",a)};this.getEdgeLength=function(a){var b=0;a=a.vertices;for(var c=
0;c<a.length;c+=2)b+=a[c].distanceTo(a[c+1]);b=Autodesk.Viewing.Private.convertUnits(h.model.getUnitString(),z,b);return Autodesk.Viewing.Private.formatValueWithUnits(b,z,3,F)};this.getFaceArea=function(a){var b=0;a=a.vertices;for(var c=new THREE.Vector3,d=new THREE.Vector3,f=0;f<a.length;f+=3)c.subVectors(a[f+1],a[f]),d.subVectors(a[f+2],a[f]),b+=c.length()*d.length()*Math.sin(c.angleTo(d))/2;b=Autodesk.Viewing.Private.convertUnits(h.model.getUnitString(),z,b,"square");return z?Autodesk.Viewing.Private.formatValueWithUnits(b,
z+"^2",3,F):Autodesk.Viewing.Private.formatValueWithUnits(b,null,3,F)};this.updateLabels=function(){r===SNAP_EDGE?w.first.label.textContent="Length = "+this.getEdgeLength(n):r===SNAP_FACE&&(A.first.label.textContent="Area = "+this.getFaceArea(n));B===SNAP_EDGE?w.second.label.textContent="Length = "+this.getEdgeLength(q):B===SNAP_FACE&&(A.second.label.textContent="Area = "+this.getFaceArea(q))};this.updateLabelPositions=function(){function a(b,c,d){var f=h.navigation.getCamera(),g=h.navigation.getScreenViewport();
b=new THREE.Vector3(b,c,d);b=b.project(f);return{x:Math.round((b.x+1)/2*g.width),y:Math.round((-b.y+1)/2*g.height)}}function b(c){var d=c.p1,f=c.p2,g=a(d.x,d.y,d.z),h=a(f.x,f.y,f.z),d=h.x-g.x,g=h.y-g.y,h=a(f.x,f.y,f.z),f=h.x,h=h.y;c=c.label.getBoundingClientRect();h=0<g?h+4:h-(c.height+4);f=0>d||0<g?f-(c.width+4):f+4;return{x:f,y:h}}function c(b,d){var f=b.p1,g=b.p2,g=a(f.x+(g.x-f.x)/2,f.y+(g.y-f.y)/2,f.z+(g.z-f.z)/2),f=g.x,g=g.y,h=d.p1,k=d.p2,h=a(h.x,h.y,h.z),l=a(k.x,k.y,k.z),k=f-(f+h.x+l.x)/3,h=
g-(g+h.y+l.y)/3,m=b.label.getBoundingClientRect(),l=m.width/2,m=m.height/2,f=f-l,g=g-m;return{x:0<k?f+l:f-l,y:0<h?g+m:g-m}}for(var d in D)if(D.hasOwnProperty(d)){var f=D[d],g=f.label;g&&(f=f.axis?c(f,D.xyz):b(f),g.style.top=f.y+"px",g.style.left=f.x+"px",L.push(g))}G&&(g=G.label)&&(f=b(G),g.style.top=f.y+"px",g.style.left=f.x+"px",L.push(g));for(d in A)A.hasOwnProperty(d)&&(f=A[d],g=f.label,f=f.intersectPoint,g&&f&&(f=a(f.x,f.y,f.z),g.style.top=f.y+"px",g.style.left=f.x+"px",L.push(g)));for(d in w)w.hasOwnProperty(d)&&
(f=w[d],g=f.label,f=f.intersectPoint,g&&f&&(f=a(f.x,f.y,f.z),g.style.top=f.y+"px",g.style.left=f.x+"px",L.push(g)));for(d=0;d<L.length;d++)for(g=0;g<d;g++)this.labelsOverlapDetection(L[g],L[d]);L=[]};this.labelsOverlapDetection=function(a,b){var c=a.getBoundingClientRect(),d=b.getBoundingClientRect();d.top<=c.bottom&&d.bottom>=c.top&&(d.right>=c.left&&d.right<=c.right?b.style.left=parseInt(b.style.left,10)-(d.right-c.left)+"px":d.left>=c.left&&d.left<=c.right?b.style.left=parseInt(b.style.left,10)+
(c.right-d.left)+"px":d.left<=c.left&&d.right>=c.right&&(b.style.left=parseInt(b.style.left,10)+(c.right-d.left)+"px"))};this.drawLine=function(a,d){function f(a,d,g,k,l,m,n){var p=D[a],q=p.line,z=p.label;d=new THREE.Vector3(d,g,k);m=new THREE.Vector3(l,m,n);q&&(h.impl.removeOverlay("MeasureTool-"+a,q),p.line=null);z&&z.classList.remove("visible");0<d.distanceTo(m)&&(l="xyz"===a||!c&&t,q||(p.material=new THREE.LineBasicMaterial({color:parseInt(p.color,16),linewidth:2,depthTest:!1,depthWrite:!1}),
p.overlayName="MeasureTool-"+a,h.impl.createOverlayScene(p.overlayName)),p.material.opacity=t?1:.5,h.impl.clearOverlay(p.overlayName),q=p.geometry=new THREE.Geometry,q.vertices.push(d),q.vertices.push(m),q=p.line=new THREE.Line(q,p.material),h.impl.addOverlay(p.overlayName,q),q.visible=l,p.p1=d,p.p2=m,"xyz"!=a||t)&&(z||(z=p.label=document.createElement("div"),z.className="measure-length","xyz"===a?(q=document.createElement("div"),q.className="measure-length-text",z.appendChild(q)):z.style.pointerEvents=
"none",p.axis&&(z.style.color="#"+p.color,z.style.backgroundColor="transparent",z.textContent=a.toUpperCase()),h.container.appendChild(z)),p.axis||b.updateDistance(),z.classList.toggle("visible",l))}f("xyz",a.x,a.y,a.z,d.x,d.y,d.z);var g=h.navigation.getAlignedUpVector(),k=Math.abs(g.x),l=Math.abs(g.y),g=Math.abs(g.z);g>k&&g>l?(f("x",a.x,a.y,a.z,d.x,a.y,a.z),f("y",d.x,a.y,a.z,d.x,d.y,a.z),f("z",d.x,d.y,a.z,d.x,d.y,d.z)):l>k&&l>g?(f("x",a.x,a.y,a.z,d.x,a.y,a.z),f("z",d.x,a.y,a.z,d.x,a.y,d.z),f("y",
d.x,a.y,d.z,d.x,d.y,d.z)):(f("y",a.x,a.y,a.z,a.x,d.y,a.z),f("z",a.x,d.y,a.z,a.x,d.y,d.z),f("x",a.x,d.y,d.z,d.x,d.y,d.z));this.updateLabelPositions()};this.updateDistance=function(){var a=D.xyz.label;a&&(a.children[0].textContent=g.getDistance("xyz"))};this.updateAngle=function(){var a=G.label;a&&(a.textContent=g.getAngle())};this.drawExtensionLine=function(a,b,c){var d=new THREE.Vector3,f=new THREE.Vector3;d.subVectors(b,a);f.subVectors(c,b);a=d.dot(f);d.subVectors(c,b);a=-a/d.dot(d);d.subVectors(c,
b);d.multiplyScalar(a);d=d.add(b);if(0>a)c=d;else if(1<a)b=c,c=d;else return;l||(l=new THREE.LineDashedMaterial({color:parseInt(D.xyz.color,16),linewidth:2,dashSize:1,gapSize:.5,depthTest:!1}),h.impl.createOverlayScene("MeasureTool-extensionLine"));l.opacity=t?1:.5;d=this.setScale(b);l.dashSize=4*d;l.gapSize=2*d;d=new THREE.Geometry;d.vertices.push(b);d.vertices.push(c);d.computeLineDistances();b=new THREE.Line(d,l);h.impl.addOverlay("MeasureTool-extensionLine",b)};this.drawExtensionLinePointToPoint=
function(a,b){l||(l=new THREE.LineDashedMaterial({color:parseInt(D.xyz.color,16),linewidth:2,dashSize:1,gapSize:.5,depthTest:!1}),h.impl.createOverlayScene("MeasureTool-extensionLine"));l.opacity=t?1:.5;var c=this.setScale(a);l.dashSize=4*c;l.gapSize=2*c;c=new THREE.Geometry;c.vertices.push(a);c.vertices.push(b);c.computeLineDistances();c=new THREE.Line(c,l);h.impl.addOverlay("MeasureTool-extensionLine",c)};this.nearestPointsInSegmentToSegment=function(a,b,c,d){var f=new THREE.Vector3,g=new THREE.Vector3,
h=new THREE.Vector3;f.subVectors(b,a);g.subVectors(d,c);h.subVectors(a,c);d=f.dot(f);var k=f.dot(g),l=g.dot(g),m=f.dot(h),n=g.dot(h),p=d*l-k*k,q,z=p;b=p;.001>p?(q=0,z=1,p=n,b=l):(q=k*n-l*m,p=d*n-k*m,0>q?(q=0,p=n,b=l):q>z&&(q=z,p=n+k,b=l));0>p?(p=0,0>-m?q=0:-m>d?q=z:(q=-m,z=d)):p>b&&(p=b,0>-m+k?q=0:-m+k>d?q=z:(q=-m+k,z=d));d=.001>Math.abs(q)?0:q/z;b=.001>Math.abs(p)?0:p/b;f.multiplyScalar(d);g.multiplyScalar(b);h.add(f);h.sub(g);f.add(a);g.add(c);return[f,g]};this.edgeToEdgeMeasure=function(a,b,c){var d=
I.getEndPointsInEdge(a);a=d[0].clone();var f=d[1].clone(),d=I.getEndPointsInEdge(b);b=d[0].clone();var d=d[1].clone(),g=this.nearestPointInPointToLine(a,b,d),h=this.nearestPointInPointToLine(f,b,d),k=new THREE.Vector3,l=new THREE.Vector3;c=this.nearestPointInPointToLine(c,a,f);if(a.distanceTo(b)<a.distanceTo(d)&&a.distanceTo(b)<f.distanceTo(b)&&a.distanceTo(b)<f.distanceTo(d)){k.subVectors(a,f);l.subVectors(b,d);k.normalize();l.normalize();if(this.isEqualVectors(k,l,.01)||this.isInverseVectors(k,
l,.01))return this.drawLine(a,g),this.drawExtensionLine(a,b,d),[a,g];g=this.angleVectorToVector(k,l);this.drawAngleLineToLine(a,c,b,d,g);return g}if(a.distanceTo(d)<a.distanceTo(b)&&a.distanceTo(d)<f.distanceTo(b)&&a.distanceTo(d)<f.distanceTo(d)){k.subVectors(a,f);l.subVectors(d,b);k.normalize();l.normalize();if(this.isEqualVectors(k,l,.01)||this.isInverseVectors(k,l,.01))return this.drawLine(a,g),this.drawExtensionLine(a,b,d),[a,g];g=this.angleVectorToVector(k,l);this.drawAngleLineToLine(a,c,d,
b,g);return g}if(f.distanceTo(b)<a.distanceTo(b)&&f.distanceTo(b)<a.distanceTo(d)&&f.distanceTo(b)<f.distanceTo(d)){k.subVectors(f,a);l.subVectors(b,d);k.normalize();l.normalize();if(this.isEqualVectors(k,l,.01)||this.isInverseVectors(k,l,.01))return this.drawLine(f,h),this.drawExtensionLine(f,b,d),[f,h];g=this.angleVectorToVector(k,l);this.drawAngleLineToLine(f,c,b,d,g);return g}k.subVectors(f,a);l.subVectors(d,b);k.normalize();l.normalize();if(this.isEqualVectors(k,l,.01)||this.isInverseVectors(k,
l,.01))return this.drawLine(f,h),this.drawExtensionLine(f,b,d),[f,h];g=this.angleVectorToVector(k,l);this.drawAngleLineToLine(f,c,d,b,g);return g};this.nearestPointInPointToSegment=function(a,b,c){var d=new THREE.Vector3,f=new THREE.Vector3;d.subVectors(b,a);f.subVectors(c,b);a=d.dot(f);d.subVectors(c,b);a=-a/d.dot(d);0>a||(1<a?b=c:(d.subVectors(c,b),d.multiplyScalar(a),b=d.add(b)));return b};this.nearestPointInPointToLine=function(a,b,c){var d=new THREE.Vector3,f=new THREE.Vector3;d.subVectors(b,
a);f.subVectors(c,b);a=d.dot(f);d.subVectors(c,b);a=-a/d.dot(d);d.subVectors(c,b);d.multiplyScalar(a);return d.add(b)};this.pointToEdgeMeasure=function(a,b,c){b=I.getEndPointsInEdge(b);var d=b[0],f=b[1];b=this.nearestPointInPointToLine(a,d,f);c=this.nearestPointInPointToLine(c,d,f);d=new THREE.Vector3;d.subVectors(c,b);d.add(a);this.drawLine(d,c);this.drawExtensionLinePointToPoint(a,d);return[a,b]};this.edgeToPointMeasure=function(a,b){var c=I.getEndPointsInEdge(a),d=c[0],c=c[1],f=this.nearestPointInPointToLine(b,
d,c);this.drawLine(b,f);this.drawExtensionLine(b,d,c);return[b,f]};this.faceToFaceMeasure=function(a,b,c,d){var f=b.clone(),g=d.clone(),h=this.angleVectorToVector(b,d);return f.x<=g.x+.01&&f.x>=g.x-.01&&f.y<=g.y+.01&&f.y>=g.y-.01&&f.z<=g.z+.01&&f.z>=g.z-.01||f.x<=-g.x+.01&&f.x>=-g.x-.01&&f.y<=-g.y+.01&&f.y>=-g.y-.01&&f.z<=-g.z+.01&&f.z>=-g.z-.01?(b=new THREE.Vector3,b.subVectors(a,c),f=f.dot(b)/f.dot(g),b.addVectors(c,g.multiplyScalar(f)),g=new THREE.Vector3,g.subVectors(b,a),a=A.first.mesh.geometry.clone(),
a.applyMatrix((new THREE.Matrix4).makeTranslation(g.x,g.y,g.z)),this.drawExtensionFace(a),this.drawLine(c,b),[c,b,h]):h=this.drawAngleFaceToFace(a,b,c,d)};this.angleVectorToVector=function(a,b){return 180*a.angleTo(b)/Math.PI};this.intersectPlaneToPlane=function(a,b,c,d){var f=new THREE.Vector3;f.crossVectors(b,d);var g=0<=f.x?f.x:-f.x,h=0<=f.y?f.y:-f.y,k=0<=f.z?f.z:-f.z,h=g>h?g>k?1:3:h>k?2:3,g=new THREE.Vector3,l,k=-b.dot(a);l=-d.dot(c);switch(h){case 1:g.x=0;0!==f.x?(g.y=(l*b.z-k*d.z)/f.x,g.z=(k*
d.y-l*b.y)/f.x):(g.y=-(l*b.z)/(b.z*d.y),g.z=-(k*d.y)/(b.z*d.y));break;case 2:g.y=0;0!==f.y?(g.x=(k*d.z-l*b.z)/f.y,g.z=(l*b.x-k*d.x)/f.y):(g.x=-(k*d.z)/(b.x*d.z),g.z=-(l*b.x)/(b.x*d.z));break;case 3:g.z=0,0!==f.z?(g.x=(l*b.y-k*d.y)/f.z,g.y=(k*d.x-l*b.x)/f.z):(g.x=-(l*b.y)/(b.y*d.x),g.y=-(k*d.x)/(b.y*d.x))}b=new THREE.Vector3;b.addVectors(g,f.multiplyScalar(100));a=this.nearestPointInPointToLine(a,g,b);c=this.nearestPointInPointToLine(c,g,b);return[a,c]};this.drawAngle=function(a,b,c,d,f){m||(m=new THREE.LineBasicMaterial({color:52224,
opacity:.5,linewidth:2,depthTest:!1}),h.impl.createOverlayScene("MeasureTool-angle",m));h.impl.clearOverlay("MeasureTool-angle");var g=new THREE.Geometry,k=new THREE.Geometry;g.vertices.push(a,b);k.vertices.push(a,c);g=new THREE.Line(g,m);k=new THREE.Line(k,m);h.impl.addOverlay("MeasureTool-angle",g);h.impl.addOverlay("MeasureTool-angle",k);k=a.distanceTo(b);f=new THREE.CircleGeometry(k,100,0,f*Math.PI/180);f=new THREE.Line(f,m);k=f.geometry.vertices[0].clone();f.geometry.vertices.push(k);f.position.set(a.x,
a.y,a.z);k=f.position.clone();k.add(d);f.lookAt(k);f.updateMatrixWorld();var l=f.geometry.vertices[1].clone(),n=f.geometry.vertices[f.geometry.vertices.length-2].clone();l.applyMatrix4(f.matrixWorld);n.applyMatrix4(f.matrixWorld);var k=new THREE.Vector3,g=new THREE.Vector3,p=new THREE.Vector3,q=new THREE.Vector3;k.subVectors(l,a);g.subVectors(n,a);p.subVectors(b,a);q.subVectors(c,a);c=k.angleTo(p);l=k.angleTo(q);b=g.angleTo(p);n=g.angleTo(q);b=(.001>=c&&-.001<=c||.001>=l&&-.001<=l)&&(.001>=b&&-.001<=
b||.001>=n&&-.001<=n)?0:(c<=Math.PI+.001&&c>=Math.PI-.001||l<=Math.PI+.001&&l>=Math.PI-.001)&&(b<=Math.PI+.001&&b>=Math.PI-.001||n<=Math.PI+.001&&n>=Math.PI-.001)?Math.PI:c<=b+.001&&c>=b-.001||c<=n+.001&&c>=n-.001?c:l;c=new THREE.Matrix4;c.makeRotationAxis(d,b);c.multiply(f.matrix);f.matrix=c;f.rotation.setFromRotationMatrix(f.matrix);f.updateMatrixWorld();l=f.geometry.vertices[1].clone();n=f.geometry.vertices[f.geometry.vertices.length-2].clone();l.applyMatrix4(f.matrixWorld);n.applyMatrix4(f.matrixWorld);
k.subVectors(l,a);g.subVectors(n,a);c=k.angleTo(p);l=k.angleTo(q);g.angleTo(p);g.angleTo(q);.001<=c&&.001<=l&&(c=new THREE.Matrix4,c.makeRotationAxis(d,2*-b),c.multiply(f.matrix),f.matrix=c,f.rotation.setFromRotationMatrix(f.matrix));h.impl.addOverlay("MeasureTool-angle",f)};this.drawAngleFaceToFace=function(a,b,c,d){var f=this.intersectPlaneToPlane(a,b,c,d),k=new THREE.Vector3,l=new THREE.Vector3;k.subVectors(a,f[0]);l.subVectors(c,f[1]);var k=this.angleVectorToVector(k,l),l=f[0].clone(),m=new THREE.Vector3;
m.crossVectors(b,d);m.normalize();f=this.intersectPlaneToPlane(a,b,l,m);a=f[0].clone();f=this.intersectPlaneToPlane(c,d,l,m);c=f[0].clone();this.drawAngle(l,a,c,m,k);t&&(c=G.label,c||(c=G.label=document.createElement("div"),c.className="measure-length",h.container.appendChild(c)),c.textContent=g.getAngle(),c.classList.toggle("visible",!0),G.p1=l.clone(),G.p2=l.clone(),this.updateLabelPositions());return k};this.drawAngleLineToLine=function(a,b,c,d,f){var k=new THREE.Vector3,l=new THREE.Vector3,m=
new THREE.Vector3;l.subVectors(a,b);m.subVectors(c,d);k.crossVectors(l,m);k.normalize();l=new THREE.Vector3;l.subVectors(a,c);l.add(d);this.drawAngle(a,b,l,k,f);t&&(b=G.label,b||(b=G.label=document.createElement("div"),b.className="measure-length",h.container.appendChild(b)),b.textContent=g.getAngle(),b.classList.toggle("visible",!0),G.p1=a.clone(),G.p2=a.clone(),this.updateLabelPositions())};this.intersectLineToLine=function(a,b,c,d){var f=new THREE.Vector3,g=new THREE.Vector3;f.subVectors(c,a);
f.cross(d);g.crossVectors(b,d);c=f.divide(g);g=b.clone();g.multiplyScalar(c);f.addVectors(a,g);return f};this.nearestPointInPointToPlane=function(a,b,c){var d=new THREE.Vector3;c=c.clone();var f=new THREE.Vector3;f.subVectors(a,b);b=-c.dot(f);f=c.dot(c);d.addVectors(a,c.multiplyScalar(b/f));return d};this.faceToPointMeasure=function(a,b,c,d){b=this.nearestPointInPointToPlane(d,a.vertices[0],b);c=c.clone();var f=new THREE.Vector3;f.subVectors(c,b);f.add(d);f=new THREE.Vector3;f.subVectors(b,c);a=a.clone();
a.applyMatrix((new THREE.Matrix4).makeTranslation(f.x,f.y,f.z));this.drawExtensionFace(a);this.drawLine(d,b);return[d,b]};this.nearestPointInPointToFace=function(a,b,c){for(var d,f=Number.MAX_VALUE,g=new THREE.Vector3,h=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector3,m=0;m<b.vertices.length;m+=3){g.subVectors(b.vertices[m+1],b.vertices[m]);h.subVectors(b.vertices[m+2],b.vertices[m]);l.crossVectors(g,h);k.subVectors(a,b.vertices[m]);g.cross(k);var n=g.dot(l)/l.dot(l);k.cross(h);var p=k.dot(l)/
l.dot(l),q=1-n-p;if(0<=q&&1>=q&&0<=p&&1>=p&&0<=n&&1>=n)return d=this.nearestPointInPointToPlane(a,b.vertices[0],c)}for(m=0;m<b.vertices.length;m+=3)c=this.nearestPointInPointToSegment(a,b.vertices[m],b.vertices[m+1]),a.distanceTo(c)<f&&(f=a.distanceTo(c),d=c.clone()),c=this.nearestPointInPointToSegment(a,b.vertices[m],b.vertices[m+2]),a.distanceTo(c)<f&&(f=a.distanceTo(c),d=c.clone()),c=this.nearestPointInPointToSegment(a,b.vertices[m+1],b.vertices[m+2]),a.distanceTo(c)<f&&(f=a.distanceTo(c),d=c.clone());
return d};this.pointToFaceMeasure=function(a,b,c,d){b=this.nearestPointInPointToPlane(a,b.vertices[0],c);d=d.clone();c=new THREE.Vector3;c.subVectors(d,b);c.add(a);this.drawLine(d,c);this.drawExtensionLinePointToPoint(a,c);return[a,b]};this.nearestPointsInEdgeToFace=function(a,b){for(var c=[],d=Number.MAX_VALUE,f=I.getEndPointsInEdge(a),g=f[0],f=f[1],h,k,l=0;l<b.vertices.length;l+=3)h=b.vertices[l],k=b.vertices[l+1],h=this.nearestPointsInSegmentToSegment(g,f,h,k),h[0].distanceTo(h[1])<d&&(d=h[0].distanceTo(h[1]),
c[0]=h[0].clone(),c[1]=h[1].clone()),h=b.vertices[l],k=b.vertices[l+2],h=this.nearestPointsInSegmentToSegment(g,f,h,k),h[0].distanceTo(h[1])<d&&(d=h[0].distanceTo(h[1]),c[0]=h[0].clone(),c[1]=h[1].clone()),h=b.vertices[l+1],k=b.vertices[l+2],h=this.nearestPointsInSegmentToSegment(g,f,h,k),h[0].distanceTo(h[1])<d&&(d=h[0].distanceTo(h[1]),c[0]=h[0].clone(),c[1]=h[1].clone());return c};this.faceToEdgeMeasure=function(a,b,c,d,f){var g=I.getEndPointsInEdge(d),h;g[0].distanceTo(c)<g[1].distanceTo(c)?(d=
g[0],h=g[1]):(d=g[1],h=g[0]);var k=new THREE.Vector3;k.subVectors(h,d);g=this.angleLineToPlane(k,b);if(.01>=k.dot(b)&&-.01<=k.dot(b))return k=this.nearestPointInPointToPlane(d,a.vertices[0],b),f=this.nearestPointInPointToLine(f,d,h),this.faceToPointMeasure(a,b,c,f),[d,k,g];f=this.nearestPointInPointToLine(f,d,h);this.drawAngleEdgeToFace(a.vertices[0],b,c,d,f,g);return g};this.edgeToFaceMeasure=function(a,b,c,d,f){var g=I.getEndPointsInEdge(a),h;g[0].distanceTo(f)<g[1].distanceTo(f)?(a=g[0],h=g[1]):
(a=g[1],h=g[0]);var k=new THREE.Vector3;k.subVectors(h,a);g=this.angleLineToPlane(k,d);if(.01>=k.dot(d)&&-.01<=k.dot(d))return c=this.nearestPointInPointToPlane(a,c.vertices[0],d),d=new THREE.Vector3,d.subVectors(f,c),d.add(a),b=new THREE.Vector3,b.subVectors(f,c),b.add(h),this.drawLine(d,f),this.drawExtensionLinePointToPoint(d,b),[a,c,g];h=this.nearestPointInPointToLine(b,a,h);this.drawAngleEdgeToFace(c.vertices[0],d,f,a,h,g);return g};this.angleLineToPlane=function(a,b){var c=this.angleVectorToVector(a,
b);return 90<c?c-90:90-c};this.drawAngleEdgeToFace=function(a,b,c,d,f,k){var l=this.intersectPointLineToPlane(a,b,d,f);if(l){a=90===k?c.clone():this.nearestPointInPointToPlane(f,a,b);b=new THREE.Vector3;c=new THREE.Vector3;var m=new THREE.Vector3;c.subVectors(f,d);m.subVectors(a,l);b.crossVectors(c,m);b.normalize();this.drawAngle(l,f,a,b,k);t&&(d=G.label,d||(d=G.label=document.createElement("div"),d.className="measure-length",h.container.appendChild(d)),d.textContent=g.getAngle(),d.classList.toggle("visible",
!0),G.p1=l.clone(),G.p2=l.clone(),this.updateLabelPositions())}};this.intersectPointLineToPlane=function(a,b,c,d){var f=new THREE.Vector3,g=new THREE.Vector3;f.subVectors(d,c);g.subVectors(c,a);a=b.dot(f);b=-b.dot(g);if(.001>Math.abs(a))return null;f.multiplyScalar(b/a);f.add(c);return f};this.isEqualVectors=function(a,b,c){return a.x<=b.x+c&&a.x>=b.x-c&&a.y<=b.y+c&&a.y>=b.y-c&&a.z<=b.z+c&&a.z>=b.z-c?!0:!1};this.isInverseVectors=function(a,b,c){return a.x<=-b.x+c&&a.x>=-b.x-c&&a.y<=-b.y+c&&a.y>=-b.y-
c&&a.z<=-b.z+c&&a.z>=-b.z-c?!0:!1};this.setSimple=function(a){if(c!=a){c=a;for(var b in D)if("xyz"!==b&&D.hasOwnProperty(b)){var d=D[b];d.line&&(d.line.visible=!a,d.label&&d.label.classList.toggle("visible",!a))}h.impl.invalidate(!1,!1,!0)}};this.hide=function(){for(var a in C)if(C.hasOwnProperty(a)){var b=C[a];b.mesh&&(b.mesh.visible=!1)}for(a in w)w.hasOwnProperty(a)&&(b=w[a],b.line&&(b.line.visible=!1),b.label&&b.label.classList.remove("visible"));for(a in A)A.hasOwnProperty(a)&&(b=A[a],b.mesh&&
(b.mesh.visible=!1),b.label&&b.label.classList.remove("visible"));for(a in D)D.hasOwnProperty(a)&&(b=D[a],b.line&&(b.line.visible=!1),b.label&&b.label.classList.remove("visible"));G.label&&G.label.classList.remove("visible");m&&h.impl.clearOverlay("MeasureTool-angle");l&&h.impl.clearOverlay("MeasureTool-extensionLine");p&&h.impl.clearOverlay("MeasureTool-extensionFace");h.impl.invalidate(!1,!1,!0)};this.hideClick=function(a){if(C.hasOwnProperty(a)){var b=C[a];b.mesh&&(b.mesh.visible=!1)}w.hasOwnProperty(a)&&
(b=w[a],b.line&&(b.line.visible=!1),b.label&&b.label.classList.remove("visible"));A.hasOwnProperty(a)&&(a=A[a],a.mesh&&(a.mesh.visible=!1),a.label&&a.label.classList.remove("visible"));for(var c in D)D.hasOwnProperty(c)&&(a=D[c],a.line&&(a.line.visible=!1),a.label&&a.label.classList.remove("visible"));G.label&&G.label.classList.remove("visible");m&&h.impl.clearOverlay("MeasureTool-angle");l&&h.impl.clearOverlay("MeasureTool-extensionLine");p&&h.impl.clearOverlay("MeasureTool-extensionFace");h.impl.invalidate(!1,
!1,!0)};this.destroy=function(){for(var a in C)if(C.hasOwnProperty(a)){var b=C[a];b.mesh&&(h.impl.removeOverlay("MeasureTool-endPoint",b.mesh),b.mesh=b.geometry=null)}for(a in w)w.hasOwnProperty(a)&&(b=w[a],b.line&&(h.impl.removeOverlay("MeasureTool-edge",b.line),b.line=b.intersectPoint=null),b.label&&(b.label.parentNode.removeChild(b.label),b.label=null));for(a in A)A.hasOwnProperty(a)&&(b=A[a],b.mesh&&(h.impl.removeOverlay("MeasureTool-face",b.mesh),b.mesh=b.intersectPoint=null),b.label&&(b.label.parentNode.removeChild(b.label),
b.label=null));d&&(d=null,h.impl.removeOverlayScene("MeasureTool-endPoint"));k&&(k=null,h.impl.removeOverlayScene("MeasureTool-face"));f&&(f=null,h.impl.removeOverlayScene("MeasureTool-edge"));l&&(l=null,h.impl.removeOverlayScene("MeasureTool-extensionLine"));p&&(p=null,h.impl.removeOverlayScene("MeasureTool-extensionFace"));for(a in D)D.hasOwnProperty(a)&&(b=D[a],b.line&&(h.impl.removeOverlay(b.overlayName,b.line),h.impl.removeOverlayScene(b.overlayName),b.material=b.line=b.geometry=null),b.label&&
(b.label.parentNode.removeChild(b.label),b.label=null),b.material=b.line=b.geometry=b.label=b.p1=b.p2=null);G.label&&(G.label.parentNode.removeChild(G.label),G.label=null);G.label=G.p1=G.p2=null}}var g=this,h=a,k=["measure"],l=!1,n=null,q=null,m=!1,p=0,t=!1,r=null,B=null,z="",F=3,C={},w=0,E=!1,A=null,D=null,I=null,G=null,H=null,K=null,J=null,M=null,L=null;this.register=function(){D||(D=new Autodesk.Viewing.Extensions.Measure.MeasurePanel(g,h,"measure-panel","Measure",b),h.addPanel(D));I||(I=new Autodesk.Viewing.Extensions.Measure.Snapper(a),
h.toolController.registerTool(I))};this.deregister=function(){this.deactivate();h.removePanel(D);D.uninitialize();h.toolController.deregisterTool(I);I=null};this.isActive=function(){return l};this.getNames=function(){return k};this.getName=function(){return k[0]};this.getCursor=function(){return m?null:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAKZJREFUeNrclLEKwzAQQ9+FgH/Nk7d8ViFT+6cG36IsNXgIdMg5kAoOIw8WSDoDvAEN04BdEhFjgCTR4e6klFxSIgDLSNydbdsAPgRCktRaUylFkfZ0Z2qtVTlnAfugGibwAur3JFrAxoBnYGEy1pGYmQCLLNB6Uqmw182M9eRS0yzqGo+y6D9rytSQR8vM7DKfbtHy4x+/xG8J+d4W9WAi8fxFOwYA8W0ypu2ZfcsAAAAASUVORK5CYII=), wait"};
this.activate=function(){l=!0;p=0;m=!1;z||(z=h.model.getUnitString());A||(A=new d(h));A.hide();D.setVisible(!0);D.updatePanel();h.model&&h.model.is2d()&&D.isolate.setDisabled(!0);z||(D.unitList.disabled=!0);h.toolController.activateTool("snapper");h.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,c);h.addEventListener(Autodesk.Viewing.RESET_EVENT,f)};this.deactivate=function(){l=!1;n=q=null;C={};this.clearMeasurement();A&&(A.hide(),A.destroy());C={};D&&(D.setVisible(!1),D.updatePanel());I&&
I.isActive()&&h.toolController.deactivateTool("snapper");h.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,c);h.removeEventListener(Autodesk.Viewing.RESET_EVENT,f)};this.update=function(){return!1};this.getUnits=function(){return z};this.setUnits=function(a){z!==a&&(z=a,A&&(A.updateDistance(),A.updateLabels()))};this.getPrecision=function(){return F};this.setPrecision=function(a){F!==a&&(F=a,A&&(A.updateDistance(),A.updateLabels()))};this.getDistance=function(a){if(h.model&&h.model.isLoadDone())return a=
Autodesk.Viewing.Private.convertUnits(h.model.getUnitString(),z,C[a]||0),Autodesk.Viewing.Private.formatValueWithUnits(a,z,3,F)};this.getAngle=function(){return Autodesk.Viewing.Private.formatValueWithUnits(w,String.fromCharCode(176),3,F)};this.clearMeasurement=function(){M=L=r=B=n=q=null;p=1;C={};w=0;A&&A.hide();D&&(D.updatePanel(),D.hideMeasureResult(),D.isolateMeasure&&this.clearIsolate())};this.clearRubberBand=function(){B=q=null;A.hideClick("second")};this.clearFirstPick=function(){q?(A.hide(),
n=q.clone(),r=B,G=H,K=J,M=L,E=!0,r===SNAP_VERTEX?A.showFirstVertex(n):r===SNAP_EDGE?A.showFirstEdge(n,G):A.showFirstFace(n,G),E=!1,L=B=q=null,p=2,C={},w=0,D&&D.isolateMeasure&&this.clearIsolate()):this.clearMeasurement();D.showSelection1()};this.clearSecondPick=function(){L=B=q=null;p=2;C={};w=0;A.hideClick("second");D&&D.isolateMeasure&&this.clearIsolate()};this.getIndicator=function(){return A};this.getFirstGeometry=function(){return{type:r,geometry:n}};this.getSecondGeometry=function(){return{type:B,
geometry:q}};this.getEdgeLength=function(a){return A.getEdgeLength(a)};this.getFaceArea=function(a){return A.getFaceArea(a)};this.isolateMeasurement=function(){M&&L&&h.isolate([M,L])};this.clearIsolate=function(){h.showAll()};this._handleMouseEvent=function(a){if(I.isSnapped()){0===p&&(this.clearMeasurement(),p=1);if(1===p)I.getHighlightGeometry()===SNAP_VERTEX?(n=I.getVertex(),r=SNAP_VERTEX,A.showFirstVertex(n)):I.getHighlightGeometry()===SNAP_EDGE?(n=I.getEdge(),r=SNAP_EDGE,G=I.getIntersectPoint(),
A.showFirstEdge(n,G)):(n=I.getFace(),r=SNAP_FACE,G=I.getIntersectPoint(),K=I.getFaceNormal(),A.showFirstFace(n,G)),M=I.getSnapNode(),D.showSelection1();else if(2===p){var b;r===SNAP_VERTEX&&I.getHighlightGeometry()===SNAP_VERTEX?(q=I.getVertex(),B=SNAP_VERTEX,A.showSecondVertex(q),A.drawLine(n,q),b=[n,q]):r===SNAP_EDGE&&I.getHighlightGeometry()===SNAP_EDGE?(q=I.getEdge(),B=SNAP_EDGE,H=I.getIntersectPoint(),A.showSecondEdge(q,H),b=A.edgeToEdgeMeasure(q,n,H)):r===SNAP_FACE&&I.getHighlightGeometry()===
SNAP_FACE?(q=I.getFace(),B=SNAP_FACE,H=I.getIntersectPoint(),J=I.getFaceNormal(),A.showSecondFace(q,H),b=A.faceToFaceMeasure(G,K,H,J)):r===SNAP_VERTEX&&I.getHighlightGeometry()===SNAP_EDGE?(q=I.getEdge(),B=SNAP_EDGE,H=I.getIntersectPoint(),A.showSecondEdge(q,H),b=A.pointToEdgeMeasure(n,q,H)):r===SNAP_EDGE&&I.getHighlightGeometry()===SNAP_VERTEX?(q=I.getVertex(),B=SNAP_VERTEX,A.showSecondVertex(q),b=A.edgeToPointMeasure(n,q)):r===SNAP_VERTEX&&I.getHighlightGeometry()===SNAP_FACE?(q=I.getFace(),B=SNAP_FACE,
J=I.getFaceNormal(),H=I.getIntersectPoint(),A.showSecondFace(q,H),b=A.pointToFaceMeasure(n,q,J,H)):r===SNAP_FACE&&I.getHighlightGeometry()===SNAP_VERTEX?(q=I.getVertex(),B=SNAP_VERTEX,A.showSecondVertex(q),b=A.faceToPointMeasure(n,K,G,q)):r===SNAP_EDGE&&I.getHighlightGeometry()===SNAP_FACE?(q=I.getFace(),B=SNAP_FACE,J=I.getFaceNormal(),H=I.getIntersectPoint(),A.showSecondFace(q,H),b=A.edgeToFaceMeasure(n,G,q,J,H)):r===SNAP_FACE&&I.getHighlightGeometry()===SNAP_EDGE&&(q=I.getEdge(),B=SNAP_EDGE,H=I.getIntersectPoint(),
A.showSecondEdge(q,H),b=A.faceToEdgeMeasure(n,K,G,q,H));t&&(void 0===b.length?(w=b,D.showAngleResult()):(C.xyz=b[0].distanceTo(b[1]),C.x=Math.abs(b[0].x-b[1].x),C.y=Math.abs(b[0].y-b[1].y),C.z=Math.abs(b[0].z-b[1].z),D.showDistanceResult()),D.showSelection2(),D.updatePanel(),A.updateDistance(),A.updateAngle(),L=I.getSnapNode(),D.isolateMeasure&&this.isolateMeasurement());A.updateLabelPositions()}return!0}2===p&&(r===SNAP_VERTEX?(q=this.inverseProject(a.canvasX,a.canvasY),B=SNAP_VERTEX,A.drawLine(n,
q)):r===SNAP_EDGE?(q=this.inverseProject(a.canvasX,a.canvasY),B=SNAP_VERTEX,A.edgeToPointMeasure(n,q)):r===SNAP_FACE&&(q=this.inverseProject(a.canvasX,a.canvasY),B=SNAP_VERTEX,A.faceToPointMeasure(n,K,G,q)));return!1};this.inverseProject=function(a,b){var c=h.navigation.getCamera(),d=h.navigation.getScreenViewport(),f=new THREE.Vector3;f.x=a/d.width*2-1;f.y=-(b/d.height*2-1);f.z=0;return f=f.unproject(c)};this.handleButtonDown=function(a,b){m=!0;0!==b||a.ctrlKey||a.metaKey||a.shiftKey||a.altKey||
(t=!0);return!1};this.handleMouseMove=function(a){t=!1;2===p&&(this.clearRubberBand(),this._handleMouseEvent(a));return!1};this.handleButtonUp=function(a,b){return m=!1};this.handleSingleClick=function(a,b){if(t){this._handleMouseEvent(a)||(this.clearMeasurement(),p=0);if(1===p||2===p)p=1===p?2:0;t=!1}return!0};this.handleDoubleClick=function(a,b){return!0};this.handleWheelInput=function(a){A.updateScale();return!1}};AutodeskNamespace("Autodesk.Viewing.Extensions.Measure");
Autodesk.Viewing.Extensions.Measure.MeasurePanel=function(a,b,c,f,d){Autodesk.Viewing.UI.DockingPanel.call(this,b.container,c,f,d);this.kPanelExpandedHeight=310;this.kPanelCollapsedHeight=35;this.isDeltaExpanded=!0;this.isolateMeasure=!1;this.measureTool=a;this.viewer=b;this.parentContainer=b.container;this.container.classList.add("measurePanel");this.container.dockRight=!0;this.container.style.minWidth="325px";this.container.style.width="325px";this.container.style.minHeight=this.kPanelCollapsedHeight+
"px";this.container.style.height=this.kPanelExpandedHeight+"px";this.container.style.maxHeight=this.kPanelExpandedHeight+"px";this.container.style.top="200px";this.container.style.left="220px";this.container.style.position="absolute";this.addEventListener(this.closer,"click",function(a){if(d&&d.onCloseCallback)d.onCloseCallback()});this.container.children[0].classList.add("expanded");d=d||{};d.heightAdjustment||(d.heightAdjustment=40);d.marginTop||(d.marginTop=0);d.left=!1;this.createScrollContainer(d);
this.measureResults=document.createElement("div");this.scrollContainer.appendChild(this.measureResults);this.units=[{name:"Decimal feet",units:"decimal-ft",matches:["decimal-ft"]},{name:"Feet and fractional inches",units:"ft",matches:["ft","in"]},{name:"Decimal inches",units:"decimal-in",matches:["decimal-in"]},{name:"Fractional inches",units:"fractional-in",matches:["fractional-in"]},{name:"Meters",units:"m",matches:["m"]},{name:"Centimeters",units:"cm",matches:["cm"]},{name:"Millimeters",units:"mm",
matches:["mm"]},{name:"Meters and centimeters",units:"m-and-cm",matches:["m-and-cm"]}];a=this.findUnits();b=[];for(c=0;c<this.units.length;++c)b.push(this.units[c].name);var g=this;this.unitList=this.addDropDownMenu(this.measureResults,"Unit type",b,a,function(a){g.measureTool.setUnits(g.units[a].units);g.updatePanel();g.setupPrecision()});this.precisionList=this.addDropDownMenu(this.measureResults,"Precision",[],-1,function(a){g.measureTool.setPrecision(a);g.updatePanel()});this.precisionList.parentNode.style.paddingBottom=
"15px";this.setupPrecision();this.addDivider(this.measureResults);this.results=document.createElement("div");this.measureResults.appendChild(this.results);a=document.createElement("div");a.className="measure-result";a.setAttribute("data-i18n","Results");a.textContent=Autodesk.Viewing.i18n.translate("Results");this.results.appendChild(a);this.distanceDiv=document.createElement("div");this.distanceDiv.className="measure-results";this.results.appendChild(this.distanceDiv);a=document.createElement("div");
a.className="measure-result-label";a.setAttribute("data-i18n","Distance = ");a.textContent=Autodesk.Viewing.i18n.translate("Distance = ");this.distanceDiv.appendChild(a);a=document.createElement("div");a.className="measure-result-number";this.distanceDiv.appendChild(a);a=document.createElement("div");a.className="measure-delta-collapse";a.setAttribute("data-i18n","+");a.textContent=Autodesk.Viewing.i18n.translate("+");a.addEventListener("click",function(a){g.toggle()},!0);this.distanceDiv.appendChild(a);
this.deltaXDiv=document.createElement("div");this.deltaXDiv.className="measure-results";this.results.appendChild(this.deltaXDiv);a=document.createElement("div");a.className="measure-result-label";a.setAttribute("data-i18n","Delta X = ");a.textContent=Autodesk.Viewing.i18n.translate("Delta X = ");this.deltaXDiv.appendChild(a);a=document.createElement("div");a.className="measure-result-number";this.deltaXDiv.appendChild(a);this.deltaYDiv=document.createElement("div");this.deltaYDiv.className="measure-results";
this.results.appendChild(this.deltaYDiv);a=document.createElement("div");a.className="measure-result-label";a.setAttribute("data-i18n","Delta Y = ");a.textContent=Autodesk.Viewing.i18n.translate("Delta Y = ");this.deltaYDiv.appendChild(a);a=document.createElement("div");a.className="measure-result-number";this.deltaYDiv.appendChild(a);this.deltaZDiv=document.createElement("div");this.deltaZDiv.className="measure-results";this.results.appendChild(this.deltaZDiv);a=document.createElement("div");a.className=
"measure-result-label";a.setAttribute("data-i18n","Delta Z = ");a.textContent=Autodesk.Viewing.i18n.translate("Delta Z = ");this.deltaZDiv.appendChild(a);a=document.createElement("div");a.className="measure-result-number";this.deltaZDiv.appendChild(a);this.angleDiv=document.createElement("div");this.angleDiv.className="measure-results";this.results.appendChild(this.angleDiv);a=document.createElement("div");a.className="measure-result-label";a.setAttribute("data-i18n","Angle = ");a.textContent=Autodesk.Viewing.i18n.translate("Angle = ");
this.angleDiv.appendChild(a);a=document.createElement("div");a.className="measure-result-number";this.angleDiv.appendChild(a);this.addDivider(this.results);this.selection1=document.createElement("div");this.measureResults.appendChild(this.selection1);a=document.createElement("div");a.className="measure-result";a.setAttribute("data-i18n","Selection 1");a.textContent=Autodesk.Viewing.i18n.translate("Selection 1");this.selection1.appendChild(a);a=document.createElement("div");a.className="measure-selection-repick";
a.setAttribute("data-i18n","Reselect");a.textContent=Autodesk.Viewing.i18n.translate("Reselect");a.addEventListener("click",function(a){g.firstSelectionRepick()},!0);this.selection1.appendChild(a);this.selection1Element=document.createElement("div");this.selection1Element.className="measure-results";this.selection1.appendChild(this.selection1Element);a=document.createElement("div");a.className="measure-result-label";this.selection1Element.appendChild(a);this.selection1Div=document.createElement("div");
this.selection1Div.className="measure-results";this.selection1.appendChild(this.selection1Div);a=document.createElement("div");a.className="measure-result-label";this.selection1Div.appendChild(a);a=document.createElement("div");a.className="measure-result-number";this.selection1Div.appendChild(a);this.addDivider(this.selection1);this.selection2=document.createElement("div");this.measureResults.appendChild(this.selection2);a=document.createElement("div");a.className="measure-result";a.setAttribute("data-i18n",
"Selection 2");a.textContent=Autodesk.Viewing.i18n.translate("Selection 2");this.selection2.appendChild(a);a=document.createElement("div");a.className="measure-selection-repick";a.setAttribute("data-i18n","Reselect");a.textContent=Autodesk.Viewing.i18n.translate("Reselect");a.addEventListener("click",function(a){g.secondSelectionRepick()},!0);this.selection2.appendChild(a);this.selection2Element=document.createElement("div");this.selection2Element.className="measure-results";this.selection2.appendChild(this.selection2Element);
a=document.createElement("div");a.className="measure-result-label";a.setAttribute("data-i18n","Vertex selected");a.textContent=Autodesk.Viewing.i18n.translate("Vertex selected");this.selection2Element.appendChild(a);this.selection2Div=document.createElement("div");this.selection2Div.className="measure-results";this.selection2.appendChild(this.selection2Div);a=document.createElement("div");a.className="measure-result-label";a.setAttribute("data-i18n","Length = ");a.textContent=Autodesk.Viewing.i18n.translate("Length = ");
this.selection2Div.appendChild(a);a=document.createElement("div");a.className="measure-result-number";this.selection2Div.appendChild(a);this.addDivider(this.selection2);this.table=document.createElement("table");this.table.className="tftable measure-table";this.tbody=document.createElement("tbody");this.table.appendChild(this.tbody);this.measureResults.appendChild(this.table);this.isolate=new Autodesk.Viewing.Private.OptionCheckbox("Isolate measurement",this.tbody,!1);this.addEventListener(this.isolate,
"change",function(a){g.isolateMeasure=g.isolate.checked;g.isolateMeasure?g.measureTool.isolateMeasurement():g.measureTool.clearIsolate()});this.addDivider(this.measureResults);a=document.createElement("div");a.className="measure-restart";a.setAttribute("data-i18n","Restart measurement");a.textContent=Autodesk.Viewing.i18n.translate("Restart measurement");a.addEventListener("click",function(){g.measureTool.clearMeasurement()},!1);this.measureResults.appendChild(a);this.updatePanel();this.addVisibilityListener(function(){g.resizeToContent({maxHeight:g.parentContainer.offsetHeight-
75})});this.hideMeasureResult()};Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype);Autodesk.Viewing.Extensions.ViewerPanelMixin.call(Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype);
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.addDropDownMenu=function(a,b,c,f,d){var g=document.createElement("select");g.className="optionDropDown";for(var h=0;h<c.length;h++){var k=document.createElement("option");k.value=h;k.setAttribute("data-i18n",c[h]);k.textContent=Autodesk.Viewing.i18n.translate(c[h]);g.add(k)}c=document.createElement("div");c.className="measure-submenu-select";h=document.createElement("div");h.className="measure-submenu-selectlabel";h.setAttribute("for",b);
h.setAttribute("data-i18n",b);h.textContent=Autodesk.Viewing.i18n.translate(b);c.appendChild(h);c.appendChild(g);a.appendChild(c);g.selectedIndex=f;g.onchange=function(a){d(a.target.selectedIndex)};return g};Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.addDivider=function(a){var b=document.createElement("div");b.className="measure-horizontal-divider";a.appendChild(b);return b};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.findUnits=function(){var a,b,c=this.measureTool.getUnits();for(a=0;a<this.units.length;++a){var f=this.units[a].matches;if(f)for(b=0;b<f.length;++b)if(f[b]===c)return a}return 0};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.setupPrecision=function(){for(;this.precisionList.lastChild;)this.precisionList.removeChild(this.precisionList.lastChild);for(var a=this.measureTool.getUnits(),a="ft"===a||"in"===a||"fractional-in"===a?"1 1/2 1/4 1/8 1/16 1/32 1/64".split(" "):"0 0.1 0.01 0.001 0.0001 0.00001".split(" "),b=0;b<a.length;++b){var c=document.createElement("option");c.value=b;c.textContent=a[b];this.precisionList.appendChild(c)}b=this.measureTool.getPrecision();
a.length<=b&&(b=a.length-1,self.measureTool.setPrecision(b));this.precisionList.selectedIndex=b};Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.uninitialize=function(){this.viewer=null;Autodesk.Viewing.UI.DockingPanel.prototype.uninitialize.call(this)};Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.onTitleClick=function(a){};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.collapse=function(a){var b=this.container.children[0];a?(b.classList.remove("expanded"),b.classList.add("collapsed"),this.measureResults.style.display="none"):(b.classList.remove("collapsed"),b.classList.add("expanded"),this.measureResults.style.display="block");this.measureTool.getIndicator().setSimple(a);this.resizeToContent({maxHeight:this.parentContainer.offsetHeight-75})};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.deltaCollapse=function(){this.measureTool.getIndicator().setSimple(this.isDeltaExpanded);this.isDeltaExpanded?(this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none",this.isDeltaExpanded=!1):(this.deltaXDiv.style.display="block",this.deltaYDiv.style.display="block",this.deltaZDiv.style.display="block",this.isDeltaExpanded=!0);this.resizeToContent()};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.toggle=function(){this.deltaCollapse()};Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.isExpanded=function(){return this.container.children[0].classList.contains("expanded")};Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.getContentSize=function(){return{height:this.isExpanded()?this.measureResults.clientHeight+46:0,width:this.measureResults.clientWidth}};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.updatePanel=function(){function a(a,f){a.children[1].textContent="angle"===f?b.measureTool.getAngle():b.measureTool.getDistance(f)}var b=this;a(this.distanceDiv,"xyz");a(this.deltaXDiv,"x");a(this.deltaYDiv,"y");a(this.deltaZDiv,"z");a(this.angleDiv,"angle");this.unitList.selectedIndex=this.findUnits();this.showSelection1();this.showSelection2()};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.showDistanceResult=function(){this.results.style.display="block";this.angleDiv.style.display="none";this.distanceDiv.style.display="block";this.isDeltaExpanded&&(this.deltaXDiv.style.display="block",this.deltaYDiv.style.display="block",this.deltaZDiv.style.display="block");this.resizeToContent()};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.showAngleResult=function(){this.results.style.display="block";this.angleDiv.style.display="block";this.distanceDiv.style.display="none";this.isDeltaExpanded&&(this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none");this.resizeToContent()};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.showSelection1=function(){var a=this.measureTool.getFirstGeometry();null!==a.type&&(a.type===SNAP_VERTEX?(this.selection1Element.children[0].setAttribute("data-i18n","Vertex selected"),this.selection1Element.children[0].textContent=Autodesk.Viewing.i18n.translate("Vertex selected"),this.selection1Div.style.display="none"):(a.type===SNAP_EDGE?(this.selection1Element.children[0].setAttribute("data-i18n","Edge selected"),this.selection1Element.children[0].textContent=
Autodesk.Viewing.i18n.translate("Edge selected"),this.selection1Div.children[0].setAttribute("data-i18n","Length = "),this.selection1Div.children[0].textContent=Autodesk.Viewing.i18n.translate("Length = "),this.selection1Div.children[1].textContent=this.measureTool.getEdgeLength(a.geometry)):(this.selection1Element.children[0].setAttribute("data-i18n","Face selected"),this.selection1Element.children[0].textContent=Autodesk.Viewing.i18n.translate("Face selected"),this.selection1Div.children[0].setAttribute("data-i18n",
"Area = "),this.selection1Div.children[0].textContent=Autodesk.Viewing.i18n.translate("Area = "),this.selection1Div.children[1].textContent=this.measureTool.getFaceArea(a.geometry)),this.selection1Div.style.display="block"),this.selection1.style.display="block",this.resizeToContent())};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.showSelection2=function(){var a=this.measureTool.getSecondGeometry();null!==a.type&&(a.type===SNAP_VERTEX?(this.selection2Element.children[0].setAttribute("data-i18n","Vertex selected"),this.selection2Element.children[0].textContent=Autodesk.Viewing.i18n.translate("Vertex selected"),this.selection2Div.style.display="none"):(a.type===SNAP_EDGE?(this.selection2Element.children[0].setAttribute("data-i18n","Edge selected"),this.selection2Element.children[0].textContent=
Autodesk.Viewing.i18n.translate("Edge selected"),this.selection2Div.children[0].setAttribute("data-i18n","Length = "),this.selection2Div.children[0].textContent=Autodesk.Viewing.i18n.translate("Length = "),this.selection2Div.children[1].textContent=this.measureTool.getEdgeLength(a.geometry)):(this.selection2Element.children[0].setAttribute("data-i18n","Face selected"),this.selection2Element.children[0].textContent=Autodesk.Viewing.i18n.translate("Face selected"),this.selection2Div.children[0].setAttribute("data-i18n",
"Area = "),this.selection2Div.children[0].textContent=Autodesk.Viewing.i18n.translate("Area = "),this.selection2Div.children[1].textContent=this.measureTool.getFaceArea(a.geometry)),this.selection2Div.style.display="block"),this.selection2.style.display="block",this.resizeToContent())};Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.firstSelectionRepick=function(){this.measureTool.clearFirstPick();this.results.style.display="none";this.selection2.style.display="none";this.resizeToContent()};
Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.secondSelectionRepick=function(){this.measureTool.clearSecondPick();this.results.style.display="none";this.selection2.style.display="none";this.resizeToContent()};Autodesk.Viewing.Extensions.Measure.MeasurePanel.prototype.hideMeasureResult=function(){this.results.style.display="none";this.selection1.style.display="none";this.selection2.style.display="none";this.resizeToContent()};AutodeskNamespace("Autodesk.Viewing.Extensions.Measure");
var SNAP_VERTEX=0,SNAP_EDGE=1,SNAP_FACE=2,SNAP_PRECISION=.001;
Autodesk.Viewing.Extensions.Measure.Snapper=function(a){function b(a,b){this.viewer=a;this.snapper=b;this.lineGeom=new THREE.Geometry;this.circularArc=null;this.circularArcCenter;this.ellipticalArc=null;this.minDist=Number.MAX_VALUE}var c=["snapper"],f=!1,d=.05,g=null,h=null,k=null,l=null,n=null,q=null,m=null,p=null,t=null,r=!1,B=!1;this.isActive=function(){return f};this.getNames=function(){return c};this.getName=function(){return c[0]};this.activate=function(){f=!0};this.deactivate=function(){f=
!1;this.destroy()};this.getFace=function(){return k};this.getEdge=function(){return l};this.getVertex=function(){return n};this.getSnapNode=function(){return q};this.getHighlightGeometry=function(){return m};this.getIntersectPoint=function(){return p};this.getFaceNormal=function(){return t};this.getEndPointsInEdge=function(a){a=a.vertices;for(var b=[],c=0;c<a.length;++c){for(var d=!1,f=0;f<a.length;++f)if(f!==c&&a[f].equals(a[c])){d=!0;break}d||b.push(a[c])}return b};this.isSnapped=function(){return B};
this.isEqualWithPrecision=function(a,b){return a<=b+SNAP_PRECISION&&a>=b-SNAP_PRECISION?!0:!1};this.isEqualVectorsWithPrecision=function(a,b){return a.x<=b.x+SNAP_PRECISION&&a.x>=b.x-SNAP_PRECISION&&a.y<=b.y+SNAP_PRECISION&&a.y>=b.y-SNAP_PRECISION&&a.z<=b.z+SNAP_PRECISION&&a.z>=b.z-SNAP_PRECISION?!0:!1};this.isInverseVectorsWithPrecision=function(a,b){return a.x<=-b.x+SNAP_PRECISION&&a.x>=-b.x-SNAP_PRECISION&&a.y<=-b.y+SNAP_PRECISION&&a.y>=-b.y-SNAP_PRECISION&&a.z<=-b.z+SNAP_PRECISION&&a.z>=-b.z-
SNAP_PRECISION?!0:!1};this.snapping3D=function(b){q=b.dbId;var c=b.face,f=b.intersectPoint;b=void 0===b.fragId.length?[b.fragId]:b.fragId;for(var w=0;w<b.length;++w){var r=a.impl.getRenderProxy(a.model,b[w]);if(k=this.faceSnapping(c,r.geometry)){l=this.edgeSnapping(k,f,r);n=this.vertexSnapping(l,f);k.applyMatrix(r.matrixWorld);l.applyMatrix(r.matrixWorld);n.applyMatrix4(r.matrixWorld);p=f.applyMatrix4(r.matrixWorld);f=(new THREE.Matrix3).getNormalMatrix(r.matrixWorld);t=c.normal.applyMatrix3(f).normalize();
d=this.setDetectRadius(p);h<d?(this.drawPoint(n),m=SNAP_VERTEX):g<d?(this.drawLine(l),m=SNAP_EDGE):(this.drawFace(k),m=SNAP_FACE);B=!0;break}}};this.faceSnapping=function(a,b){var c=new THREE.Vector3,d=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Geometry,h=b.attributes;if(void 0!==h.index){var k=h.index.array||b.ib,l=b.vb?b.vb:h.position.array,m=b.vb?b.vbstride:3;(h=b.offsets)&&0!==h.length||(h=[{start:0,count:k.length,index:0}]);for(var n=0;n<h.length;++n)for(var p=h[n].start,q=h[n].count,
t=h[n].index,r=p;r<p+q;r+=3){var B=t+k[r],Y=t+k[r+1],U=t+k[r+2];c.set(l[B*m],l[B*m+1],l[B*m+2]);d.set(l[Y*m],l[Y*m+1],l[Y*m+2]);f.set(l[U*m],l[U*m+1],l[U*m+2]);B=THREE.Triangle.normal(c,d,f);Y=new THREE.Vector3;Y.set(l[a.a*m],l[a.a*m+1],l[a.a*m+2]);this.isEqualVectorsWithPrecision(B,a.normal)&&this.isEqualWithPrecision(B.dot(c),a.normal.dot(Y))&&(B=g.vertices.length,g.vertices.push(c.clone()),g.vertices.push(d.clone()),g.vertices.push(f.clone()),g.faces.push(new THREE.Face3(B,B+1,B+2)))}}return 0<
g.vertices.length?this.getTrianglesOnSameFace(g,a,l,m):null};this.getTrianglesOnSameFace=function(a,b,c,d){var f=!1;a=a.vertices.slice();var g=new THREE.Vector3;g.set(c[b.a*d],c[b.a*d+1],c[b.a*d+2]);var h=new THREE.Vector3;h.set(c[b.b*d],c[b.b*d+1],c[b.b*d+2]);var k=new THREE.Vector3;k.set(c[b.c*d],c[b.c*d+1],c[b.c*d+2]);b=new THREE.Geometry;b.vertices.push(g);b.vertices.push(h);b.vertices.push(k);b.faces.push(new THREE.Face3(0,1,2));c=[];do{c=[];for(d=0;d<a.length;d+=3)if(a[d].equals(g)&&a[d+1].equals(h)&&
a[d+2].equals(k))f=!0,c.push(d);else for(var l=0;l<b.vertices.length;l+=3)if(this.trianglesSharedEdge(a[d],a[d+1],a[d+2],b.vertices[l],b.vertices[l+1],b.vertices[l+2])){l=b.vertices.length;b.vertices.push(a[d].clone());b.vertices.push(a[d+1].clone());b.vertices.push(a[d+2].clone());b.faces.push(new THREE.Face3(l,l+1,l+2));c.push(d);break}for(d=c.length-1;0<=d;--d)a.splice(c[d],3)}while(0<c.length);return f?b:null};this.trianglesSharedEdge=function(a,b,c,d,f,g){var h=!1,k=!1,l=!1;if(a.equals(d)||a.equals(f)||
a.equals(g))h=!0;if(b.equals(d)||b.equals(f)||b.equals(g))k=!0;if(c.equals(d)||c.equals(f)||c.equals(g))l=!0;return h&k||h&l||k&l?!0:!1};this.edgeSnapping=function(a,b,c){for(var d=new THREE.Geometry,f=!0,h=!0,k=!0,l=0;l<a.vertices.length;l+=3){for(var m=0;m<a.vertices.length;m+=3)l!==m&&((a.vertices[l].equals(a.vertices[m])||a.vertices[l].equals(a.vertices[m+1])||a.vertices[l].equals(a.vertices[m+2]))&&(a.vertices[l+1].equals(a.vertices[m])||a.vertices[l+1].equals(a.vertices[m+1])||a.vertices[l+
1].equals(a.vertices[m+2]))&&(f=!1),(a.vertices[l].equals(a.vertices[m])||a.vertices[l].equals(a.vertices[m+1])||a.vertices[l].equals(a.vertices[m+2]))&&(a.vertices[l+2].equals(a.vertices[m])||a.vertices[l+2].equals(a.vertices[m+1])||a.vertices[l+2].equals(a.vertices[m+2]))&&(h=!1),(a.vertices[l+1].equals(a.vertices[m])||a.vertices[l+1].equals(a.vertices[m+1])||a.vertices[l+1].equals(a.vertices[m+2]))&&(a.vertices[l+2].equals(a.vertices[m])||a.vertices[l+2].equals(a.vertices[m+1])||a.vertices[l+2].equals(a.vertices[m+
2]))&&(k=!1));f&&(d.vertices.push(a.vertices[l].clone()),d.vertices.push(a.vertices[l+1].clone()));h&&(d.vertices.push(a.vertices[l].clone()),d.vertices.push(a.vertices[l+2].clone()));k&&(d.vertices.push(a.vertices[l+1].clone()),d.vertices.push(a.vertices[l+2].clone()));k=h=f=!0}a=new THREE.Geometry;var n,f=Number.MAX_VALUE,h=new THREE.Matrix4;h.getInverse(c.matrixWorld);b.applyMatrix4(h);for(c=0;c<d.vertices.length;c+=2)h=this.distancePointToLine(b,d.vertices[c],d.vertices[c+1]),h<f&&(f=h,n=c);a.vertices.push(d.vertices[n].clone());
a.vertices.push(d.vertices[n+1].clone());a.vertices=this.getConnectedLineSegmentsOnSameLine(d,a.vertices);g=f;return a};this.distancePointToLine=function(a,b,c){var d=new THREE.Vector3,f=new THREE.Vector3,g;d.subVectors(b,a);f.subVectors(c,b);g=d.dot(f);d.subVectors(c,b);g=-g/d.dot(d);0>g?a=a.distanceTo(b):1<g?a=a.distanceTo(c):(d.subVectors(a,b),f.subVectors(a,c),d.cross(f),f.subVectors(c,b),a=Math.sqrt(d.dot(d))/Math.sqrt(f.dot(f)));return a};this.getConnectedLineSegmentsOnSameLine=function(a,b){var c=
a.vertices.slice(),d=b[0],f=b[1],g=[];do{for(var g=[],h=0;h<c.length;h+=2)if(!c[h].equals(d)||!c[h+1].equals(f))for(var k=0;k<b.length;k+=2)if(c[h].equals(b[k])||c[h+1].equals(b[k])||c[h].equals(b[k+1])||c[h+1].equals(b[k+1])){var l=new THREE.Vector3,m=new THREE.Vector3;l.subVectors(b[k],b[k+1]);l.normalize();m.subVectors(c[h],c[h+1]);m.normalize();if(this.isEqualVectorsWithPrecision(l,m)||this.isInverseVectorsWithPrecision(l,m)){g.push(h);break}}for(h=g.length-1;0<=h;--h)b.push(c[g[h]]),b.push(c[g[h]+
1]),c.splice(g[h],2)}while(0<g.length);return b};this.vertexSnapping=function(a,b){for(var c=Number.MAX_VALUE,d,f=0;f<a.vertices.length;++f){var g=b.distanceTo(a.vertices[f]);g<c-SNAP_PRECISION&&(c=g,d=a.vertices[f].clone())}h=c;return d};this.angleVector2=function(a){return 0<a.x&&0<=a.y?Math.atan(a.y/a.x):0<=a.x&&0>a.y?Math.atan(a.y/a.x)+2*Math.PI:0>a.x&&0>=a.y?Math.atan(a.y/a.x)+Math.PI:0>=a.x&&0<a.y?Math.atan(a.y/a.x)+Math.PI:null};b.prototype.onLineSegment=function(a,b,c,d){var f=this.lineGeom.vertices;
a=new THREE.Vector3(a,b,0);c=new THREE.Vector3(c,d,0);d=this.snapper.getIntersectPoint();d=this.snapper.distancePointToLine(d,a,c);d<this.minDist&&(f.splice(0,2,a,c),this.minDist=d)};b.prototype.onCircularArc=function(a,b,c,d,f){var g=this.snapper.getIntersectPoint(),h=new THREE.Vector2(g.x,g.y),k=new THREE.Vector2(a,b),g=h.distanceTo(k);h.sub(k);h=this.snapper.angleVector2(h);if(g<=f+.1&&g>=f-.1){if(d>c&&h>=c&&h<=d)c=new THREE.CircleGeometry(f,100,c,d-c);else if(d<c&&(h>=c||h<=d))c=new THREE.CircleGeometry(f,
100,c,2*Math.PI-c+d);else return;c.vertices.splice(0,1);this.circularArc=c;this.circularArcCenter=new THREE.Vector3(a,b,0)}};b.prototype.onEllipticalArc=function(a,b,c,d,f,g,h){h=this.snapper.getIntersectPoint();var k=new THREE.Vector2(h.x,h.y);h=(k.x-a)*(k.x-a)/(f*f)+(k.y-b)*(k.y-b)/(g*g);var l=new THREE.Vector2(a,b);k.sub(l);k.x*=g;k.y*=f;k=this.snapper.angleVector2(k);d>2*Math.PI&&(d=2*Math.PI);1.1>=h&&.9<=h&&(d>c&&k>=c&&k<=d||d<c&&(k>=c||k<=d))&&(a=new THREE.EllipseCurve(a,b,f,g,c,d,!1),a=(new THREE.Path(a.getPoints(50))).createPointsGeometry(50),
this.isEqualWithPrecision(d-c,2*Math.PI)||a.vertices.pop(),this.ellipticalArc=a)};this.snapping2D=function(c){if(c){var f=c.intersectPoint,g=c.fragId;if("undefined"!==typeof g){Array.isArray(g)||(g=[g]);p=f;for(var h=new b(a,this),k=0;k<g.length;++k){var q=a.impl.getRenderProxy(a.model,g[k]);(new Autodesk.Viewing.Private.VertexBufferReader(q.geometry)).enumGeomsForObject(c.dbId,h)}h.circularArc?(this.drawArc(h.circularArc,h.circularArcCenter),h.circularArc=null,n=h.circularArcCenter,m=SNAP_VERTEX,
B=!0):h.ellipticalArc?(this.drawArc(h.ellipticalArc),h.ellipticalArc=null):h.lineGeom.vertices.length&&(d=this.setDetectRadius(f),f.distanceTo(h.lineGeom.vertices[0])<d?(n=h.lineGeom.vertices[0],this.drawPoint(n),m=SNAP_VERTEX):f.distanceTo(h.lineGeom.vertices[1])<d?(n=h.lineGeom.vertices[1],this.drawPoint(n),m=SNAP_VERTEX):(l=h.lineGeom,this.drawLine(l),m=SNAP_EDGE),B=!0)}}};this.createOverlay=function(b){a.impl.createOverlayScene(b)};this.addOverlay=function(b,c){a.impl.addOverlay(b,c)};this.clearOverlay=
function(){a.impl.overlayScenes["MeasureTool-snapper-face"]&&a.impl.clearOverlay("MeasureTool-snapper-face");a.impl.overlayScenes["MeasureTool-snapper-vertex"]&&a.impl.clearOverlay("MeasureTool-snapper-vertex");a.impl.overlayScenes["MeasureTool-snapper-edge"]&&a.impl.clearOverlay("MeasureTool-snapper-edge")};this.drawFace=function(a){this.createOverlay("MeasureTool-snapper-face");var b=new THREE.MeshPhongMaterial({color:52224,ambient:52224,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide});
a=new THREE.Mesh(a,b,!0);this.addOverlay("MeasureTool-snapper-face",a)};this.drawLine=function(a){this.createOverlay("MeasureTool-snapper-edge");var b=new THREE.LineBasicMaterial({color:52224,opacity:.5,linewidth:5,depthTest:!1,depthWrite:!1});a=new THREE.Line(a,b,THREE.LinePieces);this.addOverlay("MeasureTool-snapper-edge",a)};this.drawArc=function(a,b){this.createOverlay("MeasureTool-snapper-edge");var c=new THREE.LineBasicMaterial({color:52224,opacity:.5,linewidth:5,depthTest:!1,depthWrite:!1}),
c=new THREE.Line(a,c);b&&c.position.set(b.x,b.y,b.z);this.addOverlay("MeasureTool-snapper-edge",c)};this.drawPoint=function(a){this.createOverlay("MeasureTool-snapper-vertex");var b=new THREE.MeshPhongMaterial({color:52224,ambient:52224,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1}),b=new THREE.Mesh(new THREE.SphereGeometry(1),b);b.position.set(a.x,a.y,a.z);this.setPointScale(b);this.addOverlay("MeasureTool-snapper-vertex",b)};this.setPointScale=function(b){var c=a.navigation,d=c.getCamera(),
f=c.getEyeVector(),g=c.getPosition(),h=b.position.clone(),d=d.isPerspective?h.sub(g).dot(f.normalize()):c.getEyeVector().length(),f=c.getVerticalFov(),d=2*d*Math.tan(THREE.Math.degToRad(.5*f)),c=c.getScreenViewport(),c=5*d/(c.height*(window.devicePixelRatio||1));b.scale.x=c;b.scale.y=c;b.scale.z=c};this.updatePointScale=function(){var b=a.impl.overlayScenes["MeasureTool-snapper-vertex"];if(b)for(var b=b.scene,c=0;c<b.children.length;c++){var d=b.children[c];d&&this.setPointScale(d)}};this.setDetectRadius=
function(b){var c=a.navigation,d=c.getCamera(),f=c.getEyeVector(),g=c.getPosition();b=b.clone();d=d.isPerspective?b.sub(g).dot(f.normalize()):c.getEyeVector().length();f=c.getVerticalFov();d=2*d*Math.tan(THREE.Math.degToRad(.5*f));c=c.getScreenViewport();c=1.5*d/(c.height*(window.devicePixelRatio||1));a.impl.is2d&&(c*=10);return c};this.drawIntersectFace=function(a,b,c,d){this.createOverlay();var f=new THREE.Vector3;f.set(b[a.a*c],b[a.a*c+1],b[a.a*c+2]);var g=new THREE.Vector3;g.set(b[a.b*c],b[a.b*
c+1],b[a.b*c+2]);var h=new THREE.Vector3;h.set(b[a.c*c],b[a.c*c+1],b[a.c*c+2]);a=new THREE.Geometry;a.vertices.push(f);a.vertices.push(g);a.vertices.push(h);a.faces.push(new THREE.Face3(0,1,2));f=new THREE.Mesh(a,d.material,!0);f.matrixWorld=d.matrixWorld;this.addOverlay(f)};this.handleWheelInput=function(a){this.updatePointScale();return!1};this.handleButtonDown=function(a,b){r=!0;return!1};this.handleButtonUp=function(a,b){return r=!1};this.handleMouseMove=function(b){r||(this.clearOverlay(),n=
l=k=null,B=!1,(b=a.impl.renderer().hasMRT()?a.impl.snappingHitTest(b.canvasX,b.canvasY,!1):a.impl.hitTest(b.canvasX,b.canvasY,!1))&&b.intersectPoint&&(b.face?this.snapping3D(b):this.snapping2D(b)));return!1};this.destroy=function(){this.clearOverlay();a.impl.removeOverlayScene("MeasureTool-snapper-face");a.impl.removeOverlayScene("MeasureTool-snapper-vertex");a.impl.removeOverlayScene("MeasureTool-snapper-edge")}};AutodeskNamespace("Autodesk.Viewing.Extensions.FirstPerson");
Autodesk.Viewing.Extensions.FirstPerson.FirstPersonTool=function(a){var b=-1!=navigator.userAgent.search("Mac OS"),c=a.navigation,f=a.container,d=c.getCamera(),g=["firstperson"],h=0,k=Autodesk.Viewing.theHotkeyManager.KEYCODES,l=!1,n=!0,q=!1,m=null,p=new THREE.Clock(!0),t=-1,r=5E3,B=1,z=2,F=0,C=-1E20,w=-1E20,E=0,A=0,D=!1,I=!1,G=!1,H=!1,K=!1,J=!1;this.isActive=function(){return l};this.getNames=function(){return g};this.getName=function(){return g[0]};this.activate=function(b){p.start();c.toPerspective();
c.setVerticalFov(75,!0);a.model.getUnitScale();b=a.model.getBoundingBox().size();B=Math.max(Math.min(Math.min(b.x,b.y),b.z)/10,1E-4);a.canvas.focus();l=!0};this.deactivate=function(a){l=!1;p.stop();Autodesk.Viewing.Private.HudMessage.dismiss();t=-1};this.getCursor=function(){return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3goOFQoQszohGAAAA9hJREFUSMedll1oHGUUhp8zuzP5291pEvNTomgVjFCCCa0NpAqJEJTUFVv8uWxQLwKCF6IUr7wJ6J30QvBCAlZssA0EkYJaAm1FwU3iakrbVNNuutlukk3dzWyT/ZnJ7ufFTtokbmvX72Y45+N73/Oe8858I+xYSikBJJFI7AmFQh9alvVWoVC47vP5ho4cOXJeRGwqWN4yOQ2oHh0dPROJRNo7OjqIRCKPRxeiP66srBxSSn0vIsX/RaCU0gDV399vNjQ0tB8/fpxAIEAsFuP06dPEYrFvgHqguEMxIqLKdUPbmnArU52dnb2maWJUGeRyOWzbpqGxgXg87gOMncDlwLe2Y5uCwcHBFp/P90k4PE349xkWolGi0SjhPy5hF+UmIEopz/1AtxRcqmJzDQ8P7750+Wq8e9+TPGLe4sSp39jz9LMsxm/izE6gOVnquoIcOHDgnddfe/VEU3PLWkUzSCQSesCzxNtvHKZu11O0137OuTMneYY1+l+px99sci5zgU+/Pv/Z5OTkWeCvigja2tqqri3/RPbiMfSWLvY+/wJ7XwxCOoyz+gPF5C0OzsFZv8NEOOxU7KL5+fkcooFUo9avYt+4htTU43noJVTmIPYvp8hnChSKCr/fr1VMkEqlCgEATUDTAIVykhSWRtj4M4/KKzZ9Z9u2ehCCbVUYhlEaurg7m09NB/GWYhe2r69vV8UEvb29DeIWL+6uIG6w6b1SGAqF0hUTZDKZ7GLKy1w0h+Z1keQuMEDOKbK+oZFIJOyKZqCUEsuy/k4mk6kr0ZH6/Z2CkrttEl1QjuJkKI3z6KGp6vTFpYoVmKaZ9Xg8lleDoq3IzOdBILuygbVgs2YVSNrgOM7o1NTURkUE7qufX15evo5A0VHcnrNRgFgFJF6gsVmntlaIxWKNIlK/s8D/VCAianZ29spmv0vfVoVuaNT6PYhWMpGIGIZhNAGtQC3bbXDfj51YlrWObHeOKu3didfX1x3btgGqgADgu5eafyXT6XT2zmDLnVDg9Xq9uq573fMeQAeqy+HtTAgguq7h0aUsgyZCJpPZcBxnE1xz3fhACqp7enoe+3ZimVg8j6ELiIACEUETWErnsCwrD2h1dXW6C+4A2a033T0VfPD+e8dePvoFb36sM/LzKomkQ1FgMW3z7neL3Gh6jtbW1rmamhrDNM0NYAVIAYWyl06ZPwoNeHh6evqJmZmZiV8vnCBw+yLRRCv7gkdpamr6aGho6KuBgQFnfHx88V7AZQlcEt01jgD+sbGx3V+OjPR07d8fDQaDl1OpVLK7u9swTXP1Qa7NfwCi46BIaoRmhAAAAABJRU5ErkJggg==), auto"};
this.adjustSpeed=function(a){0===a?z=2:(z*=0<a?1.1:.9,.01>z&&(z=.01))};this.handleGesture=function(a){switch(a.type){case "dragstart":return m="drag",this.handleButtonDown(a,0);case "dragmove":return"drag"===m?this.handleMouseMove(a):!1;case "dragend":if("drag"===m)return this.handleButtonUp(a,0),m=null,!0}return!1};this.handleSingleClick=function(a,b){return!1};this.handleButtonDown=function(a,c){var d;m?d=!0:(d=a.metaKey&&!b,d=a.ctrlKey||b&&a.metaKey||d||a.shiftKey||a.altKey);0!==c||d||(E=A=0,q=
!0);return!0};this.handleMouseMove=function(a){var b=-1E10>C?0:a.pageX-C,c=-1E10>w?0:a.pageY-w;C=a.pageX;w=a.pageY;q===n&&(E+=.007*b,A+=.007*c);return!0};this.handleButtonUp=function(a,b){0===b&&q&&(E=A=0,q=!1);return!0};this.handleKeyDown=function(a,b){var c=!1;switch(b){case k.TAB:c=!1;break;case k.SHIFT:h=1;c=!0;break;case k.CONTROL:c=!0;break;case k.ALT:c=!0;break;case k.SPACE:c=!0;break;case k.EQUALS:this.adjustSpeed(1);c=!0;break;case k.DASH:this.adjustSpeed(-1);c=!0;break;case k.ZERO:this.adjustSpeed(0);
c=!0;break;case k.UP:case k.w:c=D=!0;break;case k.LEFT:case k.a:c=G=!0;break;case k.DOWN:case k.s:c=I=!0;break;case k.RIGHT:case k.d:c=H=!0;break;case k.q:c=K=!0;break;case k.e:c=J=!0;break;case k.g:c=!0;break;case k.F1:c=!0}return c};this.handleKeyUp=function(a,b){var c=!1;switch(b){case k.TAB:c=!1;break;case k.SHIFT:h=0;c=!0;break;case k.CONTROL:c=!0;break;case k.ALT:c=!0;break;case k.SPACE:c=!0;break;case k.UP:case k.w:D=!1;c=!0;break;case k.LEFT:case k.a:G=!1;c=!0;break;case k.DOWN:case k.s:I=
!1;c=!0;break;case k.RIGHT:case k.d:H=!1;c=!0;break;case k.q:K=!1;c=!0;break;case k.e:J=!1;c=!0;break;case k.g:n=!n;M({msgTitleKey:"Dragging Look Mode Toggled",messageKey:"Dragging Look Mode Toggled",messageDefaultValue:n?"Press the primary mouse button and drag to change the view orientation.":"Move the cursor to change the view orientation."},5E3);c=!0;break;case k.F1:M({msgTitleKey:"First Person Tool",messageKey:"First Person Tool",messageDefaultValue:"Use the WASD and QE keys to move.  Shift+Key to move faster.  G key to toggle drag mode for changing view orientation."},
5E3),c=!0}return c};this.handleWheelInput=function(a){c.getReverseZoomDirection()&&(a*=-1);F+=a;return!0};this.handleSingleClick=function(a,b){return!1};this.handleDoubleClick=function(a,b){return!1};this.handleSingleTap=function(a){return this.handleSingleClick(a,0)};this.handleDoubleTap=function(a){return!1};this.handleBlur=function(a){return K=J=G=H=D=I=!1};this.update=function(){if(!l)return!1;var a=p.getDelta();-1<t&&(new Date).getTime()-t>r&&(Autodesk.Viewing.Private.HudMessage.dismiss(),t=
-1);d.isPerspective||(console.log("Lost perspective mode: resetting view."),c.toPerspective());var b=d.clone(),f=a*z*B*(1===h?4:1),a=.5*a*B*(1===h?4:1);0!=F&&(b.translateZ(-(1*F*B*(1===h?4:1))),F=0);D&&b.translateZ(-f);I&&b.translateZ(f);G&&b.translateX(-f);H&&b.translateX(f);K&&b.translateY(a);J&&b.translateY(-a);var f=b.position,a=0!==f.distanceToSquared(d.position),g=b.target,g=d.target.clone().sub(d.position),k=g.clone().cross(d.up).normalize();if(0!=A){var m=new THREE.Quaternion;m.setFromAxisAngle(k,
-A);k=g.clone();k.applyQuaternion(m);var n=d.worldup.clone(),k=k.angleTo(n),n=THREE.Math.degToRad(5);k>=n&&k<=Math.PI-n&&(g.applyQuaternion(m),b.up.applyQuaternion(m));A=0}0!=E&&(m=new THREE.Quaternion,m.setFromAxisAngle(d.worldup,-E),g.applyQuaternion(m),b.up.applyQuaternion(m),E=0);g=f.clone().add(g);b=0!==g.distanceToSquared(d.target);if(a||b)c.setView(f,g),c.orientCameraUp();return d.dirty};var M=function(a,b,c,d){Autodesk.Viewing.Private.HudMessage.displayMessage(f,a,c,d);0<b?(t=(new Date).getTime(),
r=b):(t=-1,r=0)}};"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.FirstPerson");Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)};Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype);Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.constructor=Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension;
Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.load=function(){var a=this,b=this.viewer,c=b.getToolbar(!0),f=Autodesk.Viewing.UI;this.tool=new Autodesk.Viewing.Extensions.FirstPerson.FirstPersonTool(b);b.toolController.registerTool(this.tool);this.createUI(c);this.onToolChanged=function(b){-1!==b.toolName.indexOf("firstperson")&&a.firstPersonToolButton.setState(b.active?f.Button.State.ACTIVE:f.Button.State.INACTIVE)};b.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged);
return!0};
Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.createUI=function(a){var b=this,c=this.viewer,f=Autodesk.Viewing.UI;a=a.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.firstPersonToolButton=new f.Button("toolbar-firstPersonTool");this.firstPersonToolButton.setToolTip("First person");this.firstPersonToolButton.onClick=function(a){a=b.firstPersonToolButton.getState();a===f.Button.State.INACTIVE?c.setActiveNavigationTool("firstperson"):a===f.Button.State.ACTIVE&&c.setActiveNavigationTool()};
this.firstPersonToolButton.setIcon("adsk-icon-first-person");var d=a.getControl("toolbar-cameraSubmenuTool");d?a.addControl(this.firstPersonToolButton,{index:a.indexOf(d.getId())}):a.addControl(this.firstPersonToolButton)};
Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.unload=function(){var a=this.viewer;a.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged);this.onToolChanged=void 0;Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID);var b=a.getToolbar(!1);b&&b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.firstPersonToolButton.getId());this.firstPersonToolButton=null;a.getActiveNavigationTool()==this.tool.getName()&&a.setActiveNavigationTool();
a.toolController.deregisterTool(this.tool);this.tool=null;return!0};Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.FirstPerson",Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension);AutodeskNamespace("Autodesk.Viewing.Extensions.VR");
Autodesk.Viewing.Extensions.VR.VRTool=function(a,b){var c=a.navigation,f=a.container,d=c.getCamera(),g=["vr"],h=!1,k=null,l=!1,n=0,q=0,m=Autodesk.Viewing.theHotkeyManager.KEYCODES,p=0,t=!1,r=!1,B=!1,z=!1,F=!1,C=!1,w=new THREE.Clock(!0),E=-1,A=5E3,D=1,I=16,G=!1,H=16,K=d.isPerspective,J=null,M=null,L=null,P=!1,S=-1,Y=!0,U=null,Z=null,da=!1,V=new THREE.Vector3(0,0,0),O=new THREE.Vector3(0,0,0),ca=!1;this.isActive=function(){return h};this.getNames=function(){return g};this.getName=function(){return g[0]};
this.activate=function(b){h||(l=d.worldup&&1===d.worldup.z,console.log("VRTool : camera world up = "+d.worldup.x+","+d.worldup.y+","+d.worldup.z),w.start(),ba()?(X({msgTitleKey:"VR Head Mounted Display",messageKey:"VR Head Mounted Display",messageDefaultValue:"VR Mode Enabled (Head Mounted Display) - Use SPACE key to toggle move control."},2E3),W(!1),console.log("VR Supported (Web API): Oculus, etc.")):(X({msgTitleKey:"VR Device Orientation",messageKey:"VR Device Orientation",messageDefaultValue:"VR Mode Enabled (Device Orientation)"},
2E3),window.addEventListener("deviceorientation",fa,!0)),ca="wearality"===(a.config&&a.config.useVR?a.config.useVR:"").toLowerCase(),N(!0),b=a.utilities.getBoundingBox(!0).size(),D=Math.max(Math.min(Math.min(b.x,b.y),b.z)/100,1),this.resetPointerTracking(),a.canvas.focus(),ia(),h=!0)};this.deactivate=function(a){h&&(h=!1,Autodesk.Viewing.Private.HudMessage.dismiss(),E=-1,J&&(L&&(L.stop(),L=null),J.disconnect(),J=null,M&&M.disable()),N(!1),exitFullscreen(),w.stop(),W(!0))};this.getCursor=function(){return"url(data:image/gif;base64,R0lGODlhGAAYAMIDAAQEBH19feDg4P///////////////////yH+EUNyZWF0ZWQgd2l0aCBHSU1QACH5BAEKAAQALAAAAAAYABgAAAMqSLrc/jDKSau9OOvN8fjDNghBIITZEABAgHpr+15jeYpgp+987//AICEBADs=), auto"};
var W=function(a){var b=document.getElementsByClassName("toolbar-menu");0<b.length&&""!==b[0]&&(b[0].style.display=a?"block":"none")},N=function(b){if(b!==!!k)if(console.log("Enable Render Context: "+b),b){a.displayViewCube(!1,!1);(K=a.navigation.isPerspective)||a.navigation.toPerspective();b=!!U;var c=null,c=ca?{useWarp:b,HMD:{hResolution:1920,vResolution:1080,hScreenSize:.12576,vScreenSize:.07074,interpupillaryDistance:.075,lensSeparationDistance:.075,eyeToScreenDistance:.041,distortionK:[1,.22,
.24,0],chromaAbParameter:[.996,-.004,1.014,0]}}:{useWarp:b};k=new Autodesk.Viewing.Extensions.Oculus.StereoRenderContext(c);a.impl.setUserRenderContext(k);a.resize(a.canvas.clientWidth,a.canvas.clientHeight);U?launchFullscreen(a.impl.canvas,{vrDisplay:U}):launchFullscreen(a.impl.canvas)}else k=null,a.impl.setUserRenderContext(null),a.setScreenMode(Autodesk.Viewing.ScreenMode.kNormal),a.displayViewCube(a.prefs.get("viewCube"),!1)};this.handleSingleTap=function(b){if(J&&b.pointers){if(1===b.pointers.length)return setTimeout(function(){a.setActiveNavigationTool(a.defaultNavigationToolName)},
10),!0;if(2===b.pointers.length)return ea(),!0}return!1};this.handleDoubleTap=function(a){return!1};this.handlePressHold=function(a){return!1};this.handleGesture=function(a){return!1};this.handleKeyDown=function(a,b){var c=!1;switch(b){case m.TAB:c=!0;break;case m.SHIFT:n=1;c=!0;break;case m.CONTROL:q=1;c=!0;break;case m.ALT:c=!0;break;case m.SPACE:c=!0;break;case m.EQUALS:this.adjustSpeed(1);c=!0;break;case m.DASH:this.adjustSpeed(-1);c=!0;break;case m.ZERO:this.adjustSpeed(0);c=!0;break;case m.w:if(1===
q&&1===n){c=!0;break}case m.UP:c=t=!0;break;case m.LEFT:case m.a:c=B=!0;break;case m.DOWN:case m.s:c=r=!0;break;case m.RIGHT:case m.d:c=z=!0;break;case m.q:c=C=!0;break;case m.e:c=F=!0;break;case m.h:c=!0}return c};this.handleKeyUp=function(a,b){var c=!1;switch(b){case m.SHIFT:n=0;break;case m.CONTROL:q=0;break;case m.SPACE:U&&U&&((da=!da)&&V.copy(O),aa(da));c=!0;break;case m.w:if(!t&&1===q&&1===n){setTimeout(function(){N(!1);ca=!ca;N(!0)},10);c=!0;break}case m.UP:t=!1;c=!0;break;case m.LEFT:case m.a:B=
!1;c=!0;break;case m.DOWN:case m.s:r=!1;c=!0;break;case m.RIGHT:case m.d:z=!1;c=!0;break;case m.q:C=!1;c=!0;break;case m.e:F=!1;c=!0;break;case m.h:ia(),c=!0}return c};this.handleBlur=function(a){return z=B=r=t=!1};this.update=function(a){if(h){a=w.getDelta();-1<E&&(new Date).getTime()-E>A&&(Autodesk.Viewing.Private.HudMessage.dismiss(),E=-1);var b;if(b=!!U)if(Z){b=Z.getState();if(d){l?(O.x=b.position.x,O.y=-b.position.z,O.z=b.position.y):(O.x=b.position.x,O.y=b.position.y,O.z=b.position.z);if(da){var f=
V.distanceTo(O);.15<=f&&(f=(f-.15)/.0762*I*D*a,f=O.clone().sub(V).normalize().multiplyScalar(f),d.position.add(f))}l?(d.quaternion.x=b.orientation.x,d.quaternion.y=-b.orientation.z,d.quaternion.z=b.orientation.y):(d.quaternion.x=b.orientation.x,d.quaternion.y=b.orientation.y,d.quaternion.z=b.orientation.z);d.quaternion.w=b.orientation.w;b=new THREE.Vector3(0,0,-1);l&&(b=new THREE.Vector3(b.x,-b.z,b.y));b.applyQuaternion(d.quaternion);d.target=d.position.clone().add(b.clone().multiplyScalar(10));d.dirty=
!0}b=!0}else b=!1;!b&&J&&J&&(b=J.update())&&(l&&(f=b.z,b.z=b.y,b.y=-f),b=(l?new THREE.Vector3(0,1,0):new THREE.Vector3(0,0,-1)).clone().applyQuaternion(b),f=d.target.clone().sub(d.position).length(),c.setTarget(d.position.clone().add(b.multiplyScalar(f))),L?L.isStarted()&&(0>=S?L.checkVideoThreshold(15)&&ea():L.checkVideoThreshold(15)?G&&(b=(new Date).getTime(),f=b-S,250<f&&(S=b,I+=H,aa(!0))):S=-1):(f=l?new THREE.Vector3(0,0,-1):new THREE.Vector3(0,-1,0),b=THREE.Math.radToDeg(b.angleTo(f)),30>b)?
P?G&&(b=(new Date).getTime(),f=b-S,f>=(Y?1500:1E3)&&(Y=!1,S=b,I+=H,aa(!0))):(ea(),P=!0,G&&(Y=!0)):30<=b&&(P=!1,S=-1),d.dirty=!0);b=d.clone();f=a*I*D*(1===n?4:1);a=15*a*D*(1===n?4:1);0!=p&&(b.translateZ(-(3*p*D*(1===n?4:1))),p=0);var g=!1;G&&(g=!0);(t||g)&&b.translateZ(-f);r&&b.translateZ(f);B&&b.translateX(-f);z&&b.translateX(f);F&&b.translateY(a);C&&b.translateY(-a);a=b.position;0!==a.distanceToSquared(d.position)&&(b=b.target,f=a.clone().sub(d.position),b.add(f),c.setView(a,b));return d.dirty}};
this.resetPointerTracking=function(){_mouseDraggingLookMode=F=C=B=z=t=r=!1};var ea=function(){(G=!G)?(H=I,I=1.75,S=(new Date).getTime()):I=H;aa(G);return G},ba=function(){function a(c){for(var d=0;d<c.length;++d)c[d]instanceof HMDVRDevice&&(U=c[d]);for(d=0;d<c.length;++d)c[d]instanceof PositionSensorVRDevice&&(!U||c[d].hardwareUnitId==U.hardwareUnitId)&&(Z=c[d],b=!0)}var b=!1;navigator.getVRDevices?navigator.getVRDevices().then(a):navigator.mozGetVRDevices?navigator.mozGetVRDevices(a):b=!1;return b},
fa=function(a){if(!a.alpha)return!1;window.removeEventListener("deviceorientation",fa,!0);J=new THREE.DeviceOrientationControls;J.connect();M||(M=new window.NoSleep,M.enable());L=new VideoHelper("videoVR","videoVR-canvas",1);L.start()||(L=null,console.log("VideoHelper : Failed to start."));W(!1);console.log("VR Supported (DeviceOrientation): Google Goggles, etc.");return!0},X=function(a,b){Autodesk.Viewing.Private.HudMessage.dismiss();Autodesk.Viewing.Private.HudMessage.displayMessage(f,a);E=(new Date).getTime();
if(!b||0>=b)b=5E3;A=b},ia=function(){X({msgTitleKey:"Virtual Reality Tool",messageKey:"Virtual Reality Tool",messageDefaultValue:"This is the Virtual Reality tool."},3E3)},aa=function(a,b){if(!b||0>=b)b=250;X({msgTitleKey:"VR Toggle Move",messageKey:"VR Toggle Move",messageDefaultValue:a?"START Auto Move ("+Math.floor(I)+")":"STOP Auto Move"},b)}};"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.VR");
Autodesk.Viewing.Extensions.VR.VRExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)};Autodesk.Viewing.Extensions.VR.VRExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype);Autodesk.Viewing.Extensions.VR.VRExtension.prototype.constructor=Autodesk.Viewing.Extensions.VR.VRExtension;
Autodesk.Viewing.Extensions.VR.VRExtension.prototype.load=function(){var a=this,b=this.viewer,c=b.getToolbar(!0),f=Autodesk.Viewing.UI;this.tool=new Autodesk.Viewing.Extensions.VR.VRTool(b,this);b.toolController.registerTool(this.tool);this.createUI(c);this.onToolChanged=function(b){-1!==b.toolName.indexOf("vr")&&a.vrToolButton.setState(b.active?f.Button.State.ACTIVE:f.Button.State.INACTIVE)};b.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged);return!0};
Autodesk.Viewing.Extensions.VR.VRExtension.prototype.createUI=function(a){var b=this,c=this.viewer,f=Autodesk.Viewing.UI;a=a.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.vrToolButton=new f.Button("toolbar-vrTool");this.vrToolButton.setToolTip("Virtual Reality Tool");this.vrToolButton.setIcon("toolbar-vrToolButton");this.vrToolButton.onClick=function(a){a=b.vrToolButton.getState();a===f.Button.State.INACTIVE?c.setActiveNavigationTool("vr"):a===f.Button.State.ACTIVE&&c.setActiveNavigationTool()};
var d=a.getControl("toolbar-cameraSubmenuTool");d?a.addControl(this.vrToolButton,{index:a.indexOf(d.getId())}):a.addControl(this.vrToolButton)};
Autodesk.Viewing.Extensions.VR.VRExtension.prototype.unload=function(){var a=this.viewer;a.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged);this.onToolChanged=void 0;Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID);var b=a.getToolbar(!1);b&&b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.vrToolButton.getId());this.vrToolButton=null;a.toolController.deregisterTool(this.tool);this.tool=null;return!0};
Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.VR",Autodesk.Viewing.Extensions.VR.VRExtension);AutodeskNamespace("Autodesk.Viewing.Extensions.FusionOrbit");
(function(){var a=Autodesk.Viewing.Extensions.FusionOrbit;a.FusionOrbitExtension=function(a,c){Autodesk.Viewing.Extension.call(this,a,c)};a.FusionOrbitExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype);a.FusionOrbitExtension.prototype.constructor=a.FusionOrbitExtension;a.FusionOrbitExtension.prototype.load=function(){function a(){f.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a);c.createUI()}var c=this,f=this.viewer,d=f.getToolbar?f.getToolbar(!0):void 0;this.tool=
new Autodesk.Viewing.Extensions.FusionOrbit.FusionOrbitTool(f);f.toolController.registerTool(this.tool);d?(d=d.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID))&&0<d.getNumberOfControls()?a():f.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a):f.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a);return!0};a.FusionOrbitExtension.prototype.createUI=function(){var a=this.viewer,c=Autodesk.Viewing.UI,f=a.getToolbar(!1).getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.classicBehavior=
{};this.classicBehavior.orbitOnClick=f.orbitbutton.onClick;this.classicBehavior.freeorbitOnClick=f.freeorbitbutton.onClick;this.classicBehavior.returnToDefault=f.returnToDefault;f.freeorbitbutton.onClick=function(d){d=f.freeorbitbutton.getState();d===c.Button.State.INACTIVE?(a.setActiveNavigationTool("fusion orbit"),f.freeorbitbutton.setState(c.Button.State.ACTIVE)):d===c.Button.State.ACTIVE&&(a.setActiveNavigationTool(),f.freeorbitbutton.setState(c.Button.State.INACTIVE))};f.orbitbutton.onClick=
function(d){d=f.orbitbutton.getState();d===c.Button.State.INACTIVE?(a.setActiveNavigationTool("fusion orbit constrained"),f.orbitbutton.setState(c.Button.State.ACTIVE)):d===c.Button.State.ACTIVE&&(a.setActiveNavigationTool(),f.orbitbutton.setState(c.Button.State.INACTIVE))};f.returnToDefault=function(){f.orbittoolsbutton.setState(c.Button.State.ACTIVE);f.orbittoolsbutton.setState(c.Button.State.INACTIVE)};f.orbittoolsbutton.setState(c.Button.State.INACTIVE);a.prefs.fusionOrbitConstrained?(f.orbittoolsbutton.onClick=
f.orbitbutton.onClick,f.orbittoolsbutton.setIcon(f.orbitbutton.iconClass),a.setDefaultNavigationTool("orbit")):(f.orbittoolsbutton.onClick=f.freeorbitbutton.onClick,f.orbittoolsbutton.setIcon(f.freeorbitbutton.iconClass),a.setDefaultNavigationTool("freeorbit"));a.setActiveNavigationTool();f.returnToDefault()};a.FusionOrbitExtension.prototype.unload=function(){var a=this.viewer,c=a.getToolbar(!1).getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);c.orbitbutton.onClick=this.classicBehavior.orbitOnClick;
c.freeorbitbutton.onClick=this.classicBehavior.freeorbitOnClick;c.returnToDefault=this.classicBehavior.returnToDefault;c.orbittoolsbutton&&(c.orbittoolsbutton.onClick=c.orbitbutton.onClick,c.orbittoolsbutton.setIcon("adsk-icon-orbit-constrained"),c.orbittoolsbutton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE));a.setActiveNavigationTool("orbit");a.setDefaultNavigationTool("orbit");a.toolController.deregisterTool(this.tool);this.tool=null;return!0};Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.FusionOrbit",
a.FusionOrbitExtension)})();Autodesk.Viewing.Extensions.FusionOrbit.html='<div class="orbit-gizmo noselect">\n<div class="outside"></div>\n<div class="ring"></div>\n<div class="layout-hor">\n<div class="edgemark-area"><div class="edgemark"></div></div>\n</div>\n<div class="layout-mid">\n<div class="layout-ver">\n<div class="edgemark-area"><div class="edgemark"></div></div>\n</div>\n<div class="circle">\n<div class="crosshair-area">\n<div class="crosshair-v"></div>\n<div class="crosshair-h"></div>\n</div>\n</div>\n<div class="layout-ver">\n<div class="edgemark-area"><div class="edgemark"></div></div>\n</div>\n</div>\n<div class="layout-hor">\n<div class="edgemark-area"><div class="edgemark"></div></div>\n</div>\n</div>';
Autodesk.Viewing.Extensions.FusionOrbit.FusionOrbitTool=function(a,b){var c=["fusion orbit","fusion orbit constrained"],f,d,g,h,k,l=a.navigation,n,q=isTouchDevice(),m=!1,p={buttons:[],src:void 0,x:0,y:0,dx:0,dy:0,firstMove:!0,mode:void 0},t=function(a){p.buttons[a.touches?0:a.button]=!0;p.src=a.target.className;p.x=0;p.y=0;p.dx=0;p.dy=0;p.firstMove=!0;p.mode=void 0;"ring"===p.src?p.mode=2:"edgemark-area"===p.src&&("layout-ver"===a.target.parentNode.className?p.mode=0:"layout-hor"===a.target.parentNode.className&&
(p.mode=1));C();a.stopPropagation()},r=function(a){p.buttons[a.touches?0:a.button]=!1;p.src=void 0},B=function(a){if(p.buttons[0]){var b=a.touches?a.touches[0].pageX:a.pageX;a=a.touches?a.touches[0].pageY:a.pageY;p.firstMove||(p.dx=b-p.x,p.dy=a-p.y);p.x=b;p.y=a;b=n.target.clone().sub(n.position).normalize();a=b.clone().cross(n.up).normalize();var c=a.clone().cross(b).normalize();n.up.copy(c);if(2===p.mode){var f=new THREE.Vector3(p.x-d.center.x,p.y-d.center.y,0),g=(new THREE.Vector3(p.dx,p.dy,0)).add(f);
f.normalize();g.normalize();f=f.clone().cross(g);f=Math.asin(f.z);n.up.applyAxisAngle(b,1*-f)}else 0===p.mode?(g=.005*-p.dx,k&&(n.up=Autodesk.Viewing.Navigation.snapToAxis(n.up.clone())),f=n.up):1===p.mode&&(g=.005*-p.dy,k?(p.firstMove&&(n.up=Autodesk.Viewing.Navigation.snapToAxis(n.up.clone())),f=b.clone().cross(n.up).normalize()):f=a,n.up.applyAxisAngle(f,g)),b=l.getPivotPoint(),a=n.position.clone().sub(b),a.applyAxisAngle(f,g),n.position.addVectors(b,a),a=n.target.clone().sub(b),a.applyAxisAngle(f,
g),n.target.addVectors(b,a);n.dirty=!0;p.firstMove=!1}},z=function(){var b=n.target.clone().sub(n.position).normalize();return(b=a.impl.rayIntersect(new THREE.Ray(n.position,b)))&&b.intersectPoint?b.intersectPoint:n.target},F=function(a,b){var c=b||a.clone().sub(n.position).normalize();return new THREE.Plane(c,-c.x*a.x-c.y*a.y-c.z*a.z)},C=function(){var a=n.target.clone().sub(n.position).normalize(),b=F(n.position,a).distanceToPoint(n.pivot);n.pivot.copy(a).multiplyScalar(b).add(n.position)},w=function(a){a.touches||
0!==a.button||C()},E=function(b){m&&a.setActiveNavigationTool()},A=function(b,c){var d=a.impl.hitTest(b,c),d=d&&d.intersectPoint?d.intersectPoint:a.impl.viewportToRay(a.impl.clientToViewport(b,c)).intersectPlane(F(n.target)),f=n.position.clone().sub(z()).add(d);l.setRequestTransition(!0,f,d,n.fov)};this.register=function(){f=stringToDOM(Autodesk.Viewing.Extensions.FusionOrbit.html);f.style.display="none";a.canvasWrap.insertBefore(f,a.canvasWrap.firstChild);g=f.querySelector(".ring");g.addEventListener("mousedown",
t);Array.prototype.forEach.call(f.querySelectorAll(".edgemark-area"),function(a,b){a.addEventListener("mousedown",t);q&&a.addEventListener("touchstart",t)});window.addEventListener("mouseup",r);window.addEventListener("mousemove",B);h=f.querySelector(".outside");h.addEventListener("mousedown",E);var b=f.querySelector(".circle");b.addEventListener("mousedown",w);q&&(g.addEventListener("touchstart",t),window.addEventListener("touchend",r),window.addEventListener("touchmove",B),h.addEventListener("touchstart",
E),b.addEventListener("touchstart",w));n=a.impl.camera};this.deregister=function(){window.removeEventListener("mouseup",r);window.removeEventListener("mousemove",B);q&&(window.removeEventListener("touchend",r),window.removeEventListener("touchmove",B));g=f=void 0};this.activate=function(b){f.style.display="";this.handleResize();(k="fusion orbit constrained"===b)?(a.setDefaultNavigationTool("orbit"),a.prefs.set("fusionOrbitConstrained",!0)):(a.setDefaultNavigationTool("freeorbit"),a.prefs.set("fusionOrbitConstrained",
!1));a.navigation.setZoomTowardsPivot(!0)};this.deactivate=function(b){f.style.display="none";a.navigation.setZoomTowardsPivot(a.prefs.zoomTowardsPivot)};this.getNames=function(){return c};this.getName=function(){return c[0]};this.update=function(){return!1};this.handleSingleClick=function(a,b){A(a.canvasX,a.canvasY);return!0};this.handleDoubleClick=function(a,b){return!0};this.handleSingleTap=function(a){A(a.canvasX,a.canvasY);return!0};this.handleDoubleTap=function(a){return!1};this.handleKeyDown=
function(a,b){return!1};this.handleKeyUp=function(a,b){return!1};this.handleWheelInput=function(a){return!1};this.handleButtonDown=function(a,b){return!1};this.handleButtonUp=function(a,b){return!1};this.handleMouseMove=function(b){var c=a.impl.canvas.getBoundingClientRect();b=1.2<(c.width>c.height?new THREE.Vector2(((b.canvasX+.5)/c.width*2-1)*c.width/c.height,2*-((b.canvasY+.5)/c.height)+1):new THREE.Vector2((b.canvasX+.5)/c.width*2-1,(2*-((b.canvasY+.5)/c.height)+1)*c.height/c.width)).length();
m!==b&&(h.style.cursor=b?"":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto",
m=b);return!1};this.handleGesture=function(a){C();return!1};this.handleBlur=function(a){return!1};this.handleResize=function(){d=f.getBoundingClientRect();d.center={};d.center.x=d.left+d.width/2;d.center.y=d.top+d.height/2;var a=.8*(window.innerWidth>window.innerHeight?window.innerHeight:window.innerWidth);f.style.width=f.style.height=""+a+"px";f.style.top=f.style.left="calc(50% - "+a/2+"px)";g.style.borderWidth=""+.1*a+"px"}};AutodeskNamespace("Autodesk.Viewing.Private.Collaboration");
(function(){function a(a,b,c){function d(b){b=b.data.msg;n.x=b.x1;n.y=b.y1;q.x=b.x2;q.y=b.y2;m=b.explode;b.command&&("gohome"==b.command?(n.x=n.y=0,q.x=q.y=0,a.navigation.setRequestHomeView(!0),a.showAll(),a.impl.selector.clearSelection(),a.explode(0),p=null):"select"==b.command?(b=a.impl.hitTestViewport(new THREE.Vector3(0,0,0)))?a.impl.selector.toggleSelection(b.dbId):a.impl.selector.clearSelection():"hide"==b.command?(b=a.impl.hitTestViewport(new THREE.Vector3(0,0,0)))&&a.hide(b.dbId):"fly"==b.command?
p=p?null:t.target.clone().sub(t.position).normalize():"savepoint"==b.command?(b=z.getState(w),F.push(b),alertify.success("Savepoint created.")):"nextsavepoint"==b.command&&F.length&&(C>=F.length&&(C=0),z.restoreState(F[C++])))}var n=new THREE.Vector2,q=new THREE.Vector2,m=0,p=null,t,r=.02,B=.002,z,F=[],C=0,w={seedURN:!1,objectSet:!0,viewport:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}},E=function(){if(!a.impl.svfloader.isf2d){var b=a.impl.svfloader.svf.bbox.size().length();
r*=b;B*=b;a.removeEventListener(Autodesk.Viewing.PROGRESS_UPDATE_EVENT,E)}};a.addEventListener(Autodesk.Viewing.PROGRESS_UPDATE_EVENT,E);this.getNames=function(){return["joystick"]};this.getName=function(){return"joystick"};this.activate=function(m){b.addEventListener("joystick",d);c.addEventListener("joystick",d);t=a.navigation.getCamera();a.model&&(a.model.getBoundingBox().size().length(),z=new f.ViewerState(a))};this.deactivate=function(a){b.removeEventListener("joystick",d);c.removeEventListener("joystick",
d);z=t=null;F.length=0};this.update=function(b){t.isPerspective||a.navigation.toPerspective();p&&(b=p.clone().multiplyScalar(B),t.position.add(b),t.target.add(b));0!=m&&(b=a.getExplodeScale()+.01*m,1<b&&(b=1),0>b&&(b=0),a.explode(b));if(0==n.x&&0==n.y&&0==q.x&&0==q.y)return!(!p&&!m);var c=t.target.clone().sub(t.position);b=c.length();c.multiplyScalar(1/b);var d=c.clone().cross(t.up).normalize(),f=c.clone().multiplyScalar(n.y*r);t.position.add(f);t.target.add(f);f=d.clone().multiplyScalar(n.x*r);t.position.add(f);
t.target.add(f);f=new THREE.Quaternion;f.setFromAxisAngle(d,.05*q.y);c=c.clone().applyQuaternion(f);t.up.applyQuaternion(f);d=new THREE.Quaternion;d.setFromAxisAngle(t.worldup,.05*-q.x);c.applyQuaternion(d);t.up.applyQuaternion(d);c.multiplyScalar(b);t.target.copy(t.position).add(c);p&&p.copy(t.target).sub(t.position).normalize();return!0};this.handleSingleClick=function(a,b){return!1};this.handleDoubleClick=function(a,b){return!1};this.handleSingleTap=function(a){return!1};this.handleDoubleTap=function(a,
b){return!1};this.handleKeyDown=function(a,b){return!1};this.handleKeyUp=function(a,b){return!1};this.handleWheelInput=function(a){return!1};this.handleButtonDown=function(a,b){return!1};this.handleButtonUp=function(a,b){return!1};this.handleMouseMove=function(a){return!1};this.handleGesture=function(a,b){return!1};this.handleTouchChange=function(a,b){return!1};this.handleBlur=function(a){return!1};this.handleResize=function(){}}var b=Autodesk.Viewing,c=b.Extensions,f=b.Private,d=b.UI;c.RemoteControl=
function(c,d){b.Extension.call(this,c,d);this.viewer=c;this.client=f.MessageClient.GetInstance();this.p2p=new f.P2PClient(this.client);this.controllerTool=new a(c,this.client,this.p2p);c.toolController.registerTool(this.controllerTool)};c.RemoteControl.prototype=Object.create(b.Extension.prototype);c.RemoteControl.prototype.constructor=c.RemoteControl;c.RemoteControl.prototype.createUI=function(){var a=this,b=this.viewer;this.controlButton=new d.Button("toolbar-remoteControlTool");this.controlButton.setToolTip("Pair with controller device");
this.controlButton.onClick=function(){this.getState()===d.Button.State.INACTIVE?(a.connect(),this.setState(d.Button.State.ACTIVE)):(a.disconnect(),this.setState(d.Button.State.INACTIVE))};this.controlButton.setIcon("adsk-icon-game-controller");b.modelTools.addControl(this.controlButton);this.panel=new Autodesk.Viewing.UI.DockingPanel(b.container,"remote-panel","Remote Control");this.panel.width=300;this.panel.height=375;this.panel.container.style.width=this.panel.width+"px";this.panel.container.style.height=
this.panel.height+"px";this.panel.container.style.top=(window.innerHeight-this.panel.height)/2+"px";this.panel.container.style.left=(window.innerWidth-this.panel.width)/2+"px";this.panel.body=document.createElement("div");this.panel.body.classList.add("body");this.panel.container.appendChild(this.panel.body);this.panel.body.innerHTML='<p>Go to this link:</p>\n<p><a class="url" target="_blank" href="#">Link</a></p>\n<p>or</p>\n<p>Scan the QR code with your device:</p>\n<img class="qr-img" src="">';
this.panel.link=this.panel.container.querySelector(".url");this.panel.code=this.panel.container.querySelector(".code");this.panel.qrImg=this.panel.container.querySelector(".qr-img")};c.RemoteControl.prototype.load=function(){function a(d){b.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a);c.createUI()}var b=this.viewer,c=this;b.modelTools&&0<b.modelTools.getNumberOfControls()?c.createUI():b.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a);return!0};c.RemoteControl.prototype.unload=
function(){var a=this.viewer;this.p2p.hangup();this.client.disconnect();a.toolController.deactivateTool(this.controllerTool.getName());this.panel&&(this.panel.setVisible(!1),this.panel=null);if(this.controlButton)try{a.modelTools.removeControl(this.controlButton),this.controlButton=null}catch(b){stderr("RemoteControlReceiver - Failed to remove controlButton"),this.controlButton=null}return!0};c.RemoteControl.prototype.addCrosshair=function(){this.crosshair=stringToDOM('<div id="remote-crosshair"><div class="crosshair-v"></div><div class="crosshair-h"></div></div>');
this.viewer.canvasWrap.appendChild(this.crosshair)};c.RemoteControl.prototype.removeCrosshair=function(){this.crosshair&&this.crosshair.remove()};c.RemoteControl.prototype.connect=function(a){if(this.client.isConnected())console.log("RemoteControl already connected");else{var b=this,c=this.viewer;b.client.addEventListener("connectSucceeded",function(c){function d(){m&&m.setVisible(!1);b.p2p.removeEventListener(d);b.addCrosshair()}stderr("connect succeeded");c=c.data.id+"rc";b.client.join(c);c=(LMV_RESOURCE_ROOT.length?
LMV_RESOURCE_ROOT:window.location.origin+"/")+"rc.html?sessionId="+c+"&env="+f.env;var k="http://chart.googleapis.com/chart?cht=qr&chs=200x200&choe=UTF-8&chld=H|0&chl="+escape(c),m=b.panel;m&&(m.link.href=c,m.link.innerHTML=(LMV_RESOURCE_ROOT.length?LMV_RESOURCE_ROOT:window.location.origin+"/")+"rc.html",m.qrImg.src=k,m.setVisible(!0));b.p2p.addEventListener("dataChannelAdded",d);a&&a instanceof Function&&a(c)});c.navigation.toPerspective();b.client.connect();c.toolController.activateTool(b.controllerTool.getName())}};
c.RemoteControl.prototype.disconnect=function(){this.p2p.hangup();this.client.disconnect();this.viewer.toolController.deactivateTool(this.controllerTool.getName());this.removeCrosshair()};b.theExtensionManager.registerExtension("Autodesk.Viewing.RemoteControl",c.RemoteControl)})();"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.Section");Autodesk.Viewing.Extensions.Section.SectionExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b);this.viewer=a};
Autodesk.Viewing.Extensions.Section.SectionExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype);Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.constructor=Autodesk.Viewing.Extensions.Section.SectionExtension;
Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.load=function(){function a(){c.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a);b.createUI()}var b=this,c=this.viewer;this.tool=new Autodesk.Viewing.Extensions.Section.SectionTool(c);c.toolController.registerTool(this.tool);this.tool.setOutlineColor({r:1,g:0,b:0});var f=c.getToolbar?c.getToolbar(!0):void 0;f?(f=f.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID))&&0<f.getNumberOfControls()?a():c.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,
a):c.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a);c.addEventListener(Autodesk.Viewing.RESET_EVENT,function(){b.tool&&b.tool.resetSection()});this.HOTKEYS_ID="Autodesk.Section.Hotkeys";Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.HOTKEYS_ID,[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){return b.enableSectionTool(!1)}}]);return!0};
Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.enableSectionTool=function(a){if(this.tool){var b=this.viewer.toolController,c=this.tool.isActive();if(a&&!c)return b.activateTool("section"),this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0;if(!a&&c)return b.deactivateTool("section"),this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0}return!1};
Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.createUI=function(){var a=this.viewer;this.sectionToolButton=new Autodesk.Viewing.UI.ComboButton("toolbar-sectionTool");this.sectionToolButton.setToolTip("Section analysis");this.sectionToolButton.setIcon("adsk-icon-section-analysis");this.createSubmenu(this.sectionToolButton);var a=a.getToolbar(!1).getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID),b=a.getControl("toolbar-resetTool");b?a.addControl(this.sectionToolButton,{index:a.indexOf(b.getId())}):
a.addControl(this.sectionToolButton,{index:0})};
Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.createSubmenu=function(a){function b(a,b){return function(){var c=a.getState();c===g.Button.State.INACTIVE?(a.setState(g.Button.State.ACTIVE),f.enableSectionTool(!0),!1===this instanceof g.ComboButton?f.tool.setSection(b):f.tool.attachControl(!0)):c===g.Button.State.ACTIVE&&(a.setState(g.Button.State.INACTIVE),f.enableSectionTool(!1))}}function c(){var a=function(){var a=new THREE.Vector3;return function(b,c,d){a.subVectors(b,c);return a.lengthSq()<
d}}(),b=new THREE.Vector3(1,0,0),g=new THREE.Vector3(0,1,0),h=new THREE.Vector3(0,0,1),m=d.autocam.getWorldRightVector(),p=d.autocam.getWorldUpVector(),t=d.autocam.getWorldFrontVector();a(p,b,1E-4)?f.sectionYButton.setIcon("adsk-icon-plane-x"):a(p,h,1E-4)?f.sectionYButton.setIcon("adsk-icon-plane-z"):f.sectionYButton.setIcon("adsk-icon-plane-y");a(m,g,1E-4)?f.sectionXButton.setIcon("adsk-icon-plane-y"):a(m,h,1E-4)?f.sectionXButton.setIcon("adsk-icon-plane-z"):f.sectionXButton.setIcon("adsk-icon-plane-x");
a(t,b,1E-4)?f.sectionZButton.setIcon("adsk-icon-plane-x"):a(t,g,1E-4)?f.sectionZButton.setIcon("adsk-icon-plane-y"):f.sectionZButton.setIcon("adsk-icon-plane-z");d.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,c)}var f=this,d=this.viewer,g=Autodesk.Viewing.UI,h=this.sectionXButton=new g.Button("toolbar-sectionTool-x");h.setToolTip("Add X plane");h.setIcon("adsk-icon-plane-x");h.onClick=b(h,"X");a.addControl(h);h=this.sectionYButton=new g.Button("toolbar-sectionTool-y");h.setToolTip("Add Y plane");
h.setIcon("adsk-icon-plane-y");h.onClick=b(h,"Y");a.addControl(h);h=this.sectionZButton=new g.Button("toolbar-sectionTool-z");h.setToolTip("Add Z plane");h.setIcon("adsk-icon-plane-z");h.onClick=b(h,"Z");a.addControl(h);h=this.sectionBoxButton=new g.Button("toolbar-sectionTool-box");h.setToolTip("Add box");h.setIcon("adsk-icon-box");h.onClick=b(h,"BOX");a.addControl(h);d.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,c)};
Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.destroyUI=function(){var a=this.viewer.getToolbar(!1);if(a&&(a=a.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID))&&this.sectionToolButton){var b=a.getControl("toolbar-inspectSubMenu");b?b.removeControl(this.sectionToolButton.getId()):a.removeControl(this.sectionToolButton.getId());this.sectionToolButton=null}};
Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.unload=function(){var a=this.viewer;Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID);this.destroyUI();a.toolController.deregisterTool(this.tool);this.tool=null;return!0};Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Section",Autodesk.Viewing.Extensions.Section.SectionExtension);AutodeskNamespace("Autodesk.Viewing.Extensions.Section");
Autodesk.Viewing.Extensions.Section.SectionTool=function(a,b){function c(){p.invalidate(!1,!1,!0)}function f(){F&&F.update();C&&C.update()}function d(a){init_three_triangulator();init_three_intersector();var b=p.model.getData().instanceTree;if(b){var c=p.modelQueue().getFragmentList(),d=p.sceneAfter.getObjectByName("section");d&&p.sceneAfter.remove(d);d=new THREE.Object3D;d.name="section";p.sceneAfter.add(d);var f=new THREE.Object3D;d.add(f);var g=new THREE.Object3D;d.add(g);var h=Autodesk.Viewing.Private,
k=h.Intersector.makePlaneBasis(a),l=(new THREE.Matrix4).getInverse(k),d=p.matman().create2DMaterial(null,{skipCircles:!0,skipEllipticals:!0},!1,!1),m=p.matman().findMaterial(null,d);m.transparent=!0;var n=new THREE.Box3;p.getVisibleBounds(!0).size().length();b.enumNodeChildren(p.model.getRootId(),function(d){var q=[],t;b.enumNodeFragments(d,function(b){c.getWorldBounds(b,n);h.Intersector.intersectBoxPlane(a,n)&&(t=c.getVizmesh(b),h.Intersector.intersectMeshPlane(a,t,q))},!1);if(q.length){var r=new THREE.Box3;
h.Intersector.convertToPlaneCoords(k,q,r);var w=new VertexBufferBuilder(!1,8*q.length),C=0|63.875*t.material.color.r,A=0|63.875*t.material.color.g,z=0|63.875*t.material.color.b,D=4278190080|z<<16|A<<8|C,B=new h.Triangulator.ContourSet(q,r);B.snapEdges();B.stitchContours();for(r=0;r<B.contours.length;r++)for(var E=B.contours[r],C=0|255.5*Math.random(),A=0|255.5*Math.random(),z=0|255.5*Math.random(),C=1;C<E.length;C++)A=B.pts[E[C-1]],z=B.pts[E[C]],w.addSegment(A.x,A.y,z.x,z.y,.01,D,d,0);r={mesh:w.toMesh()};
h.SvfLoader.meshToGeometry(r);r=r.geometry;r.streamingDraw=!0;r.streamingIndex=!0;r=new THREE.Mesh(r,m);r.matrix.copy(l);r.matrixAutoUpdate=!1;r.frustumCulled=!1;g.add(r);w=new h.Triangulator.TriangulatedSurface(B);if(w.indices.length){B=new THREE.BufferGeometry;D=new Float32Array(3*w.pts.length);for(r=0;r<w.pts.length;r++)D[3*r]=w.pts[r].x,D[3*r+1]=w.pts[r].y,D[3*r+2]=0;B.addAttribute("position",new THREE.BufferAttribute(D,3));E=(D=t.material.packedNormals)?new Uint16Array(2*w.pts.length):new Float32Array(3*
w.pts.length);for(r=0;r<w.pts.length;r++)D?(E[2*r]=32767.5*(0/Math.PI+1)|0,E[2*r+1]=65535):(E[3*r]=0,E[3*r+1]=0,E[3*r+2]=1);B.addAttribute("normal",new THREE.BufferAttribute(E,D?2:3));D&&(B.attributes.normal.bytesPerItem=2,B.attributes.normal.normalize=!0);r=new Uint16Array(w.indices.length);r.set(w.indices);B.addAttribute("index",new THREE.BufferAttribute(r,1));B.streamingDraw=!0;B.streamingIndex=!0;r=p.matman().cloneMaterial(t.material);r.packedNormals=D;r.cutplanes=null;r.side=THREE.FrontSide;
r.depthTest=!0;r.map=null;r.bumpMap=null;r.specularMap=null;r.transparent=!1;r.depthWrite=!0;r.hatchPattern=!0;r.needsUpdate=!0;w=Math.tan((t.material.id+2)*Math.PI*.125);r.hatchParams=new THREE.Vector2(w,10);r=new THREE.Mesh(B,r);r.matrix.copy(l);r.matrixAutoUpdate=!1;r.dbId=d;f.add(r)}}},!0)}}function g(a,b){b=b||p.getVisibleBounds();var c=new THREE.Vector3(0,0,1),c=(new THREE.Quaternion).setFromUnitVectors(c,a.normal),d=a.projectPoint(b.max),f=a.projectPoint(b.min),g=c.clone().inverse();d.applyQuaternion(g);
f.applyQuaternion(g);d=(new THREE.Vector3).subVectors(d,f);d=new THREE.PlaneBufferGeometry(d.x,d.y);f=new THREE.MeshBasicMaterial({opacity:.1,color:16777215,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1,transparent:!0});d=new H.SectionMesh(d,f,a);f=a.projectPoint(b.center());d.position.copy(f);d.quaternion.multiply(c);return d}function h(){k(function(a){if(a instanceof H.SectionMesh&&0<a.connectivity.length){for(var b=(new THREE.Matrix4).getInverse(a.matrixWorld),c=new THREE.Vector3,d=a.geometry.getAttribute("position"),
f=0;f<d.length/d.itemSize;f++){var g=a.connectivity[f];null!==K(a.plane,g[0],g[1],c)&&(c.applyMatrix4(b),d.setXYZ(f,c.x,c.y,c.z))}d.needsUpdate=!0}})}function k(a){for(var b=0;b<w.length;b++)w[b].traverse(a)}function l(){k(function(a){a instanceof H.SectionMesh&&a.update()});d((new THREE.Plane).setComponents(E[0].x,E[0].y,E[0].z,E[0].w));p.setCutPlanes(E)}function n(a){for(var b=0;b<w.length;b++)w[b].visible=a;z!==a&&c();z=a}function q(a,b){a.attach(b);a.setPosition(b.position)}function m(a){var b=
new THREE.Group;a=new THREE.Plane(a,0);a=g(a);b.add(a);E.push(a.planeVec);w.push(b);p.addOverlay("gizmo",b);q(F,a);F.showRotationGizmos(!0);A=F.getPicker();l()}var p=a.impl,t=["section"],r=!1,B=!1,z=!0,F,C,w=[],E=[],A=[],D="",I=null,G=!1,H=Autodesk.Viewing.Extensions.Section;init_TransformGizmos();init_SectionMesh();var K=function(){var a=new THREE.Matrix3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(f,g,h,k){a.set(f.normal.x,f.normal.y,f.normal.z,g.normal.x,g.normal.y,
g.normal.z,h.normal.x,h.normal.y,h.normal.z);var l=a.determinant();if(0===l)return null;b.crossVectors(g.normal,h.normal).multiplyScalar(-f.constant);c.crossVectors(h.normal,f.normal).multiplyScalar(-g.constant);d.crossVectors(f.normal,g.normal).multiplyScalar(-h.constant);return(k||new THREE.Vector3).copy(b).add(c).add(d).divideScalar(l)}}(),J=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Raycaster,d=p.camera;return function(f,g){var h=p.canvas.getBoundingClientRect(),k=(f.clientX-
h.left)/h.width*2-1,h=2*-((f.clientY-h.top)/h.height)+1;d.isPerspective?(a.set(k,h,.5),a.unproject(d),c.set(d.position,a.sub(d.position).normalize())):(a.set(k,h,-1),a.unproject(d),b.set(0,0,-1),c.set(a,b.transformDirection(d.matrixWorld)));k=c.intersectObjects(g,!0);return k[0]?k[0]:!1}}();this.isActive=function(){return r};this.setSection=function(a){this.clearSection();switch(a){case "X":var b=new THREE.Vector3(1,0,0);m(b);break;case "Y":b=new THREE.Vector3(0,1,0);m(b);break;case "Z":b=new THREE.Vector3(0,
0,1);m(b);break;case "BOX":for(var c=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,-1)],b=[[[1,2],[1,5],[2,4],[4,5]],[[3,5],[0,5],[2,3],[0,2]],[[1,3],[0,1],[3,4],[0,4]],[[1,5],[1,2],[4,5],[2,4]],[[2,3],[0,2],[3,5],[0,5]],[[0,1],[3,1],[0,4],[3,4]]],d=new THREE.Group,f=p.getVisibleBounds(),h=f.center(),f=new THREE.Box3(f.min,h),k=[],n=[],r=0;r<c.length;r++){var t=new THREE.Plane(c[r],-1*h.dot(c[r]));
k.push(t);if(2<r){var z=t.orthoPoint(f.max),B=t.orthoPoint(f.min),z=(new THREE.Vector3).subVectors(z,B);t.constant-=z.length()}t=g(t,f);d.add(t);n.push(t);E.push(t.planeVec)}for(r=0;r<n.length;r++)for(t=n[r],c=b[r],h=0;h<c.length;h++){for(var z=[],B=c[h],G=0;G<B.length;G++)z.push(k[B[G]]);t.connectivity.push(z)}w.push(d);p.addOverlay("gizmo",d);C.setSize(f.getBoundingSphere().radius/6);q(F,w[0].children[0]);q(C,w[0]);F.showRotationGizmos(!1);A=F.getPicker().concat(C.getPicker());l()}D=a};this.clearSection=
function(){F&&F.detach();for(C&&C.detach();0<E.length;)E.pop();for(;0<w.length;){var a=w.pop();p.removeOverlay("gizmo",a)}(a=p.sceneAfter.getObjectByName("section"))&&p.sceneAfter.remove(a);p.setCutPlanes()};this.isPlaneOn=function(){return z};this.showPlane=function(a){n(a)};this.attachControl=function(a){a?(q(F,w[0].children[0]),"BOX"===D&&q(C,w[0])):(F.detach(),C.detach())};this.setOutlineColor=function(a){p.setCutPlanesOutlineColor(a)};this.resetSection=function(){this.setSection(D)};this.getNames=
function(){return t};this.getName=function(){return t[0]};this.register=function(){};this.deregister=function(){this.clearSection();G&&(p.removeOverlay("gizmo",F),F.removeEventListener("change",c),F=null,p.removeOverlay("gizmo",C),C.removeEventListener("change",c),C=null,p.removeOverlayScene("gizmo"),a.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,f),G=!1)};this.activate=function(b){G||(F=new THREE.TransformControls(p.camera,p.canvas,"transrotate"),F.addEventListener("change",c),F.setSnap(Math.PI/
2,Math.PI/36),C=new THREE.TransformControls(p.camera,p.canvas,"translate"),C.addEventListener("change",c),void 0===p.overlayScenes.gizmo&&p.createOverlayScene("gizmo"),p.addOverlay("gizmo",F),p.addOverlay("gizmo",C),a.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,f),G=!0);r=!0;B=!1;E=E||[];0<E.length&&a.setCutPlanes(E);n(!0)};this.deactivate=function(a){B=r=!1;(a=p.sceneAfter.getObjectByName("section"))&&p.sceneAfter.remove(a);n(!1);p.setCutPlanes();F.detach();C.detach()};this.update=function(){return!1};
this.handleSingleClick=function(a,b){var d=J(a.pointers?a.pointers[0]:a,w);return d?(q(F,d.object),c(),!0):!1};this.handleDoubleClick=function(a,b){return!1};this.handleSingleTap=function(a){return this.handleSingleClick(a,0)};this.handleDoubleTap=function(a){return!1};this.handleKeyDown=function(a,b){return!1};this.handleKeyUp=function(a,b){return!1};this.handleWheelInput=function(a){return!1};this.handleButtonDown=function(a,b){B=!0;return C.onPointerDown(a)?!0:F.onPointerDown(a)};this.handleButtonUp=
function(a,b){B=!1;return C.onPointerUp(a)?!0:F.onPointerUp(a)};this.handleMouseMove=function(a){if(B){if(C.onPointerMove(a))return l(),F.update(),!0;if(F.onPointerMove(a))return l(),h(),!0}if("touch"!==a.pointerType){k(function(a){a instanceof H.SectionMesh&&(a.material.opacity=a.materialOpacity)});var b=a.pointers?a.pointers[0]:a,c=J(b,w);c&&(c.object.material.opacity=.2);b=c||J(b,A)?!0:!1;F.visible=b;C.visible=void 0!==C.object&&b;n(b)}return C.onPointerHover(a)?!0:F.onPointerHover(a)};this.handleGesture=
function(a){switch(a.type){case "dragstart":return I="drag",this.handleButtonDown(a,0);case "dragmove":return"drag"===I?this.handleMouseMove(a):!1;case "dragend":if("drag"===I)return I=null,this.handleButtonUp(a,0)}return!1};this.handleBlur=function(a){return!1};this.handleResize=function(){};this.handlePressHold=function(a){return!0}};
function init_SectionMesh(){Autodesk.Viewing.Extensions.Section.SectionMesh||(Autodesk.Viewing.Extensions.Section.SectionMesh=function(a,b,c){THREE.Mesh.call(this,a,b,!1);this.plane=c;this.planeVec=new THREE.Vector4(c.normal.x,c.normal.y,c.normal.z,c.constant);this.materialColor=this.material.color.clone();this.materialOpacity=this.material.opacity;this.connectivity=[]},Autodesk.Viewing.Extensions.Section.SectionMesh.prototype=Object.create(THREE.Mesh.prototype),Autodesk.Viewing.Extensions.Section.SectionMesh.prototype.constructor=
Autodesk.Viewing.Extensions.Section.SectionMesh,Autodesk.Viewing.Extensions.Section.SectionMesh.prototype.update=function(){this.plane.normal.set(0,0,1);this.plane.normal.applyQuaternion(this.quaternion);var a=this.plane.normal,b=-1*this.getWorldPosition().dot(a);this.planeVec.set(a.x,a.y,a.z,b);this.plane.constant=b})}
function init_TransformGizmos(){var a=function(a){THREE.MeshBasicMaterial.call(this);this.depthWrite=this.depthTest=!1;this.side=THREE.FrontSide;this.transparent=!0;this.setValues(a);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(a){a?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};a.prototype=Object.create(THREE.MeshBasicMaterial.prototype);var b=function(a){THREE.LineBasicMaterial.call(this);
this.depthWrite=this.depthTest=!1;this.transparent=!0;this.linewidth=1;this.setValues(a);this.oldColor=this.color.clone();this.oldOpacity=this.opacity;this.highlight=function(a){a?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};b.prototype=Object.create(THREE.LineBasicMaterial.prototype);void 0===THREE.PolyhedronGeometry&&(THREE.PolyhedronGeometry=function(a,b,c,d){function f(a){var b=a.normalize().clone();b.index=t.vertices.push(b)-
1;var c=Math.atan2(a.z,-a.x)/2/Math.PI+.5;a=Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))/Math.PI+.5;b.uv=new THREE.Vector2(c,1-a);return b}function q(a,b,c){var d=new THREE.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);t.faces.push(d);A.copy(a).add(b).add(c).divideScalar(3);d=Math.atan2(A.z,-A.x);t.faceVertexUvs[0].push([p(a.uv,a,d),p(b.uv,b,d),p(c.uv,c,d)])}function m(a,b){var c=Math.pow(2,b);Math.pow(4,b);for(var d=f(t.vertices[a.a]),g=f(t.vertices[a.b]),h=f(t.vertices[a.c]),k=[],
l=0;l<=c;l++){k[l]=[];for(var m=f(d.clone().lerp(h,l/c)),p=f(g.clone().lerp(h,l/c)),r=c-l,w=0;w<=r;w++)k[l][w]=0==w&&l==c?m:f(m.clone().lerp(p,w/r))}for(l=0;l<c;l++)for(w=0;w<2*(c-l)-1;w++)d=Math.floor(w/2),0==w%2?q(k[l][d+1],k[l+1][d],k[l][d]):q(k[l][d+1],k[l+1][d+1],k[l+1][d])}function p(a,b,c){0>c&&1===a.x&&(a=new THREE.Vector2(a.x-1,a.y));0===b.x&&0===b.z&&(a=new THREE.Vector2(c/2/Math.PI+.5,a.y));return a.clone()}THREE.Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:a,
indices:b,radius:c,detail:d};c=c||1;d=d||0;for(var t=this,r=0,B=a.length;r<B;r+=3)f(new THREE.Vector3(a[r],a[r+1],a[r+2]));a=this.vertices;for(var z=[],F=r=0,B=b.length;r<B;r+=3,F++){var C=a[b[r]],w=a[b[r+1]],E=a[b[r+2]];z[F]=new THREE.Face3(C.index,w.index,E.index,[C.clone(),w.clone(),E.clone()])}for(var A=new THREE.Vector3,r=0,B=z.length;r<B;r++)m(z[r],d);r=0;for(B=this.faceVertexUvs[0].length;r<B;r++)b=this.faceVertexUvs[0][r],d=b[0].x,a=b[1].x,z=b[2].x,F=Math.max(d,Math.max(a,z)),C=Math.min(d,
Math.min(a,z)),.9<F&&.1>C&&(.2>d&&(b[0].x+=1),.2>a&&(b[1].x+=1),.2>z&&(b[2].x+=1));r=0;for(B=this.vertices.length;r<B;r++)this.vertices[r].multiplyScalar(c);this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype));void 0===THREE.OctahedronGeometry&&(THREE.OctahedronGeometry=function(a,b){this.parameters={radius:a,detail:b};THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,
1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],a,b);this.type="OctahedronGeometry";this.parameters={radius:a,detail:b}},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype));void 0===THREE.TorusGeometry&&(THREE.TorusGeometry=function(a,b,c,d,f){THREE.Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:f};a=a||100;b=b||40;c=c||8;d=d||6;f=f||2*Math.PI;for(var q=new THREE.Vector3,m=[],
p=[],t=0;t<=c;t++)for(var r=0;r<=d;r++){var B=r/d*f,z=t/c*Math.PI*2;q.x=a*Math.cos(B);q.y=a*Math.sin(B);var F=new THREE.Vector3;F.x=(a+b*Math.cos(z))*Math.cos(B);F.y=(a+b*Math.cos(z))*Math.sin(B);F.z=b*Math.sin(z);this.vertices.push(F);m.push(new THREE.Vector2(r/d,t/c));p.push(F.clone().sub(q).normalize())}for(t=1;t<=c;t++)for(r=1;r<=d;r++)a=(d+1)*t+r-1,b=(d+1)*(t-1)+r-1,f=(d+1)*(t-1)+r,q=(d+1)*t+r,B=new THREE.Face3(a,b,q,[p[a].clone(),p[b].clone(),p[q].clone()]),this.faces.push(B),this.faceVertexUvs[0].push([m[a].clone(),
m[b].clone(),m[q].clone()]),B=new THREE.Face3(b,f,q,[p[b].clone(),p[f].clone(),p[q].clone()]),this.faces.push(B),this.faceVertexUvs[0].push([m[b].clone(),m[f].clone(),m[q].clone()]);this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype));var c=function(a,b,c){var d=new THREE.Geometry;c=c?c:1;for(var f=0;f<=64*c;++f)"x"==b&&d.vertices.push((new THREE.Vector3(0,Math.cos(f/32*Math.PI),Math.sin(f/32*Math.PI))).multiplyScalar(a)),"y"==b&&d.vertices.push((new THREE.Vector3(Math.cos(f/
32*Math.PI),0,Math.sin(f/32*Math.PI))).multiplyScalar(a)),"z"==b&&d.vertices.push((new THREE.Vector3(Math.sin(f/32*Math.PI),Math.cos(f/32*Math.PI),0)).multiplyScalar(a));return d},f=function(a,b,c,d,f,q){var m=new THREE.Geometry;a=new THREE.Mesh(new THREE.CylinderGeometry(a,b,c,d,f,q));a.position.y=.5;a.updateMatrix();m.merge(a.geometry,a.matrix);return m},d=function(a){var b=new THREE.Geometry;"X"===a?b.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0)):"Y"===a?b.vertices.push(new THREE.Vector3(0,
0,0),new THREE.Vector3(0,1,0)):"Z"===a&&b.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));return b};THREE.TransformGizmo=function(){var a=this;this.init=function(){THREE.Object3D.call(this);this.handles=new THREE.Object3D;this.pickers=new THREE.Object3D;this.planes=new THREE.Object3D;this.highlights=new THREE.Object3D;this.hemiPicker=new THREE.Object3D;this.subPickers=new THREE.Object3D;this.add(this.handles);this.add(this.pickers);this.add(this.planes);this.add(this.highlights);
this.add(this.hemiPicker);this.add(this.subPickers);var a=new THREE.PlaneBufferGeometry(50,50,2,2),b=new THREE.MeshBasicMaterial({wireframe:!0});b.side=THREE.DoubleSide;a={XY:new THREE.Mesh(a,b),YZ:new THREE.Mesh(a,b),XZ:new THREE.Mesh(a,b),XYZE:new THREE.Mesh(a,b)};this.activePlane=a.XYZE;a.YZ.rotation.set(0,Math.PI/2,0);a.XZ.rotation.set(-Math.PI/2,0,0);for(var c in a)a[c].name=c,this.planes.add(a[c]),this.planes[c]=a[c],a[c].visible=!1;this.setupGizmos();this.activeMode="";this.traverse(function(a){if(a instanceof
THREE.Mesh){a.updateMatrix();var b=new THREE.Geometry;a.geometry instanceof THREE.BufferGeometry&&(a.geometry=(new THREE.Geometry).fromBufferGeometry(a.geometry));b.merge(a.geometry,a.matrix);a.geometry=b;a.position.set(0,0,0);a.rotation.set(0,0,0);a.scale.set(1,1,1)}})};this.hide=function(){this.traverse(function(a){a.visible=!1})};this.show=function(){this.traverse(function(b){b.visible=!0;if(b.parent==a.pickers||b.parent==a.hemiPicker)b.visible=!1;b.parent==a.planes&&(b.visible=!1)});this.activePlane.visible=
!1};this.highlight=function(a){this.traverse(function(b){b.material&&b.material.highlight&&(b.name==a?b.material.highlight(!0):b.material.highlight(!1))})};this.setupGizmos=function(){var a=function(a,b){for(var c in a)for(var d=a[c].length;d--;){var f=a[c][d][0],g=a[c][d][1],h=a[c][d][2],r=a[c][d][3];f.name=c;g&&f.position.set(g[0],g[1],g[2]);h&&f.rotation.set(h[0],h[1],h[2]);r&&(f.visble=r);b.add(f)}};this.setHandlePickerGizmos();a(this.handleGizmos,this.handles);a(this.pickerGizmos,this.pickers);
a(this.highlightGizmos,this.highlights);a(this.hemiPickerGizmos,this.hemiPicker);a(this.subPickerGizmos,this.subPickers);this.hide();this.show()}};THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype);THREE.TransformGizmo.prototype.update=function(a,b){var c=new THREE.Vector3(0,0,0),d=new THREE.Vector3(0,1,0),f=new THREE.Matrix4;this.traverse(function(q){q.name&&(-1!=q.name.search("E")?q.quaternion.setFromRotationMatrix(f.lookAt(b,c,d)):-1==q.name.search("X")&&-1==q.name.search("Y")&&
-1==q.name.search("Z")||q.quaternion.setFromEuler(a))})};THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this);this.setHandlePickerGizmos=function(){var c=f(0,.05,.2,12,1,!1),h=d("X"),k=d("Y"),l=d("Z");this.handleGizmos={X:[[new THREE.Mesh(c,new a({color:15805484})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(h,new b({color:15805484}))]],Y:[[new THREE.Mesh(c,new a({color:768011})),[0,.5,0]],[new THREE.Line(k,new b({color:768011}))]],Z:[[new THREE.Mesh(c,new a({color:2895089})),[0,
0,.5],[Math.PI/2,0,0]],[new THREE.Line(l,new b({color:2895089}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new a({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16711935,opacity:.25})),
[.15,0,.15],[-Math.PI/2,0,0]]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),new a({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,
.4),new a({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new a({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new a({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]};this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(1.2,1.2,1.2),new a({color:255})),[.5,.5,.5],null,!1]]}};this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld)));
"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ));"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ));"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ));"XYZ"==a&&(this.activePlane=this.planes.XYZE);"XY"==a&&(this.activePlane=this.planes.XY);"YZ"==a&&(this.activePlane=this.planes.YZ);"XZ"==a&&(this.activePlane=this.planes.XZ);this.hide();
this.show()};this.init()};THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this);this.setHandlePickerGizmos=function(){this.handleGizmos={RX:[[new THREE.Line(c(1,"x",.5),new b({color:16711680}))]],RY:[[new THREE.Line(c(1,"y",.5),new b({color:65280}))]],RZ:[[new THREE.Line(c(1,"z",.5),new b({color:255}))]],RE:[[new THREE.Line(c(1.25,"z",1),new b({color:65535}))]],RXYZE:[[new THREE.Line(c(1,"z",1),new b({color:16711935}))]]};
this.pickerGizmos={RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],RZ:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],RE:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),new a({color:65535,opacity:.25}))]],RXYZE:[[new THREE.Mesh(new THREE.TorusGeometry(1,
.12,2,24),new a({color:16711935,opacity:.25}))]]}};this.setActivePlane=function(a){"RE"==a&&(this.activePlane=this.planes.XYZE);"RX"==a&&(this.activePlane=this.planes.YZ);"RY"==a&&(this.activePlane=this.planes.XZ);"RZ"==a&&(this.activePlane=this.planes.XY);this.hide();this.show()};this.update=function(a,b){THREE.TransformGizmo.prototype.update.apply(this,arguments);var c=new THREE.Matrix4,d=new THREE.Euler(0,0,1),f=new THREE.Quaternion,q=new THREE.Vector3(1,0,0),m=new THREE.Vector3(0,1,0),p=new THREE.Vector3(0,
0,1),t=new THREE.Quaternion,r=new THREE.Quaternion,B=new THREE.Quaternion,z=b.clone();d.copy(this.planes.XY.rotation);f.setFromEuler(d);c.makeRotationFromQuaternion(f).getInverse(c);z.applyMatrix4(c);this.traverse(function(a){f.setFromEuler(d);"RX"==a.name&&(t.setFromAxisAngle(q,Math.atan2(-z.y,z.z)),f.multiplyQuaternions(f,t),a.quaternion.copy(f));"RY"==a.name&&(r.setFromAxisAngle(m,Math.atan2(z.x,z.z)),f.multiplyQuaternions(f,r),a.quaternion.copy(f));"RZ"==a.name&&(B.setFromAxisAngle(p,Math.atan2(z.y,
z.x)),f.multiplyQuaternions(f,B),a.quaternion.copy(f))})};this.init()};THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoTranslateRotate=function(){THREE.TransformGizmo.call(this);var b=this;this.setHandlePickerGizmos=function(){var b=f(0,.05,.2,12,1,!1);(new THREE.Geometry).vertices.push(new THREE.Vector3(0,0,-.1),new THREE.Vector3(0,0,.1),new THREE.Vector3(-.1,0,0),new THREE.Vector3(.1,0,0));this.handleGizmos={Z:[[new THREE.Mesh(b,new a({color:16777215})),
[0,0,.25],[Math.PI/2,0,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.015,.015,.6,4,1,!1),new a({color:16777215})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new a({color:16711680})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.015,60,1,!1),new a({color:16711680})),[0,0,1],[Math.PI/2,0,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new a({color:255})),[0,0,0],[Math.PI/2,0,.35*
Math.PI]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.01,60,1,!1),new a({color:255})),[0,0,1]]]};this.pickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new a({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new a({color:16711680,opacity:.25})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new a({color:255,opacity:.25})),[0,0,0],[Math.PI/
2,0,.35*Math.PI]]]};this.subPickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new a({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]]};this.highlightGizmos={Z:[],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new a({color:16711680,opacity:1})),[0,0,0],[0,-Math.PI/2,-Math.PI/2],!1]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new a({color:255,opacity:1})),[0,0,0],[Math.PI/2,0,0],!1]]};this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.SphereGeometry(1.2,
8,8,0,Math.PI),new a({color:255})),null,null,!1]]}};this.setActivePlane=function(a,b){if("translate"==this.activeMode){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld)));"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ));"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ));"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=
this.planes.YZ))}else"rotate"==this.activeMode&&("RX"==a&&(this.activePlane=this.planes.YZ),"RY"==a&&(this.activePlane=this.planes.XZ),"RZ"==a&&(this.activePlane=this.planes.XY));this.hide();this.show()};this.update=function(a,b){if("translate"==this.activeMode)THREE.TransformGizmo.prototype.update.apply(this,arguments);else if("rotate"==this.activeMode){THREE.TransformGizmo.prototype.update.apply(this,arguments);var c=new THREE.Matrix4,d=new THREE.Euler(0,0,1),f=new THREE.Quaternion,g=new THREE.Vector3(1,
0,0),p=new THREE.Vector3(0,1,0),t=new THREE.Vector3(0,0,1),r=new THREE.Quaternion,B=new THREE.Quaternion,z=new THREE.Quaternion,F=b.clone();d.copy(this.planes.XY.rotation);f.setFromEuler(d);c.makeRotationFromQuaternion(f).getInverse(c);F.applyMatrix4(c);this.traverse(function(a){f.setFromEuler(d);"RX"==a.name&&(r.setFromAxisAngle(g,Math.atan2(-F.y,F.z)),f.multiplyQuaternions(f,r),a.quaternion.copy(f));"RY"==a.name&&(B.setFromAxisAngle(p,Math.atan2(F.x,F.z)),f.multiplyQuaternions(f,B),a.quaternion.copy(f));
"RZ"==a.name&&(z.setFromAxisAngle(t,Math.atan2(F.y,F.x)),f.multiplyQuaternions(f,z),a.quaternion.copy(f))})}};this.show=function(){this.traverse(function(a){if(null==b.parent||b.parent.useAllPickers||a.parent!=b.handles)a.visible=!0;a.material&&(a.material.opacity=a.material.oldOpacity);if(a.parent==b.pickers||a.parent==b.hemiPicker||a.parent==b.subPickers)a.visible=!1;if(a.parent==b.planes||a.parent==b.highlights)a.visible=!1});this.activePlane.visible=!1};this.highlight=function(a){this.traverse(function(c){if(c.material&&
c.material.highlight)if(c.name==a){if(c.parent==b.highlights||c.parent==b.handles)c.visible=!0;c.material.highlight(!0)}else c.material.highlight(!1),c.material.opacity=.1})};this.init()};THREE.TransformGizmoTranslateRotate.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this);this.setHandlePickerGizmos=function(){var c=f(.125,.125,.125),h=d("X"),k=d("Y"),l=d("Z");this.handleGizmos={X:[[new THREE.Mesh(c,new a({color:16711680})),
[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(h,new b({color:16711680}))]],Y:[[new THREE.Mesh(c,new a({color:65280})),[0,.5,0]],[new THREE.Line(k,new b({color:65280}))]],Z:[[new THREE.Mesh(c,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(l,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new a({color:16777215,opacity:.25}))]]};this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:16711680,opacity:.25})),[.6,0,0],[0,
0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),new a({color:16777215,opacity:.25}))]]}};this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld)));"X"==a&&(this.activePlane=this.planes.XY,
Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ));"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ));"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ));"XYZ"==a&&(this.activePlane=this.planes.XYZE);this.hide();this.show()};this.init()};THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype);THREE.TransformControls=function(a,b,c){function d(c,f){var k=
b.getBoundingClientRect(),l=(c.clientX-k.left)/k.width*2-1,k=2*-((c.clientY-k.top)/k.height)+1;a.isPerspective?(w.set(l,k,.5),w.unproject(a),C.set(a.position,w.sub(a.position).normalize())):(w.set(l,k,-1),w.unproject(a),E.set(0,0,-1),C.set(w,E.transformDirection(a.matrixWorld)));l=C.intersectObjects(f,!0);return l[0]?l[0]:!1}THREE.Object3D.call(this);b=void 0!==b?b:document;this.gizmo={};switch(c){case "translate":this.gizmo[c]=new THREE.TransformGizmoTranslate;break;case "rotate":this.gizmo[c]=new THREE.TransformGizmoRotate;
break;case "transrotate":this.gizmo[c]=new THREE.TransformGizmoTranslateRotate;break;case "scale":this.gizmo[c]=new THREE.TransformGizmoScale}this.add(this.gizmo[c]);this.gizmo[c].hide();this.object=void 0;this.snap=null;this.snapDelta=0;this.space="world";this.size=1;this.axis=null;this.useAllPickers=!0;this.unitX=new THREE.Vector3(1,0,0);this.unitY=new THREE.Vector3(0,1,0);this.unitZ=new THREE.Vector3(0,0,1);this.normal=new THREE.Vector3(0,0,1);if("transrotate"===c){var f=new THREE.Geometry;f.vertices.push(new THREE.Vector3(0,
0,0),new THREE.Vector3(0,0,1));var q=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1});this.startLine=new THREE.Line(f,q);f=new THREE.Geometry;q=new THREE.LineBasicMaterial({color:16770563,linewidth:2,depthTest:!1});f.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));this.endLine=new THREE.Line(f,q);f=new THREE.Geometry;q=new THREE.LineDashedMaterial({color:0,linewidth:1,depthTest:!1});f.vertices.push(new THREE.Vector3(0,-1,0),new THREE.Vector3(0,1,0));this.centerLine=
new THREE.Line(f,q);q=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/centerMarker_X.png"));q.magFilter=q.minFilter=THREE.NearestFilter;f=new THREE.CircleGeometry(.1,32);q=new THREE.MeshBasicMaterial({opacity:1,side:THREE.DoubleSide,transparent:!0,map:q});this.centerMark=new THREE.Mesh(f,q);this.centerMark.rotation.set(Math.PI/2,0,0);this.ticks={};q=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/cardinalPoint.png"));q.magFilter=
q.minFilter=THREE.NearestFilter;q=new THREE.MeshBasicMaterial({depthTest:!1,opacity:1,transparent:!0,side:THREE.DoubleSide,map:q});this.ticks.RX=new THREE.Object3D;f=new THREE.PlaneBufferGeometry(.12,.25);f=new THREE.Mesh(f,q);f.position.set(0,0,-1.275);f.rotation.set(Math.PI/2,Math.PI/2,0);this.ticks.RX.add(f);f=f.clone();f.position.set(0,1.275,0);f.rotation.set(0,Math.PI/2,0);this.ticks.RX.add(f);f=f.clone();f.position.set(0,0,1.275);f.rotation.set(0,Math.PI/2,Math.PI/2);this.ticks.RX.add(f);f=
f.clone();f.position.set(0,-1.275,0);f.rotation.set(0,Math.PI/2,0);this.ticks.RX.add(f);this.ticks.RY=new THREE.Object3D;f=f.clone();f.position.set(0,0,-1.275);f.rotation.set(Math.PI/2,0,0);this.ticks.RY.add(f);f=f.clone();f.position.set(-1.275,0,0);f.rotation.set(Math.PI/2,0,Math.PI/2);this.ticks.RY.add(f);f=f.clone();f.position.set(0,0,1.275);f.rotation.set(Math.PI/2,0,0);this.ticks.RY.add(f);f=f.clone();f.position.set(1.275,0,0);f.rotation.set(Math.PI/2,0,Math.PI/2);this.ticks.RY.add(f)}var m=
this,p=!1,t=c,r={type:"change"},B={type:"mouseDown"},z={type:"mouseUp",mode:t},F={type:"objectChange"},C=new THREE.Raycaster,w=new THREE.Vector3,E=new THREE.Vector3,A=new THREE.Vector3,D=new THREE.Vector3,I=new THREE.Vector3,G=new THREE.Vector3,H=1,K=new THREE.Matrix4,J=new THREE.Vector3,M=new THREE.Matrix4,L=new THREE.Vector3,P=new THREE.Quaternion,S=new THREE.Vector3,Y=new THREE.Vector3,U=new THREE.Vector3,Z=new THREE.Quaternion,da=new THREE.Quaternion,V=new THREE.Quaternion,O=new THREE.Quaternion,
ca=new THREE.Quaternion,W=new THREE.Vector3,N=new THREE.Vector3,ea=new THREE.Matrix4,ba=new THREE.Matrix4,fa=new THREE.Vector3,X=new THREE.Vector3,ia=new THREE.Euler,aa=new THREE.Matrix4,R=new THREE.Vector3;new THREE.Euler;this.attach=function(a){m.object=a;this.gizmo[t].show();m.update();m.updateUnitVectors()};this.detach=function(a){m.object=void 0;this.axis=null;this.gizmo[t].hide()};this.setMode=function(a){t=a?a:t;"scale"==t&&(m.space="local");this.gizmo[t].show();this.update();m.dispatchEvent(r)};
this.getPicker=function(){return m.gizmo[t].hemiPicker.children};this.setPosition=function(a){this.object.position.copy(a);this.update()};this.setNormal=function(a){P.setFromUnitVectors(this.normal,a);this.unitX.applyQuaternion(P);this.unitY.applyQuaternion(P);this.unitZ.applyQuaternion(P);this.normal.copy(a);this.object&&this.object.quaternion.multiply(P);this.update()};this.setSnap=function(a,b){m.snap=a;m.snapDelta=b};this.setSize=function(a){m.size=a;this.update();m.dispatchEvent(r)};this.setSpace=
function(a){m.space=a;this.update();m.dispatchEvent(r)};this.update=function(c){if(void 0!==m.object){m.object.updateMatrixWorld();X.setFromMatrixPosition(m.object.matrixWorld);ia.setFromRotationMatrix(M.extractRotation(m.object.matrixWorld));a.updateMatrixWorld();R.setFromMatrixPosition(a.matrixWorld);this.position.copy(X);this.quaternion.setFromEuler(ia);this.normal.set(0,0,1);this.normal.applyEuler(ia);var d=X.distanceTo(R),d=2*Math.tan(a.fov*Math.PI/180/2)*d,f=b.getBoundingClientRect();H=100*
d/f.height;this.scale.set(H,H,H);c&&this.gizmo[t].highlight(m.axis)}};this.updateUnitVectors=function(){this.unitX.set(1,0,0);this.unitY.set(0,1,0);this.unitZ.set(0,0,1);this.unitX.applyEuler(ia);this.unitY.applyEuler(ia);this.unitZ.applyEuler(ia)};this.showRotationGizmos=function(a){for(var b=this.gizmo[t].handles.children,c=0;c<b.length;c++){var d=b[c];d.visible=!0;-1!==d.name.search("R")&&(d.visible=a)}this.useAllPickers=a};this.onPointerHover=function(a){if(void 0===m.object||!0===p)return!1;
a=d(a.pointers?a.pointers[0]:a,m.useAllPickers?m.gizmo[t].pickers.children:m.gizmo[t].subPickers.children);var b=null,c="";a&&(b=a.object.name,c=-1!=b.search("R")?"rotate":"translate");m.axis!==b&&(m.axis=b,m.gizmo[t].activeMode=c,m.update(!0),m.dispatchEvent(r));null===m.axis&&m.gizmo[t].show();return a?!0:!1};this.onPointerDown=function(b){if(void 0===m.object||!0===p)return!1;var c=b.pointers?b.pointers[0]:b;if("touch"===b.pointerType){b=d(c,m.useAllPickers?m.gizmo[t].pickers.children:m.gizmo[t].subPickers.children);
var f=null,h="";b&&(f=b.object.name,h=-1!=f.search("R")?"rotate":"translate");m.axis!==f&&(m.axis=f,m.gizmo[t].activeMode=h)}b=null;if(0===c.button||void 0===c.button)if(b=d(c,m.useAllPickers?m.gizmo[t].pickers.children:m.gizmo[t].subPickers.children))if(m.dispatchEvent(B),m.axis=b.object.name,m.update(),J.copy(a.position).sub(X).normalize(),m.gizmo[t].setActivePlane(m.axis,J),(c=d(c,[m.gizmo[t].activePlane]))&&D.copy(c.point),W.copy(m.object.position),N.copy(m.object.scale),ea.extractRotation(m.object.matrix),
aa.extractRotation(m.object.matrixWorld),m.object.parent?(ba.extractRotation(m.object.parent.matrixWorld),fa.setFromMatrixScale(M.getInverse(m.object.parent.matrixWorld))):(ba.extractRotation(m.object.matrixWorld),fa.setFromMatrixScale(M.getInverse(m.object.matrixWorld))),"transrotate"===t&&"rotate"===m.gizmo[t].activeMode){m.startLine.geometry.vertices[0].set(0,0,0).applyMatrix4(m.matrixWorld);m.startLine.geometry.vertices[1].set(0,0,1).applyMatrix4(m.matrixWorld);m.startLine.geometry.verticesNeedUpdate=
!0;m.parent.add(m.startLine);var k=m.object.geometry.getAttribute("position"),c=(new THREE.Vector3).fromAttribute(k,0).applyMatrix4(m.object.matrixWorld),f=(new THREE.Vector3).fromAttribute(k,1).applyMatrix4(m.object.matrixWorld),h=(new THREE.Vector3).fromAttribute(k,2).applyMatrix4(m.object.matrixWorld),k=(new THREE.Vector3).fromAttribute(k,3).applyMatrix4(m.object.matrixWorld);"RX"===m.axis?(c.lerp(h,.5),f.lerp(k,.5),k=c.distanceTo(f),m.centerLine.material.dashSize=k/15,m.centerLine.material.gapSize=
k/30,m.centerLine.geometry.vertices[0].copy(c),m.centerLine.geometry.vertices[1].copy(f)):(c.lerp(f,.5),h.lerp(k,.5),k=c.distanceTo(h),m.centerLine.material.dashSize=k/15,m.centerLine.material.gapSize=k/30,m.centerLine.geometry.vertices[0].copy(c),m.centerLine.geometry.vertices[1].copy(h));m.centerLine.geometry.computeLineDistances();m.centerLine.geometry.verticesNeedUpdate=!0;m.parent.add(m.centerLine);m.ticks[m.axis].position.copy(m.position);m.ticks[m.axis].quaternion.copy(m.quaternion);m.ticks[m.axis].scale.copy(m.scale);
m.parent.add(m.ticks[m.axis])}p=!0;return b?!0:!1};this.onPointerMove=function(a){if(void 0===m.object||null===m.axis||!1===p)return!1;(a=d(a.pointers?a.pointers[0]:a,[m.gizmo[t].activePlane]))&&A.copy(a.point);var b=m.gizmo[t].activeMode;if("translate"==b){if(A.sub(D),A.multiply(fa),"local"==m.space&&(A.applyMatrix4(M.getInverse(aa)),S.copy(this.unitX),Y.copy(this.unitY),U.copy(this.unitZ),L.set(0,0,0),-1!=m.axis.search("X")&&(S.multiplyScalar(A.dot(this.unitX)),L.add(S)),-1!=m.axis.search("Y")&&
(Y.multiplyScalar(A.dot(this.unitY)),L.add(Y)),-1!=m.axis.search("Z")&&(U.multiplyScalar(A.dot(this.unitZ)),L.add(U)),A.copy(L),A.applyMatrix4(ea),m.object.position.copy(W),m.object.position.add(A)),"world"==m.space||-1!=m.axis.search("XYZ"))S.copy(this.unitX),Y.copy(this.unitY),U.copy(this.unitZ),L.set(0,0,0),-1!=m.axis.search("X")&&(S.multiplyScalar(A.dot(this.unitX)),L.add(S)),-1!=m.axis.search("Y")&&(Y.multiplyScalar(A.dot(this.unitY)),L.add(Y)),-1!=m.axis.search("Z")&&(U.multiplyScalar(A.dot(this.unitZ)),
L.add(U)),A.copy(L),A.applyMatrix4(M.getInverse(ba)),m.object.position.copy(W),m.object.position.add(A)}else if("scale"==b)A.sub(D),A.multiply(fa),"local"==m.space&&("XYZ"==m.axis?(H=1+A.y/50,m.object.scale.x=N.x*H,m.object.scale.y=N.y*H,m.object.scale.z=N.z*H):(A.applyMatrix4(M.getInverse(aa)),"X"==m.axis&&(m.object.scale.x=N.x*(1+A.x/50)),"Y"==m.axis&&(m.object.scale.y=N.y*(1+A.y/50)),"Z"==m.axis&&(m.object.scale.z=N.z*(1+A.z/50))));else if("rotate"==b){A.sub(X);A.multiply(fa);L.copy(D).sub(X);
L.multiply(fa);if("RE"==m.axis){A.applyMatrix4(M.getInverse(K));L.applyMatrix4(M.getInverse(K));I.set(Math.atan2(A.z,A.y),Math.atan2(A.x,A.z),Math.atan2(A.y,A.x));G.set(Math.atan2(L.z,L.y),Math.atan2(L.x,L.z),Math.atan2(L.y,L.x));P.setFromRotationMatrix(M.getInverse(ba));var c=I.z-G.z;null!==m.snap&&(b=Math.round(c/m.snap)*m.snap,Math.abs(b-c)<m.snapDelta&&(c=b));ca.setFromAxisAngle(J,c);Z.setFromRotationMatrix(aa);P.multiplyQuaternions(P,ca);P.multiplyQuaternions(P,Z);m.object.quaternion.copy(P)}else if("RXYZE"==
m.axis){c=A.clone().cross(L).normalize();P.setFromRotationMatrix(M.getInverse(ba));var f=-A.clone().angleTo(L);null!==m.snap&&(b=Math.round(f/m.snap)*m.snap,Math.abs(b-f)<m.snapDelta&&(f=b));da.setFromAxisAngle(c,f);Z.setFromRotationMatrix(aa);P.multiplyQuaternions(P,da);P.multiplyQuaternions(P,Z);m.object.quaternion.copy(P)}else if("local"==m.space){A.applyMatrix4(M.getInverse(aa));L.applyMatrix4(M.getInverse(aa));var b=A.dot(this.unitX),c=A.dot(this.unitY),f=A.dot(this.unitZ),g=L.dot(this.unitX),
h=L.dot(this.unitY),k=L.dot(this.unitZ);I.set(Math.atan2(f,c),Math.atan2(b,f),Math.atan2(c,b));G.set(Math.atan2(k,h),Math.atan2(g,k),Math.atan2(h,g));f=I.x-G.x;g=I.y-G.y;c=I.z-G.z;null!==m.snap&&(-1!=m.axis.search("X")&&(b=Math.round(f/m.snap)*m.snap,Math.abs(b-f)<m.snapDelta&&(f=b)),-1!=m.axis.search("Y")&&(b=Math.round(g/m.snap)*m.snap,Math.abs(b-g)<m.snapDelta&&(g=b)),-1!=m.axis.search("Z")&&(b=Math.round(c/m.snap)*m.snap,Math.abs(b-c)<m.snapDelta&&(c=b)));da.setFromAxisAngle(this.unitX,f);V.setFromAxisAngle(this.unitY,
g);O.setFromAxisAngle(this.unitZ,c);Z.setFromRotationMatrix(ea);"RX"==m.axis&&Z.multiplyQuaternions(Z,da);"RY"==m.axis&&Z.multiplyQuaternions(Z,V);"RZ"==m.axis&&Z.multiplyQuaternions(Z,O);m.object.quaternion.copy(Z)}else"world"==m.space&&(b=A.dot(this.unitX),c=A.dot(this.unitY),f=A.dot(this.unitZ),g=L.dot(this.unitX),h=L.dot(this.unitY),k=L.dot(this.unitZ),I.set(Math.atan2(f,c),Math.atan2(b,f),Math.atan2(c,b)),G.set(Math.atan2(k,h),Math.atan2(g,k),Math.atan2(h,g)),P.setFromRotationMatrix(M.getInverse(ba)),
f=I.x-G.x,g=I.y-G.y,c=I.z-G.z,null!==m.snap&&(-1!=m.axis.search("X")&&(b=Math.round(f/m.snap)*m.snap,Math.abs(b-f)<m.snapDelta&&(f=b)),-1!=m.axis.search("Y")&&(b=Math.round(g/m.snap)*m.snap,Math.abs(b-g)<m.snapDelta&&(g=b)),-1!=m.axis.search("Z")&&(b=Math.round(c/m.snap)*m.snap,Math.abs(b-c)<m.snapDelta&&(c=b))),da.setFromAxisAngle(this.unitX,f),V.setFromAxisAngle(this.unitY,g),O.setFromAxisAngle(this.unitZ,c),Z.setFromRotationMatrix(aa),"RX"==m.axis&&P.multiplyQuaternions(P,da),"RY"==m.axis&&P.multiplyQuaternions(P,
V),"RZ"==m.axis&&P.multiplyQuaternions(P,O),P.multiplyQuaternions(P,Z),m.object.quaternion.copy(P));"transrotate"===t&&(m.add(m.endLine),m.add(m.centerMark))}m.object.matrixAutoUpdate=!0;m.update(!0);m.dispatchEvent(r);m.dispatchEvent(F);return a?!0:!1};this.onPointerUp=function(a){p&&null!==m.axis&&(z.mode=t,m.dispatchEvent(z));p=!1;this.gizmo[t].show();this.updateUnitVectors();"transrotate"===t&&"rotate"===this.gizmo[t].activeMode&&(this.remove(this.endLine),this.remove(this.centerMark),this.parent.remove(this.centerLine),
this.parent.remove(this.startLine),this.parent.remove(this.ticks[this.axis]));return!1}};THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype)}
(function(a,b){var c=a.document;"undefined"===typeof a.alertify&&(a.alertify=new function(){var f={},d=!1,g=[],h,k,l,n,q,m,p,t,r,B,z,F;F=function(){var a,d,f=!1,g=c.createElement("fakeelement"),h={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend",transition:"transitionend"};for(a in h)if(g.style[a]!==b){d=h[a];f=!0;break}return{type:d,supported:f}};h=function(a){return c.getElementById(a)};f={labels:{ok:"OK",cancel:"Cancel"},delay:5E3,buttonReverse:!1,
buttonFocus:"ok",transition:b,addListeners:function(a){var b="undefined"!==typeof l,d="undefined"!==typeof k,f="undefined"!==typeof z,g="",h=this,m,p,r,t,B;m=function(b){"undefined"!==typeof b.preventDefault&&b.preventDefault();r(b);"undefined"!==typeof z&&(g=z.value);"function"===typeof a&&("undefined"!==typeof z?a(!0,g):a(!0));return!1};p=function(b){"undefined"!==typeof b.preventDefault&&b.preventDefault();r(b);"function"===typeof a&&a(!1);return!1};r=function(a){h.hide();h.unbind(c.body,"keyup",
t);h.unbind(n,"focus",B);b&&h.unbind(l,"click",m);d&&h.unbind(k,"click",p)};t=function(a){var b=a.keyCode;(32===b&&!f||f&&13===b)&&m(a);27===b&&d&&p(a)};B=function(a){f?z.focus():!d||h.buttonReverse?l.focus():k.focus()};this.bind(n,"focus",B);this.bind(q,"focus",B);b&&this.bind(l,"click",m);d&&this.bind(k,"click",p);this.bind(c.body,"keyup",t);this.transition.supported||this.setFocus()},bind:function(a,b,c){"function"===typeof a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+
b,c)},handleErrors:function(){if("undefined"!==typeof a.onerror){var b=this;a.onerror=function(a,c,d){b.error("["+a+" on line "+d+" of "+c+"]",0)};return!0}return!1},appendButtons:function(a,b){return this.buttonReverse?b+a:a+b},build:function(a){var b=a.type,c=a.message,d=a.cssClass||"";a='<div class="alertify-dialog"><a id="alertify-resetFocusBack" class="alertify-resetFocus" href="#">Reset Focus</a>';"none"===f.buttonFocus&&(a+='<a href="#" id="alertify-noneFocus" class="alertify-hidden"></a>');
"prompt"===b&&(a+='<div id="alertify-form">');a+='<article class="alertify-inner">';a+='<p class="alertify-message">{{message}}</p>'.replace("{{message}}",c);"prompt"===b&&(a+='<div class="alertify-text-wrapper"><input type="text" class="alertify-text" id="alertify-text"></div>');a+='<nav class="alertify-buttons">{{buttons}}</nav>';a+="</article>";"prompt"===b&&(a+="</div>");a+='<a id="alertify-resetFocus" class="alertify-resetFocus" href="#">Reset Focus</a>';a+="</div>";switch(b){case "confirm":a=
a.replace("{{buttons}}",this.appendButtons('<button class="alertify-button alertify-button-cancel" id="alertify-cancel">{{cancel}}</button>','<button class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>'));a=a.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case "prompt":a=a.replace("{{buttons}}",this.appendButtons('<button class="alertify-button alertify-button-cancel" id="alertify-cancel">{{cancel}}</button>','<button type="submit" class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>'));
a=a.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case "alert":a=a.replace("{{buttons}}",'<button class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>'),a=a.replace("{{ok}}",this.labels.ok)}r.className="alertify alertify-"+b+" "+d;t.className="alertify-cover";return a},close:function(a,b){var c=b&&!isNaN(b)?+b:this.delay,d=this,f,g;this.bind(a,"click",function(){f(a)});g=function(a){a.stopPropagation();d.unbind(this,d.transition.type,g);B.removeChild(this);
B.hasChildNodes()||(B.className+=" alertify-logs-hidden")};f=function(a){"undefined"!==typeof a&&a.parentNode===B&&(d.transition.supported?(d.bind(a,d.transition.type,g),a.className+=" alertify-log-hide"):(B.removeChild(a),B.hasChildNodes()||(B.className+=" alertify-logs-hidden")))};0!==b&&setTimeout(function(){f(a)},c)},dialog:function(a,b,f,h,k){p=c.activeElement;var l=function(){B&&null!==B.scrollTop&&t&&null!==t.scrollTop||l()};if("string"!==typeof a)throw Error("message must be a string");if("string"!==
typeof b)throw Error("type must be a string");if("undefined"!==typeof f&&"function"!==typeof f)throw Error("fn must be a function");this.init();l();g.push({type:b,message:a,callback:f,placeholder:h,cssClass:k});d||this.setup();return this},extend:function(a){if("string"!==typeof a)throw Error("extend method must have exactly one paramter");return function(b,c){this.log(b,a,c);return this}},hide:function(){var a,b=this;g.splice(0,1);0<g.length?this.setup(!0):(d=!1,a=function(c){c.stopPropagation();
b.unbind(r,b.transition.type,a)},this.transition.supported?(this.bind(r,this.transition.type,a),r.className="alertify alertify-hide alertify-hidden"):r.className="alertify alertify-hide alertify-hidden alertify-isHidden",t.className="alertify-cover alertify-cover-hidden",p.focus())},init:function(){c.createElement("nav");c.createElement("article");c.createElement("section");null==h("alertify-cover")&&(t=c.createElement("div"),t.setAttribute("id","alertify-cover"),t.className="alertify-cover alertify-cover-hidden",
c.body.appendChild(t));null==h("alertify")&&(d=!1,g=[],r=c.createElement("section"),r.setAttribute("id","alertify"),r.setAttribute("style","z-index : 999999999"),r.className="alertify alertify-hidden",c.body.appendChild(r));null==h("alertify-logs")&&(B=c.createElement("section"),B.setAttribute("id","alertify-logs"),B.className="alertify-logs alertify-logs-hidden",c.body.appendChild(B));c.body.setAttribute("tabindex","0");this.transition=F()},log:function(a,b,c){var d=function(){B&&null!==B.scrollTop||
d()};this.init();d();B.className="alertify-logs";this.notify(a,b,c);return this},notify:function(a,b,d){var f=c.createElement("article");f.className="alertify-log"+("string"===typeof b&&""!==b?" alertify-log-"+b:"");f.innerHTML=a;B.appendChild(f);setTimeout(function(){f.className+=" alertify-log-show"},50);this.close(f,d)},set:function(a){var b;if("object"!==typeof a&&a instanceof Array)throw Error("args must be an object");for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},setFocus:function(){z?(z.focus(),
z.select()):m.focus()},setup:function(a){var c=g[0],p=this,t;d=!0;t=function(a){a.stopPropagation();p.setFocus();p.unbind(r,p.transition.type,t)};this.transition.supported&&!a&&this.bind(r,this.transition.type,t);r.innerHTML=this.build(c);n=h("alertify-resetFocus");q=h("alertify-resetFocusBack");l=h("alertify-ok")||b;k=h("alertify-cancel")||b;m="cancel"===f.buttonFocus?k:"none"===f.buttonFocus?h("alertify-noneFocus"):l;z=h("alertify-text")||b;h("alertify-form");"string"===typeof c.placeholder&&""!==
c.placeholder&&(z.value=c.placeholder);a&&this.setFocus();this.addListeners(c.callback)},unbind:function(a,b,c){"function"===typeof a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)}};return{alert:function(a,b,c){f.dialog(a,"alert",b,"",c);return this},confirm:function(a,b,c){f.dialog(a,"confirm",b,"",c);return this},extend:f.extend,init:f.init,log:function(a,b,c){f.log(a,b,c);return this},prompt:function(a,b,c,d){f.dialog(a,"prompt",b,c,d);return this},success:function(a,
b){f.log(a,"success",b);return this},error:function(a,b){f.log(a,"error",b);return this},set:function(a){f.set(a)},hide:function(a){f.hide(a)},labels:f.labels,debug:f.handleErrors}})})(this);AutodeskNamespace("Autodesk.Viewing");AutodeskNamespace("Autodesk.Viewing.Private");var auth=null,VIEWING_URL,ACM_SESSION_URL,PROTEIN_ROOT=null,PRISM_ROOT=null,LOCALIZATION_REL_PATH="",LMV_VIEWER_VERSION="1.2.15",LMV_RESOURCE_VERSION=null,LMV_RESOURCE_ROOT="";
function stderr(){ENABLE_TRACE&&console.log.apply(console,arguments)}
(function(){var a=Autodesk.Viewing.Private;a.env=null;a.logger=null;a.refreshToken=null;a.docItemId=null;a.token={getAccessToken:null,tokenRefreshInterval:null};a.memoryOptimizedLoading=!0;a.GPU_MEMORY_LIMIT=268435456;a.GPU_OBJECT_LIMIT=1E4;a.FRAGS_PERSISTENT_COUNT=1E4;a.FRAGS_PERSISTENT_MAX_COUNT=8E5;a.onDemandLoading=a.memoryOptimizedLoading;a.cullGeometryOnLoading=a.onDemandLoading;a.pageOutGeometryEnabled=a.onDemandLoading;a.PAGEOUT_SUCCESS=0;a.PAGEOUT_FAIL=1;a.PAGEOUT_NONE=2;a.GEOMS_COUNT_LIMIT=
3E5;a.PAGEOUT_PERCENTAGE=.35;a.GEOMS_PAGEOUT_COUNT=a.GEOMS_COUNT_LIMIT*a.PAGEOUT_PERCENTAGE;a.assets=[];a.offline=!1;a.offlineResourcePrefix=null;a.EnvironmentConfigurations={Local:{VIEWING:"https://viewing-dev.api.autodesk.com/viewingservice/v1",ACM:"https://developer-dev.api.autodesk.com/oss-ext/v1/acmsessions",LOGGING:"rtc-dev.api.autodesk.com",RTC:"https://rtc-dev.api.autodesk.com:443"},Development:{VIEWING:"https://viewing-dev.api.autodesk.com/viewingservice/v1",ACM:"https://developer-dev.api.autodesk.com/oss-ext/v1/acmsessions",
LOGGING:"rtc-dev.api.autodesk.com",RTC:"https://rtc-dev.api.autodesk.com:443"},Staging:{VIEWING:"https://viewing-staging.api.autodesk.com/viewingservice/v1",ACM:"https://developer-stg.api.autodesk.com/oss-ext/v1/acmsessions",LOGGING:"rtc-stg.api.autodesk.com",RTC:"https://rtc-stg.api.autodesk.com:443"},Production:{VIEWING:"https://viewing.api.autodesk.com/viewingservice/v1",ACM:"https://developer.api.autodesk.com/oss-ext/v1/acmsessions",LOGGING:"rtc.api.autodesk.com",RTC:"https://rtc.api.autodesk.com:443"},
AutodeskDevelopment:{VIEWING:"https://developer-dev.api.autodesk.com/viewingservice/v1",ACM:"https://developer-dev.api.autodesk.com/oss-ext/v1/acmsessions",LOGGING:"rtc-dev.api.autodesk.com",RTC:"https://rtc-dev.api.autodesk.com:443"},AutodeskStaging:{VIEWING:"https://developer-stg.api.autodesk.com/viewingservice/v1",ACM:"https://developer-stg.api.autodesk.com/oss-ext/v1/acmsessions",LOGGING:"rtc-stg.api.autodesk.com",RTC:"https://rtc-stg.api.autodesk.com:443"},AutodeskProduction:{VIEWING:"https://developer.api.autodesk.com/viewingservice/v1",
ACM:"https://developer.api.autodesk.com/oss-ext/v1/acmsessions",LOGGING:"rtc.api.autodesk.com",RTC:"https://rtc.api.autodesk.com:443"}};a.initializeEnvironmentVariable=function(b){var c;b&&b.env&&(c=b.env);c||(c=a.getParameterByName("env"));b&&b.offlineResourcePrefix&&(a.offlineResourcePrefix=b.offlineResourcePrefix);b&&b.offline&&"true"===b.offline&&(a.offline=!0);if(!c)switch(window.location.hostname){case "viewing-dev.api.autodesk.com":c="Development";break;case "viewing-staging.api.autodesk.com":c=
"Staging";break;case "viewing.api.autodesk.com":c="Production";break;case "developer-dev.api.autodesk.com":c="AutodeskDevelopment";break;case "developer-stg.api.autodesk.com":c="AutodeskStaging";break;case "developer.api.autodesk.com":c="AutodeskProduction";break;case "ec2-23-20-101-198.compute-1.amazonaws.com":c="Development";break;case "localhost.autodesk.com":c="Local";break;case "":c="Local";break;case "127.0.0.1":c="Local";break;default:c="AutodeskProduction"}console.log("Host name : "+window.location.hostname);
console.log("Environment initialized as : "+c);a.env=c};a.initializeServiceEndPoints=function(b){var c=a.EnvironmentConfigurations[a.env];VIEWING_URL=c.VIEWING;ACM_SESSION_URL=c.ACM;c=[];b&&b.hasOwnProperty("libraryName")&&c.push(b.libraryName);c.push("viewer3D.min.js");c.push("viewer3D.js");var f,d;for(b=0;b<c.length;b++){d=(d=a.getScript(c[b]))?d.src:"";var g=d.indexOf(c[b]);if(0<=g){f=d.substr(0,g);break}}LMV_RESOURCE_VERSION="v"+LMV_VIEWER_VERSION;(c=a.getParameterByNameFromPath("v",d))&&c.length&&
c!=LMV_RESOURCE_VERSION?(console.warn("Version string mismatch between requested and actual version: "+c+" vs. "+LMV_RESOURCE_VERSION+". Using "+c),LMV_RESOURCE_VERSION=c):c&&c.length||(LMV_RESOURCE_VERSION=null,console.info("No viewer version specified, will implicitly use "+LMV_VIEWER_VERSION));LMV_RESOURCE_ROOT=f||LMV_RESOURCE_ROOT};a.refreshCookie=function(b,c,f){var d=new XMLHttpRequest;d.onload=c;d.onerror=f;d.ontimeout=f;0===a.env.indexOf("Autodesk")?(c=VIEWING_URL.substring(0,VIEWING_URL.indexOf("/viewingservice")),
d.open("POST",c+"/utility/v1/settoken",!0),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d.withCredentials=!0,d.send("access-token="+b),_isIE11&&(a.accessToken=b)):(b={oauth:{token:b}},d.open("POST",VIEWING_URL+"/token",!0),d.setRequestHeader("Content-Type","application/json"),d.withCredentials=!0,d.send(JSON.stringify(b)))};a.initializeAuth=function(b,c){var f=c?c.shouldInitializeAuth:null;f||(f=a.getParameterByName("auth"));if("Local"==a.env&&!f)return setTimeout(b,0),auth=
!1;auth=!0;var d;if(c&&c.accessToken)d=c.accessToken,a.refreshCookie(d,b);else if(c&&c.getAccessToken){var g=function(f,k){d=f;a.refreshCookie(d,a.token.tokenRefreshInterval?null:b);var l=k-60;0>=l&&(l=k);a.token.tokenRefreshInterval=1E3*l;setTimeout(function(){c.getAccessToken(g)},a.token.tokenRefreshInterval)};a.token.getAccessToken=c.getAccessToken;d=c.getAccessToken(g);"string"==typeof d&&d&&a.refreshCookie(d,b)}else d=a.getParameterByName("accessToken"),d||(d="jRnwoX5jKWhkqMM+qemNnsJ/oho=",console.log("Warning : no access token is provided. Use built in token : "+
d)),a.refreshCookie(d,b);return auth};a.refreshTokenAndCookie=function(b,c){var f=null;a.refreshToken&&(f=a.refreshToken());f?a.refreshCookie(f,b,c):c&&c(null)};a.initializeLogger=function(b){a.logger=new a.Logger({endpoint:a.EnvironmentConfigurations[a.env].LOGGING,eventCallback:b?b.eventCallback:void 0})};a.initializeProtein=function(){if((!ENABLE_DEBUG||"Local"!=a.env||auth)&&!a.offline){var b=new XMLHttpRequest;b.open("GET","https://raas-assets.autodesk.com/StaticContent/BaseAddress?family=protein",
!0);b.responseType="json";b.onload=function(a){(a=b.response.url)&&a.length&&(a=a.replace("http://","https://"),PROTEIN_ROOT=a+"/",stderr("Protein root is: "+PROTEIN_ROOT))};b.send();var c=new XMLHttpRequest;c.open("GET","https://raas-assets.autodesk.com/StaticContent/BaseAddress?family=prism",!0);c.responseType="json";c.onload=function(a){(a=c.response.url)&&a.length&&(a=a.replace("http://","https://"),PRISM_ROOT=a+"/",stderr("Prism root is: "+PRISM_ROOT))};c.send()}};a.getAuthObject=function(){return auth};
a.getParameterByName=function(b){return a.getParameterByNameFromPath(b,window.location.href)};a.getParameterByNameFromPath=function(a,c){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var f=(new RegExp("[\\?&]"+a+"=([^&#]*)")).exec(c);return null==f?"":decodeURIComponent(f[1].replace(/\+/g," "))};a.getDemoDocumentURN=function(){var b;switch(a.env){case "Development":b="urn:dXJuOmFkc2suYTM2MGJldGFkZXY6ZnMuZmlsZTplbnRlcnByaXNlLmxtdnRlc3QuRFM1YTczMFFUYmYwMDIyZDA3NTFhYmE5MjZlZDZkMjJlZDY0P3ZlcnNpb249MQ==";
break;case "Staging":b="urn:dXJuOmFkc2suczM6ZGVyaXZlZC5maWxlOlZpZXdpbmdTZXJ2aWNlVGVzdEFwcC91c2Vycy9NaWNoYWVsX0hhbicvTU0zNTAwQXNzZW1ibHkuZHdm";break;case "Production":b="FIXME";break;default:b="https://lmv.rocks/viewer/data/gears/output/bubble.json"}return b};a.setLanguage=function(a,c){var f={lng:a,resGetPath:"res/locales/__lng__/__ns__.json",ns:{namespaces:["allstrings"],defaultNs:"allstrings"},fallbackLng:"en",debug:!1};LOCALIZATION_REL_PATH="res/locales/"+a+"/";Autodesk.Viewing.i18n.init(f,function(a){Autodesk.Viewing.i18n.localize();
c&&c()})};a.initializeLocalization=function(){navigator.language.split("-");a.setLanguage("en")};a.initializeUserInfo=function(b){b&&b.userInfo&&(a.setUserName(b.userInfo.name),b.comment2Token&&(a.comment2Token=b.comment2Token))};a.getScript=function(a){a=a.toLowerCase();var c=document.getElementsByTagName("SCRIPT");if(c&&0<c.length)for(var f=0;f<c.length;++f)if(c[f].src&&-1!==c[f].src.toLowerCase().indexOf(a))return c[f];return null};a.getResourceUrl=function(a){var c=LMV_RESOURCE_VERSION;return LMV_RESOURCE_ROOT+
a+(c?"?v="+c:"")};a.loadDependency=function(b,c,f){"undefined"==typeof window[b]?(b=document.createElement("SCRIPT"),b.src=a.getResourceUrl(c),document.head.appendChild(b),f&&(b.onload=f)):f&&f()};Autodesk.Viewing.Initializer=function(b,c){a.WEBGL_HELP_LINK=b?b.webGLHelpLink:null;a.initializeEnvironmentVariable(b);a.initializeServiceEndPoints(b);a.initializeProtein();a.initWorkerScript();a.loadDependency("THREE","three.min.js",function(){THREE.warn=function(){stderr.apply(stderr,arguments)};init_three_dds_loader();
a.initializeLogger(b);a.initializeAuth(c,b);a.initializeLocalization();a.initializeUserInfo(b)})}})();
